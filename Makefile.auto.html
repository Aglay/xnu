<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Makefile</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">Makefile&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">#
</span><span class="enscript-comment"># Copyright (C) 1999-2013 Apple Inc. All rights reserved.
</span><span class="enscript-comment">#
</span>
ifndef VERSDIR
export VERSDIR := $(<span class="enscript-reference">shell /bin/pwd</span>)
endif

ifndef SRCROOT
export SRCROOT := $(<span class="enscript-reference">shell /bin/pwd</span>)
endif
ifndef OBJROOT
export OBJROOT = $(<span class="enscript-reference">SRCROOT</span>)/BUILD/obj
endif
ifndef DSTROOT
export DSTROOT = $(<span class="enscript-reference">SRCROOT</span>)/BUILD/dst
endif
ifndef SYMROOT
export SYMROOT = $(<span class="enscript-reference">SRCROOT</span>)/BUILD/sym
endif

export MakeInc_top=${<span class="enscript-reference">VERSDIR</span>}/makedefs/MakeInc.top
export MakeInc_kernel=${<span class="enscript-reference">VERSDIR</span>}/makedefs/MakeInc.kernel
export MakeInc_cmd=${<span class="enscript-reference">VERSDIR</span>}/makedefs/MakeInc.cmd
export MakeInc_def=${<span class="enscript-reference">VERSDIR</span>}/makedefs/MakeInc.def
export MakeInc_rule=${<span class="enscript-reference">VERSDIR</span>}/makedefs/MakeInc.rule
export MakeInc_dir=${<span class="enscript-reference">VERSDIR</span>}/makedefs/MakeInc.dir

<span class="enscript-comment">#
</span><span class="enscript-comment"># Dispatch non-xnu build aliases to their own build
</span><span class="enscript-comment"># systems. All xnu variants start with MakeInc_top.
</span><span class="enscript-comment">#
</span>
ifeq ($(<span class="enscript-reference">findstring Libsyscall,$(RC_ProjectName)</span>),Libsyscall)

ifeq ($(<span class="enscript-reference">RC_ProjectName</span>),Libsyscall_headers_Sim)
TARGET=-target Libsyscall_headers_Sim
endif

<span class="enscript-keyword">default:</span> install

installhdrs install:
	cd libsyscall ; \
		xcodebuild $@ $(<span class="enscript-reference">TARGET</span>)	\
			<span class="enscript-string">&quot;SRCROOT=$(SRCROOT)/libsyscall&quot;</span>					\
			<span class="enscript-string">&quot;OBJROOT=$(OBJROOT)&quot;</span> 						\
			<span class="enscript-string">&quot;SYMROOT=$(SYMROOT)&quot;</span> 						\
			<span class="enscript-string">&quot;DSTROOT=$(DSTROOT)&quot;</span>						\
			<span class="enscript-string">&quot;SDKROOT=$(SDKROOT)&quot;</span>

<span class="enscript-keyword">clean:</span>

<span class="enscript-keyword">installsrc:</span>
	pax -rw . $(<span class="enscript-reference">SRCROOT</span>)

else ifeq ($(<span class="enscript-reference">RC_ProjectName</span>),libkxld)

include $(<span class="enscript-reference">MakeInc_cmd</span>)

<span class="enscript-keyword">default:</span> install

installhdrs install clean:
	 $(<span class="enscript-reference">MAKE</span>) -C libkern/kxld $@ USE_APPLE_PB_SUPPORT=all

<span class="enscript-keyword">installsrc:</span>
	$(<span class="enscript-reference">_v</span>)$(<span class="enscript-reference">MKDIR</span>) $(<span class="enscript-reference">SRCROOT</span>)
	$(<span class="enscript-reference">_v</span>)$(<span class="enscript-reference">FIND</span>) -x . \! \( \( -name BUILD -o -name .svn -o -name .git -o -name cscope.\* -o -name \*~ \) -prune \) -print0 | $(<span class="enscript-reference">PAX</span>) -rw -p a -d0 $(<span class="enscript-reference">SRCROOT</span>)
	$(<span class="enscript-reference">_v</span>)$(<span class="enscript-reference">CHMOD</span>) -R go+rX $(<span class="enscript-reference">SRCROOT</span>)

else ifeq ($(<span class="enscript-reference">RC_ProjectName</span>),libkxld_host)

include $(<span class="enscript-reference">MakeInc_cmd</span>)

<span class="enscript-keyword">default:</span> install

installhdrs install clean:
	 $(<span class="enscript-reference">MAKE</span>) -C libkern/kxld $@ USE_APPLE_PB_SUPPORT=all PRODUCT_TYPE=ARCHIVE

<span class="enscript-keyword">installsrc:</span>
	$(<span class="enscript-reference">_v</span>)$(<span class="enscript-reference">MKDIR</span>) $(<span class="enscript-reference">SRCROOT</span>)
	$(<span class="enscript-reference">_v</span>)$(<span class="enscript-reference">FIND</span>) -x . \! \( \( -name BUILD -o -name .svn -o -name .git -o -name cscope.\* -o -name \*~ \) -prune \) -print0 | $(<span class="enscript-reference">PAX</span>) -rw -p a -d0 $(<span class="enscript-reference">SRCROOT</span>)
	$(<span class="enscript-reference">_v</span>)$(<span class="enscript-reference">CHMOD</span>) -R go+rX $(<span class="enscript-reference">SRCROOT</span>)

else ifeq ($(<span class="enscript-reference">RC_ProjectName</span>),libkmod)

<span class="enscript-keyword">default:</span> install

installhdrs install:
	cd libkern/kmod ; \
		xcodebuild $@ 	\
			<span class="enscript-string">&quot;SRCROOT=$(SRCROOT)/libkern/kmod&quot;</span>				\
			<span class="enscript-string">&quot;OBJROOT=$(OBJROOT)&quot;</span> 						\
			<span class="enscript-string">&quot;SYMROOT=$(SYMROOT)&quot;</span> 						\
			<span class="enscript-string">&quot;DSTROOT=$(DSTROOT)&quot;</span>						\
			<span class="enscript-string">&quot;SDKROOT=$(SDKROOT)&quot;</span>

<span class="enscript-keyword">clean:</span>

<span class="enscript-keyword">installsrc:</span>
	pax -rw . $(<span class="enscript-reference">SRCROOT</span>)

else ifeq ($(<span class="enscript-reference">RC_ProjectName</span>),xnu_quick_test)

<span class="enscript-keyword">default:</span> install

<span class="enscript-keyword">installhdrs:</span>

<span class="enscript-keyword">install:</span> xnu_quick_test

<span class="enscript-keyword">clean:</span>

<span class="enscript-keyword">installsrc:</span>
	pax -rw . $(<span class="enscript-reference">SRCROOT</span>)

else <span class="enscript-comment"># all other RC_ProjectName
</span>
ifndef CURRENT_BUILD_CONFIG

<span class="enscript-comment"># avoid having to include MakeInc.cmd
</span>ifeq ($(<span class="enscript-reference">RC_XBS</span>),YES)
_v =
else ifeq ($(<span class="enscript-reference">VERBOSE</span>),YES)
_v =
else
_v = @
endif

<span class="enscript-comment">#
</span><span class="enscript-comment"># Setup for parallel sub-makes, taking into account physical and logical
</span><span class="enscript-comment"># CPUs. If the system does not support SMT, use N+1.
</span><span class="enscript-comment"># If MAKEJOBS or -jN is passed on the make line, that takes precedence.
</span><span class="enscript-comment">#
</span>export SYSCTL_HW_PHYSICALCPU := $(<span class="enscript-reference">shell /usr/sbin/sysctl -n hw.physicalcpu</span>)
export SYSCTL_HW_LOGICALCPU  := $(<span class="enscript-reference">shell /usr/sbin/sysctl -n hw.logicalcpu</span>)
ifeq ($(<span class="enscript-reference">SYSCTL_HW_PHYSICALCPU</span>),$(<span class="enscript-reference">SYSCTL_HW_LOGICALCPU</span>))
MAKEJOBS := --jobs=$(<span class="enscript-reference">shell expr $(SYSCTL_HW_PHYSICALCPU) + 1</span>)
else
MAKEJOBS := --jobs=$(<span class="enscript-reference">SYSCTL_HW_LOGICALCPU</span>)
endif

TOP_TARGETS = 								\
	clean 								\
	installsrc 							\
	exporthdrs 							\
	all all_desktop all_embedded					\
	all_release_embedded all_development_embedded 			\
	installhdrs installhdrs_desktop installhdrs_embedded 		\
	installhdrs_release_embedded installhdrs_development_embedded 	\
	install install_desktop install_embedded 			\
	install_release_embedded install_development_embedded 		\
	installopensource 						\
	cscope tags TAGS reindent					\
	help

DEFAULT_TARGET = all

<span class="enscript-comment"># Targets for internal build system debugging
</span>TOP_TARGETS += 						\
	print_exports print_exports_first_build_config	\
	setup 						\
	build						\
	config						\
	install_textfiles				\
	install_config

ifeq ($(<span class="enscript-reference">BUILD_JSON_COMPILATION_DATABASE</span>),1)
MAKEARGS += -B
DEFAULT_TARGET := build
endif

<span class="enscript-keyword">.PHONY:</span> $(<span class="enscript-reference">TOP_TARGETS</span>)

<span class="enscript-keyword">default:</span> $(<span class="enscript-reference">DEFAULT_TARGET</span>)

ifneq ($(<span class="enscript-reference">REMOTEBUILD</span>),)
<span class="enscript-keyword">$(TOP_TARGETS):</span>
	$(<span class="enscript-reference">_v</span>)$(<span class="enscript-reference">VERSDIR</span>)/tools/remote_build.sh _REMOTEBUILD_TARGET=$@ _REMOTEBUILD_MAKE=$(<span class="enscript-reference">MAKE</span>) $(<span class="enscript-reference">if $(filter --,$(MAKEFLAGS)),-,</span>)$(<span class="enscript-reference">MAKEFLAGS</span>)
else
<span class="enscript-keyword">$(TOP_TARGETS):</span>
	$(<span class="enscript-reference">_v</span>)$(<span class="enscript-reference">MAKE</span>) $(<span class="enscript-reference">MAKEARGS</span>) -r $(<span class="enscript-reference">if $(filter -j,$(MAKEFLAGS)),,$(MAKEJOBS)</span>) -f $(<span class="enscript-reference">MakeInc_top</span>) $@
endif

else <span class="enscript-comment"># CURRENT_BUILD_CONFIG
</span>
include $(<span class="enscript-reference">MakeInc_cmd</span>)
include $(<span class="enscript-reference">MakeInc_def</span>)

ALL_SUBDIRS = \
	bsd  \
	iokit \
	osfmk \
	pexpert \
	libkern \
	libsa \
	security \
	config

CONFIG_SUBDIRS = config tools

INSTINC_SUBDIRS = $(<span class="enscript-reference">ALL_SUBDIRS</span>) EXTERNAL_HEADERS
INSTINC_SUBDIRS_X86_64 = $(<span class="enscript-reference">INSTINC_SUBDIRS</span>)
INSTINC_SUBDIRS_X86_64H = $(<span class="enscript-reference">INSTINC_SUBDIRS</span>)
INSTINC_SUBDIRS_ARM = $(<span class="enscript-reference">INSTINC_SUBDIRS</span>)
INSTINC_SUBDIRS_ARM64 = $(<span class="enscript-reference">INSTINC_SUBDIRS</span>)

EXPINC_SUBDIRS = $(<span class="enscript-reference">ALL_SUBDIRS</span>)
EXPINC_SUBDIRS_X86_64 = $(<span class="enscript-reference">EXPINC_SUBDIRS</span>)
EXPINC_SUBDIRS_X86_64H = $(<span class="enscript-reference">EXPINC_SUBDIRS</span>)
EXPINC_SUBDIRS_ARM = $(<span class="enscript-reference">EXPINC_SUBDIRS</span>)
EXPINC_SUBDIRS_ARM64 = $(<span class="enscript-reference">EXPINC_SUBDIRS</span>)

SETUP_SUBDIRS = SETUP

COMP_SUBDIRS_X86_64 = $(<span class="enscript-reference">ALL_SUBDIRS</span>)
COMP_SUBDIRS_X86_64H = $(<span class="enscript-reference">ALL_SUBDIRS</span>)
COMP_SUBDIRS_ARM = $(<span class="enscript-reference">ALL_SUBDIRS</span>)
COMP_SUBDIRS_ARM64 = $(<span class="enscript-reference">ALL_SUBDIRS</span>)

INSTTEXTFILES_SUBDIRS =	\
	bsd

include $(<span class="enscript-reference">MakeInc_kernel</span>)
include $(<span class="enscript-reference">MakeInc_rule</span>)
include $(<span class="enscript-reference">MakeInc_dir</span>)

endif <span class="enscript-comment"># CURRENT_BUILD_CONFIG
</span>
endif <span class="enscript-comment"># all other RC_ProjectName
</span>
installhdrs_libkdd install_libkdd:
	cd libkdd; \
		xcodebuild $(<span class="enscript-reference">subst _libkdd,,$@</span>) 	\
			<span class="enscript-string">&quot;SRCROOT=$(SRCROOT)/libkdd&quot;</span>		\
			<span class="enscript-string">&quot;OBJROOT=$(OBJROOT)&quot;</span> 			\
			<span class="enscript-string">&quot;SYMROOT=$(SYMROOT)&quot;</span> 			\
			<span class="enscript-string">&quot;DSTROOT=$(DSTROOT)&quot;</span>			\
			<span class="enscript-string">&quot;SDKROOT=$(SDKROOT)&quot;</span>


<span class="enscript-comment"># &quot;xnu_quick_test&quot; and &quot;testbots&quot; are targets that can be invoked via a standalone
</span><span class="enscript-comment"># &quot;make xnu_quick_test&quot; or via buildit/XBS with the RC_ProjectName=xnu_quick_test.
</span><span class="enscript-comment"># Define the target here in the outermost scope of the initial Makefile
</span>
<span class="enscript-keyword">xnu_quick_test:</span>
	$(<span class="enscript-reference">MAKE</span>) -C $(<span class="enscript-reference">SRCROOT</span>)/tools/tests					\
		SRCROOT=$(<span class="enscript-reference">SRCROOT</span>)/tools/tests

<span class="enscript-comment"># This target is defined to compile and run xnu_quick_test under testbots
</span><span class="enscript-keyword">testbots:</span>
	$(<span class="enscript-reference">MAKE</span>) -C $(<span class="enscript-reference">SRCROOT</span>)/tools/tests/xnu_quick_test			\
		SRCROOT=$(<span class="enscript-reference">SRCROOT</span>)/tools/tests/xnu_quick_test			\
		MORECFLAGS=<span class="enscript-string">&quot;-DRUN_UNDER_TESTBOTS=1&quot;</span> 				\
		MAKE=$(<span class="enscript-reference">MAKE</span>)							\
		testbots
</pre>
<hr />
</body></html>