<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>RootDomain.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">RootDomain.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 1998-2000 Apple Computer, Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_IOKIT_ROOTDOMAIN_H</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_IOKIT_ROOTDOMAIN_H</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;IOKit/IOService.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;IOKit/pwr_mgt/IOPM.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;IOKit/IOBufferMemoryDescriptor.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/vnode.h&gt;</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
<span class="enscript-type">struct</span> AggressivesRecord;
<span class="enscript-type">struct</span> IOPMMessageFilterContext;
<span class="enscript-type">struct</span> IOPMActions;
<span class="enscript-type">struct</span> IOPMSystemSleepParameters;
class PMSettingObject;
class PMTraceWorker;
class IOPMPowerStateQueue;
class RootDomainUserClient;
class PMAssertionsTracker;

#<span class="enscript-reference">define</span> <span class="enscript-function-name">OBFUSCATE</span>(x) \
    (((((uintptr_t)(x)) &gt;= VM_MIN_KERNEL_AND_KEXT_ADDRESS) &amp;&amp; (((uintptr_t)(x)) &lt; VM_MAX_KERNEL_ADDRESS)) ? \
        ((<span class="enscript-type">void</span> *)(VM_KERNEL_ADDRPERM(x))) : (<span class="enscript-type">void</span> *)(x))

#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*!
 * Types for PM Assertions
 * For creating, releasing, and getting PM assertion levels.
 */</span>

<span class="enscript-comment">/*! IOPMDriverAssertionType
 * A bitfield describing a set of assertions. May be used to specify which assertions
 * to set with &lt;link&gt;IOPMrootDomain::createPMAssertion&lt;/link&gt;; or to query which
 * assertions are set with &lt;link&gt;IOPMrootDomain::releasePMAssertion&lt;/link&gt;.
 */</span>
<span class="enscript-type">typedef</span> uint64_t IOPMDriverAssertionType;

<span class="enscript-comment">/* IOPMDriverAssertionID
 * Drivers may create PM assertions to request system behavior (keep the system awake,
 *  or keep the display awake). When a driver creates an assertion via
 *  &lt;link&gt;IOPMrootDomain::createPMAssertion&lt;/link&gt;, PM returns a handle to
 *  the assertion of type IOPMDriverAssertionID.
 */</span>
<span class="enscript-type">typedef</span> uint64_t IOPMDriverAssertionID;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMUndefinedDriverAssertionID</span>       0

<span class="enscript-comment">/* IOPMDriverAssertionLevel
 * Possible values for IOPMDriverAssertionLevel are &lt;link&gt;kIOPMDriverAssertionLevelOff&lt;/link&gt;
 * and &lt;link&gt;kIOPMDriverAssertionLevelOn&lt;/link&gt;
 */</span>
<span class="enscript-type">typedef</span> uint32_t IOPMDriverAssertionLevel;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMDriverAssertionLevelOff</span>          0
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMDriverAssertionLevelOn</span>           255

<span class="enscript-comment">/*
 * Flags for get/setSleepSupported()
 */</span>
<span class="enscript-type">enum</span> {
    kRootDomainSleepNotSupported    = 0x00000000,
    kRootDomainSleepSupported         = 0x00000001,
    kFrameBufferDeepSleepSupported    = 0x00000002,
    kPCICantSleep                   = 0x00000004
};

<span class="enscript-comment">/*
 *IOPMrootDomain registry property keys
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kRootDomainSupportedFeatures</span>        <span class="enscript-string">&quot;Supported Features&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kRootDomainSleepReasonKey</span>           <span class="enscript-string">&quot;Last Sleep Reason&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kRootDomainSleepOptionsKey</span>          <span class="enscript-string">&quot;Last Sleep Options&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMRootDomainWakeReasonKey</span>        <span class="enscript-string">&quot;Wake Reason&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMRootDomainWakeTypeKey</span>          <span class="enscript-string">&quot;Wake Type&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMRootDomainPowerStatusKey</span>       <span class="enscript-string">&quot;Power Status&quot;</span>

<span class="enscript-comment">/*
 * Possible sleep reasons found under kRootDomainSleepReasonsKey
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMClamshellSleepKey</span>              <span class="enscript-string">&quot;Clamshell Sleep&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMPowerButtonSleepKey</span>            <span class="enscript-string">&quot;Power Button Sleep&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMSoftwareSleepKey</span>               <span class="enscript-string">&quot;Software Sleep&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMOSSwitchHibernationKey</span>         <span class="enscript-string">&quot;OS Switch Sleep&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMIdleSleepKey</span>                   <span class="enscript-string">&quot;Idle Sleep&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMLowPowerSleepKey</span>               <span class="enscript-string">&quot;Low Power Sleep&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMThermalEmergencySleepKey</span>       <span class="enscript-string">&quot;Thermal Emergency Sleep&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMMaintenanceSleepKey</span>            <span class="enscript-string">&quot;Maintenance Sleep&quot;</span>

<span class="enscript-comment">/*
 * String constants for communication with PM CPU
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMRootDomainLidCloseCString</span>      <span class="enscript-string">&quot;LidClose&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPMRootDomainBatPowerCString</span>      <span class="enscript-string">&quot;BatPower&quot;</span>

<span class="enscript-comment">/*
 * Supported Feature bitfields for IOPMrootDomain::publishFeature()
 */</span>
<span class="enscript-type">enum</span> {
    kIOPMSupportedOnAC      = (1&lt;&lt;0),
    kIOPMSupportedOnBatt    = (1&lt;&lt;1),
    kIOPMSupportedOnUPS     = (1&lt;&lt;2)
};

<span class="enscript-type">typedef</span> <span class="enscript-function-name">IOReturn</span> (*IOPMSettingControllerCallback)
                    (OSObject *target, <span class="enscript-type">const</span> OSSymbol *type,
                     OSObject *val, uintptr_t refcon);

__BEGIN_DECLS
IONotifier *    <span class="enscript-function-name">registerSleepWakeInterest</span>(
                    IOServiceInterestHandler, <span class="enscript-type">void</span> *, <span class="enscript-type">void</span> * = 0);

IONotifier *    <span class="enscript-function-name">registerPrioritySleepWakeInterest</span>(
                    IOServiceInterestHandler handler,
                    <span class="enscript-type">void</span> * self, <span class="enscript-type">void</span> * ref = 0);

IOReturn        <span class="enscript-function-name">acknowledgeSleepWakeNotification</span>(<span class="enscript-type">void</span> * );

IOReturn        <span class="enscript-function-name">vetoSleepWakeNotification</span>(<span class="enscript-type">void</span> * PMrefcon);
__END_DECLS

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IOPM_ROOTDOMAIN_REV</span>        2

class IOPMrootDomain: public IOService
{
    OSDeclareFinalStructors(IOPMrootDomain)

<span class="enscript-reference">public</span>:
    <span class="enscript-type">static</span> IOPMrootDomain * construct( <span class="enscript-type">void</span> );

    virtual bool        start( IOService * provider ) APPLE_KEXT_OVERRIDE;
    virtual IOReturn    setAggressiveness( <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span>, <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> ) APPLE_KEXT_OVERRIDE;
    virtual IOReturn    getAggressiveness( <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span>, <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> * ) APPLE_KEXT_OVERRIDE;

    virtual IOReturn    sleepSystem( <span class="enscript-type">void</span> );
    IOReturn            sleepSystemOptions( OSDictionary *options );

    virtual IOReturn    setProperties( OSObject * ) APPLE_KEXT_OVERRIDE;
    virtual bool        serializeProperties( OSSerialize * s ) <span class="enscript-type">const</span> APPLE_KEXT_OVERRIDE;
    virtual OSObject *  copyProperty( <span class="enscript-type">const</span> <span class="enscript-type">char</span> * aKey ) <span class="enscript-type">const</span> APPLE_KEXT_OVERRIDE;

<span class="enscript-comment">/*! @function systemPowerEventOccurred
    @abstract Other drivers may inform IOPMrootDomain of system PM events
    @discussion systemPowerEventOccurred is a richer alternative to receivePowerNotification()
        Only Apple-owned kexts should have reason to call systemPowerEventOccurred.
    @param event An OSSymbol describing the type of power event.
    @param value A 32-bit integer value associated with the event.
    @param shouldUpdate indicates whether the root domain should send a notification
        to interested parties. Pass false if you're calling systemPowerEventOccurred
        several times in succession; and pass true only on the last invocatino.
    @result kIOReturnSuccess on success */</span>

    IOReturn            systemPowerEventOccurred(
                                    <span class="enscript-type">const</span> OSSymbol *event,
                                    uint32_t intValue );

    IOReturn            systemPowerEventOccurred(
                                    <span class="enscript-type">const</span> OSSymbol *event,
                                    OSObject *value );

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>   // <span class="enscript-variable-name">Hide</span> <span class="enscript-variable-name">doc</span> <span class="enscript-variable-name">from</span> <span class="enscript-variable-name">public</span> <span class="enscript-variable-name">headers</span>
<span class="enscript-comment">/*! @function claimSystemWakeEvent
    @abstract   Apple-internal SPI to describe system wake events.
    @discussion IOKit drivers may call claimSystemWakeEvent() during system wakeup to
                provide human readable debug information describing the event(s) that
                caused the system to wake.

                - Drivers should call claimSystemWakeEvent before completing
                  their setPowerState() acknowledgement. IOPMrootDomain stops
                  collecting wake events when driver wake is complete.

                - It is only appropriate to claim a wake event when the driver
                  can positively identify its hardware has generated an event
                  that can wake the system.

                - This call tracks wake events from a non-S0 state (S0i, S3, S4) into S0.
                - This call does not track wake events from DarkWake(S0) to FullWake(S0).

	Examples:
		(reason  = &quot;WiFi.TCPData&quot;,
         details = &quot;TCPKeepAlive packet arrived from IP 16.2.1.1&quot;)
		(reason  = &quot;WiFi.ScanOffload&quot;,
         details = &quot;WiFi station 'AppleWiFi' signal dropped below threshold&quot;)
		(reason  = &quot;Enet.LinkToggle&quot;,
         details = &quot;Ethernet attached&quot;)

    @param device   The device/nub that is associated with the wake event.

    @param flags    Pass kIOPMWakeEventSource if the device is the source
                    of the wake event. Pass zero if the device is forwarding or
                    aggregating wake events from multiple sources, e.g. an USB or
                    Thunderbolt host controller.

    @param reason   Caller should pass a human readable C string describing the
                    wake reason. Please use a string from the list below, or create
                    your own string matching this format:
                              [Hardware].[Event]
                              WiFi.MagicPacket
                              WiFi.ScanOffload
                              WiFi.mDNSConflict
                              WiFi.mDNSService
                              WiFi.TCPData
                              WiFi.TCPTimeout
                              WiFi.FirmwareCrash
                              Enet.MagicPacket
                              Enet.mDNSConflict
                              Enet.mDNSService
                              Enet.TCPData
                              Enet.TCPTimeout
                              Enet.Service
                              Enet.LinkToggle
                              Enet.ConflictResolution
                              Enet.PatternMatch
                              Enet.Timer
                              Enet.LinkUpTimeout
                              Enet.LinkDown
                              USB.DeviceAttach
                              USB.DeviceDetach

     @param details Optional details further describing the wake event.
                    Please pass an OSString defining the event.
     */</span>
#<span class="enscript-reference">endif</span>
    <span class="enscript-type">void</span> 				claimSystemWakeEvent( IOService     *device,
                                              IOOptionBits  flags,
                                              <span class="enscript-type">const</span> <span class="enscript-type">char</span>    *reason,
                                              OSObject      *details = 0 );

    virtual IOReturn    receivePowerNotification( UInt32 msg );

    virtual <span class="enscript-type">void</span>        setSleepSupported( IOOptionBits flags );

    virtual IOOptionBits getSleepSupported( <span class="enscript-type">void</span> );

    <span class="enscript-type">void</span>                wakeFromDoze( <span class="enscript-type">void</span> );

    <span class="enscript-comment">// KEXT driver announces support of power management feature
</span>
    <span class="enscript-type">void</span>                publishFeature( <span class="enscript-type">const</span> <span class="enscript-type">char</span> *feature );

    <span class="enscript-comment">// KEXT driver announces support of power management feature
</span>    <span class="enscript-comment">// And specifies power sources with kIOPMSupportedOn{AC/Batt/UPS} bitfield.
</span>    <span class="enscript-comment">// Returns a unique uint32_t identifier for later removing support for this
</span>    <span class="enscript-comment">// feature.
</span>    <span class="enscript-comment">// NULL is acceptable for uniqueFeatureID for kexts without plans to unload.
</span>
    <span class="enscript-type">void</span>                publishFeature( <span class="enscript-type">const</span> <span class="enscript-type">char</span> *feature,
                                        uint32_t supportedWhere,
                                        uint32_t *uniqueFeatureID);

    <span class="enscript-comment">// KEXT driver announces removal of a previously published power management
</span>    <span class="enscript-comment">// feature. Pass 'uniqueFeatureID' returned from publishFeature()
</span>
    IOReturn            removePublishedFeature( uint32_t removeFeatureID );

<span class="enscript-comment">/*! @function copyPMSetting
    @abstract Copy the current value for a PM setting. Returns an OSNumber or
        OSData depending on the setting.
    @param whichSetting Name of the desired setting.
    @result OSObject value if valid, NULL otherwise. */</span>

    OSObject *          copyPMSetting( OSSymbol *whichSetting );

<span class="enscript-comment">/*! @function registerPMSettingController
    @abstract Register for callbacks on changes to certain PM settings.
    @param settings NULL terminated array of C strings, each string for a PM
        setting that the caller is interested in and wants to get callbacks for.
    @param callout C function ptr or member function cast as such.
    @param target The target of the callback, usually 'this'
    @param refcon Will be passed to caller in callback; for caller's use.
    @param handle Caller should keep the OSObject * returned here. If non-NULL,
        handle will have a retain count of 1 on return. To deregister, pass to
        unregisterPMSettingController()
    @result kIOReturnSuccess on success. */</span>

    IOReturn            registerPMSettingController(
                                 <span class="enscript-type">const</span> OSSymbol *settings[],
                                 IOPMSettingControllerCallback callout,
                                 OSObject   *target,
                                 uintptr_t  refcon,
                                 OSObject   **handle);    <span class="enscript-comment">// out param
</span>
<span class="enscript-comment">/*! @function registerPMSettingController
    @abstract Register for callbacks on changes to certain PM settings.
    @param settings NULL terminated array of C strings, each string for a PM
        setting that the caller is interested in and wants to get callbacks for.
    @param supportedPowerSources bitfield indicating which power sources these
        settings are supported for (kIOPMSupportedOnAC, etc.)
    @param callout C function ptr or member function cast as such.
    @param target The target of the callback, usually 'this'
    @param refcon Will be passed to caller in callback; for caller's use.
    @param handle Caller should keep the OSObject * returned here. If non-NULL,
        handle will have a retain count of 1 on return. To deregister, pass to
        unregisterPMSettingController()
    @result kIOReturnSuccess on success. */</span>

    IOReturn            registerPMSettingController(
                                 <span class="enscript-type">const</span> OSSymbol *settings[],
                                 uint32_t   supportedPowerSources,
                                 IOPMSettingControllerCallback callout,
                                 OSObject   *target,
                                 uintptr_t  refcon,
                                 OSObject   **handle);    <span class="enscript-comment">// out param
</span>
    virtual IONotifier * registerInterest(
                                <span class="enscript-type">const</span> OSSymbol * typeOfInterest,
                                IOServiceInterestHandler handler,
                                <span class="enscript-type">void</span> * target, <span class="enscript-type">void</span> * ref = 0 ) APPLE_KEXT_OVERRIDE;

    virtual IOReturn    callPlatformFunction(
                                <span class="enscript-type">const</span> OSSymbol *functionName,
                                bool waitForFunction,
                                <span class="enscript-type">void</span> *param1, <span class="enscript-type">void</span> *param2,
                                <span class="enscript-type">void</span> *param3, <span class="enscript-type">void</span> *param4 ) APPLE_KEXT_OVERRIDE;

<span class="enscript-comment">/*! @function createPMAssertion
    @abstract Creates an assertion to influence system power behavior.
    @param whichAssertionBits A bitfield specify the assertion that the caller requests.
    @param assertionLevel An integer detailing the initial assertion level, kIOPMDriverAssertionLevelOn
        or kIOPMDriverAssertionLevelOff.
    @param ownerService A pointer to the caller's IOService class, for tracking.
    @param ownerDescription A reverse-DNS string describing the caller's identity and reason.
    @result On success, returns a new assertion of type IOPMDriverAssertionID
*/</span>
    IOPMDriverAssertionID createPMAssertion(
                                IOPMDriverAssertionType whichAssertionsBits,
                                IOPMDriverAssertionLevel assertionLevel,
                                IOService *ownerService,
                                <span class="enscript-type">const</span> <span class="enscript-type">char</span> *ownerDescription);

<span class="enscript-comment">/* @function setPMAssertionLevel
   @abstract Modify the level of a pre-existing assertion.
   @discussion Change the value of a PM assertion to influence system behavior,
    without undergoing the work required to create or destroy an assertion. Suggested
    for clients who will assert and de-assert needs for PM behavior several times over
    their lifespan.
   @param assertionID An assertion ID previously returned by &lt;link&gt;createPMAssertion&lt;/link&gt;
   @param assertionLevel The new assertion level.
   @result kIOReturnSuccess if it worked; kIOReturnNotFound or other IOReturn error on failure.
*/</span>
    IOReturn setPMAssertionLevel(IOPMDriverAssertionID assertionID, IOPMDriverAssertionLevel assertionLevel);

<span class="enscript-comment">/*! @function getPMAssertionLevel
    @absract Returns the active level of the specified assertion(s).
    @discussion Returns &lt;link&gt;kIOPMDriverAssertionLevelOff&lt;/link&gt; or
        &lt;link&gt;kIOPMDriverAssertionLevelOn&lt;/link&gt;. If multiple assertions are specified
        in the bitfield, only returns &lt;link&gt;kIOPMDriverAssertionLevelOn&lt;/link&gt;
        if all assertions are active.
    @param whichAssertionBits Bits defining the assertion or assertions the caller is interested in
        the level of. If in doubt, pass &lt;link&gt;kIOPMDriverAssertionCPUBit&lt;/link&gt; as the argument.
    @result Returns &lt;link&gt;kIOPMDriverAssertionLevelOff&lt;/link&gt; or
        &lt;link&gt;kIOPMDriverAssertionLevelOn&lt;/link&gt; indicating the specified assertion's levels, if available.
        If the assertions aren't supported on this machine, or aren't recognized by the OS, the
        result is undefined.
*/</span>
    IOPMDriverAssertionLevel getPMAssertionLevel(IOPMDriverAssertionType whichAssertionBits);

<span class="enscript-comment">/*! @function releasePMAssertion
    @abstract Removes an assertion to influence system power behavior.
    @result On success, returns a new assertion of type IOPMDriverAssertionID *
*/</span>
    IOReturn releasePMAssertion(IOPMDriverAssertionID releaseAssertion);

<span class="enscript-comment">/*! @function restartWithStackshot
    @abstract Take a stackshot of the system and restart the system.
    @result Return kIOReturnSuccess if it work, kIOReturnError if the service is not available.
*/</span>
    IOReturn restartWithStackshot();

<span class="enscript-reference">private</span>:
    virtual IOReturn    changePowerStateTo( <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> ordinal ) APPLE_KEXT_COMPATIBILITY_OVERRIDE;
    virtual IOReturn    changePowerStateToPriv( <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> ordinal );
    virtual IOReturn    requestPowerDomainState( IOPMPowerFlags, IOPowerConnection *, <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> ) APPLE_KEXT_OVERRIDE;
    virtual <span class="enscript-type">void</span>        powerChangeDone( <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> ) APPLE_KEXT_OVERRIDE;
    virtual bool        tellChangeDown( <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> ) APPLE_KEXT_OVERRIDE;
    virtual bool        askChangeDown( <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> ) APPLE_KEXT_OVERRIDE;
    virtual <span class="enscript-type">void</span>        tellChangeUp( <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> ) APPLE_KEXT_OVERRIDE;
    virtual <span class="enscript-type">void</span>        tellNoChangeDown( <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> ) APPLE_KEXT_OVERRIDE;
    virtual IOReturn configureReport(IOReportChannelList   *channels,
                                    IOReportConfigureAction action,
                                    <span class="enscript-type">void</span>                    *result,
                                    <span class="enscript-type">void</span>                    *destination) APPLE_KEXT_OVERRIDE;
    virtual IOReturn updateReport(IOReportChannelList      *channels,
                                  IOReportUpdateAction     action,
                                  <span class="enscript-type">void</span>                     *result,
                                  <span class="enscript-type">void</span>                     *destination) APPLE_KEXT_OVERRIDE;

    <span class="enscript-type">void</span>             configureReportGated(uint64_t channel_id,
                                          uint64_t action,
                                          <span class="enscript-type">void</span>     *result);
    IOReturn         updateReportGated(uint64_t ch_id, 
                                       <span class="enscript-type">void</span> *result, 
                                       IOBufferMemoryDescriptor *dest);

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
    <span class="enscript-comment">/* Root Domain internals */</span>
<span class="enscript-reference">public</span>:
    <span class="enscript-type">void</span>        tagPowerPlaneService(
                    IOService *     service,
                    IOPMActions *   actions );

    <span class="enscript-type">void</span>        overrideOurPowerChange(
                    IOService *             service,
                    IOPMActions *           actions,
                    IOPMPowerStateIndex *   inOutPowerState,
                    IOPMPowerChangeFlags *  inOutChangeFlags,
                    IOPMRequestTag          requestTag );

    <span class="enscript-type">void</span>        handleOurPowerChangeStart(
                    IOService *             service,
                    IOPMActions *           actions,
                    IOPMPowerStateIndex     powerState,
                    IOPMPowerChangeFlags *  inOutChangeFlags,
                    IOPMRequestTag          requestTag );

    <span class="enscript-type">void</span>        handleOurPowerChangeDone(
                    IOService *             service,
                    IOPMActions *           actions,
                    IOPMPowerStateIndex     powerState,
                    IOPMPowerChangeFlags    changeFlags,
                    IOPMRequestTag          requestTag );

    <span class="enscript-type">void</span>        overridePowerChangeForUIService(
                    IOService *             service,
                    IOPMActions *           actions,
                    IOPMPowerStateIndex *   inOutPowerState,
                    IOPMPowerChangeFlags *  inOutChangeFlags );

    <span class="enscript-type">void</span>        handleActivityTickleForDisplayWrangler(
                    IOService *             service,
                    IOPMActions *           actions );

    <span class="enscript-type">void</span>        handleUpdatePowerClientForDisplayWrangler(
                    IOService *             service,
                    IOPMActions *           actions,
                    <span class="enscript-type">const</span> OSSymbol *        powerClient,
                    IOPMPowerStateIndex     oldPowerState,
                    IOPMPowerStateIndex     newPowerState );

    bool        shouldDelayChildNotification(
                    IOService *     service );

    <span class="enscript-type">void</span>        handlePowerChangeStartForPCIDevice(
                    IOService *             service,
                    IOPMActions *           actions,
                    IOPMPowerStateIndex     powerState,
                    IOPMPowerChangeFlags *  inOutChangeFlags );

    <span class="enscript-type">void</span>        handlePowerChangeDoneForPCIDevice(
                    IOService *             service,
                    IOPMActions *           actions,
                    IOPMPowerStateIndex     powerState,
                    IOPMPowerChangeFlags    changeFlags );

    <span class="enscript-type">void</span>        askChangeDownDone(
                    IOPMPowerChangeFlags * inOutChangeFlags,
                    bool * cancel );

    <span class="enscript-type">void</span>        handlePublishSleepWakeUUID(
                    bool shouldPublish);

    <span class="enscript-type">void</span>        handleQueueSleepWakeUUID(
                    OSObject *obj);

    <span class="enscript-type">void</span>        handleDisplayPowerOn( );

    <span class="enscript-type">void</span>        willNotifyPowerChildren( IOPMPowerStateIndex newPowerState );

    IOReturn    setMaintenanceWakeCalendar(
                    <span class="enscript-type">const</span> IOPMCalendarStruct * calendar );

    IOReturn    getSystemSleepType( uint32_t * sleepType );

    <span class="enscript-comment">// Handle callbacks from IOService::systemWillShutdown()
</span>    <span class="enscript-type">void</span>        acknowledgeSystemWillShutdown( IOService * from );

    <span class="enscript-comment">// Handle platform halt and restart notifications
</span>    <span class="enscript-type">void</span>        handlePlatformHaltRestart( UInt32 pe_type );

    IOReturn    shutdownSystem( <span class="enscript-type">void</span> );
    IOReturn    restartSystem( <span class="enscript-type">void</span> );
    <span class="enscript-type">void</span>        handleSleepTimerExpiration( <span class="enscript-type">void</span> );

    bool        activitySinceSleep(<span class="enscript-type">void</span>);
    bool        abortHibernation(<span class="enscript-type">void</span>);

    IOReturn    joinAggressiveness( IOService * service );
    <span class="enscript-type">void</span>        handleAggressivesRequests( <span class="enscript-type">void</span> );

    <span class="enscript-type">void</span>        tracePoint( uint8_t point );
    <span class="enscript-type">void</span>        tracePoint( uint8_t point, uint8_t data );
    <span class="enscript-type">void</span>        traceDetail( uint32_t data32 );

    bool        systemMessageFilter(
                    <span class="enscript-type">void</span> * object, <span class="enscript-type">void</span> * arg1, <span class="enscript-type">void</span> * arg2, <span class="enscript-type">void</span> * arg3 );

    bool        updatePreventIdleSleepList(
                    IOService * service, bool addNotRemove );
    <span class="enscript-type">void</span>        updatePreventSystemSleepList(
                    IOService * service, bool addNotRemove );

    <span class="enscript-type">void</span>        publishPMSetting(
                    <span class="enscript-type">const</span> OSSymbol * feature, uint32_t where, uint32_t * featureID );

    <span class="enscript-type">void</span>        pmStatsRecordEvent(
                                <span class="enscript-type">int</span>             eventIndex,
                                AbsoluteTime    timestamp);

    <span class="enscript-type">void</span>        pmStatsRecordApplicationResponse(
                                <span class="enscript-type">const</span> OSSymbol      *response,
                                <span class="enscript-type">const</span> <span class="enscript-type">char</span>          *name,
                                <span class="enscript-type">int</span>                 messageType,
                                uint32_t            delay_ms,
                                <span class="enscript-type">int</span>                 app_pid,
                                OSObject            *object,
                                IOPMPowerStateIndex ps=0);

    <span class="enscript-type">void</span>        copyWakeReasonString( <span class="enscript-type">char</span> * outBuf, size_t bufSize );

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">HIBERNATION</span>
    bool        getHibernateSettings(
                    uint32_t *  hibernateMode,
                    uint32_t *  hibernateFreeRatio,
                    uint32_t *  hibernateFreeTime );
#<span class="enscript-reference">endif</span>
    <span class="enscript-type">void</span>        takeStackshot(bool restart, bool isOSXWatchdog, bool isSpinDump);
    <span class="enscript-type">void</span>        sleepWakeDebugTrig(bool restart);
    <span class="enscript-type">void</span>        sleepWakeDebugEnableWdog();
    bool        sleepWakeDebugIsWdogEnabled();
    <span class="enscript-type">static</span> <span class="enscript-type">void</span> saveTimeoutAppStackShot(<span class="enscript-type">void</span> *p0, <span class="enscript-type">void</span> *p1);
    <span class="enscript-type">void</span>        sleepWakeDebugSaveSpinDumpFile();

<span class="enscript-reference">private</span>:
    friend class PMSettingObject;
    friend class RootDomainUserClient;
    friend class PMAssertionsTracker;

    <span class="enscript-type">static</span> IOReturn sysPowerDownHandler( <span class="enscript-type">void</span> * target, <span class="enscript-type">void</span> * refCon,
                                    UInt32 messageType, IOService * service,
                                    <span class="enscript-type">void</span> * messageArgument, vm_size_t argSize );

    <span class="enscript-type">static</span> IOReturn displayWranglerNotification( <span class="enscript-type">void</span> * target, <span class="enscript-type">void</span> * refCon,
                                    UInt32 messageType, IOService * service,
                                    <span class="enscript-type">void</span> * messageArgument, vm_size_t argSize );

    <span class="enscript-type">static</span> IOReturn rootBusyStateChangeHandler( <span class="enscript-type">void</span> * target, <span class="enscript-type">void</span> * refCon,
                                    UInt32 messageType, IOService * service,
                                    <span class="enscript-type">void</span> * messageArgument, vm_size_t argSize );

    <span class="enscript-type">static</span> bool displayWranglerMatchPublished( <span class="enscript-type">void</span> * target, <span class="enscript-type">void</span> * refCon,
                                    IOService * newService,
                                    IONotifier * notifier);

    <span class="enscript-type">static</span> bool IONVRAMMatchPublished( <span class="enscript-type">void</span> * target, <span class="enscript-type">void</span> * refCon,
                                    IOService * newService,
                                    IONotifier * notifier);

    <span class="enscript-type">static</span> bool batteryPublished( <span class="enscript-type">void</span> * target, <span class="enscript-type">void</span> * refCon,
                                    IOService * resourceService,
                                    IONotifier * notifier);

    <span class="enscript-type">void</span> initializeBootSessionUUID( <span class="enscript-type">void</span> );

    <span class="enscript-type">void</span> fullWakeDelayedWork( <span class="enscript-type">void</span> );

    IOService *             wrangler;
    OSDictionary *          wranglerIdleSettings;

    IOLock                  *featuresDictLock;  <span class="enscript-comment">// guards supportedFeatures
</span>    IOLock                  *wakeEventLock;
    IOPMPowerStateQueue     *pmPowerStateQueue;

    OSArray                 *allowedPMSettings;
    OSArray                 *noPublishPMSettings;
    PMTraceWorker           *pmTracer;
    PMAssertionsTracker     *pmAssertions;

    <span class="enscript-comment">// Settings controller info
</span>    IOLock                  *settingsCtrlLock;
    OSDictionary            *settingsCallbacks;
    OSDictionary            *fPMSettingsDict;

    IONotifier              *_batteryPublishNotifier;
    IONotifier              *_displayWranglerNotifier;

    <span class="enscript-comment">// Statistics
</span>    <span class="enscript-type">const</span> OSSymbol          *_statsNameKey;
    <span class="enscript-type">const</span> OSSymbol          *_statsPIDKey;
    <span class="enscript-type">const</span> OSSymbol          *_statsTimeMSKey;
    <span class="enscript-type">const</span> OSSymbol          *_statsResponseTypeKey;
    <span class="enscript-type">const</span> OSSymbol          *_statsMessageTypeKey;
    <span class="enscript-type">const</span> OSSymbol          *_statsPowerCapsKey;
    uint32_t                sleepCnt;
    uint32_t                darkWakeCnt;
    uint32_t                displayWakeCnt;

    OSString                *queuedSleepWakeUUIDString;
    OSArray                 *pmStatsAppResponses;
    IOLock                  *pmStatsLock;   <span class="enscript-comment">// guards pmStatsAppResponses
</span>
    <span class="enscript-type">void</span>                    *sleepDelaysReport;     <span class="enscript-comment">// report to track time taken to go to sleep
</span>    uint32_t                sleepDelaysClientCnt;   <span class="enscript-comment">// Number of interested clients in sleepDelaysReport
</span>    uint64_t                ts_sleepStart;
    uint64_t                wake2DarkwakeDelay;      <span class="enscript-comment">// Time taken to change from full wake -&gt; Dark wake
</span>

    <span class="enscript-type">void</span>                    *assertOnWakeReport;    <span class="enscript-comment">// report to track time spent without any assertions held after wake
</span>    uint32_t                assertOnWakeClientCnt;  <span class="enscript-comment">// Number of clients interested in assertOnWakeReport
</span>    clock_sec_t             assertOnWakeSecs;       <span class="enscript-comment">// Num of secs after wake for first assertion
</span>
    bool                    uuidPublished;

    <span class="enscript-comment">// Pref: idle time before idle sleep
</span>    <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span>           sleepSlider;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span>           idleSeconds;
    uint64_t                autoWakeStart;
    uint64_t                autoWakeEnd;

    <span class="enscript-comment">// Difference between sleepSlider and longestNonSleepSlider
</span>    <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span>           extraSleepDelay;

    <span class="enscript-comment">// Used to wait between say display idle and system idle
</span>    thread_call_t           extraSleepTimer;
    thread_call_t           diskSyncCalloutEntry;
    thread_call_t           fullWakeThreadCall;
    thread_call_t           hibDebugSetupEntry;
    thread_call_t           updateConsoleUsersEntry;

    <span class="enscript-comment">// Track system capabilities.
</span>    uint32_t                _desiredCapability;
    uint32_t                _currentCapability;
    uint32_t                _pendingCapability;
    uint32_t                _highestCapability;
    OSSet *                 _joinedCapabilityClients;
    uint32_t                _systemStateGeneration;

    <span class="enscript-comment">// Type of clients that can receive system messages.
</span>    <span class="enscript-type">enum</span> {
        kSystemMessageClientPowerd    = 0x01,
        kSystemMessageClientLegacyApp = 0x02,
        kSystemMessageClientKernel    = 0x04,
        kSystemMessageClientAll       = 0x07
    };
    uint32_t                _systemMessageClientMask;

    <span class="enscript-comment">// Power state and capability change transitions.
</span>    <span class="enscript-type">enum</span> {
        kSystemTransitionNone         = 0,
        kSystemTransitionSleep        = 1,
        kSystemTransitionWake         = 2,
        kSystemTransitionCapability   = 3,
        kSystemTransitionNewCapClient = 4
    }                       _systemTransitionType;

    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            systemBooting           :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            systemShutdown          :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            systemDarkWake          :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            clamshellExists         :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            clamshellClosed         :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            clamshellDisabled       :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            desktopMode             :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            acAdaptorConnected      :1;

    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            clamshellSleepDisabled  :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            idleSleepTimerPending   :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            userDisabledAllSleep    :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            ignoreTellChangeDown    :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            wranglerAsleep          :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            wranglerTickled         :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            _preventUserActive      :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            graphicsSuppressed      :1;

    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            capabilityLoss          :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            pciCantSleepFlag        :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            pciCantSleepValid       :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            logGraphicsClamp        :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            darkWakeToSleepASAP     :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            darkWakeMaintenance     :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            darkWakeSleepService    :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            darkWakePostTickle      :1;

    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            sleepTimerMaintenance   :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            sleepToStandby          :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            lowBatteryCondition     :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            hibernateDisabled       :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            hibernateRetry          :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            wranglerTickleLatched   :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            userIsActive            :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            userWasActive           :1;

    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            displayIdleForDemandSleep :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            darkWakeHibernateError  :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            thermalWarningState:1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            toldPowerdCapWillChange :1;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>            displayPowerOnRequested:1;

    uint32_t                hibernateMode;
    AbsoluteTime            userActivityTime;
    AbsoluteTime            userActivityTime_prev;
    uint32_t                userActivityCount;
    uint32_t                userActivityAtSleep;
    uint32_t                lastSleepReason;
    uint32_t                fullToDarkReason;
    uint32_t                hibernateAborted;

    <span class="enscript-type">enum</span> FullWakeReason {
        kFullWakeReasonNone = 0,
        kFullWakeReasonLocalUser = 1,
        kFullWakeReasonDisplayOn = 2,
        fFullWakeReasonDisplayOnAndLocalUser = 3
    };
    uint32_t                fullWakeReason;

    <span class="enscript-comment">// Info for communicating system state changes to PMCPU
</span>    int32_t                 idxPMCPUClamshell;
    int32_t                 idxPMCPULimitedPower;

    IOOptionBits            platformSleepSupport;
    uint32_t                _debugWakeSeconds;
    uint32_t                _lastDebugWakeSeconds;

    queue_head_t            aggressivesQueue;
    thread_call_t           aggressivesThreadCall;
    OSData *                aggressivesData;

    AbsoluteTime            userBecameInactiveTime;
    AbsoluteTime            systemWakeTime;

    <span class="enscript-comment">// PCI top-level PM trace
</span>    IOService *             pciHostBridgeDevice;
    IOService *             pciHostBridgeDriver;

    IONotifier *            systemCapabilityNotifier;

    <span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
        uint32_t            pid;
        uint32_t            refcount;
    } PMNotifySuspendedStruct;

    uint32_t                pmSuspendedCapacity;
    uint32_t                pmSuspendedSize;
    PMNotifySuspendedStruct *pmSuspendedPIDS;

    OSSet *                 preventIdleSleepList;
    OSSet *                 preventSystemSleepList;

    UInt32                  _scheduledAlarms;
    UInt32                  _userScheduledAlarm;

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">HIBERNATION</span>
    clock_sec_t             _standbyTimerResetSeconds;
#<span class="enscript-reference">endif</span>
    <span class="enscript-type">volatile</span> uint32_t   swd_lock;    <span class="enscript-comment">/* Lock to access swd_buffer &amp; and its header */</span>
    <span class="enscript-type">void</span>  *             swd_buffer;  <span class="enscript-comment">/* Memory allocated for dumping sleep/wake logs */</span>
    uint8_t             swd_flags;   <span class="enscript-comment">/* Flags defined in IOPMPrivate.h */</span>
    <span class="enscript-type">void</span>  *             swd_spindump_buffer;

    IOMemoryMap  *      swd_logBufMap; <span class="enscript-comment">/* Memory with sleep/wake logs from previous boot */</span>

    <span class="enscript-comment">// Wake Event Reporting
</span>    OSArray *               _systemWakeEventsArray;
    bool                    _acceptSystemWakeEvents;

    <span class="enscript-type">int</span>         findSuspendedPID(uint32_t pid, uint32_t *outRefCount);

    <span class="enscript-comment">// IOPMrootDomain internal sleep call
</span>    IOReturn    privateSleepSystem( uint32_t sleepReason );
    <span class="enscript-type">void</span>        reportUserInput( <span class="enscript-type">void</span> );
    <span class="enscript-type">void</span>        setDisableClamShellSleep( bool );
    bool        checkSystemSleepAllowed( IOOptionBits options,
                                         uint32_t sleepReason );
    bool        checkSystemSleepEnabled( <span class="enscript-type">void</span> );
    bool        checkSystemCanSleep( uint32_t sleepReason );
    bool        checkSystemCanSustainFullWake( <span class="enscript-type">void</span> );

    <span class="enscript-type">void</span>        adjustPowerState( bool sleepASAP = false );
    <span class="enscript-type">void</span>        setQuickSpinDownTimeout( <span class="enscript-type">void</span> );
    <span class="enscript-type">void</span>        restoreUserSpinDownTimeout( <span class="enscript-type">void</span> );

    bool        shouldSleepOnClamshellClosed(<span class="enscript-type">void</span> );
    <span class="enscript-type">void</span>        sendClientClamshellNotification( <span class="enscript-type">void</span> );

    <span class="enscript-comment">// Inform PMCPU of changes to state like lid, AC vs. battery
</span>    <span class="enscript-type">void</span>        informCPUStateChange( uint32_t type, uint32_t value );

    <span class="enscript-type">void</span>        dispatchPowerEvent( uint32_t event, <span class="enscript-type">void</span> * arg0, uint64_t arg1 );
    <span class="enscript-type">void</span>        handlePowerNotification( UInt32 msg );

    IOReturn    setPMSetting(<span class="enscript-type">const</span> OSSymbol *, OSObject *);

    <span class="enscript-type">void</span>        startIdleSleepTimer( uint32_t inSeconds );
    <span class="enscript-type">void</span>        cancelIdleSleepTimer( <span class="enscript-type">void</span> );
    uint32_t    getTimeToIdleSleep( <span class="enscript-type">void</span> );

    IOReturn    setAggressiveness(
                        <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> type,
                        <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> value,
                        IOOptionBits  options );

    <span class="enscript-type">void</span>        synchronizeAggressives(
                        queue_head_t * services,
                        <span class="enscript-type">const</span> AggressivesRecord * array,
                        <span class="enscript-type">int</span> count );

    <span class="enscript-type">void</span>        broadcastAggressives(
                        <span class="enscript-type">const</span> AggressivesRecord * array,
                        <span class="enscript-type">int</span> count );

    IOReturn    setPMAssertionUserLevels(IOPMDriverAssertionType);

    <span class="enscript-type">void</span>        publishSleepWakeUUID( bool shouldPublish );

    <span class="enscript-type">void</span>        evaluatePolicy( <span class="enscript-type">int</span> stimulus, uint32_t arg = 0 );
    <span class="enscript-type">void</span>        requestFullWake( FullWakeReason reason );
    <span class="enscript-type">void</span>        willEnterFullWake( <span class="enscript-type">void</span> );

    <span class="enscript-type">void</span>        evaluateAssertions(IOPMDriverAssertionType newAssertions,
                                   IOPMDriverAssertionType oldAssertions);

    <span class="enscript-type">void</span>        deregisterPMSettingObject( PMSettingObject * pmso );

    <span class="enscript-type">void</span>        checkForValidDebugData(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *fname, vfs_context_t *ctx, 
                                            <span class="enscript-type">void</span> *tmpBuf, <span class="enscript-type">struct</span> vnode **vp);
    <span class="enscript-type">void</span>        sleepWakeDebugMemAlloc( );
    <span class="enscript-type">void</span>        sleepWakeDebugSpinDumpMemAlloc( );
    <span class="enscript-type">void</span>        sleepWakeDebugDumpFromMem(IOMemoryMap *logBufMap);
    <span class="enscript-type">void</span>        sleepWakeDebugDumpFromFile( );
    IOMemoryMap *sleepWakeDebugRetrieve();
    errno_t     sleepWakeDebugSaveFile(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *name, <span class="enscript-type">char</span> *buf, <span class="enscript-type">int</span> len);
    errno_t     sleepWakeDebugCopyFile( <span class="enscript-type">struct</span> vnode *srcVp,
                               vfs_context_t srcCtx,
                               <span class="enscript-type">char</span> *tmpBuf, uint64_t tmpBufSize,
                               uint64_t srcOffset, 
                               <span class="enscript-type">const</span> <span class="enscript-type">char</span> *dstFname, 
                               uint64_t numBytes,
                               uint32_t crc);


#<span class="enscript-reference">if</span> <span class="enscript-variable-name">HIBERNATION</span>
    bool        getSleepOption( <span class="enscript-type">const</span> <span class="enscript-type">char</span> * key, uint32_t * option );
    bool        evaluateSystemSleepPolicy( IOPMSystemSleepParameters * p,
                                           <span class="enscript-type">int</span> phase, uint32_t * hibMode );
    <span class="enscript-type">void</span>        evaluateSystemSleepPolicyEarly( <span class="enscript-type">void</span> );
    <span class="enscript-type">void</span>        evaluateSystemSleepPolicyFinal( <span class="enscript-type">void</span> );
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* HIBERNATION */</span>

    bool        latchDisplayWranglerTickle( bool latch );
    <span class="enscript-type">void</span>        setDisplayPowerOn( uint32_t options );

    <span class="enscript-type">void</span>        acceptSystemWakeEvents( bool accept );
    <span class="enscript-type">void</span>        systemDidNotSleep( <span class="enscript-type">void</span> );
    <span class="enscript-type">void</span>        preventTransitionToUserActive( bool prevent );
    <span class="enscript-type">void</span>        setThermalState(OSObject *value);
    <span class="enscript-type">void</span>        copySleepPreventersList(OSArray  **idleSleepList, OSArray  **systemSleepList);
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>
};

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
class IORootParent: public IOService
{
    OSDeclareFinalStructors(IORootParent)

<span class="enscript-reference">public</span>:
    <span class="enscript-type">static</span> <span class="enscript-type">void</span> initialize( <span class="enscript-type">void</span> );
    virtual OSObject * copyProperty( <span class="enscript-type">const</span> <span class="enscript-type">char</span> * aKey ) <span class="enscript-type">const</span> APPLE_KEXT_OVERRIDE;
    bool start( IOService * nub ) APPLE_KEXT_OVERRIDE;
    <span class="enscript-type">void</span> shutDownSystem( <span class="enscript-type">void</span> );
    <span class="enscript-type">void</span> restartSystem( <span class="enscript-type">void</span> );
    <span class="enscript-type">void</span> sleepSystem( <span class="enscript-type">void</span> );
    <span class="enscript-type">void</span> dozeSystem( <span class="enscript-type">void</span> );
    <span class="enscript-type">void</span> sleepToDoze( <span class="enscript-type">void</span> );
    <span class="enscript-type">void</span> wakeSystem( <span class="enscript-type">void</span> );
};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* _IOKIT_ROOTDOMAIN_H */</span>
</pre>
<hr />
</body></html>