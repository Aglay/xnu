<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>IOReportTypes.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">IOReportTypes.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2012-2014 Apple Computer, Inc.  All Rights Reserved.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_IOREPORT_TYPES_H_</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_IOREPORT_TYPES_H_</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;stdint.h&gt;</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__cplusplus</span>
<span class="enscript-type">extern</span> <span class="enscript-string">&quot;C&quot;</span> {
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IOR_VALUES_PER_ELEMENT</span>  4

<span class="enscript-comment">/*! @const      kIOReportInvalidValue
    @const      kIOReportInvalidIntValue
    @abstract   cardinal value used to indicate data errors

    @discussion
        kIOReportInvalidValue and kIOReportInvalidIntValue have the
        same bit pattern so that clients checking for one or the other
        don't have to worry about getting the signedness right.
*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportInvalidIntValue</span> INT64_MIN
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportInvalidValue</span> (uint64_t)kIOReportInvalidIntValue

<span class="enscript-comment">/*! @typedef    IOReportCategories
    @abstract   encapsulate important, multi-purpose &quot;tags&quot; for channels

    @discussion
        IOReportCategories is the type for the .categories field of
        IOReportChanelType.  These categories are inteded to empower a
        limited number of clients to retrieve a broad range of channels
        without knowing much about them.  They can be OR'd together as
        needed.  Groups and subgroups are a more extensible mechanism
        for aggregating channels produced by different drivers.
*/</span>
<span class="enscript-type">typedef</span> uint16_t IOReportCategories;                                                                                                
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportCategoryPower</span>           (1 &lt;&lt; 1)       // and energy
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportCategoryTraffic</span>         (1 &lt;&lt; 2)       // I/O at any level
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportCategoryPerformance</span>     (1 &lt;&lt; 3)       // e.g. cycles/byte
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportCategoryPeripheral</span>      (1 &lt;&lt; 4)       // not built-in

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportCategoryField</span>           (1 &lt;&lt; 8)       // consider logging

<span class="enscript-comment">// future categories TBD
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportCategoryInterrupt</span>       (1 &lt;&lt; 14)      // TBR: 15850269
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportCategoryDebug</span>           (1 &lt;&lt; 15)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportInvalidCategory</span>         UINT16_MAX               


<span class="enscript-comment">// IOReportChannelType.report_format
</span><span class="enscript-type">typedef</span> uint8_t IOReportFormat;
<span class="enscript-type">enum</span> {
   kIOReportInvalidFormat = 0,
   kIOReportFormatSimple = 1,
   kIOReportFormatState = 2,
   kIOReportFormatHistogram = 3,
   kIOReportFormatSimpleArray = 4
};

<span class="enscript-comment">// simple report values
</span><span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
    int64_t    simple_value;
    uint64_t    reserved1;
    uint64_t    reserved2;
    uint64_t    reserved3;
} __attribute((packed)) IOSimpleReportValues;

<span class="enscript-comment">// simple value array
</span><span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
    int64_t    simple_values[IOR_VALUES_PER_ELEMENT];
} __attribute((packed)) IOSimpleArrayReportValues;

<span class="enscript-comment">// state report values
</span><span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
    uint64_t    state_id;           <span class="enscript-comment">// 0..N-1 or 8-char code (see MAKEID())
</span>    uint64_t    intransitions;      <span class="enscript-comment">// number of transitions into this state
</span>    uint64_t    upticks;            <span class="enscript-comment">// ticks spent in state (local timebase)
</span>    uint64_t    last_intransition;  <span class="enscript-comment">// ticks at last in-transition
</span>} __attribute((packed)) IOStateReportValues;

<span class="enscript-comment">// histogram report values
</span><span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
    uint64_t    bucket_hits;
    int64_t     bucket_min;
    int64_t     bucket_max;
    int64_t     bucket_sum;
} __attribute((packed)) IOHistogramReportValues;



<span class="enscript-comment">// configuration actions generally change future behavior
</span><span class="enscript-type">typedef</span> uint32_t IOReportConfigureAction;
<span class="enscript-type">enum</span> {
    <span class="enscript-comment">// basics (in common operational order)
</span>    kIOReportEnable             = 0x01,
    kIOReportGetDimensions      = 0x02,
    kIOReportDisable            = 0x00,

    <span class="enscript-comment">// Enable/disable modifiers
</span>    kIOReportNotifyHubOnChange  = 0x10,     <span class="enscript-comment">// triggered polling
</span>
    kIOReportTraceOnChange      = 0x20      <span class="enscript-comment">// kdebug.h tracing
</span>};

<span class="enscript-comment">// update actions should not have observable side effects
</span><span class="enscript-type">typedef</span> uint32_t IOReportUpdateAction;
<span class="enscript-type">enum</span> {
    kIOReportCopyChannelData    = 1,
    kIOReportTraceChannelData   = 2
};

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
    uint8_t     report_format;      <span class="enscript-comment">// Histogram, StateResidency, etc.
</span>    uint8_t     reserved;           <span class="enscript-comment">// must be zero
</span>    uint16_t    categories;         <span class="enscript-comment">// power, traffic, etc (omnibus obs.)
</span>    uint16_t    nelements;          <span class="enscript-comment">// internal size of channel
</span>
    <span class="enscript-comment">// only meaningful in the data pipeline
</span>    int16_t     element_idx;        <span class="enscript-comment">// 0..nelements-1
</span>                                    <span class="enscript-comment">// -1..-(nelements) = invalid (13127884)
</span>} __attribute((packed)) IOReportChannelType;

<span class="enscript-comment">/*!
    @define     IOREPORT_MAKECHID
    @abstract   convert up to 8 printable characters into a 64-bit channel ID
    @param  &lt;char0..char7&gt; - printable chars to be packed into a channel ID
    @result     a 64-bit channel ID with an implicit ASCII name
    @discussion A simple example:
                IOREPORT_MAKECHID('H', 'i', ' ', 'w', 'o', 'r', 'l', 'd');
                will evaluate to 0x686920776f726c64.  Any NUL bytes are
                ignored (by libIOReport) for naming purposes, but will
                appear in the channel ID.  Using a non-NUL non-printable
                character will disable the implicit name.  Putting NUL
                bytes first eliminates trailing zeros when the channel
                ID is printed as hex.  For example:
                IORERPORT_MAKECHID('\0','\0','n','x','f','e','r','s');
                To see the text, use xxd -r -p # not -rp; see 12976241
*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">__IOR_lshiftchr</span>(c, chshift)     ((uint64_t)(c) &lt;&lt; (8*(chshift)))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">IOREPORT_MAKEID</span>(A, B, C, D, E, F, G, H) \
    (__IOR_lshiftchr(A, 7) | __IOR_lshiftchr(B, 6) | __IOR_lshiftchr(C, 5) \
    | __IOR_lshiftchr(D, 4) | __IOR_lshiftchr(E, 3) | __IOR_lshiftchr(F, 2) \
    | __IOR_lshiftchr(G, 1) | __IOR_lshiftchr(H, 0))

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
    uint64_t                channel_id;
    IOReportChannelType     channel_type;
} IOReportChannel;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
    uint32_t                nchannels;
    IOReportChannel         channels[];
} IOReportChannelList;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
    uint64_t                provider_id;
    IOReportChannel         channel;
} IOReportInterest;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
    uint32_t                ninterests;
    IOReportInterest        interests[];
} IOReportInterestList;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
    uint64_t                v[IOR_VALUES_PER_ELEMENT];
} __attribute((packed)) IOReportElementValues;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
    uint64_t                provider_id;
    uint64_t                channel_id;
    IOReportChannelType     channel_type;
    uint64_t                timestamp;   <span class="enscript-comment">// mach_absolute_time()
</span>    IOReportElementValues   values;
} __attribute((packed)) IOReportElement;

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__cplusplus</span>
}
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">endif</span> // <span class="enscript-variable-name">_IOREPORT_TYPES_H_</span>
</pre>
<hr />
</body></html>