<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>IOKernelReportStructs.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">IOKernelReportStructs.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2012-2014 Apple Computer, Inc.  All Rights Reserved.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>

<span class="enscript-comment">// Internal data structures to be used by IOReporters and User Space Observers
</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_IOKERNELREPORTSTRUCTS_H_</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_IOKERNELREPORTSTRUCTS_H_</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;stdint.h&gt;</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;IOKit/IOReportTypes.h&gt;</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__cplusplus</span>
<span class="enscript-type">extern</span> <span class="enscript-string">&quot;C&quot;</span> {
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportAPIVersion</span> 28

<span class="enscript-comment">// Drivers participating in IOReporting can advertise channels by
</span><span class="enscript-comment">// publishing properties in the I/O Kit registry.  Various helper
</span><span class="enscript-comment">// mechanisms exist to produce correctly-formatted legends.
</span><span class="enscript-comment">// 12836893 tracks declaring channels in user space.
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportLegendPublicKey</span>        <span class="enscript-string">&quot;IOReportLegendPublic&quot;</span>      // bool
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportLegendKey</span>              <span class="enscript-string">&quot;IOReportLegend&quot;</span>            // arr
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportLegendChannelsKey</span>      <span class="enscript-string">&quot;IOReportChannels&quot;</span>          // arr
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportLegendGroupNameKey</span>     <span class="enscript-string">&quot;IOReportGroupName&quot;</span>         // str
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportLegendSubGroupNameKey</span>  <span class="enscript-string">&quot;IOReportSubGroupName&quot;</span>      // str
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportLegendInfoKey</span>          <span class="enscript-string">&quot;IOReportChannelInfo&quot;</span>       // dict
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportLegendUnitKey</span>          <span class="enscript-string">&quot;IOReportChannelUnit&quot;</span>       // num
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportLegendConfigKey</span>        <span class="enscript-string">&quot;IOReportChannelConfig&quot;</span>     // data
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportLegendStateNamesKey</span>    <span class="enscript-string">&quot;IOReportChannelStateNames&quot;</span> // str[]

<span class="enscript-comment">// in an I/O Kit registry legend, a small &quot;array struct&quot; represents a channel
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportChannelIDIdx</span>           0       // required
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportChannelTypeIdx</span>         1       // required
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportChannelNameIdx</span>         2       // optional
    
<span class="enscript-comment">// We are currently (internally) limited to 15 (broad!) categories.
</span>

<span class="enscript-comment">/*
   Units / Scaling Factors

   1. Implementation Details
   2. Unit Constants (kIOReportUnit...) for clients

   Please file radars if you need more units (IOReporting | X)
*/</span>

<span class="enscript-comment">// 1. Implementation Details
</span><span class="enscript-comment">// We are likely to someday support IOReporting data as stored binary data.
</span><span class="enscript-comment">// Don't change existing values lest that data become unreadable.
</span>
<span class="enscript-type">typedef</span> uint64_t IOReportUnits;
#<span class="enscript-reference">define</span> <span class="enscript-function-name">__IOR_MAKEUNIT</span>(quantity, scale) \
        (((IOReportUnits)quantity &lt;&lt; 56) | (uint64_t)scale)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">IOREPORT_GETUNIT_QUANTITY</span>(unit) \
        ((IOReportQuantity)((uint64_t)unit &gt;&gt; 56) &amp; 0xff)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">IOREPORT_GETUNIT_SCALE</span>(unit) \
        ((IOReportScaleFactor)unit &amp; 0x00ffffffffffffff)

<span class="enscript-comment">// 8b quantity + 32b const + 8b * 2^10 + 8b * 2^n + 8b cardinal + 8b unused
</span><span class="enscript-type">typedef</span> uint8_t IOReportQuantity;       <span class="enscript-comment">// SI &quot;quantity&quot; is what's measured
</span><span class="enscript-type">typedef</span> uint64_t IOReportScaleFactor;

<span class="enscript-comment">// See &lt;<a href="http://en.wikipedia.org/wiki/SI_base_unit">http://en.wikipedia.org/wiki/SI_base_unit</a>&gt; for a list
</span><span class="enscript-comment">// of quantities and their symbols.
</span><span class="enscript-type">enum</span> {
    <span class="enscript-comment">// used by state reports, etc
</span>    kIOReportQuantityUndefined = 0,

    kIOReportQuantityTime = 1,          <span class="enscript-comment">// Seconds
</span>    kIOReportQuantityPower = 2,         <span class="enscript-comment">// Watts
</span>    kIOReportQuantityEnergy = 3,        <span class="enscript-comment">// Joules
</span>    kIOReportQuantityCurrent = 4,       <span class="enscript-comment">// Amperes
</span>    kIOReportQuantityVoltage = 5,       <span class="enscript-comment">// Volts
</span>    kIOReportQuantityCapacitance = 6,   <span class="enscript-comment">// Farad
</span>    kIOReportQuantityInductance = 7,    <span class="enscript-comment">// Henry
</span>    kIOReportQuantityFrequency = 8,     <span class="enscript-comment">// Hertz
</span>    kIOReportQuantityData = 9,          <span class="enscript-comment">// bits/bytes (see scale)
</span>    kIOReportQuantityTemperature = 10,  <span class="enscript-comment">// Celsius (not Kelvin :)
</span>
    kIOReportQuantityEventCount = 100,
    kIOReportQuantityPacketCount = 101
};


<span class="enscript-comment">/* A number of units end up with both IEC (2^n) and SI (10^n) scale factors.
   For example, the &quot;MB&quot; of a 1.44 MB floppy or a 1024MHz clock.  We
   thus support separate 2^n and 10^n factors.  The exponent encoding
   scheme is modeled loosely on single-precision IEEE 754.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleConstMask</span> 0x000000007fffffff      // constant (<span class="enscript-string">&quot;uint31&quot;</span>)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleOneOver</span>   (1LL &lt;&lt; 31)             // 1/constant
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportExpBase</span>        (-127)                  // support base^(-n)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportExpZeroOffset</span>  -(kIOReportExpBase)     // max exponent = 128
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleSIShift</span>   32                      // * 10^n
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleSIMask</span>    0x000000ff00000000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleIECShift</span>  40                      // * 2^n
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleIECMask</span>   0x0000ff0000000000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportCardinalShift</span>  48                      // placeholders
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportCardinalMask</span>   0x00ff000000000000


<span class="enscript-comment">/*
   Scales are described as a factor times unity:
   1ms = kIOReportScaleMilli * s

   A value expressed in a scaled unit can be scaled to unity via
   multiplication by the constant:
   100ms * kIOReportScaleMilli [1e-3] = 0.1s.
*/</span>

<span class="enscript-comment">// SI / decimal
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScalePico</span>  ((-12LL + kIOReportExpZeroOffset)  \
                                        &lt;&lt; kIOReportScaleSIShift)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleNano</span>  ((-9LL + kIOReportExpZeroOffset)  \
                                        &lt;&lt; kIOReportScaleSIShift)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleMicro</span> ((-6LL + kIOReportExpZeroOffset)  \
                                        &lt;&lt; kIOReportScaleSIShift)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleMilli</span> ((-3LL + kIOReportExpZeroOffset)  \
                                        &lt;&lt; kIOReportScaleSIShift)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleUnity</span> 0    // 10^0 = 2^0 = 1
<span class="enscript-comment">// unity = 0 is a special case for which we give up exp = -127
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleKilo</span>  ((3LL + kIOReportExpZeroOffset)  \
                                        &lt;&lt; kIOReportScaleSIShift)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleMega</span>  ((6LL + kIOReportExpZeroOffset)  \
                                        &lt;&lt; kIOReportScaleSIShift)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleGiga</span>  ((9LL + kIOReportExpZeroOffset)  \
                                        &lt;&lt; kIOReportScaleSIShift)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleTera</span>  ((12LL + kIOReportExpZeroOffset)  \
                                        &lt;&lt; kIOReportScaleSIShift)

<span class="enscript-comment">// IEC / computer / binary
</span><span class="enscript-comment">// It's not clear we'll ever use 2^(-n), but 1..2^~120 should suffice.
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleBits</span>  kIOReportScaleUnity
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleBytes</span>     ((3LL + kIOReportExpZeroOffset)  \
                                            &lt;&lt; kIOReportScaleIECShift)
<span class="enscript-comment">// (bytes have to be added to the exponents up front, can't just OR in)
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleKibi</span>      ((10LL + kIOReportExpZeroOffset)  \
                                            &lt;&lt; kIOReportScaleIECShift)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleKiBytes</span>   ((13LL + kIOReportExpZeroOffset)  \
                                            &lt;&lt; kIOReportScaleIECShift)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleMebi</span>      ((20LL + kIOReportExpZeroOffset)  \
                                            &lt;&lt; kIOReportScaleIECShift)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleMiBytes</span>   ((23LL + kIOReportExpZeroOffset)  \
                                            &lt;&lt; kIOReportScaleIECShift)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleGibi</span>      ((30LL + kIOReportExpZeroOffset)  \
                                            &lt;&lt; kIOReportScaleIECShift)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleGiBytes</span>   ((33LL + kIOReportExpZeroOffset)  \
                                            &lt;&lt; kIOReportScaleIECShift)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleTebi</span>      ((40LL + kIOReportExpZeroOffset)  \
                                            &lt;&lt; kIOReportScaleIECShift)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleTiBytes</span>   ((43LL + kIOReportExpZeroOffset)  \
                                            &lt;&lt; kIOReportScaleIECShift)
<span class="enscript-comment">// can't encode more than 2^125 (keeping bits &amp; bytes inside -126..128)
</span><span class="enscript-comment">// Also, IOReportScaleValue() is currently limited internally by uint64_t.
</span>

<span class="enscript-comment">// Cardinal values, to be filled in appropriately.
</span><span class="enscript-comment">// Add values in increasing order.
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleMachHWTicks</span>   (1LL &lt;&lt; kIOReportCardinalShift)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScaleHWPageSize</span>    (2LL &lt;&lt; kIOReportCardinalShift)

<span class="enscript-comment">// page scales: 2 pages * 4ikB/page = 8096 bytes
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScale4KiB</span>      (4 | kIOReportScaleKiBytes)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScale8KiB</span>      (8 | kIOReportScaleKiBytes)

<span class="enscript-comment">// Clock frequencies scales (units add seconds).
</span><span class="enscript-comment">// 1 GHz ticks are 1 ns: 1000 ticks * 1e-6 = 1e-3s
</span><span class="enscript-comment">// The '1' is a no-op, but allows a custom label.
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScale1GHz</span>      (1 | kIOReportScaleNano)
<span class="enscript-comment">// 24MHz ticks are 1/24 of a microsecond: (1/24 * kIOReportScaleMicro [1e-6])s
</span><span class="enscript-comment">// So for example, 240 24Mticks * 1/24 * 1e-6 = .00001s [1e-5]s
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportScale24MHz</span>     (kIOReportScaleOneOver|24 |kIOReportScaleMicro)

<span class="enscript-comment">// --- END: implementation details
</span>
<span class="enscript-comment">// 2. Units Constants 
</span><span class="enscript-comment">// --- BEGIN: units constants driver writers might use
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportUnitNone</span>       __IOR_MAKEUNIT(kIOReportQuantityUndefined,  \
                                                  kIOReportScaleUnity)
    
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportUnit_s</span>         __IOR_MAKEUNIT(kIOReportQuantityTime,  \
                                               kIOReportScaleUnity)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportUnit_ms</span>        __IOR_MAKEUNIT(kIOReportQuantityTime,  \
                                               kIOReportScaleMilli)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportUnit_us</span>        __IOR_MAKEUNIT(kIOReportQuantityTime,  \
                                               kIOReportScaleMicro)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportUnit_ns</span>        __IOR_MAKEUNIT(kIOReportQuantityTime,  \
                                               kIOReportScaleNano)
    
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportUnit_J</span>         __IOR_MAKEUNIT(kIOReportQuantityEnergy,  \
                                               kIOReportScaleUnity)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportUnit_mJ</span>        __IOR_MAKEUNIT(kIOReportQuantityEnergy,  \
                                               kIOReportScaleMilli)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportUnit_uJ</span>        __IOR_MAKEUNIT(kIOReportQuantityEnergy,  \
                                               kIOReportScaleMicro)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportUnit_nJ</span>        __IOR_MAKEUNIT(kIOReportQuantityEnergy,  \
                                               kIOReportScaleNano)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportUnit_pJ</span>        __IOR_MAKEUNIT(kIOReportQuantityEnergy,  \
                                               kIOReportScalePico)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportUnitHWTicks</span>    __IOR_MAKEUNIT(kIOReportQuantityTime,  \
                                               kIOReportScaleMachHWTicks)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportUnit24MHzTicks</span> __IOR_MAKEUNIT(kIOReportQuantityTime,  \
                                               kIOReportScale24MHz)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportUnit1GHzTicks</span>  __IOR_MAKEUNIT(kIOReportQuantityTime,  \
                                               kIOReportScale1GHz)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportUnitBits</span>       __IOR_MAKEUNIT(kIOReportQuantityData,  \
                                                kIOReportScaleBits)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportUnitBytes</span>      __IOR_MAKEUNIT(kIOReportQuantityData,  \
                                                kIOReportScaleBytes)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportUnit_KiB</span>       __IOR_MAKEUNIT(kIOReportQuantityData,  \
                                               kIOReportScaleKiBytes)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportUnitEvents</span>     __IOR_MAKEUNIT(kIOReportQuantityEventCount,  \
                                               kIOReportScaleUnity)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOReportUnitPackets</span>    __IOR_MAKEUNIT(kIOReportQuantityPacketCount,  \
                                               kIOReportScaleUnity)

<span class="enscript-comment">// Please file radars if you need more units (IOReporting | X)
</span>    
<span class="enscript-comment">// --- END: unit constants driver writers might use
</span>    
<span class="enscript-comment">/*  Histogram Segment Configuration
    Currently supports 2 types of scaling to compute bucket upper bounds,
    linear or exponential.
    scale_flag = 0 -&gt; linear scale
                 1 -&gt; exponential scale
    upper_bound[n] = (scale_flag) ? pow(base,(n+1)) : base * (n+1);
*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOHistogramScaleLinear</span> 0
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOHistogramScaleExponential</span> 1
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
    uint32_t    base_bucket_width;    <span class="enscript-comment">// segment[0].bucket[0] = [0, base_width]
</span>    uint32_t    scale_flag;           <span class="enscript-comment">// bit 0 only in current use (see #defs)
</span>    uint32_t    segment_idx;          <span class="enscript-comment">// for multiple segments histograms
</span>    uint32_t    segment_bucket_count; <span class="enscript-comment">// number of buckets in this segment
</span>} __attribute((packed)) IOHistogramSegmentConfig;

<span class="enscript-comment">// &quot;normalized distribution&quot;(FIXME?) internal format (unused?)
</span><span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
    uint64_t    samples;
    uint64_t    mean;
    uint64_t    variance;
    uint64_t    reserved;
} __attribute((packed)) IONormDistReportValues;
    
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__cplusplus</span>
}
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">endif</span> // <span class="enscript-variable-name">_IOKERNELREPORTSTRUCTS_H_</span>
</pre>
<hr />
</body></html>