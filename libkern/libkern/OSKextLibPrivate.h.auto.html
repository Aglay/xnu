<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>OSKextLibPrivate.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">OSKextLibPrivate.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 1998-2000 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_LIBKERN_OSKEXTLIBPRIVATE_H</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_LIBKERN_OSKEXTLIBPRIVATE_H</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/cdefs.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;uuid/uuid.h&gt;</span>

__BEGIN_DECLS
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;libkern/OSTypes.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/kmod.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/vm_types.h&gt;</span>
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;CoreFoundation/CoreFoundation.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/kmod.h&gt;</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL */</span>
__END_DECLS

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;libkern/OSReturn.h&gt;</span>

__BEGIN_DECLS

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Misc</span> <span class="enscript-variable-name">Constants</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-type">typedef</span> uint8_t OSKextExcludeLevel;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextExcludeNone</span>  (0)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextExcludeKext</span>  (1)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextExcludeAll</span>   (2)

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Kext</span>/<span class="enscript-variable-name">OSBundle</span> <span class="enscript-variable-name">Property</span> <span class="enscript-variable-name">List</span> <span class="enscript-variable-name">Keys</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*!
 * @define   kOSBundleHelperKey
 * @abstract Used by loginwindow.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleHelperKey</span>      <span class="enscript-string">&quot;OSBundleHelper&quot;</span>

<span class="enscript-comment">/*!
 * @define   kOSBundleDeveloperOnlyKey
 * @abstract A boolean value indicating whether the kext should only load on
 *           Developer devices.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleDeveloperOnlyKey</span>		<span class="enscript-string">&quot;OSBundleDeveloperOnly&quot;</span>

<span class="enscript-comment">/*!
 * @define   kOSBundleRamDiskOnlyKey
 * @abstract A boolean value indicating whether the kext should only load when
 *           booted from a ram disk.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleRamDiskOnlyKey</span>		<span class="enscript-string">&quot;OSBundleRamDiskOnly&quot;</span>


<span class="enscript-comment">/*!
 * @define   kAppleSecurityExtensionKey
 * @abstract A boolean value indicating whether the kext registers
 *           MACF hooks.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kAppleSecurityExtensionKey</span>	<span class="enscript-string">&quot;AppleSecurityExtension&quot;</span>

<span class="enscript-comment">/*!
 * @define   kAppleKernelExternalComponentKey
 * @abstract A boolean value indicating whether the kext is vending kernel
 *           KPI, and needs special loading behavior.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kAppleKernelExternalComponentKey</span>	<span class="enscript-string">&quot;AppleKernelExternalComponent&quot;</span>

<span class="enscript-comment">// properties found in the registry root
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKernelCPUTypeKey</span>             <span class="enscript-string">&quot;OSKernelCPUType&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKernelCPUSubtypeKey</span>          <span class="enscript-string">&quot;OSKernelCPUSubtype&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSStartupMkextCRC</span>              <span class="enscript-string">&quot;OSStartupMkextCRC&quot;</span>             <span class="enscript-comment">/* value is 32-bit OSData */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSPrelinkKextCountKey</span>          <span class="enscript-string">&quot;OSPrelinkKextCount&quot;</span>            <span class="enscript-comment">/* value is 32-bit OSNumber */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSPrelinkPersonalityCountKey</span>   <span class="enscript-string">&quot;OSPrelinkPersonalityCount&quot;</span>     <span class="enscript-comment">/* value is 32-bit OSNumber */</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Load</span> <span class="enscript-variable-name">Info</span> <span class="enscript-variable-name">Keys</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>
<span class="enscript-comment">/*********************************************************************
* In addition to the keys defined here, you will find:
*   kCFBundleIdentifierKey
*   kCFBundleVersionKey
*   kOSBundleCompatibleVersionKey
*   kOSBundleIsInterfaceKey
*   kOSKernelResourceKey
*********************************************************************/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleMachOHeadersKey</span>                <span class="enscript-string">&quot;OSBundleMachOHeaders&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleCPUTypeKey</span>                     <span class="enscript-string">&quot;OSBundleCPUType&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleCPUSubtypeKey</span>                  <span class="enscript-string">&quot;OSBundleCPUSubtype&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundlePathKey</span>                        <span class="enscript-string">&quot;OSBundlePath&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleExecutablePathKey</span>              <span class="enscript-string">&quot;OSBundleExecutablePath&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleUUIDKey</span>                        <span class="enscript-string">&quot;OSBundleUUID&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleStartedKey</span>                     <span class="enscript-string">&quot;OSBundleStarted&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundlePrelinkedKey</span>                   <span class="enscript-string">&quot;OSBundlePrelinked&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleLoadTagKey</span>                     <span class="enscript-string">&quot;OSBundleLoadTag&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleLoadAddressKey</span>                 <span class="enscript-string">&quot;OSBundleLoadAddress&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleLoadSizeKey</span>                    <span class="enscript-string">&quot;OSBundleLoadSize&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleWiredSizeKey</span>                   <span class="enscript-string">&quot;OSBundleWiredSize&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleDependenciesKey</span>                <span class="enscript-string">&quot;OSBundleDependencies&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleRetainCountKey</span>                 <span class="enscript-string">&quot;OSBundleRetainCount&quot;</span>

<span class="enscript-comment">/* Dictionary of metaclass info keyed by classname.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleClassesKey</span>                     <span class="enscript-string">&quot;OSBundleClasses&quot;</span>

<span class="enscript-comment">/* These are contained in kOSBundleClassesKey. kOSMetaClassSuperclassNameKey
 * may be absent (for the root class).
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSMetaClassNameKey</span>                     <span class="enscript-string">&quot;OSMetaClassName&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSMetaClassSuperclassNameKey</span>           <span class="enscript-string">&quot;OSMetaClassSuperclassName&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSMetaClassTrackingCountKey</span>            <span class="enscript-string">&quot;OSMetaClassTrackingCount&quot;</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Kext</span> <span class="enscript-variable-name">Log</span> <span class="enscript-variable-name">Specification</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>
<span class="enscript-comment">/*!
 * @group Kext Log Specification
 * Logging levels &amp; flags for kernel extensions.
 * See &lt;code&gt;@link //apple_ref/c/tdef/OSKextLogSpec OSKextLogSpec@/link&lt;/code&gt;
 * for an overview.
 */</span>

<span class="enscript-comment">/*!
 * @typedef  OSKextLogSpec
 * @abstract Describes what a log message applies to,
 *           or a filter that determines which log messages are displayed.
 *
 * @discussion
 * A kext log specification is a 32-bit value used as a desription of
 * what a given log message applies to, or as a filter
 * indicating which log messages are desired and which are not.
 * A log specification has three parts (described in detail shortly):
 * &lt;ul&gt;
 *   &lt;li&gt;A &lt;b&gt;level&lt;/b&gt; from 0-7 in the lowest-order nibble (0x7).&lt;/li&gt;
 *   &lt;li&gt;A flag bit in the lowest-order nibble (0x8) indicating whether
 *       log messages tied to individual kexts are always printed (1)
 *       or printed only if the kext has an 
 *       @link //apple_ref/c/macro/kOSBundleEnableKextLoggingKey
 *       OSBundleEnableKextLogging@/link set to &lt;code&gt;true&lt;/code&gt;.
 *   &lt;li&gt;A set of &lt;b&gt;activity flags&lt;/b&gt; in the remaining nibbles (0xFFFFFFF0),
 *       which describe areas of activity related to kernel extensions.&lt;/li&gt;
 * &lt;/ul&gt;
 *
 * You can specify a log spec to most of the kext tools with the -v option
 * and a hex number (rather than the escalating decimal levels 0-6).
 * You can also specify a log spec to the kernel with the &quot;kextlog&quot; boot arg
 * or &quot;debug.kextlog&quot; sysctl.
 *
 * &lt;b&gt;Log Levels&lt;/b&gt;
 *
 * The log level spans a range from silent (no log messages)
 * to debuging information:
 *
 * &lt;ol start=&quot;0&quot;&gt;
 * &lt;li&gt;Silent - Not applicable to messages; as a filter, do not print any log messages.&lt;/li&gt;
 * &lt;li&gt;Errors - Log message is an error.
 * &lt;li&gt;Warnings - Log message is a warning.
 * &lt;li&gt;Basic information - Log message is basic success/failure.&lt;/li&gt;
 * &lt;li&gt;Progress - Provides high-level information about stages in processing.&lt;/li&gt;
 * &lt;li&gt;Step - Provides low-level information about complex operations,
 *          typically about individual kexts.&lt;/li&gt;
 * &lt;li&gt;Detail - Provides very low-level information about parts of kexts,
 *          including individual Libkern classes and operations on bundle files.&lt;/li&gt;
 * &lt;li&gt;Debug - Very verbose logging about internal activities.&lt;/li&gt;
 * &lt;/ol&gt;
 *
 * Log messages at
 * &lt;code&gt;@link kOSKextLogErrorLevel kOSKextLogErrorLevel@/link&lt;/code&gt; or
 * &lt;code&gt;@link kOSKextLogWarningLevel kOSKextLogWarningLevel@/link&lt;/code&gt;
 * ignore activity flags and the
 * @link //apple_ref/c/macro/kOSBundleEnableKextLoggingKey
 * OSBundleEnableKextLogging@/link property;
 * that is, only the filter level is checked for messages at these levels.
 * Log messages at levels above
 * &lt;code&gt;@link kOSKextLogWarningLevel kOSKextLogWarningLevel@/link&lt;/code&gt;
 * are filtered according both to the activity flags in the current filter
 * and to whether the log message is associated with a kext or not.
 * Normally log messages associated with kexts are not printed
 * unless the kext has a
 * @link //apple_ref/c/macro/kOSBundleEnableKextLoggingKey
 * OSBundleEnableKextLogging@/link property set to &lt;code&gt;true&lt;/code&gt;.
 * If you set the high-order bit of the log level (that is, add 8 to the level),
 * then all kext-specific log messages matching the activity flags are printed.
 * This can be very verbose.
 *
 * &lt;b&gt;Activity Flags&lt;/b&gt;
 *
 * Each flag governs a category of activity,
 * such as loading, IPC, or archives; by combining them with bitwise OR,
 * you can choose which messages you wish to see (or when logging messages,
 * which bit flags select your message).
 *
 * &lt;b&gt;Byte 1:&lt;/b&gt; &lt;code&gt;0xF0&lt;/code&gt; - Basic activities
 * (&lt;code&gt;@link kOSKextLogGeneralFlag kOSKextLogGeneralFlag@/link&lt;/code&gt;,
 * &lt;code&gt;@link kOSKextLogLoadFlag kOSKextLogLoadFlag@/link&lt;/code&gt;, and
 * &lt;code&gt;@link kOSKextLogArchiveFlag kOSKextLogArchiveFlag@/link&lt;/code&gt;).
 *
 * &lt;b&gt;Byte 2:&lt;/b&gt; &lt;code&gt;0xF00&lt;/code&gt; - Reserved.
 *
 * &lt;b&gt;Byte 4:&lt;/b&gt; &lt;code&gt;0xF000&lt;/code&gt; - Kext diagnostics
 * (&lt;code&gt;@link kOSKextLogValidationFlag kOSKextLogValidationFlag@/link&lt;/code&gt;,
 * &lt;code&gt;@link kOSKextLogAuthenticationFlag kOSKextLogAuthenticationFlag@/link&lt;/code&gt;, and
 * &lt;code&gt;@link kOSKextLogDependenciesFlag kOSKextLogDependenciesFlag@/link&lt;/code&gt;).
 *
 * &lt;b&gt;Byte 5:&lt;/b&gt; &lt;code&gt;0xF00000&lt;/code&gt; - Kext access &amp; bookkeeping
 * (&lt;code&gt;@link kOSKextLogDirectoryScanFlag kOSKextLogDirectoryScanFlag@/link&lt;/code&gt;,
 * &lt;code&gt;@link kOSKextLogFileAccessFlag kOSKextLogFileAccessFlag@/link&lt;/code&gt;,
 * &lt;code&gt;@link kOSKextLogKextBookkeepingFlag kOSKextLogKextBookkeepingFlag@/link &lt;/code&gt;).
 *
 * &lt;b&gt;Byte 6:&lt;/b&gt; &lt;code&gt;0xF000000&lt;/code&gt; - Linking &amp; patching
 * (&lt;code&gt;@link kOSKextLogLinkFlag kOSKextLogLinkFlag@/link&lt;/code&gt; and
 * &lt;code&gt;@link kOSKextLogPatchFlag kOSKextLogPatchFlag@/link&lt;/code&gt;).
 *
 * &lt;b&gt;Byte 7:&lt;/b&gt; &lt;code&gt;0xF0000000&lt;/code&gt; - Reserved.
 */</span>
<span class="enscript-type">typedef</span> uint32_t OSKextLogSpec;

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Masks</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>
<span class="enscript-comment">/*!
 * @define   kOSKextLogLevelMask
 * @abstract Masks the bottom 3 bits of an
 *           &lt;code&gt;@link OSKextLogSpec OSKextLogSpec@/link&lt;/code&gt; to extract
 *           the raw level.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogLevelMask</span>              ((OSKextLogSpec) 0x00000007)

<span class="enscript-comment">/*!
 * @define   kOSKextLogKextOrGlobalMask
 * @abstract Determines whether per-kext log messages are output.
 *
 * @discussion
 * In filter specifications, if unset (the usual default),
 * then log messages associated with a kext are only output
 * if the kext has an
 * @link //apple_ref/c/macro/kOSBundleEnableKextLoggingKey
 * OSBundleEnableKextLogging@/link
 * property set to &lt;code&gt;true&lt;/code&gt;.
 * If set, then all log messages associated with kexts
 * are output.
 *
 * In message specifications, if set it indicates that the message is either
 * not associated with a kext, or is associated with a kext that has an
 * @link //apple_ref/c/macro/kOSBundleEnableKextLoggingKey
 * OSBundleEnableKextLogging@/link
 * property set to &lt;code&gt;true&lt;/code&gt;.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogKextOrGlobalMask</span>       ((OSKextLogSpec) 0x00000008)


<span class="enscript-comment">/*!
 * @define   kOSKextLogFlagsMask
 * @abstract Masks the flag bits of an
 *           &lt;code&gt;@link OSKextLogSpec OSKextLogSpec@/link&lt;/code&gt;.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogFlagsMask</span>              ((OSKextLogSpec) 0x0ffffff0)

<span class="enscript-comment">/*!
 * @define   kOSKextLogFlagsMask
 * @abstract Masks the flag bits of an
 *           &lt;code&gt;@link OSKextLogSpec OSKextLogSpec@/link&lt;/code&gt;
 *           to which command-line &lt;code&gt;-v&lt;/code&gt; levels apply.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogVerboseFlagsMask</span>       ((OSKextLogSpec) 0x00000ff0)

<span class="enscript-comment">/*!
 * @define   kOSKextLogConfigMask
 * @abstract Masks the config bits of an
 *           &lt;code&gt;@link OSKextLogSpec OSKextLogSpec@/link&lt;/code&gt;.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogConfigMask</span>             ((OSKextLogSpec) 0xf0000000)

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> 0xF - <span class="enscript-variable-name">Log</span> <span class="enscript-variable-name">Level</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*!
 * @define   kOSKextLogExplicitLevel
 * @abstract Used when logging a message to overrides the current log filter,
 *           even if it's set to silent for log messages.
 *           This is essentially a pass-through for
 *           unconditional print messages to go
 *           through the logging engine.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogExplicitLevel</span>          ((OSKextLogSpec)        0x0)

<span class="enscript-comment">/*!
 * @define   kOSKextLogErrorLevel
 * @abstract Log messages concerning error conditions in any category.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogErrorLevel</span>            ((OSKextLogSpec)        0x1)


<span class="enscript-comment">/*!
 * @define   kOSKextLogWarningLevel
 * @abstract Log messages concerning warning conditions in any category,
 *           which indicate potential error conditions,
 *           and notices, which may explain unexpected but correct behavior.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogWarningLevel</span>          ((OSKextLogSpec)        0x2)


<span class="enscript-comment">/*!
 * @define   kOSKextLogBasicLevel
 * @abstract Log messages concerning top-level outcome in any category
 *           (kext load/unload, kext cache creation/extration w/# kexts).
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogBasicLevel</span>           ((OSKextLogSpec)        0x3)


<span class="enscript-comment">/*!
 * @define   kOSKextLogProgressLevel
 * @abstract Log messages concerning high-level progress in any category,
 *           such as sending a load request to the kernel,
 *           allocation/link/map/start (load operation),
 *           stop/unmap (unload operation), kext added/extracted (archive).
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogProgressLevel</span>          ((OSKextLogSpec)        0x4)


<span class="enscript-comment">/*!
 * @define   kOSKextLogStepLevel
 * @abstract Log messages concerning major steps in any category,
 *           such as sending personalities to the IOCatalogue when loading,
 *           detailed IPC with the kernel, or filtering of kexts for an archive.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogStepLevel</span>             ((OSKextLogSpec)        0x5)


<span class="enscript-comment">/*!
 * @define   kOSKextLogDetailLevel
 * @abstract Log messages concerning specific details in any category,
 *           such as classes being registered/unregistered or
 *           operations on indivdual files in a kext.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogDetailLevel</span>           ((OSKextLogSpec)        0x6)


<span class="enscript-comment">/*!
 * @define   kOSKextLogDebugLevel
 * @abstract Log messages concerning very low-level actions that are
 *           useful mainly for debugging the kext system itself.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogDebugLevel</span>             ((OSKextLogSpec)        0x7)


#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> 0xF0 - <span class="enscript-variable-name">General</span> <span class="enscript-variable-name">Activity</span>, <span class="enscript-variable-name">Load</span>, <span class="enscript-variable-name">Kernel</span> <span class="enscript-variable-name">IPC</span>, <span class="enscript-variable-name">Personalities</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*!
 * @define   kOSKextLogGeneralFlag
 * @abstract Log messages about general activity in the kext system.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogGeneralFlag</span>            ((OSKextLogSpec)       0x10)

<span class="enscript-comment">/*!
 * @define   kOSKextLogLoadFlag
 * @abstract Log messages regarding kernel extension load, start/stop, or unload activity
 *           in the kernel.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogLoadFlag</span>               ((OSKextLogSpec)       0x20)

<span class="enscript-comment">/*!
 * @define   kOSKextLogIPCFlag
 * @abstract Log messages about any interaction between kernel and user space
 *           regarding kernel extensions.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogIPCFlag</span>                ((OSKextLogSpec)       0x40)

<span class="enscript-comment">/*!
 * @define   kOSKextLogArchiveFlag
 * @abstract Log messages about creating or processing a kext startup cache file
 *           (mkext or prelinked kernel).
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogArchiveFlag</span>           ((OSKextLogSpec)       0x80)


#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> 0xF00 - <span class="enscript-variable-name">Reserved</span> <span class="enscript-variable-name">Verbose</span> <span class="enscript-variable-name">Area</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>
<span class="enscript-comment">// reserved slot for group               ((OSKextLogSpec)      0x100)
</span><span class="enscript-comment">// reserved slot for group               ((OSKextLogSpec)      0x200)
</span><span class="enscript-comment">// reserved slot for group               ((OSKextLogSpec)      0x400)
</span><span class="enscript-comment">// reserved slot for group               ((OSKextLogSpec)      0x800)
</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> 0xF000 - <span class="enscript-variable-name">Kext</span> <span class="enscript-variable-name">diagnostic</span> <span class="enscript-variable-name">activity</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*!
 * @define   kOSKextLogValidationFlag
 * @abstract Log messages when validating kernel extensions.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogValidationFlag</span>         ((OSKextLogSpec)     0x1000)

<span class="enscript-comment">/*!
 * @define   kOSKextLogAuthenticationFlag
 * @abstract Log messages when autnenticating kernel extension files.
 *           Irrelevant in the kernel.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogAuthenticationFlag</span>     ((OSKextLogSpec)     0x2000)

<span class="enscript-comment">/*!
 * @define   kOSKextLogDependenciesFlag
 * @abstract Log messages when resolving dependencies for a kernel extension.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogDependenciesFlag</span>       ((OSKextLogSpec)     0x4000)

<span class="enscript-comment">// reserved slot for group               ((OSKextLogSpec)     0x8000)
</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> 0xF0000 - <span class="enscript-variable-name">Archives</span>, <span class="enscript-variable-name">caches</span>, <span class="enscript-variable-name">directory</span> <span class="enscript-variable-name">scan</span>, <span class="enscript-variable-name">file</span> <span class="enscript-variable-name">access</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*!
 * @define   kOSKextLogDirectoryScanFlag
 * @abstract Log messages when scanning directories for kernel extensions.
 *           In the kernel logs every booter kext entry processed.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogDirectoryScanFlag</span>      ((OSKextLogSpec)    0x10000)

<span class="enscript-comment">/*!
 * @define   kOSKextLogFileAccessFlag
 * @abstract Log messages when performing any filesystem access (very verbose).
 *           Irrelevant in the kernel.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogFileAccessFlag</span>         ((OSKextLogSpec)    0x20000)

<span class="enscript-comment">/*!
 * @define   kOSKextLogKextBookkeepingFlag
 * @abstract Log messages about internal tracking of kexts. Can be very verbose.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogKextBookkeepingFlag</span>    ((OSKextLogSpec)    0x40000)

<span class="enscript-comment">// reserved slot for group               ((OSKextLogSpec)    0x80000)
</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> 0xF00000 - <span class="enscript-variable-name">Linking</span> &amp; <span class="enscript-variable-name">Patching</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*!
 * @define   kOSKextLogLinkFlag
 * @abstract Log messages about linking.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogLinkFlag</span>               ((OSKextLogSpec)   0x100000)

<span class="enscript-comment">/*!
 * @define   kOSKextLogPatchFlag
 * @abstract Log messages about patching.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogPatchFlag</span>              ((OSKextLogSpec)   0x200000)

<span class="enscript-comment">// reserved slot for group               ((OSKextLogSpec)   0x400000)
</span><span class="enscript-comment">// reserved slot for group               ((OSKextLogSpec)   0x800000)
</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> 0xF000000 - <span class="enscript-variable-name">Reserved</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// reserved slot for grouping            ((OSKextLogSpec)  0x1000000)
</span><span class="enscript-comment">// reserved slot for grouping            ((OSKextLogSpec)  0x2000000)
</span><span class="enscript-comment">// reserved slot for grouping            ((OSKextLogSpec)  0x4000000)
</span><span class="enscript-comment">// reserved slot for grouping            ((OSKextLogSpec)  0x8000000)
</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> 0xF0000000 - <span class="enscript-variable-name">Config</span> <span class="enscript-variable-name">Flags</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// reserved slot for grouping            ((OSKextLogSpec) 0x10000000)
</span><span class="enscript-comment">// reserved slot for grouping            ((OSKextLogSpec) 0x20000000)
</span><span class="enscript-comment">// reserved slot for grouping            ((OSKextLogSpec) 0x40000000)
</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Predefined</span> <span class="enscript-variable-name">Specifications</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*!
 * @define   kOSKextLogSilentFilter
 * @abstract For use in filter specs:
 *           Ignore all log messages with a log level greater than
 *           &lt;code&gt;@link kOSKextLogExplicitLevel kOSKextLogExplicitLevel@/link&lt;/code&gt;.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogSilentFilter</span>           ((OSKextLogSpec)        0x0)

<span class="enscript-comment">/*!
 * @define   kOSKextLogShowAllFilter
 * @abstract For use in filter specs:
 *           Print all log messages not associated with a kext or
 *           associated with a kext that has
 *           @link //apple_ref/c/macro/kOSBundleEnableKextLoggingKey
 *           OSBundleEnableKextLogging@/link
 *           set to &lt;code&gt;true&lt;/code&gt;.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogShowAllFilter</span>          ((OSKextLogSpec) 0x0ffffff7)

<span class="enscript-comment">/*!
 * @define   kOSKextLogShowAllKextsFilter
 * @abstract For use in filter specs:
 *           Print all log messages has
 *           @link //apple_ref/c/macro/kOSBundleEnableKextLoggingKey
 *           OSBundleEnableKextLogging@/link
 *           set to &lt;code&gt;true&lt;/code&gt;.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLogShowAllKextsFilter</span>     ((OSKextLogSpec) \
                                           (kOSKextLogShowAllFilter | \
                                            kOSKextLogKextOrGlobalMask))

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Kext</span> <span class="enscript-variable-name">Version</span> <span class="enscript-variable-name">String</span> <span class="enscript-variable-name">Processing</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>
<span class="enscript-comment">/*!
 * @group Kext Version String Processing
 * Functions for working with kext versions and compatible versions.
 */</span>
 
<span class="enscript-comment">/*!
 * @typedef   OSKextVersion
 * @abstract  An encoded kext version that can be compared arithmetically.
 *
 * @discussion
 * A value of zero (&lt;code&gt;@link kOSKextVersionUndefined kOSKextVersionUndefined@/link&lt;/code&gt;)
 * is &lt;i&gt;not&lt;/i&gt; equivalent to a version string of &quot;0.0&quot;,
 * and typically means there is no version specified
 * (for example, that there is no CFBundleVersion property at all).
 * Values below zero are invalid.
 *
 * The encoding used is subject to change,
 * and should never be saved to permanent storage.
 * Always use proper version strings in files and interprocess communication.
 */</span>
<span class="enscript-type">typedef</span> int64_t OSKextVersion;

<span class="enscript-comment">/*!
 * @define    kOSKextVersionMaxLength
 * @abstract  The length of a string buffer
 *            guaranteed to be able to hold a kext version.
 *
 * @discussion
 * Kext versions use an extended Mac OS 'vers' format with double the number
 * of digits before the build stage: ####.##.##s{1-255} where 's'
 * is a build stage 'd', 'a', 'b', 'f' or 'fc'.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextVersionMaxLength</span> (20)
<span class="enscript-comment">// with a few bytes to spare including a nul byte
</span><span class="enscript-comment">// xx-review: Should we make this much bigger in case we ever need longer strings?
</span>
<span class="enscript-comment">/*!
 * @define    kOSKextVersionUndefined
 * @abstract  The undefined version.
 *
 * @discussion
 * This value of &lt;code&gt;@link OSKextVersion OSKextVersion@/link&lt;/code&gt; represents the
 * lack of a version
 * (for example, that there is no CFBundleVersion property at all).
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextVersionUndefined</span>  (0)

<span class="enscript-comment">/*!
 * @function OSKextParseVersionString
 *
 * @abstract
 * Parses a kext version string into an &lt;code&gt;@link OSKextVersion OSKextVersion@/link&lt;/code&gt;.
 *
 * @param  versionString  The kext version string to parse.
 *
 * @result
 * An encoded kext version that can be compared numerically
 * against other encoded kext versions,
 * &lt;0 if &lt;code&gt;versionString&lt;/code&gt; is &lt;code&gt;NULL&lt;/code&gt;, empty,
 * or cannot be parsed.
 *
 * @discussion
 * Kext versions use an extended Mac OS 'vers' format with double the number
 * of digits before the build stage: ####.##.##s{1-255} where 's'
 * is a build stage 'd', 'a', 'b', 'f' or 'fc'.
 */</span>
OSKextVersion <span class="enscript-function-name">OSKextParseVersionString</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> * versionString);


<span class="enscript-comment">/*!
 * @function OSKextVersionGetString
 *
 * @abstract
 * Formats an encoded &lt;code&gt;@link OSKextVersion OSKextVersion@/link&lt;/code&gt; into a string
 * representation.
 *
 * @param  aVersion
 *         The encoded version to format.
 * @param  buffer
 *         A C string buffer of at least
 *         &lt;code&gt;@link kOSKextVersionMaxLength kOSKextVersionMaxLength@/link&lt;/code&gt; bytes.
 * @param  bufferSize  The size in bytes of &lt;code&gt;buffer&lt;/code&gt;.
 *
 * @result
 * &lt;code&gt;TRUE&lt;/code&gt; if the encoded version is formatted successfully.
 * &lt;code&gt;FALSE&lt;/code&gt; if &lt;code&gt;buffer&lt;/code&gt; is &lt;code&gt;NULL&lt;/code&gt; or
 * &lt;code&gt;bufferSize&lt;/code&gt; is less than
 * &lt;code&gt;@link kOSKextVersionMaxLength kOSKextVersionMaxLength@/link&lt;/code&gt;.
 *
 * @discussion
 * The return value strictly indicates whether &lt;code&gt;buffer&lt;/code&gt;
 * is large enough to hold the result.
 * If &lt;code&gt;aVersion&lt;/code&gt; is 0, the resulting string is &quot;(missing)&quot;.
 * If &lt;code&gt;aVersion&lt;/code&gt; is less than 0
 * or is not a valid kext version encoding,
 * the resulting string is &quot;(invalid)&quot;.
 */</span>
Boolean <span class="enscript-function-name">OSKextVersionGetString</span>(
    OSKextVersion   aVersion,
    <span class="enscript-type">char</span>          * buffer,
    uint32_t        bufferSize);


#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>


#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Weak</span> <span class="enscript-variable-name">linking</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
<span class="enscript-type">void</span> <span class="enscript-function-name">kext_weak_symbol_referenced</span>(<span class="enscript-type">void</span>);
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Miscellaneous</span> <span class="enscript-variable-name">Kernel</span>-<span class="enscript-variable-name">Only</span> <span class="enscript-variable-name">Kext</span> <span class="enscript-variable-name">Functions</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*!
 * @function kext_get_vm_map
 * @abstract Returns the vm_map from which the kext was allocated.
 *
 * @param info The kmod_info_t structure of the kext.
 * @result The vm_map from which the kext was allocated.  This function
 * cannot return &lt;code&gt;NULL&lt;/code&gt;.
 */</span>
vm_map_t <span class="enscript-function-name">kext_get_vm_map</span>(kmod_info_t * info);

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">CONFIG_DTRACE</span>
<span class="enscript-comment">/*!
 * @function OSKextRegisterKextsWithDTrace
 * @abstract
 * DTrace calls this once when it has started up so that the kext system
 * will register any already-loaded kexts with it.
 */</span>
<span class="enscript-type">void</span> <span class="enscript-function-name">OSKextRegisterKextsWithDTrace</span>(<span class="enscript-type">void</span>);

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* CONFIG_DTRACE */</span>

<span class="enscript-comment">/*!
 * @function kext_dump_panic_lists
 * @abstract Prints compacted lists of last unloaded &amp; all loaded kexts
 *           during a panic.
 *
 * @param printf_func The printf-style function to use for output.
 */</span>
<span class="enscript-type">void</span> <span class="enscript-function-name">kext_dump_panic_lists</span>(<span class="enscript-type">int</span> (*printf_func)(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *fmt, ...));

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Kext</span> <span class="enscript-variable-name">Loading</span> <span class="enscript-variable-name">C</span> <span class="enscript-variable-name">Functions</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>
<span class="enscript-comment">/*!
 * @function OSKextGetLoadTagForBundleIdentifier
 * @abstract Look up the load tag for a kext.
 *
 * @param  kextIdentifier  The bundle identifier of the kext to look up.
 * @result
 * The load tag of the requested kext, or
 * &lt;code&gt;@link //apple_ref/c/macro/kOSKextInvalidLoadTag kOSKextInvalidLoadTag@/link&lt;/code&gt;
 * if the kext was not found.
 *
 * @discussion
 * A load tag uniquely identifies a loaded kext.
 * It can be found as the &lt;code&gt;id&lt;/code&gt; field of a loaded kext's
 * &lt;code&gt;kmod_info_t&lt;/code&gt; struct.
 *
 * Note that a load tag represents a specific loaded instance of a kext.
 * If that kext is unloaded, the load tag is no longer a valid reference.
 * If the same kext is later reloaded, it will have a new load tag.
 *
 * You can use the load tag to adjust a kext's reference count
 * via
 * &lt;code&gt;@link //apple_ref/c/func/OSKextRetainKextWithLoadTag
 * OSKextRetainKextWithLoadTag@/link&lt;/code&gt;
 * and
 * &lt;code&gt;@link //apple_ref/c/func/OSKextReleaseKextWithLoadTag
 * OSKextReleaseKextWithLoadTag@/link&lt;/code&gt;,
 * so that the kext is automatically unloaded when no references remain,
 * or to unload the kext immediately
 * with &lt;code&gt;@link //apple_ref/c/func/OSKextUnloadKextWithLoadTag OSKextUnloadKextWithLoadTag@/link&lt;/code&gt;.
 *
 * Those functions are intended for use with non-IOKit kexts
 * (specifically, kexts that define no subclasses of
 * &lt;code&gt;@link //apple_ref/doc/class/IOServiceIOService@/link&lt;/code&gt;).
 * Pure IOKit kexts are managed via instance counts
 * of their libkern C++ object classes;
 * using those functions on them will only interfere with that mechanism.
 * If you have a hybrid kext with both IOService subclasses and non-IOKit code,
 * however, you may want to use reference counting for the non-IOKit portions:
 * that way the kext will only unload automaticaly
 * when there are no C++ objects and the kext reference count is zero.
 */</span>
uint32_t <span class="enscript-function-name">OSKextGetLoadTagForBundleIdentifier</span>(
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> * kextIdentifier);


<span class="enscript-comment">/*!
 * @function OSKextUnloadKextWithLoadTag
 * @abstract Stop and unload a kext based on its load tag.
 *
 * @param  loadTag   The load tag of the kext to unload.
 * @result
 * &lt;code&gt;@link //apple_ref/c/macro/kOSReturnSuccess kOSReturnSuccess@/link&lt;/code&gt;
 * if the kext was found and unloaded.
 * &lt;code&gt;@link //apple_ref/c/macro/kOSKextReturnNotFound
 * kOSKextReturnNotFound@/link&lt;/code&gt;
 * if the kext was not found.
 * &lt;code&gt;@link //apple_ref/c/macro/kOSKextReturnInUse
 * kOSKextReturnInUse@/link&lt;/code&gt;
 * if the kext has outstanding references
 * or if there are instances of its libkern C++ subclasses.
 * Other return values indicate a failure to unload the kext,
 * typically because the module stop routine failed.
 *
 * @discussion
 * A panic will occur if a kext calls this function to unload itself.
 * The safest way for a kext to unload itself is to call
 * &lt;code&gt;@link //apple_ref/c/func/OSKextRetainKextWithLoadTag
 * OSKextRetainKextWithLoadTag@/link&lt;/code&gt;
 * with its own load tag
 * (the &lt;code&gt;id&lt;/code&gt; field of its &lt;code&gt;kmod_info_t&lt;/code&gt; struct),
 * followed by 
 * &lt;code&gt;@link //apple_ref/c/func/OSKextReleaseKextWithLoadTag
 * OSKextReleaseKextWithLoadTag@/link&lt;/code&gt;;
 * this will schedule the kext for unload on a separate thread.
 *
 * This function can be used when reference-based autounloading is not
 * appropriate.
 * If a kernel system or kext is already monitoring
 * the need for a kext,
 * it can simply call this function when it's known that the kext is not needed.
 */</span>
OSReturn <span class="enscript-function-name">OSKextUnloadKextWithLoadTag</span>(uint32_t loadTag);

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL */</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Loaded</span> <span class="enscript-variable-name">Kext</span> <span class="enscript-variable-name">Summary</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*!
 * @define kOSKextLoadedKextSummaryVersion
 * @abstract The current version of the loaded kext summary headers.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextLoadedKextSummaryVersion</span> 2

<span class="enscript-comment">/*!
 * @typedef OSKextLoadedKextSummary
 * @abstract A structure that describes a loaded kext.
 *
 * @field name The kext's bundle identifier.
 * @field uuid The kext's UUID;
 * @field address The kext's load address.
 * @field size The kext's load size.
 * @field version The binary format (OSKextVersion) version of the kext.
 * @field loadTag The kext's load tag.
 * @field flags Internal tracking flags.
 * @field reference_list who this refs (links on).
 * 
 * @discussion
 * The OSKextLoadedKextSummary structure contains a basic set of information
 * about the kext to facilitate kext debugging and panic debug log output.
 */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> _loaded_kext_summary {
    <span class="enscript-type">char</span>        name[KMOD_MAX_NAME];
    uuid_t      uuid;
    uint64_t    address;
    uint64_t    size;
    uint64_t    version;
    uint32_t    loadTag;
    uint32_t    flags;
    uint64_t    reference_list;
} OSKextLoadedKextSummary;

<span class="enscript-comment">/*!
 * @typedef OSKextLoadedKextSummaryHeader
 * @abstract A structure that describes the set of loaded kext summaries.
 *
 * @field version The version of the loaded kext summary structures.
 * @field entry_size The size of each entry in summaries.
 * @field numSummaries The number of OSKextLoadedKextSummary structures
 *        following the header.
 * @field summaries A convenience pointer to the array of summaries following
 *        the header.
 *
 * @discussion
 * The OSKextLoadedKextSummaryHeader describes the set of loaded kext summaries
 * available for use by the debugger or panic log routine.
 * The array of summaries contains one OSKextLoadedKextSummary for every kext
 * that declares an executable and is not an interface to the kernel.
 */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> _loaded_kext_summary_header {
    uint32_t version;
    uint32_t entry_size;
    uint32_t numSummaries;
    uint32_t reserved; <span class="enscript-comment">/* explicit alignment for gdb  */</span>
    OSKextLoadedKextSummary summaries[0];
} OSKextLoadedKextSummaryHeader;

<span class="enscript-comment">/*!
 * @var gLoadedKextSummaries
 * @abstract The global pointer to the current set of loaded kext summaries.
 */</span>
<span class="enscript-type">extern</span> OSKextLoadedKextSummaryHeader * gLoadedKextSummaries;

<span class="enscript-comment">/*!
 * @function OSKextLoadedKextSummariesUpdated
 * @abstract Called when gLoadedKextSummaries has been updated.
 *
 * @discussion
 * gLoadedKextSummaries is updated when a kext is loaded or unloaded.
 * When the update is complete, OSKextLoadedKextSummariesUpdated is called.
 * gdb can set a breakpoint on this function to detect kext loads and unloads.
 */</span>
<span class="enscript-type">void</span> <span class="enscript-function-name">OSKextLoadedKextSummariesUpdated</span>(<span class="enscript-type">void</span>);

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>

<span class="enscript-type">extern</span> <span class="enscript-type">const</span> vm_allocation_site_t * <span class="enscript-function-name">OSKextGetAllocationSiteForCaller</span>(uintptr_t address);
<span class="enscript-type">extern</span> uint32_t                     <span class="enscript-function-name">OSKextGetKmodIDForSite</span>(vm_allocation_site_t * site);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>                         <span class="enscript-function-name">OSKextFreeSite</span>(vm_allocation_site_t * site);

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>

__END_DECLS

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* ! _LIBKERN_OSKEXTLIBPRIVATE_H */</span>
</pre>
<hr />
</body></html>