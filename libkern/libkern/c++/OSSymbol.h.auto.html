<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>OSSymbol.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">OSSymbol.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000 Apple Computer, Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/* IOSymbol.h created by gvdl on Fri 1998-10-30 */</span>
<span class="enscript-comment">/* OSSymbol must be created through the factory methods and thus is not subclassable. */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_OS_OSSYMBOL_H</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_OS_OSSYMBOL_H</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;libkern/c++/OSString.h&gt;</span>

<span class="enscript-comment">/*!
 * @header
 *
 * @abstract
 * This header declares the OSSymbol container class.
 */</span>
 
<span class="enscript-comment">// xx-review: OSSymbol does not override setChar
</span>
<span class="enscript-comment">/*!
 * @class OSSymbol
 *
 * @abstract
 * OSSymbol wraps a C string in a unique C++ object
 * for use as keys in Libkern collections.
 *
 * @discussion
 * OSSymbol is a container class for managing uniqued strings,
 * for example, those used as dictionary keys.
 * Its static instance-creation functions check
 * for an existing instance of OSSymbol
 * with the requested C string value before creating a new object.
 * If an instance already exists in the pool of unique symbols,
 * its reference count is incremented
 * and the existing instance is returned.
 *
 * While OSSymbol provides for uniquing of a given string value,
 * it makes no effort to enforce immutability of that value.
 * Altering the contents of an OSSymbol should be avoided.
 *
 * &lt;b&gt;Use Restrictions&lt;/b&gt;
 *
 * With very few exceptions in the I/O Kit, all Libkern-based C++
 * classes, functions, and macros are &lt;b&gt;unsafe&lt;/b&gt;
 * to use in a primary interrupt context.
 * Consult the I/O Kit documentation related to primary interrupts 
 * for more information.
 *
 * OSSymbol provides no concurrency protection;
 * it's up to the usage context to provide any protection necessary.
 * Some portions of the I/O Kit, such as
 * @link //apple_ref/doc/class/IORegistryEntry IORegistryEntry@/link,
 * handle synchronization via defined member functions for setting
 * properties.
 */</span>
class OSSymbol : public OSString
{
    friend class OSSymbolPool;

    OSDeclareAbstractStructors(OSSymbol)

<span class="enscript-reference">private</span>:
    <span class="enscript-type">struct</span> ExpansionData { };
    
    <span class="enscript-comment">/* Reserved for future use. (Internal use only)  */</span>
    ExpansionData * reserved;

    <span class="enscript-type">static</span> <span class="enscript-type">void</span> initialize();

    <span class="enscript-comment">// xx-review: not in xnu, delete?
</span>    friend <span class="enscript-type">void</span> checkModuleForSymbols(<span class="enscript-type">void</span>); <span class="enscript-comment">/* in catalogue? */</span>

    <span class="enscript-comment">// xx-review: these should be removed from the symbol set.
</span>
   <span class="enscript-comment">/*!
    * @function initWithString
    *
    * @abstract
    * Overridden to prevent creation of duplicate symbols.
    *
    * @param aString   Unused.
    *
    * @result
    * &lt;code&gt;false&lt;/code&gt;.
    *
    * @discussion
    * Overrides OSString's implementation to prevent creation
    * of distinct OSSymbols with the same string value.
    */</span>
    virtual bool initWithString(<span class="enscript-type">const</span> OSString * aString) APPLE_KEXT_OVERRIDE;


   <span class="enscript-comment">/*!
    * @function initWithCString
    *
    * @abstract
    * Overridden to prevent creation of duplicate symbols.
    *
    * @param cString   Unused.
    *
    * @result
    * &lt;code&gt;false&lt;/code&gt;.
    *
    * @discussion
    * Overrides OSString's implementation to prevent creation
    * of distinct OSSymbols with the same string value.
    */</span>
    virtual bool initWithCString(<span class="enscript-type">const</span> <span class="enscript-type">char</span> * cString) APPLE_KEXT_OVERRIDE;


   <span class="enscript-comment">/*!
    * @function initWithCStringNoCopy
    *
    * @abstract
    * Overridden to prevent creation of duplicate symbols.
    *
    * @param cString   Unused.
    *
    * @result
    * &lt;code&gt;false&lt;/code&gt;.
    *
    * @discussion
    * Overrides OSString's implementation to prevent creation
    * of distinct OSSymbols with the same string value.
    */</span>
    virtual bool initWithCStringNoCopy(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *cString) APPLE_KEXT_OVERRIDE;

<span class="enscript-reference">protected</span>:

<span class="enscript-comment">// xx-review: should we just omit this from headerdoc?
</span>   <span class="enscript-comment">/*!
    * @function taggedRelease
    *
    * @abstract
    * Overrides
    * &lt;code&gt;@link
    * //apple_ref/cpp/instm/OSObject/taggedRelease/virtualvoid/(constvoid*,constint)
    * OSObject::taggedRelease(const void *, const int)@/link&lt;/code&gt;
    * to synchronize with the symbol pool.
    *
    * @param tag      Used for tracking collection references.
    * @param freeWhen If decrementing the reference count makes it
    *                 &gt;= &lt;code&gt;freeWhen&lt;/code&gt;, the object is immediately freed.
    *
    * @discussion
    * Because OSSymbol shares instances, the reference-counting functions
    * must synchronize access to the class-internal tables
    * used to track those instances.
    */</span>
    virtual <span class="enscript-type">void</span> taggedRelease(
        <span class="enscript-type">const</span> <span class="enscript-type">void</span> * tag,
        <span class="enscript-type">const</span> <span class="enscript-type">int</span>    freeWhen) <span class="enscript-type">const</span> APPLE_KEXT_OVERRIDE;


<span class="enscript-comment">// xx-review: should we just omit this from headerdoc?
</span>   <span class="enscript-comment">/*!
    * @function free
    *
    * @abstract
    * Overrides
    * &lt;code&gt;@link
    * //apple_ref/cpp/instm/OSObject/free/virtualvoid/()
    * OSObject::free@/link&lt;/code&gt;
    * to synchronize with the symbol pool.
    *
    * @discussion
    * Because OSSymbol shares instances, the reference-counting functions
    * must synchronize access to the class-internal tables
    * used to track those instances.
    */</span>
    virtual <span class="enscript-type">void</span> free() APPLE_KEXT_OVERRIDE;

<span class="enscript-reference">public</span>:

<span class="enscript-comment">// xx-review: should we just omit this from headerdoc?
</span>   <span class="enscript-comment">/*!
    * @function taggedRelease
    *
    * @abstract
    * Overrides
    * &lt;code&gt;@link
    * //apple_ref/cpp/instm/OSObject/taggedRelease/virtualvoid/(constvoid*)
    * OSObject::taggedRelease(const void *)@/link&lt;/code&gt;
    * to synchronize with the symbol pool.
    *
    * @param tag      Used for tracking collection references.
    *
    * @discussion
    * Because OSSymbol shares instances, the reference-counting functions
    * must synchronize access to the class-internal tables
    * used to track those instances.
    */</span>
    
   <span class="enscript-comment">/* Original note (not for headerdoc):
    * The C++ language has forced me to override this method
    * even though I have implemented it as
    * &lt;code&gt;{ super::taggedRelease(tag) }&lt;/code&gt;.
    * It seems that C++ is confused about the appearance of the protected
    * taggedRelease with 2 parameters and refuses to only inherit one function.
    * See
    * &lt;code&gt;@link
    * //apple_ref/cpp/instm/OSObject/taggedRelease/virtualvoid/(constvoid*,constint)
    * OSObject::taggedRelease(const void *, const int)@/link&lt;/code&gt;.
    */</span>
    virtual <span class="enscript-type">void</span> taggedRelease(<span class="enscript-type">const</span> <span class="enscript-type">void</span> * tag) <span class="enscript-type">const</span>  APPLE_KEXT_OVERRIDE;


   <span class="enscript-comment">/*!
    * @function withString
    *
    * @abstract
    * Returns an OSSymbol created from an OSString,
    * or the existing unique instance of the same value.
    *
    * @param aString   The OSString object to look up or copy.
    *
    * @result
    * An instance of OSSymbol
    * representing the same characters  as &lt;code&gt;aString&lt;/code&gt;;
    * &lt;code&gt;NULL&lt;/code&gt; on failure.
    *
    * @discussion
    * This function creates or returns the unique OSSymbol instance
    * representing the string value of &lt;code&gt;aString&lt;/code&gt;.
    * You can compare it with other OSSymbols using the &lt;code&gt;==&lt;/code&gt; operator.
    *
    * OSSymbols are reference-counted normally.
    * This function either returns a
    * new OSSymbol with a retain count of 1,
    * or increments the retain count of the existing instance.
    */</span>
    <span class="enscript-type">static</span> <span class="enscript-type">const</span> OSSymbol * withString(<span class="enscript-type">const</span> OSString * aString);


   <span class="enscript-comment">/*!
    * @function withCString
    *
    * @abstract
    * Returns an OSSymbol created from a C string,
    * or the existing unique instance of the same value.
    *
    * @param cString   The C string to look up or copy.
    *
    * @result
    * An instance of OSSymbol representing
    * the same characters as &lt;code&gt;cString&lt;/code&gt;;
    * &lt;code&gt;NULL&lt;/code&gt; on failure.
    *
    * @discussion
    * This function returns the unique OSSymbol instance
    * representing the string value of &lt;code&gt;cString&lt;/code&gt;.
    * You can compare it with other OSSymbols using the &lt;code&gt;==&lt;/code&gt; operator.
    *
    * OSSymbols are reference-counted normally.
    * This function either returns a
    * new OSSymbol with a retain count of 1,
    * or increments the retain count of the existing instance.
    */</span>
    <span class="enscript-type">static</span> <span class="enscript-type">const</span> OSSymbol * withCString(<span class="enscript-type">const</span> <span class="enscript-type">char</span> * cString);


   <span class="enscript-comment">/*!
    * @function withCStringNoCopy
    *
    * @abstract
    * Returns an OSSymbol created from a C string,
    * without copying that string,
    * or the existing unique instance of the same value.
    *
    * @param cString   The C string to look up or use.
    * @result
    * An instance of OSSymbol representing
    * the same characters as &lt;code&gt;cString&lt;/code&gt;;
    * &lt;code&gt;NULL&lt;/code&gt;.
    *
    * @discussion
    * Avoid using this function;
    * OSSymbols should own their internal string buffers.
    *
    * This function returns the unique OSSymbol instance
    * representing the string value of &lt;code&gt;cString&lt;/code&gt;.
    * You can compare it with other OSSymbols using the &lt;code&gt;==&lt;/code&gt; operator.
    *
    * OSSymbols are reference-counted normally.
    * This function either returns a
    * new OSSymbol with a retain count of 1,
    * or increments the retain count of the existing instance.
    */</span>
    <span class="enscript-type">static</span> <span class="enscript-type">const</span> OSSymbol * withCStringNoCopy(<span class="enscript-type">const</span> <span class="enscript-type">char</span> * cString);


   <span class="enscript-comment">/*!
    * @function isEqualTo
    *
    * @abstract
    * Tests the equality of two OSSymbol objects.
    *
    * @param aSymbol The OSSymbol object being compared against the receiver.
    *
    * @result
    * &lt;code&gt;true&lt;/code&gt; if the two OSSymbol objects are equivalent,
    * &lt;code&gt;false&lt;/code&gt; otherwise.
    *
    * @discussion
    * Two OSSymbol objects are considered equal if they have the same address;
    * that is, this function is equivalent to the &lt;code&gt;==&lt;/code&gt; operator.
    */</span>
    virtual bool isEqualTo(<span class="enscript-type">const</span> OSSymbol * aSymbol) <span class="enscript-type">const</span>;


   <span class="enscript-comment">/*!
    * @function isEqualTo
    *
    * @abstract Tests the equality of an OSSymbol object with a C string.
    *
    * @param cString  The C string to compare against the receiver.
    * 
    * @result
    * &lt;code&gt;true&lt;/code&gt; if the OSSymbol's characters
    * are equivalent to the C string's,
    * &lt;code&gt;false&lt;/code&gt; otherwise.
    */</span>
    virtual bool isEqualTo(<span class="enscript-type">const</span> <span class="enscript-type">char</span> * cString) <span class="enscript-type">const</span> APPLE_KEXT_OVERRIDE;


   <span class="enscript-comment">/*!
    * @function isEqualTo
    *
    * @abstract Tests the equality of an OSSymbol object to an arbitrary object.
    *
    * @param anObject The object to be compared against the receiver.
    * @result         Returns &lt;code&gt;true&lt;/code&gt; if the two objects are equivalent,
    *                 &lt;code&gt;false&lt;/code&gt; otherwise.
    *
    * @discussion
    * An OSSymbol is considered equal to another object
    * if that object is derived from
    * @link //apple_ref/doc/class/OSMetaClassBase OSString@/link
    * and contains the equivalent bytes of the same length.
    */</span>
    virtual bool isEqualTo(<span class="enscript-type">const</span> OSMetaClassBase * anObject) <span class="enscript-type">const</span> APPLE_KEXT_OVERRIDE;


#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
   <span class="enscript-comment">/* OSRuntime only INTERNAL API - DO NOT USE */</span>
   <span class="enscript-comment">/* Not to be included in headerdoc. */</span>
    <span class="enscript-comment">// xx-review: this should be removed from the symbol set.
</span>
    <span class="enscript-type">static</span> <span class="enscript-type">void</span> checkForPageUnload(
        <span class="enscript-type">void</span> * startAddr,
        <span class="enscript-type">void</span> * endAddr);

    <span class="enscript-type">static</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> bsearch(
	<span class="enscript-type">const</span> <span class="enscript-type">void</span> *  key,
	<span class="enscript-type">const</span> <span class="enscript-type">void</span> *  array,
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>  arrayCount,
	size_t        memberSize);
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>

    OSMetaClassDeclareReservedUnused(OSSymbol, 0);
    OSMetaClassDeclareReservedUnused(OSSymbol, 1);
    OSMetaClassDeclareReservedUnused(OSSymbol, 2);
    OSMetaClassDeclareReservedUnused(OSSymbol, 3);
    OSMetaClassDeclareReservedUnused(OSSymbol, 4);
    OSMetaClassDeclareReservedUnused(OSSymbol, 5);
    OSMetaClassDeclareReservedUnused(OSSymbol, 6);
    OSMetaClassDeclareReservedUnused(OSSymbol, 7);
};

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !_OS_OSSYMBOL_H */</span>
</pre>
<hr />
</body></html>