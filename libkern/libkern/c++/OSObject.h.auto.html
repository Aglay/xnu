<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>OSObject.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">OSObject.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000 Apple Computer, Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*
Copyright (c) 1998 Apple Computer, Inc.  All rights reserved.
HISTORY
    1998-10-30  Godfrey van der Linden(gvdl)
    Created
*/</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_LIBKERN_OSOBJECT_H</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_LIBKERN_OSOBJECT_H</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;libkern/c++/OSMetaClass.h&gt;</span>

#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__clang__</span>)
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">clang</span> <span class="enscript-variable-name">diagnostic</span> <span class="enscript-variable-name">ignored</span> <span class="enscript-string">&quot;-Woverloaded-virtual&quot;</span>
#<span class="enscript-reference">endif</span>

class OSSymbol;
class OSString;


<span class="enscript-comment">/*!
 * @header
 *
 * @abstract
 * This header declares the OSObject class,
 * which is the concrete root of the Libkern C++ class hierarchy.
 */</span>
 

<span class="enscript-comment">/*!
 * @class OSObject
 *
 * @abstract
 * OSObject is the concrete root class
 * of the Libkern and I/O Kit C++ class hierarchy.
 *
 * @discussion
 * OSObject defines the minimal functionality
 * required of Libkern and I/O Kit C++ classes:
 * tie-in to the run-time type information facility,
 * the dynamic allocation/initialization paradigm,
 * and reference counting.
 * While kernel extensions are free to use their own C++ classes internally,
 * any interaction they have with Libkern or the I/O Kit will require
 * classes ultimately derived from OSObject.
 *
 * &lt;b&gt;Run-Time Type Information&lt;/b&gt;
 *
 * OSObject is derived from the abstract root class
 * @link //apple_ref/doc/class/OSMetaClassBase OSMetaClassBase@/link,
 * which declares (and defines many of) the primitives
 * on which the run-time type information facility is based.
 * A parallel inheritance hierarchy of metaclass objects
 * provides run-time introspection, including access to class names,
 * inheritance, and safe type-casting.
 * See @link //apple_ref/doc/class/OSMetaClass OSMetaClass@/link
 * for more information.
 *
 * &lt;b&gt;Dynamic Allocation/Initialization&lt;/b&gt;
 *
 * The kernel-resident C++ runtime does not support exceptions,
 * so Libkern classes cannot use standard C++ object
 * constructors and destructors,
 * which use exceptions to report errors.
 * To support error-handling during instance creation, then,
 * OSObject separates object allocation from initialization.
 * You can create a new OSObject-derived instance
 * with the &lt;code&gt;new&lt;/code&gt; operator,
 * but this does nothing more than allocate memory
 * and initialize the reference count to 1.
 * Following this, you must call a designated initialization function
 * and check its &lt;code&gt;bool&lt;/code&gt; return value.
 * If the initialization fails,
 * you must immediately call
 * &lt;code&gt;@link
 * //apple_ref/cpp/instm/OSObject/release/virtualvoid/()
 * release@/link&lt;/code&gt;
 * on the instance and handle the failure in whatever way is appropriate.
 * Many Libkern and I/O Kit classes define static instance-creation functions
 * (beginning with the word &quot;with&quot;)
 * to make construction a one-step process for clients.
 *
 * &lt;b&gt;Reference Counting&lt;/b&gt;
 *
 * OSObject provides reference counting services using the
 * &lt;code&gt;@link
 * //apple_ref/cpp/instm/OSObject/retain/virtualvoid/()
 * retain@/link&lt;/code&gt;, 
 * &lt;code&gt;@link
 * //apple_ref/cpp/instm/OSObject/release/virtualvoid/()
 * release()@/link&lt;/code&gt;,
 * &lt;code&gt;@link
 * //apple_ref/cpp/instm/OSObject/release/virtualvoid/(int)
 * release(int freeWhen)@/link&lt;/code&gt;
 * and
 *&lt;code&gt; @link
 * //apple_ref/cpp/instm/OSObject/free/virtualvoid/()
 * free@/link&lt;/code&gt;
 * functions.
 * The public interface to the reference counting is
 * &lt;code&gt;@link
 * //apple_ref/cpp/instm/OSObject/retain/virtualvoid/()
 * retain@/link&lt;/code&gt;, 
 * and 
 * &lt;code&gt;@link
 * //apple_ref/cpp/instm/OSObject/release/virtualvoid/()
 * release@/link&lt;/code&gt;;
 * &lt;code&gt;@link
 * //apple_ref/cpp/instm/OSObject/release/virtualvoid/(int)
 * release(int freeWhen)@/link&lt;/code&gt;
 * is provided
 * for objects that have internal retain cycles.
 *
 * In general, a subclass is expected to only override
 * &lt;code&gt;@link
 * //apple_ref/cpp/instm/OSObject/free/virtualvoid/()
 * free@/link&lt;/code&gt;.
 * It may also choose to override
 * &lt;code&gt;@link
 * //apple_ref/cpp/instm/OSObject/release/virtualvoid/(int)
 * release(int freeWhen)@/link&lt;/code&gt;
 * if the object has a circular retain count, as noted above.
 *
 * &lt;b&gt;Use Restrictions&lt;/b&gt;
 *
 * With very few exceptions in the I/O Kit, all Libkern-based C++
 * classes, functions, and macros are &lt;b&gt;unsafe&lt;/b&gt;
 * to use in a primary interrupt context.
 * Consult the I/O Kit documentation related to primary interrupts 
 * for more information.
 *
 * &lt;b&gt;Concurrency Protection&lt;/b&gt;
 *
 * The basic features of OSObject are thread-safe.
 * Most Libkern subclasses are not, and require locking or other protection
 * if instances are shared between threads.
 * I/O Kit driver objects are either designed for use within thread-safe contexts
 * or designed to inherently be thread-safe.
 * Always check the individual class documentation to see what
 * steps are necessary for concurrent use of instances.
 */</span>
class OSObject : public OSMetaClassBase
{
    OSDeclareAbstractStructors(OSObject)
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">IOKITSTATS</span>
	friend class IOStatistics;
#<span class="enscript-reference">endif</span>

<span class="enscript-reference">private</span>:
   <span class="enscript-comment">/* Not to be included in headerdoc.
    *
    * @var retainCount Number of references held on this instance.
    */</span>
    mutable <span class="enscript-type">int</span> retainCount;

<span class="enscript-reference">protected</span>:

<span class="enscript-comment">// xx-review: seems not to be used, should we deprecate?
</span>
   <span class="enscript-comment">/*!
    * @function release
    *
    * @abstract
    * Releases a reference to an object,
    * freeing it immediately if the reference count
    * drops below the specified threshold.
    *
    * @param freeWhen If decrementing the reference count makes it
    *                 &gt;= &lt;code&gt;freeWhen&lt;/code&gt;, the object is immediately freed.
    *
    * @discussion
    * If the receiver has &lt;code&gt;freeWhen&lt;/code&gt; or fewer references
    * after its reference count is decremented,
    * it is immediately freed.
    *
    * This version of &lt;code&gt;release&lt;/code&gt;
    * can be used to break certain retain cycles in object graphs.
    * In general, however, it should be avoided.
    */</span>
    virtual <span class="enscript-type">void</span> release(<span class="enscript-type">int</span> freeWhen) <span class="enscript-type">const</span> APPLE_KEXT_OVERRIDE;

   <span class="enscript-comment">/*!
    * @function taggedRelease
    *
    * @abstract
    * Releases a tagged reference to an object,
    * freeing it immediately if the reference count
    * drops below the specified threshold.
    *
    * @param tag      Used for tracking collection references.
    * @param freeWhen If decrementing the reference count makes it
    *                 &gt;= &lt;code&gt;freeWhen&lt;/code&gt;, the object is immediately freed.
    *
    * @discussion
    * Kernel extensions should not use this function.
    * It is for use by OSCollection and subclasses to track
    * inclusion in collections.
    *
    * If the receiver has &lt;code&gt;freeWhen&lt;/code&gt; or fewer references
    * after its reference count is decremented,
    * it is immediately freed.
    *
    * This version of &lt;code&gt;release&lt;/code&gt;
    * can be used to break certain retain cycles in object graphs.
    * In general, however, it should be avoided.
    */</span>
    virtual <span class="enscript-type">void</span> taggedRelease(<span class="enscript-type">const</span> <span class="enscript-type">void</span> * tag, <span class="enscript-type">const</span> <span class="enscript-type">int</span> freeWhen) <span class="enscript-type">const</span> APPLE_KEXT_OVERRIDE;


   <span class="enscript-comment">/*!
    * @function init
    *
    * @abstract
    * Initializes a newly-allocated object.
    *
    * @result
    * &lt;code&gt;true&lt;/code&gt; on success, &lt;code&gt;false&lt;/code&gt; on failure.
    *
    * @discussion
    * Classes derived from OSObject must override the primary init method
    * of their parent.
    * In general most implementations call
    * &lt;code&gt;&lt;i&gt;super&lt;/i&gt;::init()&lt;/code&gt;
    * before doing local initialisation.
    * If the superclass call fails then return &lt;code&gt;false&lt;/code&gt; immediately.
    * If the subclass encounters a failure then it should return &lt;code&gt;false&lt;/code&gt;.
    */</span>
    virtual bool init();


   <span class="enscript-comment">/*!
    * @function free
    *
    * @abstract
    * Deallocates/releases resources held by the object.
    *
    * @discussion
    * Classes derived from OSObject should override this function
    * to deallocate or release all dynamic resources held by the instance,
    * then call the superclass's implementation.  
    *
    * &lt;b&gt;Caution:&lt;b&gt;
    * &lt;ol&gt;
    * &lt;li&gt;You can not assume that you have completed initialization
    *     before &lt;code&gt;free&lt;/code&gt; is called,
    *     so be very careful in your implementation.&lt;/li&gt;
    * &lt;li&gt;OSObject's implementation performs the C++ &lt;code&gt;delete&lt;/code&gt;
    *     of the instance, so be sure that you call the superclass
    *     implementation &lt;i&gt;last&lt;/i&gt; in your implementation.&lt;/li&gt;
    * &lt;li&gt;&lt;code&gt;free&lt;/code&gt; must not fail;
    *     all resources must be deallocated or released on completion.&lt;/li&gt;
    * &lt;/ol&gt;
    */</span>
    virtual <span class="enscript-type">void</span> free();


   <span class="enscript-comment">/*!
    * @function operator delete
    *
    * @abstract
    * Frees the memory of the object itself.
    *
    * @param mem   A pointer to the object's memory.
    * @param size  The size of the object's block of memory.
    *
    * @discussion
    * Never use &lt;code&gt;delete&lt;/code&gt; on objects derived from OSObject;
    * use
    * &lt;code&gt;@link
    * //apple_ref/cpp/instm/OSObject/release/virtualvoid/()
    * release@/link&lt;/code&gt;
    * instead.
    */</span>
    <span class="enscript-type">static</span> <span class="enscript-type">void</span> operator delete(<span class="enscript-type">void</span> * mem, size_t size);

<span class="enscript-reference">public</span>:

   <span class="enscript-comment">/*!
    * @function operator new
    *
    * @abstract
    * Allocates memory for an instance of the class.
    *
    * @param size The number of bytes to allocate
    *
    * @result
    * A pointer to block of memory if available, &lt;code&gt;NULL&lt;/code&gt; otherwise.
    */</span>
    <span class="enscript-type">static</span> <span class="enscript-type">void</span> * operator new(size_t size);


   <span class="enscript-comment">/*!
    * @function getRetainCount
    *
    * @abstract
    * Returns the reference count of the object.
    *
    * @result
    * The reference count of the object.
    */</span>
    virtual <span class="enscript-type">int</span> getRetainCount() <span class="enscript-type">const</span> APPLE_KEXT_OVERRIDE;


   <span class="enscript-comment">/*!
    * @function retain
    *
    * @abstract
    * Retains a reference to the object.
    *
    * @discussion
    * This function increments the reference count of the receiver by 1.
    * If you need to maintain a reference to an object
    * outside the context in which you received it,
    * you should always retain it immediately.
    */</span>
    virtual <span class="enscript-type">void</span> retain() <span class="enscript-type">const</span> APPLE_KEXT_OVERRIDE;


   <span class="enscript-comment">/*!
    * @function release
    *
    * @abstract
    * Releases a reference to the object,
    * freeing it immediately if the reference count drops to zero.
    *
    * @discussion
    * This function decrements the reference count of the receiver by 1.
    * If the reference count drops to zero,
    * the object is immediately freed using
    * &lt;code&gt;@link
    * //apple_ref/cpp/instm/OSObject/free/virtualvoid/()
    * free@/link&lt;/code&gt;.
    */</span>
    virtual <span class="enscript-type">void</span> release() <span class="enscript-type">const</span> APPLE_KEXT_OVERRIDE;


   <span class="enscript-comment">/*!
    * @function taggedRetain
    *
    * @abstract
    * Retains a reference to the object with an optional
    * tag used for reference-tracking.
    *
    * @param tag      Used for tracking collection references.
    *
    * @discussion
    * Kernel extensions should not use this function.
    * It is for use by OSCollection and subclasses to track
    * inclusion in collections.
    *
    * If you need to maintain a reference to an object
    * outside the context in which you received it,
    * you should always retain it immediately.
    */</span>
    virtual <span class="enscript-type">void</span> taggedRetain(<span class="enscript-type">const</span> <span class="enscript-type">void</span> * tag = 0) <span class="enscript-type">const</span> APPLE_KEXT_OVERRIDE;


   <span class="enscript-comment">/*!
    * @function taggedRelease
    *
    * @abstract
    * Releases a tagged reference to an object,
    * freeing it immediately if the reference count
    * drops to zero.
    *
    * @param tag      Used for tracking collection references.
    *
    * @discussion
    * Kernel extensions should not use this function.
    * It is for use by OSCollection and subclasses to track
    * inclusion in collections.
    */</span>
    virtual <span class="enscript-type">void</span> taggedRelease(<span class="enscript-type">const</span> <span class="enscript-type">void</span> * tag = 0) <span class="enscript-type">const</span> APPLE_KEXT_OVERRIDE;
    <span class="enscript-comment">// xx-review: used to say, &quot;Remove a reference on this object with this tag, if an attempt is made to remove a reference that isn't associated with this tag the kernel will panic immediately&quot;, but I don't see that in the implementation
</span>

   <span class="enscript-comment">/*!
    * @function serialize
    *
    * @abstract
    * Overridden by subclasses to archive the receiver into the provided
    * @link //apple_ref/doc/class/OSSerialize OSSerialize@/link object.
    *
    * @param serializer The OSSerialize object.
    *
    * @result
    * &lt;code&gt;true&lt;/code&gt; if serialization succeeds, &lt;code&gt;false&lt;/code&gt; if not.
    *
    * @discussion
    * OSObject's implementation writes a string indicating that
    * the class of the object receiving the function call
    * is not serializable.
    * Subclasses that can meaningfully encode themselves
    * in I/O Kit-style property list XML can override this function to do so.
    * See
    * @link //apple_ref/doc/class/OSSerialize OSSerialize@/link
    * for more information.
    */</span>
    virtual bool serialize(OSSerialize * serializer) <span class="enscript-type">const</span> APPLE_KEXT_OVERRIDE;

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">IOTRACKING</span>
    <span class="enscript-type">void</span> trackingAccumSize(size_t size);
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">endif</span>

    <span class="enscript-comment">// Unused Padding
</span>    OSMetaClassDeclareReservedUnused(OSObject,  0);
    OSMetaClassDeclareReservedUnused(OSObject,  1);
    OSMetaClassDeclareReservedUnused(OSObject,  2);
    OSMetaClassDeclareReservedUnused(OSObject,  3);
    OSMetaClassDeclareReservedUnused(OSObject,  4);
    OSMetaClassDeclareReservedUnused(OSObject,  5);
    OSMetaClassDeclareReservedUnused(OSObject,  6);
    OSMetaClassDeclareReservedUnused(OSObject,  7);
    OSMetaClassDeclareReservedUnused(OSObject,  8);
    OSMetaClassDeclareReservedUnused(OSObject,  9);
    OSMetaClassDeclareReservedUnused(OSObject, 10);
    OSMetaClassDeclareReservedUnused(OSObject, 11);
    OSMetaClassDeclareReservedUnused(OSObject, 12);
    OSMetaClassDeclareReservedUnused(OSObject, 13);
    OSMetaClassDeclareReservedUnused(OSObject, 14);
    OSMetaClassDeclareReservedUnused(OSObject, 15);

};

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !_LIBKERN_OSOBJECT_H */</span>
</pre>
<hr />
</body></html>