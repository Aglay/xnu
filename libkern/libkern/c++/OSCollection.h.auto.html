<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>OSCollection.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">OSCollection.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000 Apple Computer, Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/* IOCollection.h created by gvdl on Thu 1998-10-22 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_OS_OSCOLLECTION_H</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_OS_OSCOLLECTION_H</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;libkern/c++/OSObject.h&gt;</span>

class OSDictionary;


<span class="enscript-comment">/*!
 * @header
 *
 * @abstract
 * This header declares the OSDictionary collection class.
 */</span>
 
 
<span class="enscript-comment">/*!
 * @class OSCollection
 *
 * @abstract
 * The abstract superclass for Libkern collections.
 *
 * @discussion
 * OSCollection is the abstract superclass
 * for all Libkern C++ object collections.
 * It defines the necessary interfaces for managing storage space
 * and iterating through an arbitrary collection
 * (see the
 * @link //apple_ref/cpp/class/OSIterator OSIterator@/link
 * and
 * @link //apple_ref/cpp/class/OSCollectionIterator OSCollectionIterator@/link
 * classes).
 * It is up to concrete subclasses
 * to define their specific content management functions.
 *
 * &lt;b&gt;Use Restrictions&lt;/b&gt;
 *
 * With very few exceptions in the I/O Kit, all Libkern-based C++
 * classes, functions, and macros are &lt;b&gt;unsafe&lt;/b&gt;
 * to use in a primary interrupt context.
 * Consult the I/O Kit documentation related to primary interrupts 
 * for more information.
 *
 * OSCollection provides no concurrency protection;
 * it's up to the usage context to provide any protection necessary.
 * Some portions of the I/O Kit, such as
 * @link //apple_ref/doc/class/IORegistryEntry IORegistryEntry@/link,
 * handle synchronization via defined member functions for setting
 * properties.
 */</span>
class OSCollection : public OSObject
{
    friend class OSCollectionIterator;

    OSDeclareAbstractStructors(OSCollection);

    <span class="enscript-type">struct</span> ExpansionData { };
    
<span class="enscript-reference">protected</span>:
   <span class="enscript-comment">/* Not to be included in headerdoc.
    *
    * @var updateStamp
    *
    * @abstract
    * A counter for changes to the collection object.
    *
    * @discussion
    * The update stamp is used primarily to track validity
    * of iteration contexts.
    * See @link //apple_ref/cpp/class/OSIterator OSIterator@/link and
    * @link //apple_ref/cpp/class/OSCollectionIterator OSCollectionIterator@/link
    * for more information.
    */</span>
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> updateStamp;

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
<span class="enscript-reference">protected</span>:
#<span class="enscript-reference">else</span>
<span class="enscript-reference">private</span>:
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>
    <span class="enscript-comment">/* Reserved for future use.  (Internal use only)  */</span>
    <span class="enscript-comment">// ExpansionData * reserved;
</span>    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> fOptions;

<span class="enscript-reference">protected</span>:
    <span class="enscript-comment">// Member functions used by the OSCollectionIterator class.
</span>

   <span class="enscript-comment">/*!
    * @function iteratorSize
    *
    * @abstract
    * Returns the size in bytes of a subclass's iteration context.
    *
    * @result
    * The size in bytes of the iteration context
    * needed by the subclass of OSCollection.
    *
    * @discussion
    * This pure virtual member function, which subclasses must implement,
    * is called by an 
    * @link //apple_ref/doc/class/OSCollectionIterator OSCollectionIterator@/link
    * object so that it can allocate the storage needed
    * for the iteration context.
    * An iteration context contains the data necessary
    * to iterate through the collection.
    */</span>
    virtual <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> iteratorSize() <span class="enscript-type">const</span> = 0;


   <span class="enscript-comment">/*!
    * @function initIterator
    *
    * @abstract
    * Initializes the iteration context for a collection subclass.
    *
    * @param iterationContext  The iteration context to initialize.
    *
    * @result
    * &lt;code&gt;true&lt;/code&gt; if initialization was successful,
    * &lt;code&gt;false&lt;/code&gt; otherwise.
    *
    * @discussion
    * This pure virtual member function, which subclasses must implement,
    * is called by an 
    * @link //apple_ref/doc/class/OSCollectionIterator OSCollectionIterator@/link
    * object to initialize an iteration context for a collection.
    * The collection object should interpret &lt;code&gt;iterationContext&lt;/code&gt; appropriately
    * and initialize its contents to begin an iteration.
    *
    * This function can be called repeatedly for a given context,
    * whenever the iterator is reset via the
    * @link //apple_ref/cpp/instm/OSCollectionIterator/reset/virtualvoid/()
    * OSCollectionIterator::reset@/link
    * function.
    */</span>
    virtual bool initIterator(<span class="enscript-type">void</span> * iterationContext) <span class="enscript-type">const</span> = 0;


   <span class="enscript-comment">/*!
    * @function getNextObjectForIterator
    *
    * @abstract
    * Returns the next member of a collection.
    *
    * @param iterationContext  The iteration context.
    * @param nextObject        The object returned by reference to the caller.
    * 
    * @result
    * &lt;code&gt;true&lt;/code&gt; if an object was found, &lt;code&gt;false&lt;/code&gt; otherwise.
    *
    * @discussion
    * This pure virtual member function, which subclasses must implement,
    * is called by an 
    * @link //apple_ref/doc/class/OSCollectionIterator OSCollectionIterator@/link
    * to get the next object for a given iteration context.
    * The collection object should interpret
    * &lt;code&gt;iterationContext&lt;/code&gt; appropriately,
    * advance the context from its current object
    * to the next object (if it exists),
    * return that object by reference in &lt;code&gt;nextObject&lt;/code&gt;,
    * and return &lt;code&gt;true&lt;/code&gt; for the function call.
    * If there is no next object, the collection object must return &lt;code&gt;false&lt;/code&gt;.
    *
    * For associative collections, the object returned should be the key
    * used to access its associated value, and not the value itself.
    */</span>
    virtual bool getNextObjectForIterator(
        <span class="enscript-type">void</span>      * iterationContext,
        OSObject ** nextObject) <span class="enscript-type">const</span> = 0;


   <span class="enscript-comment">/*!
    * @function init
    *
    * @abstract
    * Initializes the OSCollection object.
    *
    * @result
    * &lt;code&gt;true&lt;/code&gt; on success, &lt;code&gt;false&lt;/code&gt; otherwise.
    *
    * @discussion
    * This function is used to initialize state
    * within a newly created OSCollection object.
    */</span>
    virtual bool init() APPLE_KEXT_OVERRIDE;

<span class="enscript-reference">public</span>:

   <span class="enscript-comment">/*!
    * @typedef _OSCollectionFlags
    *
    * @const kImmutable
    * @discussion
    * Used with &lt;code&gt;@link setOptions setOptions@/link&lt;/code&gt;
    * to indicate the collection's contents should
    * or should not change.
    *
    * An @link //apple_ref/doc/class/IORegistryEntry IORegistryEntry@/link
    * object marks collections immutable when set
    * as properties of a registry entry that's attached to a plane.
    * This is generally an advisory flag, used for debugging;
    * setting it does not mean a collection will in fact
    * disallow modifications.
    */</span>
    <span class="enscript-type">typedef</span> <span class="enscript-type">enum</span> {
        kImmutable  = 0x00000001,
        kSort       = 0x00000002,
        kMASK       = (<span class="enscript-type">unsigned</span>) -1
    } _OSCollectionFlags;

<span class="enscript-comment">// xx-review: should be protected, not public
</span>
   <span class="enscript-comment">/*!
    * @function haveUpdated
    *
    * @abstract
    * Tracks updates to the collection.
    *
    * @discussion
    * Subclasses call this function &lt;i&gt;before&lt;/i&gt;
    * making any change to their contents (not after, as the name implies).
    * Update tracking is used for collection iterators,
    * and to enforce certain protections in the IORegistry.
    */</span>
    <span class="enscript-type">void</span> haveUpdated();


   <span class="enscript-comment">/*!
    * @function getCount
    *
    * @abstract
    * Returns the number of objects in the collection.
    *
    * @result
    * The number of objects in the collection.
    *
    * @discussion
    * Subclasses must implement this pure virtual member function.
    */</span>
    virtual <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> getCount() <span class="enscript-type">const</span> = 0;


   <span class="enscript-comment">/*!
    * @function getCapacity
    *
    * @abstract
    * Returns the number of objects the collection
    * can store without reallocating.
    *
    * @result
    * The number objects the collection
    * can store without reallocating.
    *
    * @discussion
    * Subclasses must implement this pure virtual member function.
    */</span>
    virtual <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> getCapacity() <span class="enscript-type">const</span> = 0;


   <span class="enscript-comment">/*!
    * @function getCapacityIncrement
    *
    * @abstract
    * Returns the storage increment of the collection.
    *
    * @result
    * The storage increment of the collection.
    *
    * @discussion
    * Subclasses must implement this pure virtual member function.
    * Most collection subclasses allocate their storage
    * in multiples of the capacity increment.
    *
    * See
    * &lt;code&gt;@link
    * //apple_ref/cpp/instm/OSCollection/ensureCapacity/virtualunsignedint/(unsignedint)
    * ensureCapacity@/link&lt;/code&gt;
    * for how the capacity increment is used.
    */</span>
    virtual <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> getCapacityIncrement() <span class="enscript-type">const</span> = 0;


   <span class="enscript-comment">/*!
    * @function setCapacityIncrement
    *
    * @abstract
    * Sets the storage increment of the collection.
    *
    * @result
    * The new storage increment of the collection,
    * which may be different from the number requested.
    *
    * @discussion
    * Subclasses must implement this pure virtual member function.
    * Most collection subclasses allocate their storage
    * in multiples of the capacity increment.
    *
    * Collection subclasses should gracefully handle
    * an &lt;code&gt;increment&lt;/code&gt; of zero
    * by applying (and returning) a positive minimum capacity.
    *
    * Setting the capacity increment does not trigger an immediate adjustment
    * of a collection's storage.
    *
    * See
    * @link
    * //apple_ref/cpp/instm/OSCollection/ensureCapacity/virtualunsignedint/(unsignedint)
    * ensureCapacity@/link
    * for how the capacity increment is used.
    */</span>
    virtual <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> setCapacityIncrement(<span class="enscript-type">unsigned</span> increment) = 0;


   <span class="enscript-comment">/*!
    * @function ensureCapacity
    *
    * @abstract
    * Ensures the collection has enough space to store
    * the requested number of objects.
    *
    * @param newCapacity  The total number of objects the collection
    *                     should be able to store.
    *
    * @result 
    * The new capacity of the collection,
    * which may be different from the number requested
    * (if smaller, reallocation of storage failed).
    *
    * @discussion
    * Subclasses implement this pure virtual member function
    * to adjust their storage so that they can hold
    * at least &lt;code&gt;newCapacity&lt;/code&gt; objects.
    * Libkern collections generally allocate storage
    * in multiples of their capacity increment.
    *
    * Subclass methods that add objects to the collection
    * should call this function before adding any object,
    * and should check the return value for success.
    *
    * Collection subclasses may reduce their storage
    * when the number of contained objects falls below some threshold,
    * but no Libkern collections currently do.
    */</span>
    virtual <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> ensureCapacity(<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> newCapacity) = 0;


   <span class="enscript-comment">/*!
    * @function flushCollection
    *
    * @abstract
    * Empties the collection, releasing any objects retained.
    *
    * @discussion
    * Subclasses implement this pure virtual member function
    * to remove their entire contents.
    * This must not release the collection itself.
    */</span>
    virtual <span class="enscript-type">void</span> flushCollection() = 0;


   <span class="enscript-comment">/*!
    * @function setOptions
    *
    * @abstract
    * Recursively sets option bits in this collection
    * and all child collections.
    *
    * @param options  A bitfield whose values turn the options on (1) or off (0).
    * @param mask     A mask indicating which bits
    *                 in &lt;code&gt;options&lt;/code&gt; to change.
    *                 Pass 0 to get the whole current options bitfield
    *                 without changing any settings.
    * @param context  Unused.
    *
    * @result
    * The options bitfield as it was before the set operation.
    *
    * @discussion
    * Kernel extensions should not call this function.
    *
    * The only option currently in use is
    * &lt;code&gt;@link //apple_ref/doc/title:econst/OSCollectionFlags/kImmutable
    * kImmutable@/link&lt;/code&gt;.
    *
    * Subclasses should override this function to recursively apply
    * the options to their contents if the options actually change.
    */</span>
    virtual <span class="enscript-type">unsigned</span> setOptions(
        <span class="enscript-type">unsigned</span>   options,
        <span class="enscript-type">unsigned</span>   mask,
        <span class="enscript-type">void</span>     * context = 0);
    OSMetaClassDeclareReservedUsed(OSCollection, 0);

   <span class="enscript-comment">/*!
    * @function copyCollection
    *
    * @abstract
    * Creates a deep copy of a collection.
    *
    * @param cycleDict  A dictionary of all of the collections
    *                   that have been copied so far,
    *                   to start the copy at the top level
    *                   pass &lt;code&gt;NULL&lt;/code&gt; for &lt;code&gt;cycleDict&lt;/code&gt;.
    *
    * @result
    * The newly copied collecton,
    * &lt;code&gt;NULL&lt;/code&gt; on failure.
    *
    * @discussion
    * This function copies the collection
    * and all of the contained collections recursively.
    * Objects that are not derived from OSCollection are retained
    * rather than copied.
    *
    * Subclasses of OSCollection must override this function
    * to properly support deep copies.
    */</span>
    virtual OSCollection *copyCollection(OSDictionary * cycleDict = 0);
    OSMetaClassDeclareReservedUsed(OSCollection, 1);


    OSMetaClassDeclareReservedUnused(OSCollection, 2);
    OSMetaClassDeclareReservedUnused(OSCollection, 3);
    OSMetaClassDeclareReservedUnused(OSCollection, 4);
    OSMetaClassDeclareReservedUnused(OSCollection, 5);
    OSMetaClassDeclareReservedUnused(OSCollection, 6);
    OSMetaClassDeclareReservedUnused(OSCollection, 7);
};

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !_OS_OSCOLLECTION_H */</span>


</pre>
<hr />
</body></html>