<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>OSKextLib.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">OSKextLib.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2008 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 *
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 *
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 *
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_LIBKERN_OSKEXTLIB_H</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_LIBKERN_OSKEXTLIB_H</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/cdefs.h&gt;</span>
__BEGIN_DECLS

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;stdint.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/kmod.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/vm_types.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;uuid/uuid.h&gt;</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;libkern/OSTypes.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;libkern/OSReturn.h&gt;</span>
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;CoreFoundation/CoreFoundation.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;libkern/OSReturn.h&gt;</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL */</span>

<span class="enscript-comment">/*!
 * @header
 *
 * Declares functions, basic return values, and other constants
 * related to kernel extensions (kexts).
 */</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">OSReturn</span> <span class="enscript-variable-name">Values</span> <span class="enscript-variable-name">for</span> <span class="enscript-variable-name">Kernel</span> <span class="enscript-variable-name">Extensions</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>
<span class="enscript-comment">/*!
 * @group OSReturn Values for Kernel Extensions
 * Many kext-related functions return these values,
 * as well as those defined under
 * &lt;code&gt;@link //apple_ref/c/tdef/OSReturn OSReturn@/link&lt;/code&gt;
 * and other variants of &lt;code&gt;kern_return_t&lt;/code&gt;.
 */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
<span class="enscript-comment">/*********************************************************************
* Check libsyscall/mach/err_libkern.sub when editing or adding
* result codes!
*********************************************************************/</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">sub_libkern_kext</span>           err_sub(2)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">libkern_kext_err</span>(code)     (sys_libkern|sub_libkern_kext|(code))


<span class="enscript-comment">/*!
 * @define   kOSKextReturnInternalError
 * @abstract An internal error in the kext library.
 *           Contrast with &lt;code&gt;@link //apple_ref/c/econst/OSReturnError
 *           OSReturnError@/link&lt;/code&gt;.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnInternalError</span>                   libkern_kext_err(0x1)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnNoMemory
 * @abstract Memory allocation failed.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnNoMemory</span>                        libkern_kext_err(0x2)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnNoResources
 * @abstract Some resource other than memory (such as available load tags)
 *           is exhausted.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnNoResources</span>                     libkern_kext_err(0x3)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnNotPrivileged
 * @abstract The caller lacks privileges to perform the requested operation.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnNotPrivileged</span>                   libkern_kext_err(0x4)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnInvalidArgument
 * @abstract Invalid argument.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnInvalidArgument</span>                 libkern_kext_err(0x5)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnNotFound
 * @abstract Search item not found.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnNotFound</span>                        libkern_kext_err(0x6)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnBadData
 * @abstract Malformed data (not used for XML).
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnBadData</span>                         libkern_kext_err(0x7)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnSerialization
 * @abstract Error converting or (un)serializing URL, string, or XML.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnSerialization</span>                   libkern_kext_err(0x8)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnUnsupported
 * @abstract Operation is no longer or not yet supported.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnUnsupported</span>                     libkern_kext_err(0x9)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnDisabled
 * @abstract Operation is currently disabled.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnDisabled</span>                        libkern_kext_err(0xa)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnNotAKext
 * @abstract Bundle is not a kernel extension.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnNotAKext</span>                        libkern_kext_err(0xb)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnValidation
 * @abstract Validation failures encountered; check diagnostics for details.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnValidation</span>                      libkern_kext_err(0xc)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnAuthentication
 * @abstract Authetication failures encountered; check diagnostics for details.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnAuthentication</span>                  libkern_kext_err(0xd)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnDependencies
 * @abstract Dependency resolution failures encountered; check diagnostics for details.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnDependencies</span>                    libkern_kext_err(0xe)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnArchNotFound
 * @abstract Kext does not contain code for the requested architecture.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnArchNotFound</span>                    libkern_kext_err(0xf)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnCache
 * @abstract An error occurred processing a system kext cache.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnCache</span>                           libkern_kext_err(0x10)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnDeferred
 * @abstract Operation has been posted asynchronously to user space (kernel only).
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnDeferred</span>                        libkern_kext_err(0x11)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnBootLevel
 * @abstract Kext not loadable or operation not allowed at current boot level.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnBootLevel</span>                       libkern_kext_err(0x12)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnNotLoadable
 * @abstract Kext cannot be loaded; check diagnostics for details.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnNotLoadable</span>                     libkern_kext_err(0x13)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnLoadedVersionDiffers
 * @abstract A different version (or executable UUID, or executable by checksum)
 *           of the requested kext is already loaded.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnLoadedVersionDiffers</span>            libkern_kext_err(0x14)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnDependencyLoadError
 * @abstract A load error occurred on a dependency of the kext being loaded.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnDependencyLoadError</span>             libkern_kext_err(0x15)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnLinkError
 * @abstract A link failure occured with this kext or a dependency.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnLinkError</span>                       libkern_kext_err(0x16)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnStartStopError
 * @abstract The kext start or stop routine returned an error.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnStartStopError</span>                  libkern_kext_err(0x17)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnInUse
 * @abstract The kext is currently in use or has outstanding references,
 *           and cannot be unloaded.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnInUse</span>                           libkern_kext_err(0x18)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnTimeout
 * @abstract A kext request has timed out.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnTimeout</span>                         libkern_kext_err(0x19)

<span class="enscript-comment">/*!
 * @define   kOSKextReturnStopping
 * @abstract The kext is in the process of stopping; requests cannot be made.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextReturnStopping</span>                        libkern_kext_err(0x1a)

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Kext</span>/<span class="enscript-variable-name">OSBundle</span> <span class="enscript-variable-name">Property</span> <span class="enscript-variable-name">List</span> <span class="enscript-variable-name">Keys</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>
<span class="enscript-comment">/*!
 * @group Kext Property List Keys
 * These constants cover CFBundle properties defined for kernel extensions.
 * Because they are used in the kernel, if you want to use one with
 * CFBundle APIs you'll need to wrap it in a &lt;code&gt;CFSTR()&lt;/code&gt; macro.
 */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>
<span class="enscript-comment">/* Define C-string versions of the CFBundle keys for use in the kernel.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kCFBundleIdentifierKey</span>                  <span class="enscript-string">&quot;CFBundleIdentifier&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kCFBundleVersionKey</span>                     <span class="enscript-string">&quot;CFBundleVersion&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kCFBundleNameKey</span>                        <span class="enscript-string">&quot;CFBundleName&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kCFBundleExecutableKey</span>                  <span class="enscript-string">&quot;CFBundleExecutable&quot;</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL */</span>

<span class="enscript-comment">/*!
 * @define   kOSBundleCompatibleVersionKey
 * @abstract A string giving the backwards-compatible version of a library kext
 *           in extended Mac OS 'vers' format (####.##.##s{1-255} where 's'
 *           is a build stage 'd', 'a', 'b', 'f' or 'fc').
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleCompatibleVersionKey</span>           <span class="enscript-string">&quot;OSBundleCompatibleVersion&quot;</span>

<span class="enscript-comment">/*!
 * @define   kOSBundleEnableKextLoggingKey
 * @abstract Set to true to have the kernel kext logging spec applied
 *           to the kext.
 *           See &lt;code&gt;@link //apple_ref/c/econst/OSKextLogSpec
 *           OSKextLogSpec@/link&lt;/code&gt;.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleEnableKextLoggingKey</span>           <span class="enscript-string">&quot;OSBundleEnableKextLogging&quot;</span>

<span class="enscript-comment">/*!
 * @define   kOSBundleIsInterfaceKey
 * @abstract A boolean value indicating whether the kext executable
 *           contains only symbol references.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleIsInterfaceKey</span>                 <span class="enscript-string">&quot;OSBundleIsInterface&quot;</span>

<span class="enscript-comment">/*!
 * @define   kOSBundleLibrariesKey
 * @abstract A dictionary listing link dependencies for this kext.
 *           Keys are bundle identifiers, values are version strings.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleLibrariesKey</span>                   <span class="enscript-string">&quot;OSBundleLibraries&quot;</span>

<span class="enscript-comment">/*!
 * @define   kOSBundleRequiredKey
 * @abstract A string indicating in which kinds of startup this kext
 *           may need to load during early startup (before
 *           &lt;code&gt;@link //apple_ref/doc/man/8/kextd kextcache(8)@/link&lt;/code&gt;).
 * @discussion
 * The value is one of:
 * &lt;ul&gt;
 * &lt;li&gt;@link kOSBundleRequiredRoot &quot;OSBundleRequiredRoot&quot;@/link&lt;/li&gt;
 * &lt;li&gt;@link kOSBundleRequiredLocalRoot &quot;OSBundleRequiredLocalRoot&quot;@/link&lt;/li&gt;
 * &lt;li&gt;@link kOSBundleRequiredNetworkRoot &quot;OSBundleRequiredNetworkRoot&quot;@/link&lt;/li&gt;
 * &lt;li&gt;@link kOSBundleRequiredSafeBoot &quot;OSBundleRequiredSafeBoot&quot;@/link&lt;/li&gt;
 * &lt;li&gt;@link kOSBundleRequiredConsole &quot;OSBundleRequiredConsole&quot;@/link&lt;/li&gt;
 * &lt;/ul&gt;
 *
 * Use this property judiciously.
 * Every kext that declares a value other than &quot;OSBundleRequiredSafeBoot&quot;
 * increases startup time, as the booter must read it into memory,
 * or startup kext caches must include it.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleRequiredKey</span>                    <span class="enscript-string">&quot;OSBundleRequired&quot;</span>

<span class="enscript-comment">/*!
 * @define   kOSBundleAllowUserLoadKey
 * @abstract A boolean value indicating whether
 *           &lt;code&gt;@link //apple_ref/doc/man/8/kextd kextcache(8)@/link&lt;/code&gt;
 *           will honor a non-root process's request to load a kext.
 * @discussion
 * See &lt;code&gt;@link //apple_ref/doc/compositePage/c/func/KextManagerLoadKextWithURL
 * KextManagerLoadKextWithURL@/link&lt;/code&gt;
 * and &lt;code&gt;@link //apple_ref/doc/compositePage/c/func/KextManagerLoadKextWithIdentifier
 * KextManagerLoadKextWithIdentifier@/link&lt;/code&gt;.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleAllowUserLoadKey</span>               <span class="enscript-string">&quot;OSBundleAllowUserLoad&quot;</span>

<span class="enscript-comment">/*!
 * @define   kOSKernelResourceKey
 * @abstract A boolean value indicating whether the kext represents a built-in
 *           component of the kernel.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKernelResourceKey</span>                    <span class="enscript-string">&quot;OSKernelResource&quot;</span>

<span class="enscript-comment">/*!
 * @define   kIOKitPersonalitiesKey
 * @abstract A dictionary of dictionaries used in matching for I/O Kit drivers.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOKitPersonalitiesKey</span>                  <span class="enscript-string">&quot;IOKitPersonalities&quot;</span>

<span class="enscript-comment">/*
 * @define   kIOPersonalityPublisherKey
 * @abstract Used in personalities sent to the I/O Kit,
 *           contains the CFBundleIdentifier of the kext
 *           that the personality originated in.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kIOPersonalityPublisherKey</span>              <span class="enscript-string">&quot;IOPersonalityPublisher&quot;</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">CONFIG_KEC_FIPS</span>
<span class="enscript-comment">/*
 * @define   kAppleTextHashesKey
 * @abstract A dictionary conataining hashes for corecrypto kext.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kAppleTextHashesKey</span>                     <span class="enscript-string">&quot;AppleTextHashes&quot;</span>
#<span class="enscript-reference">endif</span>



#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Kext</span>/<span class="enscript-variable-name">OSBundle</span> <span class="enscript-variable-name">Property</span> <span class="enscript-variable-name">Deprecated</span> <span class="enscript-variable-name">Keys</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>
<span class="enscript-comment">/*
 * @define   kOSBundleDebugLevelKey
 * @abstract
 * Deprecated (used on some releases of Mac OS X prior to 10.6 Snow Leopard).
 * Value is an integer from 1-6, corresponding to the verbose levels
 * of kext tools on those releases.
 * On 10.6 Snow Leopard, use &lt;code&gt;@link OSKextEnableKextLogging
 * OSKextEnableKextLogging@/link&lt;/code&gt;.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleDebugLevelKey</span>                  <span class="enscript-string">&quot;OSBundleDebugLevel&quot;</span>

<span class="enscript-comment">/*!
 * @define   kOSBundleSharedExecutableIdentifierKey
 * @abstract Deprecated (used on some releases of Mac OS X
 *           prior to 10.6 Snow Leopard).
 *           Value is the bundle identifier of the pseudokext
 *           that contains an executable shared by this kext.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleSharedExecutableIdentifierKey</span>  <span class="enscript-string">&quot;OSBundleSharedExecutableIdentifier&quot;</span>


#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Kext</span>/<span class="enscript-variable-name">OSBundle</span> <span class="enscript-variable-name">Property</span> <span class="enscript-variable-name">List</span> <span class="enscript-variable-name">Values</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*!
 * @group Kext Property List Values
 * These constants encompass established values
 * for kernel extension bundle properties.
 */</span>

<span class="enscript-comment">/*!
* @define   kOSKextKernelIdentifier
* @abstract
* This is the CFBundleIdentifier user for the kernel itself.
*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextKernelIdentifier</span>                 <span class="enscript-string">&quot;__kernel__&quot;</span>

<span class="enscript-comment">/*!
* @define   kOSBundleRequiredRoot
* @abstract
* This &lt;code&gt;@link kOSBundleRequiredKey OSBundleRequired@/link&lt;/code&gt;
* value indicates that the kext may be needed to mount the root filesystem
* whether starting from a local or a network volume.
*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleRequiredRoot</span>                   <span class="enscript-string">&quot;Root&quot;</span>

<span class="enscript-comment">/*!
* @define   kOSBundleRequiredLocalRoot
* @abstract
* This &lt;code&gt;@link kOSBundleRequiredKey OSBundleRequired@/link&lt;/code&gt;
* value indicates that the kext may be needed to mount the root filesystem
* when starting from a local disk.
*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleRequiredLocalRoot</span>              <span class="enscript-string">&quot;Local-Root&quot;</span>

<span class="enscript-comment">/*!
* @define   kOSBundleRequiredNetworkRoot
* @abstract
* This &lt;code&gt;@link kOSBundleRequiredKey OSBundleRequired@/link&lt;/code&gt;
* value indicates that the kext may be needed to mount the root filesystem
* when starting over a network connection.
*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleRequiredNetworkRoot</span>            <span class="enscript-string">&quot;Network-Root&quot;</span>

<span class="enscript-comment">/*!
* @define   kOSBundleRequiredSafeBoot
* @abstract
* This &lt;code&gt;@link kOSBundleRequiredKey OSBundleRequired@/link&lt;/code&gt;
* value indicates that the kext can be loaded during a safe startup.
* This value does not normally cause the kext to be read by the booter
* or included in startup kext caches.
*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleRequiredSafeBoot</span>               <span class="enscript-string">&quot;Safe Boot&quot;</span>

<span class="enscript-comment">/*!
* @define   kOSBundleRequiredConsole
* @abstract
* This &lt;code&gt;@link kOSBundleRequiredKey OSBundleRequired@/link&lt;/code&gt;
* value indicates that the kext may be needed for console access
* (specifically in a single-user startup when
* &lt;code&gt;@link //apple_ref/doc/man/8/kextd kextd(8)@/link&lt;/code&gt;.
* does not run)
* and should be loaded during early startup.
*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSBundleRequiredConsole</span>                <span class="enscript-string">&quot;Console&quot;</span>


#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Kext</span> <span class="enscript-variable-name">Information</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>
<span class="enscript-comment">/*!
 * @group Kext Information
 * Types, constants, and macros providing a kext with information
 * about itself.
 */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>
<span class="enscript-comment">/*!
 * @typedef OSKextLoadTag
 *
 * @abstract
 * A unique identifier assigned to a loaded instanace of a kext.
 *
 * @discussion
 * If a kext is unloaded and later reloaded, the new instance
 * has a different load tag.
 *
 * A kext can get its own load tag in the &lt;code&gt;kmod_info_t&lt;/code&gt;
 * structure passed into its module start routine, as the
 * &lt;code&gt;id&lt;/code&gt; field (cast to this type).
 * You can use the load tag with the functions
 * &lt;code&gt;@link OSKextRetainKextWithLoadTag
 * OSKextRetainKextWithLoadTag@/link&lt;/code&gt; and
 * &lt;code&gt;@link OSKextReleaseKextWithLoadTag
 * OSKextReleaseKextWithLoadTag@/link&lt;/code&gt;.
 */</span>
#<span class="enscript-reference">else</span>
<span class="enscript-comment">/*!
 * @typedef OSKextLoadTag
 *
 * @abstract
 * A unique identifier assigned to a loaded instanace of a kext.
 *
 * @discussion
 * If a kext is unloaded and later reloaded, the new instance
 * has a different load tag.
 *
 * A kext can get its own load tag in the &lt;code&gt;kmod_info_t&lt;/code&gt;
 * structure passed into its module start routine, as the
 * &lt;code&gt;id&lt;/code&gt; field (cast to this type).
 */</span>
#<span class="enscript-reference">endif</span>
<span class="enscript-type">typedef</span> uint32_t  OSKextLoadTag;

<span class="enscript-comment">/*!
 * @define kOSKextInvalidLoadTag
 *
 * @abstract
 * A load tag value that will never be used for a loaded kext;
 * indicates kext not found.
 */</span>
#<span class="enscript-reference">define</span>  <span class="enscript-variable-name">kOSKextInvalidLoadTag</span>  ((OSKextLoadTag)(-1))

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>

<span class="enscript-comment">/* Make these visible to kexts only and *not* the kernel.
 */</span>
#<span class="enscript-reference">if</span> !<span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>

<span class="enscript-comment">/*!
 * @function OSKextGetCurrentLoadTag
 *
 * @abstract
 * Returns the run-time load tag for the calling kext as an
 * &lt;code&gt;@link OSKextLoadTag OSKextLoadTag@/link&lt;/code&gt;.
 *
 * @result
 * The run-time load tag for the calling kext as an
 * &lt;code&gt;@link OSKextLoadTag@/link&lt;/code&gt;.
 *
 * @discussion
 * The load tag identifies this loaded instance of the kext to the kernel
 * and to kernel functions that operate on kexts.
 */</span>
OSKextLoadTag <span class="enscript-function-name">OSKextGetCurrentLoadTag</span>(<span class="enscript-type">void</span>);

<span class="enscript-comment">/*!
 * @function OSKextGetCurrentIdentifier
 *
 * @abstract
 * Returns the CFBundleIdentifier for the calling kext as a C string.
 *
 * @result
 * The CFBundleIdentifier for the calling kext as a C string.
 */</span>
<span class="enscript-type">const</span> <span class="enscript-type">char</span> * <span class="enscript-function-name">OSKextGetCurrentIdentifier</span>(<span class="enscript-type">void</span>);

<span class="enscript-comment">/*!
 * @function OSKextGetCurrentVersionString
 *
 * @abstract
 * Returns the CFBundleVersion for the calling kext as a C string.
 *
 * @result
 * The CFBundleVersion for the calling kext as a C string.
 */</span>
<span class="enscript-type">const</span> <span class="enscript-type">char</span> * <span class="enscript-function-name">OSKextGetCurrentVersionString</span>(<span class="enscript-type">void</span>);

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !XNU_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Kext</span> <span class="enscript-variable-name">Loading</span> <span class="enscript-variable-name">C</span> <span class="enscript-variable-name">Functions</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>
<span class="enscript-comment">/*!
 * @group Kext Loading C Functions
 * Functions for loading and tracking kexts in the kernel.
 */</span>
 
<span class="enscript-comment">/*!
 * @function OSKextLoadKextWithIdentifier
 *
 * @abstract
 * Request that a kext be loaded.
 *
 * @param  kextIdentifier  The bundle identifier of the kext to be loaded.
 *
 * @result
 * &lt;code&gt;@link //apple_ref/c/macro/kOSReturnSuccess kOSReturnSuccess@/link&lt;/code&gt;
 * if the kext was loaded (or was already loaded).
 * &lt;code&gt;@link //apple_ref/c/macro/kOSKextReturnDeferred kOSKextReturnDeferred@/link&lt;/code&gt;
 * if the kext was not found and a request
 * was queued to &lt;code&gt;@link //apple_ref/doc/man/8/kextd kextd(8)@/link&lt;/code&gt;.
 * Other return values indicate a failure to load the kext.
 *
 * @discussion
 * If a kext is already in the kernel but not loaded, it is loaded immediately.
 * If it isn't found, an asynchronous load request is
 * made to &lt;code&gt;@link //apple_ref/doc/man/8/kextd kextd(8)@/link&lt;/code&gt;
 * and  &lt;code&gt;@link //apple_ref/c/macro/kOSKextReturnDeferred kOSKextReturnDeferred@/link&lt;/code&gt; is returned.
 * There is no general notification or callback mechanism for load requests.
 */</span>
OSReturn <span class="enscript-function-name">OSKextLoadKextWithIdentifier</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> * kextIdentifier);


<span class="enscript-comment">/*!
 * @function OSKextRetainKextWithLoadTag
 *
 * @abstract
 * Retain a loaded kext based on its load tag,
 * and enable autounload for that kext.
 *
 * @param  loadTag   The load tag of the kext to be retained.
 *                   See &lt;code&gt;@link OSKextGetCurrentLoadTag@/link&lt;/code&gt;.
 *
 * @result
 * &lt;code&gt;@link //apple_ref/c/macro/kOSReturnSuccess kOSReturnSuccess@/link&lt;/code&gt;
 * if the kext was retained.
 * &lt;code&gt;@link //apple_ref/c/macro/kOSKextReturnNotFound kOSKextReturnNotFound@/link&lt;/code&gt;
 * if the kext was not found.
 * &lt;code&gt;@link //apple_ref/c/macro/kOSKextReturnInvalidArgument
 * kOSKextReturnInvalidArgument@/link&lt;/code&gt;
 * if &lt;code&gt;loadTag&lt;/code&gt; is
 * &lt;code&gt;@link kOSKextInvalidLoadTag kOSKextInvalidLoadTag@/link&lt;/code&gt;.
 *
 * @discussion
 * Retaining a kext prevents it from being unloaded,
 * either explicitly or automatically, and enables autounload for the kext.
 * When autounload is enabled, then shortly after the kext's last reference
 * is dropped, it will be unloaded if there are no outstanding references to it
 * and there are no instances of its Libkern C++ subclasses (if any).
 *
 * Kexts that define subclasses of
 * &lt;code&gt;@link //apple_ref/doc/class/IOService IOService@/link&lt;/code&gt;
 * have autounload enabled automatically.
 * Other kexts can use the reference count to manage automatic unload
 * without having to define and create Libkern C++ objects.
 * For example, a filesystem kext can retain itself whenever a new mount
 * is created, and release itself when a mount is removed.
 * When the last mount is removed, the kext will be unloaded after a brief delay.
 *
 * A kext can get its own load tag using the
 * &lt;code&gt;@link OSKextGetCurrentLoadTag@/link&lt;/code&gt;.
 *
 * Kexts should not retain and release other kexts; linkage references
 * are accounted for internally.
 */</span>
OSReturn <span class="enscript-function-name">OSKextRetainKextWithLoadTag</span>(OSKextLoadTag loadTag);


<span class="enscript-comment">/*!
 * @function OSKextReleaseKextWithLoadTag
 *
 * @abstract
 * Release a loaded kext based on its load tag.
 *
 * @param  loadTag   The load tag of the kext to be released.
 *                   See &lt;code&gt;@link OSKextGetCurrentLoadTag@/link&lt;/code&gt;.
 *
 * @result
 * &lt;code&gt;@link //apple_ref/c/macro/kOSReturnSuccess kOSReturnSuccess@/link&lt;/code&gt;
 * if the kext was released.
 * &lt;code&gt;@link //apple_ref/c/macro/kOSKextReturnNotFound
 * kOSKextReturnNotFound@/link&lt;/code&gt;
 * if the kext was not found.
 * &lt;code&gt;@link //apple_ref/c/macro/kOSKextReturnInvalidArgument
 * kOSKextReturnInvalidArgument@/link&lt;/code&gt;
 * if &lt;code&gt;loadTag&lt;/code&gt; is
 * &lt;code&gt;@link kOSKextInvalidLoadTag kOSKextInvalidLoadTag@/link&lt;/code&gt;.
 *
 * @discussion
 * The kext should have been retained previously via
 * &lt;code&gt;@link OSKextRetainKextWithLoadTag@/link&lt;/code&gt;.
 *
 * This function schedules an autounload scan for all kexts.
 * When that scan occurs, if a kext has autounload enabled,
 * it will be unloaded if there are no outstanding references to it
 * and there are no instances of its Libkern C++ classes (if any).
 *
 * Kexts that define subclasses of
 * &lt;code&gt;@link //apple_ref/doc/class/IOService IOService@/link&lt;/code&gt;
 * have autounload enabled automatically.
 * Other kexts can use the reference count to manage automatic unload
 * without having to define and create Libkern C++ objects.
 * For example, a filesystem kext can be retained whenever a new mount
 * is created, and released when a mount is removed.
 * When the last mount is removed, the kext will be unloaded after a brief delay.
 *
 * While the autounload scan takes place after a delay of at least a minute,
 * a kext that manages its own reference counts for autounload should
 * be prepared to have its module stop function called even while the function
 * calling this function is still running.
 *
 * A kext can get its own load tag using the
 * &lt;code&gt;@link OSKextGetCurrentLoadTag@/link&lt;/code&gt;.
 *
 * Kexts should not retain and release other kexts; linkage references
 * are accounted for internally.
 */</span>
OSReturn <span class="enscript-function-name">OSKextReleaseKextWithLoadTag</span>(OSKextLoadTag loadTag);

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Kext</span> <span class="enscript-variable-name">Requests</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>
<span class="enscript-comment">/*!
 * @group Kext Requests to User Space
 * Functions for making requests to kextd in user space.
 */</span>

<span class="enscript-comment">/*!
 * @typedef OSKextRequestTag
 *
 * @abstract
 * Identifies a kext request made to user space.
 */</span>
<span class="enscript-type">typedef</span> uint32_t OSKextRequestTag;

<span class="enscript-comment">/*!
 * @define kOSKextRequestTagInvalid
 *
 * @abstract
 * A request tag value that will never be used for a kext request;
 * indicates failure to create/queue the request.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kOSKextRequestTagInvalid</span>  ((OSKextRequestTag)-1)

<span class="enscript-comment">/*!
 * @typedef OSKextRequestResourceCallback
 *
 * @abstract
 * Invoked to provide results for a kext resource request.
 *
 * @param  requestTag          The tag of the request that the callback pertains to.
 * @param  result              The result of the request:
 *                             &lt;code&gt;@link kOSReturnSuccess
 *                             kOSReturnSuccess@/link&lt;/code&gt;
 *                             if the request was fulfilled;
 *                             &lt;code&gt;@link kOSKextReturnTimeout
 *                             kOSKextReturnTimeout@/link&lt;/code&gt;
 *                             if the request has timed out;
 *                             &lt;code&gt;@link kOSKextReturnStopping
 *                             kOSKextReturnStopping@/link&lt;/code&gt;
 *                             if the kext containing the callback
 *                             address for the kext is being unloaded;
 *                             or other values on error.
 * @param  resourceData        A pointer to the requested resource data.
 *                             Owned by the system; the kext should make a copy
 *                             if it needs to keep the data past the callback.
 * @param  resourceDataLength  The length of &lt;code&gt;resourceData&lt;/code&gt;.
 * @param  context             The context pointer originally passed to
 *                             &lt;code&gt;@link OSKextRequestResource
 *                             OSKextRequestResource@/link&lt;/code&gt;.
 */</span>
<span class="enscript-type">typedef</span> <span class="enscript-function-name">void</span> (* OSKextRequestResourceCallback)(
    OSKextRequestTag                requestTag,
    OSReturn                        result,
    <span class="enscript-type">const</span> <span class="enscript-type">void</span>                    * resourceData,
    uint32_t                        resourceDataLength,
    <span class="enscript-type">void</span>                          * context);

<span class="enscript-comment">/*!
 * @function OSKextRequestResource
 *
 * @abstract
 * Requests data from a nonlocalized resource file in a kext bundle on disk.
 *
 * @param  kextIdentifier  The CFBundleIdentifier of the kext
 *                         from which to read the file.
 * @param  resourceName    The name of the resource file to read.
 * @param  callback        A pointer to a callback function; the address
 *                         must be within a currently-loaded kext.
 * @param  context         A pointer to arbitrary run-time data
 *                         that will be passed to the callback
 *                         when it is invoked. May be &lt;code&gt;NULL&lt;/code&gt;.
 * @param  requestTagOut   If non-&lt;code&gt;NULL&lt;/code&gt;,
 *                         filled on success with a tag identifying the
 *                         pending request
 *                         (or on failure with &lt;code&gt;@link kOSKextRequestTagInvalid
 *                         kOSKextRequestTagInvalid@/link&lt;/code&gt;;
 *                         can be used with
 *                         &lt;code&gt;@link OSKextCancelRequest
 *                         OSKextCancelRequest@/link&lt;/code&gt;.
 *
 * @result
 * &lt;code&gt;@link kOSReturnSuccess kOSReturnSuccess@/link&lt;/code&gt;
 * if the request is successfully queued.
 * &lt;code&gt;@link kOSKextReturnInvalidArgument kOSKextReturnInvalidArgument@/link&lt;/code&gt;
 * if &lt;code&gt;kextIdentifier&lt;/code&gt; or &lt;code&gt;resourceName&lt;/code&gt; or if
 * &lt;code&gt;callback&lt;/code&gt; is not an address within a loaded kext executable.
 * &lt;code&gt;@link kOSKextReturnStopping kOSKextReturnStopping@/link&lt;/code&gt;
 * if an unload attempt is being made
 * on the kext containing &lt;code&gt;callback&lt;/code&gt;.
 * Other &lt;code&gt;OSKextReturn...&lt;/code&gt; errors are possible.
 *
 * @discussion
 * This function queues an asynchronous request to the user-space kext daemon
 * &lt;code&gt;@link //apple_ref/doc/man/8/kextd kextd(8)@/link&lt;/code&gt;;
 * requests for resources early in system startup
 * will not be fulfilled until that daemon starts.
 * Requests made by a kext while that kext is loading
 * (specifically in the kext's module start routine)
 * will not be fulfilled until after the start routine returns and
 * the kext is completely loaded.
 * Kexts requesting resources should be sure to perform appropriate locking
 * in the callback function.
 *
 * Kext resources are stored in the kext's on-disk bundle under the
 * Resources subdirectory.
 * See {@linkdoc //apple_ref/doc/uid/10000123i Bundle Programming Guide}
 * for an overview of bundle structure.
 * The localization context of the kext daemon
 * (namely that of the superuser)
 * will be used in retrieving resources;
 * kext resources intended for use in the kernel
 * should generally not be localized.
 *
 * &lt;code&gt;callback&lt;/code&gt; is guaranteed to be invoked except when:
 * &lt;ul&gt;
 * &lt;li&gt;@link OSKextCancelRequest &lt;code&gt;OSKextCancelRequest&lt;/code&gt;@/link
 *     is used to cancel the request.
 *     In this case the kext gets the &lt;code&gt;context&lt;/code&gt; pointer
 *     and can clean it up.&lt;/li&gt;
 * &lt;li&gt;The request is made during a kext's module start routine
 *     and the start routine returns an error.
 *     In this case, callbacks cannot be safely invoked, so
 *     the kext should clean up all request contexts
 *     when returning the error from the start routine.&lt;/li&gt;
 * &lt;/ul&gt;
 *
 * Kexts with pending requests are not subject to autounload,
 * but requests are subject to timeout after a few minutes.
 * If that amount of time passes with no response from user space,
 * &lt;code&gt;callback&lt;/code&gt; is invoked with a result of.
 * &lt;code&gt;@link kOSKextReturnTimeout kOSKextReturnTimeout@/link&lt;/code&gt;.
 *
 * Kexts that are explicitly unloaded have all pending request callbacks
 * invoked with a result of
 * &lt;code&gt;@link kOSKextReturnStopping kOSKextReturnStopping@/link&lt;/code&gt;.
 * The kext must handle these callbacks,
 * even if its stop routine will prevent unloading.
 * If the kext does prevent unloading, it can reissue resource requests
 * outside of the stop function.
 */</span>
OSReturn <span class="enscript-function-name">OSKextRequestResource</span>(
    <span class="enscript-type">const</span> <span class="enscript-type">char</span>                    * kextIdentifier,
    <span class="enscript-type">const</span> <span class="enscript-type">char</span>                    * resourceName,
    OSKextRequestResourceCallback   callback,
    <span class="enscript-type">void</span>                          * context,
    OSKextRequestTag              * requestTagOut);

<span class="enscript-comment">/*!
 * @function OSKextCancelRequest
 *
 * @abstract
 * Cancels a pending user-space kext request without invoking the callback.
 *
 * @param  requestTag  A tag identifying a pending request.
 * @param  contextOut  If non-&lt;code&gt;NULL&lt;/code&gt;, filled with the context pointer
 *                     originally passed with the request.
 *
 * @result
 * &lt;code&gt;@link kOSReturnSuccess kOSReturnSuccess@/link&lt;/code&gt;
 * if the request is successfully canceled.
 * &lt;code&gt;@link kOSKextReturnNotFound kOSKextReturnNotFound@/link&lt;/code&gt;
 * if &lt;code&gt;requestTag&lt;/code&gt; does not identify any pending request.
 * Other &lt;code&gt;OSKextReturn...&lt;/code&gt; errors are possible.
 *
 * @discussion
 * This function cancels a pending request if it exists,
 * so that its callback will not be invoked.
 * It returns in &lt;code&gt;contextOut&lt;/code&gt;
 * the context pointer used to create the request
 * so that any resources allocated for the request can be cleaned up.
 *
 * Kexts do not need to cancel outstanding requests
 * in their module stop functions;
 * when a kext is unloaded, all pending request callbacks
 * are invoked with a result of
 * &lt;code&gt;@link kOSKextReturnTimeout kOSKextReturnTimeout@/link&lt;/code&gt;
 * before the stop function is called.
 */</span>
OSReturn <span class="enscript-function-name">OSKextCancelRequest</span>(
    OSKextRequestTag    requestTag,
    <span class="enscript-type">void</span>             ** contextOut);


<span class="enscript-comment">/*!
 * @function OSKextGrabPgoData
 *
 * @abstract
 * Grab a LLVM profile data buffer from a loaded kext.
 *
 * @param   uuid             the uuid identifying the kext to retrieve data from
 * @param   pSize            pointer of where to store the size of the buffer.   May be NULL.
 * @param   pBuffer          pointer to the output buffer.   May be NULL.
 * @param   bufferSize       size of the buffer pointed to by pBuffer
 * @param   wait_for_unload  (boolean) sleep until the kext is unloaded
 * @param   metadata         (boolean) include metadata footer
 *
 * @result
 * 0 on success
 * ENOTSUP if the kext does not have profile data to retrieve.
 * ENOTSUP if no kext with the given UUID is found
 * ERRORS  if the provided buffer is too small
 * EIO     internal error, such as if __llvm_profile_write_buffer_internal fails
 */</span>
<span class="enscript-type">int</span>
<span class="enscript-function-name">OSKextGrabPgoData</span>(uuid_t uuid,
                  uint64_t *pSize,
                  <span class="enscript-type">char</span> *pBuffer,
                  uint64_t bufferSize,
                  <span class="enscript-type">int</span> wait_for_unload,
                  <span class="enscript-type">int</span> metadata);



#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Weak</span> <span class="enscript-variable-name">linking</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>
<span class="enscript-comment">/*!
 * @group Weak Linking
 * Support for weak references to symbols in kexts.
 */</span>

<span class="enscript-comment">/*!
 * @var gOSKextUnresolved
 *
 * @abstract 
 * The value to which a kext's unresolved, weakly-referenced symbols are bound.
 *
 * @discussion
 * A kext must test a weak symbol before using it.  A weak symbol 
 * is only safe to use if it is not equal to &lt;code&gt;gOSKextUnresolved&lt;/code&gt;.
 *
 * Example for a weak symbol named &lt;code&gt;foo&lt;/code&gt;:
 * &lt;pre&gt;
 * @textblock
 *      if (&amp;foo != gOSKextUnresolved) {
 *          foo();
 *      } else {
 *          printf(&quot;foo() is not supported\n&quot;);
 *      }
 * @/textblock
 * &lt;/pre&gt;
 */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">const</span> <span class="enscript-type">void</span> * gOSKextUnresolved;

<span class="enscript-comment">/*!
 * @define OSKextSymbolIsResolved
 *
 * @abstract 
 * Checks whether a weakly-referenced symbol has been resolved.
 *
 * @param weak_sym   The weak symbol to be tested for resolution.
 *
 * @result 
 * &lt;code&gt;TRUE&lt;/code&gt; if weak_sym is resolved, or &lt;code&gt;FALSE&lt;/code&gt; 
 * if weak_sym is unresolved.
 *
 * @discussion
 * This is a convenience macro for testing if weak symbols are resolved.
 * 
 * Example for a weak symbol named &lt;code&gt;foo&lt;/code&gt;:
 * &lt;pre&gt;
 * @textblock
 *      if (OSKextSymbolIsResolved(foo)) {
 *          foo();
 *      } else {
 *          printf(&quot;foo() is not resolved\n&quot;);
 *      }
 * @/textblock
 * &lt;/pre&gt;
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">OSKextSymbolIsResolved</span>(weak_sym)        \
    (&amp;(weak_sym) != gOSKextUnresolved)


#<span class="enscript-reference">if</span> <span class="enscript-variable-name">CONFIG_KEC_FIPS</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRAGMA_MARK</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> <span class="enscript-variable-name">Kernel</span> <span class="enscript-variable-name">External</span> <span class="enscript-variable-name">Components</span> <span class="enscript-variable-name">for</span> <span class="enscript-variable-name">FIPS</span> <span class="enscript-variable-name">compliance</span>
<span class="enscript-comment">/********************************************************************/</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// Kernel External Components for FIPS compliance (KEC_FIPS)
</span><span class="enscript-comment">// WARNING - ath_hash is owned by the kernel, do not free
</span><span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> AppleTEXTHash {
    <span class="enscript-type">const</span> <span class="enscript-type">int</span>       ath_version;    <span class="enscript-comment">// version of this structure (value is 1)
</span>    <span class="enscript-type">int</span>             ath_length;     <span class="enscript-comment">// length of hash data
</span>    <span class="enscript-type">void</span> *          ath_hash;       <span class="enscript-comment">// hash extracted from AppleTextHashes dict 
</span>} AppleTEXTHash_t;
#<span class="enscript-reference">endif</span> // <span class="enscript-variable-name">CONFIG_KEC_FIPS</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL */</span>

__END_DECLS

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* _LIBKERN_OSKEXTLIB_H */</span>
</pre>
<hr />
</body></html>