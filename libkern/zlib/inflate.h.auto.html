<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>inflate.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">inflate.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2008 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/* inflate.h -- internal inflate state definition
 * Copyright (C) 1995-2004 Mark Adler
 * For conditions of distribution and use, see copyright notice in zlib.h
 */</span>

<span class="enscript-comment">/* WARNING: this file should *not* be used by applications. It is
   part of the implementation of the compression library and is
   subject to change. Applications should only use zlib.h.
 */</span>

<span class="enscript-comment">/* define NO_GZIP when compiling if you want to disable gzip header and
   trailer decoding by inflate().  NO_GZIP would be used to avoid linking in
   the crc code when it is not needed.  For shared libraries, gzip decoding
   should be left enabled. */</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">NO_GZIP</span>
#  <span class="enscript-reference">define</span> <span class="enscript-variable-name">GUNZIP</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/* Possible inflate modes between inflate() calls */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">enum</span> {
    HEAD,       <span class="enscript-comment">/* i: waiting for magic header */</span>
    FLAGS,      <span class="enscript-comment">/* i: waiting for method and flags (gzip) */</span>
    TIME,       <span class="enscript-comment">/* i: waiting for modification time (gzip) */</span>
    OS,         <span class="enscript-comment">/* i: waiting for extra flags and operating system (gzip) */</span>
    EXLEN,      <span class="enscript-comment">/* i: waiting for extra length (gzip) */</span>
    EXTRA,      <span class="enscript-comment">/* i: waiting for extra bytes (gzip) */</span>
    NAME,       <span class="enscript-comment">/* i: waiting for end of file name (gzip) */</span>
    COMMENT,    <span class="enscript-comment">/* i: waiting for end of comment (gzip) */</span>
    HCRC,       <span class="enscript-comment">/* i: waiting for header crc (gzip) */</span>
    DICTID,     <span class="enscript-comment">/* i: waiting for dictionary check value */</span>
    DICT,       <span class="enscript-comment">/* waiting for inflateSetDictionary() call */</span>
        TYPE,       <span class="enscript-comment">/* i: waiting for type bits, including last-flag bit */</span>
        TYPEDO,     <span class="enscript-comment">/* i: same, but skip check to exit inflate on new block */</span>
        STORED,     <span class="enscript-comment">/* i: waiting for stored size (length and complement) */</span>
        COPY,       <span class="enscript-comment">/* i/o: waiting for input or output to copy stored block */</span>
        TABLE,      <span class="enscript-comment">/* i: waiting for dynamic block table lengths */</span>
        LENLENS,    <span class="enscript-comment">/* i: waiting for code length code lengths */</span>
        CODELENS,   <span class="enscript-comment">/* i: waiting for length/lit and distance code lengths */</span>
            LEN,        <span class="enscript-comment">/* i: waiting for length/lit code */</span>
            LENEXT,     <span class="enscript-comment">/* i: waiting for length extra bits */</span>
            DIST,       <span class="enscript-comment">/* i: waiting for distance code */</span>
            DISTEXT,    <span class="enscript-comment">/* i: waiting for distance extra bits */</span>
            MATCH,      <span class="enscript-comment">/* o: waiting for output space to copy string */</span>
            LIT,        <span class="enscript-comment">/* o: waiting for output space to write literal */</span>
    CHECK,      <span class="enscript-comment">/* i: waiting for 32-bit check value */</span>
    LENGTH,     <span class="enscript-comment">/* i: waiting for 32-bit length (gzip) */</span>
    DONE,       <span class="enscript-comment">/* finished check, done -- remain here until reset */</span>
    BAD,        <span class="enscript-comment">/* got a data error -- remain here until reset */</span>
    MEM,        <span class="enscript-comment">/* got an inflate() memory error -- remain here until reset */</span>
    SYNC        <span class="enscript-comment">/* looking for synchronization bytes to restart inflate() */</span>
} inflate_mode;

<span class="enscript-comment">/*
    State transitions between above modes -

    (most modes can go to the BAD or MEM mode -- not shown for clarity)

    Process header:
        HEAD -&gt; (gzip) or (zlib)
        (gzip) -&gt; FLAGS -&gt; TIME -&gt; OS -&gt; EXLEN -&gt; EXTRA -&gt; NAME
        NAME -&gt; COMMENT -&gt; HCRC -&gt; TYPE
        (zlib) -&gt; DICTID or TYPE
        DICTID -&gt; DICT -&gt; TYPE
    Read deflate blocks:
            TYPE -&gt; STORED or TABLE or LEN or CHECK
            STORED -&gt; COPY -&gt; TYPE
            TABLE -&gt; LENLENS -&gt; CODELENS -&gt; LEN
    Read deflate codes:
                LEN -&gt; LENEXT or LIT or TYPE
                LENEXT -&gt; DIST -&gt; DISTEXT -&gt; MATCH -&gt; LEN
                LIT -&gt; LEN
    Process trailer:
        CHECK -&gt; LENGTH -&gt; DONE
 */</span>

<span class="enscript-comment">/* state maintained between inflate() calls.  Approximately 7K bytes. */</span>
<span class="enscript-type">struct</span> inflate_state {
    inflate_mode mode;          <span class="enscript-comment">/* current inflate mode */</span>
    <span class="enscript-type">int</span> last;                   <span class="enscript-comment">/* true if processing last block */</span>
    <span class="enscript-type">int</span> wrap;                   <span class="enscript-comment">/* bit 0 true for zlib, bit 1 true for gzip */</span>
    <span class="enscript-type">int</span> havedict;               <span class="enscript-comment">/* true if dictionary provided */</span>
    <span class="enscript-type">int</span> flags;                  <span class="enscript-comment">/* gzip header method and flags (0 if zlib) */</span>
    <span class="enscript-type">unsigned</span> dmax;              <span class="enscript-comment">/* zlib header max distance (INFLATE_STRICT) */</span>
    <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> check;        <span class="enscript-comment">/* protected copy of check value */</span>
    <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> total;        <span class="enscript-comment">/* protected copy of output count */</span>
    gz_headerp head;            <span class="enscript-comment">/* where to save gzip header information */</span>
        <span class="enscript-comment">/* sliding window */</span>
    <span class="enscript-type">unsigned</span> wbits;             <span class="enscript-comment">/* log base 2 of requested window size */</span>
    <span class="enscript-type">unsigned</span> wsize;             <span class="enscript-comment">/* window size or zero if not using window */</span>
    <span class="enscript-type">unsigned</span> whave;             <span class="enscript-comment">/* valid bytes in the window */</span>
    <span class="enscript-type">unsigned</span> write;             <span class="enscript-comment">/* window write index */</span>
    <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> FAR *window;  <span class="enscript-comment">/* allocated sliding window, if needed */</span>
        <span class="enscript-comment">/* bit accumulator */</span>
    <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> hold;         <span class="enscript-comment">/* input bit accumulator */</span>
    <span class="enscript-type">unsigned</span> bits;              <span class="enscript-comment">/* number of bits in &quot;in&quot; */</span>
        <span class="enscript-comment">/* for string and stored block copying */</span>
    <span class="enscript-type">unsigned</span> length;            <span class="enscript-comment">/* literal or length of data to copy */</span>
    <span class="enscript-type">unsigned</span> offset;            <span class="enscript-comment">/* distance back to copy string from */</span>
        <span class="enscript-comment">/* for table and code decoding */</span>
    <span class="enscript-type">unsigned</span> extra;             <span class="enscript-comment">/* extra bits needed */</span>
        <span class="enscript-comment">/* fixed and dynamic code tables */</span>
    code <span class="enscript-type">const</span> FAR *lencode;    <span class="enscript-comment">/* starting table for length/literal codes */</span>
    code <span class="enscript-type">const</span> FAR *distcode;   <span class="enscript-comment">/* starting table for distance codes */</span>
    <span class="enscript-type">unsigned</span> lenbits;           <span class="enscript-comment">/* index bits for lencode */</span>
    <span class="enscript-type">unsigned</span> distbits;          <span class="enscript-comment">/* index bits for distcode */</span>
        <span class="enscript-comment">/* dynamic table building */</span>
    <span class="enscript-type">unsigned</span> ncode;             <span class="enscript-comment">/* number of code length code lengths */</span>
    <span class="enscript-type">unsigned</span> nlen;              <span class="enscript-comment">/* number of length code lengths */</span>
    <span class="enscript-type">unsigned</span> ndist;             <span class="enscript-comment">/* number of distance code lengths */</span>
    <span class="enscript-type">unsigned</span> have;              <span class="enscript-comment">/* number of code lengths in lens[] */</span>
    code FAR *next;             <span class="enscript-comment">/* next available space in codes[] */</span>
    <span class="enscript-type">unsigned</span> <span class="enscript-type">short</span> lens[320];   <span class="enscript-comment">/* temporary storage for code lengths */</span>
    <span class="enscript-type">unsigned</span> <span class="enscript-type">short</span> work[288];   <span class="enscript-comment">/* work area for code table building */</span>
    code codes[ENOUGH];         <span class="enscript-comment">/* space for code tables */</span>
};
</pre>
<hr />
</body></html>