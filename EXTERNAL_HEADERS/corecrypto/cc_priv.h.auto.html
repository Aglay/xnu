<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>cc_priv.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">cc_priv.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 *  cc_priv.h
 *  corecrypto
 *
 *  Created on 12/01/2010
 *
 *  Copyright (c) 2010,2011,2012,2014,2015 Apple Inc. All rights reserved.
 *
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_CORECRYPTO_CC_PRIV_H_</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_CORECRYPTO_CC_PRIV_H_</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;corecrypto/cc.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;stdint.h&gt;</span>

<span class="enscript-comment">/* defines the following macros :

 CC_MEMCPY  : optimized memcpy.
 CC_MEMMOVE : optimized memmove.
 CC_MEMSET  : optimized memset.
 CC_BZERO   : optimized bzero, 

 CC_STORE32_BE : store 32 bit value in big endian in unaligned buffer.
 CC_STORE32_LE : store 32 bit value in little endian in unaligned buffer.
 CC_STORE64_BE : store 64 bit value in big endian in unaligned buffer.
 CC_STORE64_LE : store 64 bit value in little endian in unaligned buffer.

 CC_LOAD32_BE : load 32 bit value in big endian from unaligned buffer.
 CC_LOAD32_LE : load 32 bit value in little endian from unaligned buffer.
 CC_LOAD64_BE : load 64 bit value in big endian from unaligned buffer.
 CC_LOAD64_LE : load 64 bit value in little endian from unaligned buffer.

 CC_ROR  : Rotate Right 32 bits. Rotate count can be a variable.
 CC_ROL  : Rotate Left 32 bits. Rotate count can be a variable.
 CC_RORc : Rotate Right 32 bits. Rotate count must be a constant.
 CC_ROLc : Rotate Left 32 bits. Rotate count must be a constant.

 CC_ROR64  : Rotate Right 64 bits. Rotate count can be a variable.
 CC_ROL64  : Rotate Left 64 bits. Rotate count can be a variable.
 CC_ROR64c : Rotate Right 64 bits. Rotate count must be a constant.
 CC_ROL64c : Rotate Left 64 bits. Rotate count must be a constant.

 CC_BSWAP  : byte swap a 32 bits variable.

 CC_H2BE32 : convert a 32 bits value between host and big endian order.
 CC_H2LE32 : convert a 32 bits value between host and little endian order.

The following are not defined yet... define them if needed.

 CC_BSWAPc   : byte swap a 32 bits constant

 CC_BSWAP64  : byte swap a 64 bits variable
 CC_BSWAP64c : byte swap a 64 bits constant

 CC_READ_LE32 : read a 32 bits little endian value
 CC_READ_LE64 : read a 64 bits little endian value
 CC_READ_BE32 : read a 32 bits big endian value
 CC_READ_BE64 : read a 64 bits big endian value

 CC_WRITE_LE32 : write a 32 bits little endian value
 CC_WRITE_LE64 : write a 64 bits little endian value
 CC_WRITE_BE32 : write a 32 bits big endian value
 CC_WRITE_BE64 : write a 64 bits big endian value

 CC_H2BE64 : convert a 64 bits value between host and big endian order
 CC_H2LE64 : convert a 64 bits value between host and little endian order

*/</span>

<span class="enscript-comment">/* TODO: optimized versions */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_MEMCPY</span>(D,S,L) memcpy((D),(S),(L))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_MEMMOVE</span>(D,S,L) memmove((D),(S),(L))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_MEMSET</span>(D,V,L) memset((D),(V),(L))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_BZERO</span>(D,L) memset((D),0,(L)) // Deprecated, DO NOT USE


<span class="enscript-comment">// MARK: - Loads and Store
</span>
<span class="enscript-comment">// MARK: -- 32 bits - little endian
</span>
<span class="enscript-comment">// MARK: --- Default version
</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CC_STORE32_LE</span>(x, y) do {                                    \
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[3] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;24)&amp;255);		\
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[2] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;16)&amp;255);		\
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[1] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;8)&amp;255);		\
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[0] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)((x)&amp;255);			\
} <span class="enscript-keyword">while</span>(0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CC_LOAD32_LE</span>(x, y) do {                                     \
x = ((uint32_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[3] &amp; 255)&lt;&lt;24) |			    \
    ((uint32_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[2] &amp; 255)&lt;&lt;16) |			    \
    ((uint32_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[1] &amp; 255)&lt;&lt;8)  |			    \
    ((uint32_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[0] &amp; 255));				    \
} <span class="enscript-keyword">while</span>(0)

<span class="enscript-comment">// MARK: -- 64 bits - little endian
</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CC_STORE64_LE</span>(x, y) do {                                    \
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[7] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;56)&amp;255);     \
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[6] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;48)&amp;255);		\
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[5] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;40)&amp;255);		\
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[4] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;32)&amp;255);		\
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[3] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;24)&amp;255);		\
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[2] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;16)&amp;255);		\
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[1] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;8)&amp;255);		\
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[0] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)((x)&amp;255);			\
} <span class="enscript-keyword">while</span>(0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CC_LOAD64_LE</span>(x, y) do {                                     \
x = (((uint64_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[7] &amp; 255))&lt;&lt;56) |           \
    (((uint64_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[6] &amp; 255))&lt;&lt;48) |           \
    (((uint64_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[5] &amp; 255))&lt;&lt;40) |           \
    (((uint64_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[4] &amp; 255))&lt;&lt;32) |           \
    (((uint64_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[3] &amp; 255))&lt;&lt;24) |           \
    (((uint64_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[2] &amp; 255))&lt;&lt;16) |           \
    (((uint64_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[1] &amp; 255))&lt;&lt;8)  |           \
    (((uint64_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[0] &amp; 255)));                \
} <span class="enscript-keyword">while</span>(0)

<span class="enscript-comment">// MARK: -- 32 bits - big endian
</span><span class="enscript-comment">// MARK: --- intel version
</span>
#<span class="enscript-reference">if</span> (<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__i386__</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__x86_64__</span>))

#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_STORE32_BE</span>(x, y)     \
    __asm__ __volatile__ (      \
    <span class="enscript-string">&quot;bswapl %0     \n\t&quot;</span>        \
    <span class="enscript-string">&quot;movl   %0,(%1)\n\t&quot;</span>        \
    <span class="enscript-string">&quot;bswapl %0     \n\t&quot;</span>        \
    ::<span class="enscript-string">&quot;r&quot;</span>(x), <span class="enscript-string">&quot;r&quot;</span>(y))

#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_LOAD32_BE</span>(x, y)      \
    __asm__ __volatile__ (      \
    <span class="enscript-string">&quot;movl (%1),%0\n\t&quot;</span>          \
    <span class="enscript-string">&quot;bswapl %0\n\t&quot;</span>             \
    :<span class="enscript-string">&quot;=r&quot;</span>(x): <span class="enscript-string">&quot;r&quot;</span>(y))

#<span class="enscript-reference">else</span>
<span class="enscript-comment">// MARK: --- default version
</span>#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CC_STORE32_BE</span>(x, y) do {                                \
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[0] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;24)&amp;255);	\
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[1] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;16)&amp;255);	\
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[2] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;8)&amp;255);	\
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[3] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)((x)&amp;255);       \
} <span class="enscript-keyword">while</span>(0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CC_LOAD32_BE</span>(x, y) do {                             \
x = ((uint32_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[0] &amp; 255)&lt;&lt;24) |	    \
    ((uint32_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[1] &amp; 255)&lt;&lt;16) |		\
    ((uint32_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[2] &amp; 255)&lt;&lt;8)  |		\
    ((uint32_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[3] &amp; 255));          \
} <span class="enscript-keyword">while</span>(0)

#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// MARK: -- 64 bits - big endian
</span>
<span class="enscript-comment">// MARK: --- intel 64 bits version
</span>
#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__x86_64__</span>)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CC_STORE64_BE</span>(x, y)   \
__asm__ __volatile__ (        \
<span class="enscript-string">&quot;bswapq %0     \n\t&quot;</span>          \
<span class="enscript-string">&quot;movq   %0,(%1)\n\t&quot;</span>          \
<span class="enscript-string">&quot;bswapq %0     \n\t&quot;</span>          \
::<span class="enscript-string">&quot;r&quot;</span>(x), <span class="enscript-string">&quot;r&quot;</span>(y))

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CC_LOAD64_BE</span>(x, y)    \
__asm__ __volatile__ (        \
<span class="enscript-string">&quot;movq (%1),%0\n\t&quot;</span>            \
<span class="enscript-string">&quot;bswapq %0\n\t&quot;</span>               \
:<span class="enscript-string">&quot;=r&quot;</span>(x): <span class="enscript-string">&quot;r&quot;</span>(y))

#<span class="enscript-reference">else</span>

<span class="enscript-comment">// MARK: --- default version
</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_STORE64_BE</span>(x, y) do {                                    \
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[0] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;56)&amp;255);		\
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[1] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;48)&amp;255);		\
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[2] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;40)&amp;255);		\
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[3] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;32)&amp;255);		\
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[4] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;24)&amp;255);		\
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[5] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;16)&amp;255);		\
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[6] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)(((x)&gt;&gt;8)&amp;255);		\
    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[7] = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>)((x)&amp;255);			\
} <span class="enscript-keyword">while</span>(0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CC_LOAD64_BE</span>(x, y) do {                                     \
x = (((uint64_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[0] &amp; 255))&lt;&lt;56) |           \
    (((uint64_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[1] &amp; 255))&lt;&lt;48) |           \
    (((uint64_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[2] &amp; 255))&lt;&lt;40) |           \
    (((uint64_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[3] &amp; 255))&lt;&lt;32) |           \
    (((uint64_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[4] &amp; 255))&lt;&lt;24) |           \
    (((uint64_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[5] &amp; 255))&lt;&lt;16) |           \
    (((uint64_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[6] &amp; 255))&lt;&lt;8)  |          	\
    (((uint64_t)(((<span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(y))[7] &amp; 255)));	            \
} <span class="enscript-keyword">while</span>(0)

#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// MARK: - 32-bit Rotates
</span>
#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_MSC_VER</span>)
<span class="enscript-comment">// MARK: -- MSVC version
</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;stdlib.h&gt;</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">intrinsic</span>(<span class="enscript-variable-name">_lrotr</span>,<span class="enscript-variable-name">_lrotl</span>)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CC_ROR</span>(x,n) _lrotr(x,n)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CC_ROL</span>(x,n) _lrotl(x,n)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CC_RORc</span>(x,n) _lrotr(x,n)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CC_ROLc</span>(x,n) _lrotl(x,n)

#<span class="enscript-reference">elif</span> (<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__i386__</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__x86_64__</span>))
<span class="enscript-comment">// MARK: -- intel asm version
</span>
<span class="enscript-type">static</span> inline uint32_t <span class="enscript-function-name">CC_ROL</span>(uint32_t word, <span class="enscript-type">int</span> i)
{
    __asm__ (<span class="enscript-string">&quot;roll %%cl,%0&quot;</span>
         :<span class="enscript-string">&quot;=r&quot;</span> (word)
         :<span class="enscript-string">&quot;0&quot;</span> (word),<span class="enscript-string">&quot;c&quot;</span> (i));
    <span class="enscript-keyword">return</span> word;
}

<span class="enscript-type">static</span> inline uint32_t <span class="enscript-function-name">CC_ROR</span>(uint32_t word, <span class="enscript-type">int</span> i)
{
    __asm__ (<span class="enscript-string">&quot;rorl %%cl,%0&quot;</span>
         :<span class="enscript-string">&quot;=r&quot;</span> (word)
         :<span class="enscript-string">&quot;0&quot;</span> (word),<span class="enscript-string">&quot;c&quot;</span> (i));
    <span class="enscript-keyword">return</span> word;
}

<span class="enscript-comment">/* Need to be a macro here, because 'i' is an immediate (constant) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_ROLc</span>(word, i)                \
({  uint32_t _word=(word);              \
    __asm__ __volatile__ (<span class="enscript-string">&quot;roll %2,%0&quot;</span>  \
        :<span class="enscript-string">&quot;=r&quot;</span> (_word)                   \
        :<span class="enscript-string">&quot;0&quot;</span> (_word),<span class="enscript-string">&quot;I&quot;</span> (i));          \
    _word;                              \
})


#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_RORc</span>(word, i)                \
({  uint32_t _word=(word);              \
    __asm__ __volatile__ (<span class="enscript-string">&quot;rorl %2,%0&quot;</span>  \
        :<span class="enscript-string">&quot;=r&quot;</span> (_word)                   \
        :<span class="enscript-string">&quot;0&quot;</span> (_word),<span class="enscript-string">&quot;I&quot;</span> (i));          \
    _word;                              \
})

#<span class="enscript-reference">else</span>

<span class="enscript-comment">// MARK: -- default version
</span>
<span class="enscript-type">static</span> inline uint32_t <span class="enscript-function-name">CC_ROL</span>(uint32_t word, <span class="enscript-type">int</span> i)
{
    <span class="enscript-keyword">return</span> ( (word&lt;&lt;(i&amp;31)) | (word&gt;&gt;(32-(i&amp;31))) );
}

<span class="enscript-type">static</span> inline uint32_t <span class="enscript-function-name">CC_ROR</span>(uint32_t word, <span class="enscript-type">int</span> i)
{
    <span class="enscript-keyword">return</span> ( (word&gt;&gt;(i&amp;31)) | (word&lt;&lt;(32-(i&amp;31))) );
}

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CC_ROLc</span>(x, y) CC_ROL(x, y)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CC_RORc</span>(x, y) CC_ROR(x, y)

#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// MARK: - 64 bits rotates
</span>
#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__x86_64__</span>)
<span class="enscript-comment">// MARK: -- intel 64 asm version
</span>
<span class="enscript-type">static</span> inline uint64_t <span class="enscript-function-name">CC_ROL64</span>(uint64_t word, <span class="enscript-type">int</span> i)
{
    __asm__(<span class="enscript-string">&quot;rolq %%cl,%0&quot;</span>
        :<span class="enscript-string">&quot;=r&quot;</span> (word)
        :<span class="enscript-string">&quot;0&quot;</span> (word),<span class="enscript-string">&quot;c&quot;</span> (i));
    <span class="enscript-keyword">return</span> word;
}

<span class="enscript-type">static</span> inline uint64_t <span class="enscript-function-name">CC_ROR64</span>(uint64_t word, <span class="enscript-type">int</span> i)
{
    __asm__(<span class="enscript-string">&quot;rorq %%cl,%0&quot;</span>
        :<span class="enscript-string">&quot;=r&quot;</span> (word)
        :<span class="enscript-string">&quot;0&quot;</span> (word),<span class="enscript-string">&quot;c&quot;</span> (i));
    <span class="enscript-keyword">return</span> word;
}

<span class="enscript-comment">/* Need to be a macro here, because 'i' is an immediate (constant) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_ROL64c</span>(word, i)      \
({                              \
    uint64_t _word=(word);      \
    __asm__(<span class="enscript-string">&quot;rolq %2,%0&quot;</span>        \
        :<span class="enscript-string">&quot;=r&quot;</span> (_word)           \
        :<span class="enscript-string">&quot;0&quot;</span> (_word),<span class="enscript-string">&quot;J&quot;</span> (i));  \
    _word;                      \
})

#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_ROR64c</span>(word, i)      \
({                              \
    uint64_t _word=(word);      \
    __asm__(<span class="enscript-string">&quot;rorq %2,%0&quot;</span>        \
        :<span class="enscript-string">&quot;=r&quot;</span> (_word)           \
        :<span class="enscript-string">&quot;0&quot;</span> (_word),<span class="enscript-string">&quot;J&quot;</span> (i));  \
    _word;                      \
})


#<span class="enscript-reference">else</span> <span class="enscript-comment">/* Not x86_64  */</span>

<span class="enscript-comment">// MARK: -- default C version
</span>
<span class="enscript-type">static</span> inline uint64_t <span class="enscript-function-name">CC_ROL64</span>(uint64_t word, <span class="enscript-type">int</span> i)
{
    <span class="enscript-keyword">return</span> ( (word&lt;&lt;(i&amp;63)) | (word&gt;&gt;(64-(i&amp;63))) );
}

<span class="enscript-type">static</span> inline uint64_t <span class="enscript-function-name">CC_ROR64</span>(uint64_t word, <span class="enscript-type">int</span> i)
{
    <span class="enscript-keyword">return</span> ( (word&gt;&gt;(i&amp;63)) | (word&lt;&lt;(64-(i&amp;63))) );
}

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CC_ROL64c</span>(x, y) CC_ROL64(x, y)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CC_ROR64c</span>(x, y) CC_ROR64(x, y)

#<span class="enscript-reference">endif</span>


<span class="enscript-comment">// MARK: - Byte Swaps
</span>
<span class="enscript-type">static</span> inline uint32_t <span class="enscript-function-name">CC_BSWAP</span>(uint32_t x)
{
    <span class="enscript-keyword">return</span> (
        ((x&gt;&gt;24)&amp;0x000000FF) |
        ((x&lt;&lt;24)&amp;0xFF000000) |
        ((x&gt;&gt;8) &amp;0x0000FF00) |
        ((x&lt;&lt;8) &amp;0x00FF0000)
    );
}

#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_BSWAP64</span>(x) \
((uint64_t)((((uint64_t)(x) &amp; 0xff00000000000000ULL) &gt;&gt; 56) | \
(((uint64_t)(x) &amp; 0x00ff000000000000ULL) &gt;&gt; 40) | \
(((uint64_t)(x) &amp; 0x0000ff0000000000ULL) &gt;&gt; 24) | \
(((uint64_t)(x) &amp; 0x000000ff00000000ULL) &gt;&gt;  8) | \
(((uint64_t)(x) &amp; 0x00000000ff000000ULL) &lt;&lt;  8) | \
(((uint64_t)(x) &amp; 0x0000000000ff0000ULL) &lt;&lt; 24) | \
(((uint64_t)(x) &amp; 0x000000000000ff00ULL) &lt;&lt; 40) | \
(((uint64_t)(x) &amp; 0x00000000000000ffULL) &lt;&lt; 56)))

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__LITTLE_ENDIAN__</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_H2BE32</span>(x) CC_BSWAP(x)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_H2LE32</span>(x) (x)
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_H2BE32</span>(x) (x)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_H2LE32</span>(x) CC_BSWAP(x)
#<span class="enscript-reference">endif</span>


<span class="enscript-comment">/* extract a byte portably */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">_MSC_VER</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">cc_byte</span>(x, n) ((unsigned char)((x) &gt;&gt; (8 * (n))))
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">cc_byte</span>(x, n) (((x) &gt;&gt; (8 * (n))) &amp; 255)
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/* HEAVISIDE_STEP (shifted by one)
   function f(x): x-&gt;0, when x=0 
                  x-&gt;1, when x&gt;0
   Can also be seen as a bitwise operation: 
      f(x): x -&gt; y
        y[0]=(OR x[i]) for all i (all bits)
        y[i]=0 for all i&gt;0
   Run in constant time (log2(&lt;bitsize of x&gt;))  
   Useful to run constant time checks
*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">HEAVISIDE_STEP_UINT64</span>(x) {uint64_t _t; \
    _t=(((uint64_t)x&gt;&gt;32) | x); \
    _t=(0xFFFFFFFF + (_t &amp; 0xFFFFFFFF)); \
    x=_t &gt;&gt; 32;}

#<span class="enscript-reference">define</span> <span class="enscript-function-name">HEAVISIDE_STEP_UINT32</span>(x) {uint32_t _t; \
    _t=(((uint32_t)x&gt;&gt;16) | x); \
    _t=(0xFFFF + (_t &amp; 0xFFFF)); \
    x=_t &gt;&gt; 16;}

#<span class="enscript-reference">define</span> <span class="enscript-function-name">HEAVISIDE_STEP_UINT16</span>(x) {uint16_t _t; \
    _t=(((uint16_t)x&gt;&gt;8) | x); \
    _t=(0xFF + (_t &amp; 0xFF)); \
    x=_t &gt;&gt; 8;}

#<span class="enscript-reference">define</span> <span class="enscript-function-name">HEAVISIDE_STEP_UINT8</span>(x) {uint8_t _t; \
    _t=(((uint8_t)x&gt;&gt;4) | (uint8_t)x); \
    _t=((_t&gt;&gt;2) | _t); \
    _t=((_t&gt;&gt;1) | _t); \
    x=_t &amp; 0x1;}

#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_HEAVISIDE_STEP</span>(x) { \
    <span class="enscript-keyword">if</span> (<span class="enscript-keyword">sizeof</span>(x) == 1) {HEAVISIDE_STEP_UINT8(x);}  \
    <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (<span class="enscript-keyword">sizeof</span>(x) == 2) {HEAVISIDE_STEP_UINT16(x);} \
    <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (<span class="enscript-keyword">sizeof</span>(x) == 4) {HEAVISIDE_STEP_UINT32(x);} \
    <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (<span class="enscript-keyword">sizeof</span>(x) == 8) {HEAVISIDE_STEP_UINT64(x);} \
    <span class="enscript-keyword">else</span> {x=((x==0)?0:1);} \
    }

<span class="enscript-comment">/* Return 1 if x mod 4 =1,2,3, 0 otherwise */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_CARRY_2BITS</span>(x) (((x&gt;&gt;1) | x) &amp; 0x1)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_CARRY_3BITS</span>(x) (((x&gt;&gt;2) | (x&gt;&gt;1) | x) &amp; 0x1)

<span class="enscript-comment">/* Set a variable to the biggest power of 2 which can be represented */</span> 
#<span class="enscript-reference">define</span> <span class="enscript-function-name">MAX_POWER_OF_2</span>(x)   ((__typeof__(x))1&lt;&lt;(8*sizeof(x)-1))

#<span class="enscript-reference">define</span> <span class="enscript-function-name">cc_ceiling</span>(a,b)  (((a)+((b)-1))/(b))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">CC_BITLEN_TO_BYTELEN</span>(x) cc_ceiling((x), 8)

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* _CORECRYPTO_CC_PRIV_H_ */</span>
</pre>
<hr />
</body></html>