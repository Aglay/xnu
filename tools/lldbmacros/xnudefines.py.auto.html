<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>xnudefines.py</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">xnudefines.py&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">#!/usr/bin/env python
</span>
<span class="enscript-string">&quot;&quot;&quot; This file holds all static values that debugging macros need. These are typically object type strings, #defines in C etc.
    The objective is to provide a single place to be the bridge between C code in xnu and the python macros used by lldb.
    If you define a variable which has been copied/referred over from C code and has high chance of changing over time. It would
    be best to define a supporting function of format &quot;populate_&lt;variable_name&gt;&quot;. This will help in running them to repopulate.
     
    Please take a look at example of kobject_types below before making changes to this file.
    Note: The Format of the function has to be populate_&lt;variable_name&gt; so that the automated updating will pick it up.
&quot;&quot;&quot;</span>
<span class="enscript-keyword">import</span> os, re

lcpu_self = 0xFFFE
arm_level2_access_strings = [ <span class="enscript-string">&quot; noaccess&quot;</span>,
                              <span class="enscript-string">&quot; supervisor(readwrite) user(noaccess)&quot;</span>,
                              <span class="enscript-string">&quot; supervisor(readwrite) user(readonly)&quot;</span>,
                              <span class="enscript-string">&quot; supervisor(readwrite) user(readwrite)&quot;</span>,
                              <span class="enscript-string">&quot; noaccess(reserved)&quot;</span>,
                              <span class="enscript-string">&quot; supervisor(readonly) user(noaccess)&quot;</span>,
                              <span class="enscript-string">&quot; supervisor(readonly) user(readonly)&quot;</span>,
                              <span class="enscript-string">&quot; supervisor(readonly) user(readonly)&quot;</span>,
                              <span class="enscript-string">&quot; &quot;</span>
                             ]
kq_state_strings = {0:<span class="enscript-string">&quot;&quot;</span>, 1:<span class="enscript-string">&quot;SEL&quot;</span>, 2:<span class="enscript-string">&quot;SLEEP&quot;</span>, 4:<span class="enscript-string">&quot;PROCWAIT&quot;</span>, 8:<span class="enscript-string">&quot;KEV32&quot;</span>, 16:<span class="enscript-string">&quot;KEV64&quot;</span>}

kn_state_strings = {0:<span class="enscript-string">&quot;&quot;</span>, 1:<span class="enscript-string">&quot;ACTIVE&quot;</span>, 2:<span class="enscript-string">&quot;QUEUED&quot;</span>, 4:<span class="enscript-string">&quot;DISABLED&quot;</span>, 8:<span class="enscript-string">&quot;DROPPING&quot;</span>, 16:<span class="enscript-string">&quot;USERWAIT&quot;</span>, 32:<span class="enscript-string">&quot;ATTACHING&quot;</span>, 64:<span class="enscript-string">&quot;STAYQUED&quot;</span>}

mach_msg_type_descriptor_strings = {0: <span class="enscript-string">&quot;PORT&quot;</span>, 1: <span class="enscript-string">&quot;OOLDESC&quot;</span>, 2: <span class="enscript-string">&quot;OOLPORTS&quot;</span>, 3: <span class="enscript-string">&quot;OOLVOLATILE&quot;</span>}

proc_state_strings = [ <span class="enscript-string">&quot;&quot;</span>, <span class="enscript-string">&quot;Idle&quot;</span>, <span class="enscript-string">&quot;Run&quot;</span>, <span class="enscript-string">&quot;Sleep&quot;</span>, <span class="enscript-string">&quot;Stop&quot;</span>, <span class="enscript-string">&quot;Zombie&quot;</span>, <span class="enscript-string">&quot;Reaping&quot;</span> ]
proc_flag_explain_strings = [<span class="enscript-string">&quot;!0x00000004 - process is 32 bit&quot;</span>,  <span class="enscript-comment">#only exception that does not follow bit settings
</span>                             <span class="enscript-string">&quot;0x00000001 - may hold advisory locks&quot;</span>,
                             <span class="enscript-string">&quot;0x00000002 - has a controlling tty&quot;</span>,
                             <span class="enscript-string">&quot;0x00000004 - process is 64 bit&quot;</span>,
                             <span class="enscript-string">&quot;0x00000008 - no SIGCHLD on child stop&quot;</span>,
                             <span class="enscript-string">&quot;0x00000010 - waiting for child exec/exit&quot;</span>,
                             <span class="enscript-string">&quot;0x00000020 - has started profiling&quot;</span>,
                             <span class="enscript-string">&quot;0x00000040 - in select; wakeup/waiting danger&quot;</span>,
                             <span class="enscript-string">&quot;0x00000080 - was stopped and continued&quot;</span>,
                             <span class="enscript-string">&quot;0x00000100 - has set privileges since exec&quot;</span>,
                             <span class="enscript-string">&quot;0x00000200 - system process: no signals, stats, or swap&quot;</span>,
                             <span class="enscript-string">&quot;0x00000400 - timing out during a sleep&quot;</span>,
                             <span class="enscript-string">&quot;0x00000800 - debugged process being traced&quot;</span>,
                             <span class="enscript-string">&quot;0x00001000 - debugging process has waited for child&quot;</span>,
                             <span class="enscript-string">&quot;0x00002000 - exit in progress&quot;</span>,
                             <span class="enscript-string">&quot;0x00004000 - process has called exec&quot;</span>,
                             <span class="enscript-string">&quot;0x00008000 - owe process an addupc() XXX&quot;</span>,
                             <span class="enscript-string">&quot;0x00010000 - affinity for Rosetta children&quot;</span>,
                             <span class="enscript-string">&quot;0x00020000 - wants to run Rosetta&quot;</span>,
                             <span class="enscript-string">&quot;0x00040000 - has wait() in progress&quot;</span>,
                             <span class="enscript-string">&quot;0x00080000 - kdebug tracing on for this process&quot;</span>,
                             <span class="enscript-string">&quot;0x00100000 - blocked due to SIGTTOU or SIGTTIN&quot;</span>,
                             <span class="enscript-string">&quot;0x00200000 - has called reboot()&quot;</span>,
                             <span class="enscript-string">&quot;0x00400000 - is TBE state&quot;</span>,
                             <span class="enscript-string">&quot;0x00800000 - signal exceptions&quot;</span>,
                             <span class="enscript-string">&quot;0x01000000 - has thread cwd&quot;</span>,
                             <span class="enscript-string">&quot;0x02000000 - has vfork() children&quot;</span>,
                             <span class="enscript-string">&quot;0x04000000 - not allowed to attach&quot;</span>,
                             <span class="enscript-string">&quot;0x08000000 - vfork() in progress&quot;</span>,
                             <span class="enscript-string">&quot;0x10000000 - no shared libraries&quot;</span>,
                             <span class="enscript-string">&quot;0x20000000 - force quota for root&quot;</span>,
                             <span class="enscript-string">&quot;0x40000000 - no zombies when children exit&quot;</span>,
                             <span class="enscript-string">&quot;0x80000000 - don't hang on remote FS ops&quot;</span>
                             ]
<span class="enscript-comment">#File: xnu/osfmk/kern/ipc_kobject.h
</span><span class="enscript-comment"># string representations for Kobject types
</span>kobject_types = [<span class="enscript-string">''</span>, <span class="enscript-string">'THREAD'</span>, <span class="enscript-string">'TASK'</span>, <span class="enscript-string">'HOST'</span>, <span class="enscript-string">'HOST_PRIV'</span>, <span class="enscript-string">'PROCESSOR'</span>, <span class="enscript-string">'PSET'</span>, <span class="enscript-string">'PSET_NAME'</span>, <span class="enscript-string">'TIMER'</span>, <span class="enscript-string">'PAGER_REQ'</span>, <span class="enscript-string">'DEVICE'</span>, <span class="enscript-string">'XMM_OBJECT'</span>, <span class="enscript-string">'XMM_PAGER'</span>, <span class="enscript-string">'XMM_KERNEL'</span>, <span class="enscript-string">'XMM_REPLY'</span>, 
                     <span class="enscript-string">'NOTDEF 15'</span>, <span class="enscript-string">'NOTDEF 16'</span>, <span class="enscript-string">'HOST_SEC'</span>, <span class="enscript-string">'LEDGER'</span>, <span class="enscript-string">'MASTER_DEV'</span>, <span class="enscript-string">'TASK_NAME'</span>, <span class="enscript-string">'SUBSYTEM'</span>, <span class="enscript-string">'IO_DONE_QUE'</span>, <span class="enscript-string">'SEMAPHORE'</span>, <span class="enscript-string">'LOCK_SET'</span>, <span class="enscript-string">'CLOCK'</span>, <span class="enscript-string">'CLOCK_CTRL'</span> , <span class="enscript-string">'IOKIT_SPARE'</span>, 
                      <span class="enscript-string">'NAMED_MEM'</span>, <span class="enscript-string">'IOKIT_CON'</span>, <span class="enscript-string">'IOKIT_OBJ'</span>, <span class="enscript-string">'UPL'</span>, <span class="enscript-string">'MEM_OBJ_CONTROL'</span>, <span class="enscript-string">'AU_SESSIONPORT'</span>, <span class="enscript-string">'FILEPORT'</span>, <span class="enscript-string">'LABELH'</span>, <span class="enscript-string">'TASK_RESUME'</span>, <span class="enscript-string">'VOUCHER'</span>, <span class="enscript-string">'VOUCHER_ATTR_CONTROL'</span>]

<span class="enscript-keyword">def</span> <span class="enscript-function-name">populate_kobject_types</span>(xnu_dir_path):
    <span class="enscript-string">&quot;&quot;&quot; Function to read data from header file xnu/osfmk/kern/ipc_kobject.h
        and populate the known kobject types.
    &quot;&quot;&quot;</span>
    filename = os.path.join(xnu_dir_path, <span class="enscript-string">'osfmk'</span>, <span class="enscript-string">'kern'</span>, <span class="enscript-string">'ipc_kobject.h'</span>)
    filedata = open(filename).read()
    object_regex = re.compile(<span class="enscript-string">&quot;^#define\s+(IKOT_[A-Z_]*)\s+(\d+)\s*&quot;</span>,re.MULTILINE|re.DOTALL)
    kobject_found_types =[]
    <span class="enscript-keyword">for</span> v <span class="enscript-keyword">in</span> object_regex.findall(filedata):
        kobject_found_types.append(v[0])
    <span class="enscript-keyword">return</span> kobject_found_types

<span class="enscript-keyword">if</span> __name__ == <span class="enscript-string">&quot;__main__&quot;</span>:
    populate_kobject_types(<span class="enscript-string">&quot;../../&quot;</span>)
    
</pre>
<hr />
</body></html>