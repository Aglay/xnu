<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>kauth.py</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">kauth.py&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-string">&quot;&quot;&quot; Please make sure you read the README file COMPLETELY BEFORE reading anything below.
    It is very critical that you read coding guidelines in Section E in README file.
&quot;&quot;&quot;</span>

<span class="enscript-keyword">from</span> xnu <span class="enscript-keyword">import</span> *
<span class="enscript-keyword">from</span> utils <span class="enscript-keyword">import</span> *

<span class="enscript-comment"># Macro: walkkauthcache
</span>@lldb_command(<span class="enscript-string">'walkkauthcache'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">WalkKauthCache</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Walks the bins of the kauth credential hash cache and prints out the
        number of bins and bin usage information.
    &quot;&quot;&quot;</span>
    PrintKauthCache()
<span class="enscript-comment"># EndMacro: walkkauthcache
</span>
<span class="enscript-keyword">def</span> <span class="enscript-function-name">PrintKauthCache</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Routine to determine the size of the kauth cache, walk the bins
         and print out usage information.
    &quot;&quot;&quot;</span>
    anchor = unsigned(kern.globals.kauth_cred_table_anchor)
    alloc_info_struct = anchor - sizeof(<span class="enscript-string">'struct _mhead'</span>)
    alloc_info = kern.GetValueFromAddress(alloc_info_struct, <span class="enscript-string">'struct _mhead*'</span>)
    alloc_size = unsigned(alloc_info.mlen) - (sizeof(<span class="enscript-string">'struct _mhead'</span>))
    table_entries = alloc_size / sizeof(<span class="enscript-string">'struct kauth_cred_entry_head'</span>)
    anchor = kern.globals.kauth_cred_table_anchor
    <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Cred cache has: &quot;</span> + str(table_entries) + <span class="enscript-string">&quot; buckets\n&quot;</span>
    <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Number of items in each bucket ... \n&quot;</span>
    <span class="enscript-keyword">for</span> i <span class="enscript-keyword">in</span> range(0, table_entries):
        numinbucket = 0
        <span class="enscript-keyword">for</span> kauth_cred <span class="enscript-keyword">in</span> IterateTAILQ_HEAD(anchor[i], <span class="enscript-string">&quot;cr_link&quot;</span>):
            numinbucket += 1
            <span class="enscript-comment">#print str(kauth_cred.cr_posix)
</span>            <span class="enscript-comment">#print str(kauth_cred.cr_ref)
</span>        <span class="enscript-keyword">print</span> str(numinbucket) + <span class="enscript-string">&quot;\n&quot;</span>
</pre>
<hr />
</body></html>