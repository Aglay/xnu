<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>net.py</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">net.py&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>

<span class="enscript-string">&quot;&quot;&quot; Please make sure you read the README COMPLETELY BEFORE reading anything below.
    It is very critical that you read coding guidelines in Section E in README file. 
&quot;&quot;&quot;</span>

<span class="enscript-keyword">from</span> xnu <span class="enscript-keyword">import</span> *
<span class="enscript-keyword">from</span> utils <span class="enscript-keyword">import</span> *
<span class="enscript-keyword">from</span> string <span class="enscript-keyword">import</span> *
<span class="enscript-keyword">from</span> socket <span class="enscript-keyword">import</span> *

<span class="enscript-keyword">import</span> xnudefines
<span class="enscript-keyword">from</span> netdefines <span class="enscript-keyword">import</span> *
<span class="enscript-keyword">from</span> routedefines <span class="enscript-keyword">import</span> *

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetIfFlagsAsString</span>(if_flags):
    <span class="enscript-string">&quot;&quot;&quot; Return a formatted string description of the interface flags
    &quot;&quot;&quot;</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    flags = (unsigned)(if_flags &amp; 0xffff)
    i = 0
    num = 1
    <span class="enscript-keyword">while</span> num &lt;= flags:
        <span class="enscript-keyword">if</span> flags &amp; num:
            out_string += if_flags_strings[i] + <span class="enscript-string">&quot;,&quot;</span> 
        i += 1
        num = num &lt;&lt; 1
    <span class="enscript-keyword">return</span> rstrip(out_string, <span class="enscript-string">&quot;,&quot;</span>)


<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowIfConfiguration</span>(ifnet):
    <span class="enscript-string">&quot;&quot;&quot; Display ifconfig-like output for the ifnet
    &quot;&quot;&quot;</span>
    iface = Cast(ifnet, <span class="enscript-string">'ifnet *'</span>)
    out_string = <span class="enscript-string">&quot;&quot;</span>
    format_string = <span class="enscript-string">&quot;{0: &lt;s}: flags={1: &lt;x} &lt;{2: &lt;s}&gt; index {3: &lt;d} mtu {4: &lt;d}&quot;</span>
    <span class="enscript-keyword">if</span> iface :
        out_string += format_string.format(iface.if_xname, (iface.if_flags &amp; 0xffff), GetIfFlagsAsString(iface.if_flags), iface.if_index, iface.if_data.ifi_mtu)
        out_string += <span class="enscript-string">&quot;\n\t(struct ifnet *)&quot;</span> + hex(ifnet)
    <span class="enscript-keyword">print</span> out_string

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetIfConfiguration</span>(ifname):
    <span class="enscript-string">&quot;&quot;&quot; Return ifnet structure corresponding to the ifname passed in
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">global</span> kern
    ifnets = kern.globals.ifnet_head
    <span class="enscript-keyword">for</span> ifnet <span class="enscript-keyword">in</span> IterateTAILQ_HEAD(ifnets, <span class="enscript-string">&quot;if_link&quot;</span>) :
        <span class="enscript-keyword">if</span> str(ifnet.if_xname) == ifname :
            <span class="enscript-keyword">return</span> ifnet
    <span class="enscript-keyword">return</span> None

<span class="enscript-comment"># Macro: ifconfig
</span>@lldb_command(<span class="enscript-string">'ifconfig'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowIfconfig</span>(cmd_args=None) :
    <span class="enscript-string">&quot;&quot;&quot; Display ifconfig-like output, and print the (struct ifnet *) pointers for further inspection
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">if</span> cmd_args != None <span class="enscript-keyword">and</span> len(cmd_args) &gt; 0:
        showall = 1
    <span class="enscript-keyword">else</span>:
        showall = 0

    ifnets = kern.globals.ifnet_head
    <span class="enscript-keyword">for</span> ifnet <span class="enscript-keyword">in</span> IterateTAILQ_HEAD(ifnets, <span class="enscript-string">&quot;if_link&quot;</span>):
        ShowIfConfiguration(ifnet)
        <span class="enscript-keyword">if</span> (showall == 1):
            <span class="enscript-keyword">print</span> GetIfaddrs(ifnet)
<span class="enscript-comment"># EndMacro: ifconfig
</span>
<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetAddressAsStringColonHex</span>(addr, count):
    out_string = <span class="enscript-string">&quot;&quot;</span>
    i = 0 
    addr_format_string = <span class="enscript-string">&quot;{0:02x}&quot;</span>
    <span class="enscript-keyword">while</span> (i &lt; count):
        <span class="enscript-keyword">if</span> (i == 0):
            out_string += addr_format_string.format(addr[i])[-2:]
        <span class="enscript-keyword">else</span>:
            out_string += <span class="enscript-string">&quot;:&quot;</span> + addr_format_string.format(addr[i])[-2:]
        i += 1
    <span class="enscript-keyword">return</span> out_string

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetSocketAddrAsStringUnspec</span>(sockaddr):
    out_string = <span class="enscript-string">&quot;&quot;</span>
    out_string += GetAddressAsStringColonHex(sockaddr.sa_data, sockaddr.sa_len - 2)
    <span class="enscript-keyword">return</span> out_string

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetSocketAddrAsStringUnix</span>(sockaddr):
    sock_unix = Cast(sockaddr, <span class="enscript-string">'sockaddr_un *'</span>)
    <span class="enscript-keyword">if</span> (sock_unix == 0):
        <span class="enscript-keyword">return</span> <span class="enscript-string">&quot;(null)&quot;</span>
    <span class="enscript-keyword">else</span>:
        <span class="enscript-keyword">if</span> (len(str(sock_unix.sun_path)) &gt; 0): 
            <span class="enscript-keyword">return</span> str(sock_unix.sun_path)
        <span class="enscript-keyword">else</span>:
            <span class="enscript-keyword">return</span> <span class="enscript-string">&quot;\&quot;\&quot;&quot;</span>

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetInAddrAsString</span>(ia):
    out_string = <span class="enscript-string">&quot;&quot;</span>
    inaddr = Cast(ia, <span class="enscript-string">'in_addr *'</span>)
    
    packed_value = struct.pack(<span class="enscript-string">'I'</span>, unsigned(ia.s_addr))
    out_string = inet_ntoa(packed_value)
    <span class="enscript-keyword">return</span> out_string

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetIn6AddrAsString</span>(ia):
    out_string = <span class="enscript-string">&quot;&quot;</span>
    addr = ia

    addr_format_string = <span class="enscript-string">&quot;{0:02x}:{1:02x}:{2:02x}:{3:02x}{4:02x}:{5:02x}:{6:02x}:{7:02x}{8:02x}:{9:02x}:{10:02x}:{11:02x}{12:02x}:{13:02x}:{14:02x}:{15:02x}&quot;</span>
    out_string += addr_format_string.format(unsigned(addr[0]), unsigned(addr[1]), unsigned(addr[2]), unsigned(addr[3]), unsigned(addr[4]), unsigned(addr[5]), unsigned(addr[6]), unsigned(addr[7]), unsigned(addr[8]), unsigned(addr[9]), unsigned(addr[10]), unsigned(addr[11]), unsigned(addr[12]), unsigned(addr[13]), unsigned(addr[14]), unsigned(addr[15]))
    <span class="enscript-keyword">return</span> out_string

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetSocketAddrAsStringInet</span>(sockaddr):
    sock_in = Cast(sockaddr, <span class="enscript-string">'sockaddr_in *'</span>)
    <span class="enscript-keyword">return</span> GetInAddrAsString(sock_in.sin_addr)

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetSocketAddrAsStringInet6</span>(sockaddr):
    sock_in6 = Cast(sockaddr, <span class="enscript-string">'sockaddr_in6 *'</span>)
    <span class="enscript-keyword">return</span> GetIn6AddrAsString(sock_in6.sin6_addr.__u6_addr.__u6_addr8)

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetSocketAddrAsStringLink</span>(sockaddr):
    sock_link = Cast(sockaddr, <span class="enscript-string">'sockaddr_dl *'</span>)
    <span class="enscript-keyword">if</span> sock_link <span class="enscript-keyword">is</span> None:
        <span class="enscript-keyword">return</span> <span class="enscript-string">&quot;(null)&quot;</span>
    <span class="enscript-keyword">else</span>:
        out_string = <span class="enscript-string">&quot;&quot;</span>
        <span class="enscript-keyword">if</span> (sock_link.sdl_nlen == 0 <span class="enscript-keyword">and</span> sock_link.sdl_alen == 0 <span class="enscript-keyword">and</span> sock_link.sdl_slen == 0):
            out_string = <span class="enscript-string">&quot;link#&quot;</span> + str(int(sock_link.sdl_index))
        <span class="enscript-keyword">else</span>:
            out_string += GetAddressAsStringColonHex(addressof(sock_link.sdl_data[sock_link.sdl_nlen]), sock_link.sdl_alen)
    <span class="enscript-keyword">return</span> out_string
    
<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetSocketAddrAsStringAT</span>(sockaddr):
    out_string = <span class="enscript-string">&quot;&quot;</span>
    sock_addr = Cast(sockaddr, <span class="enscript-string">'sockaddr *'</span>)
    out_string += GetAddressAsStringColonHex(sockaddr.sa_data, sockaddr.sa_len - 2)
    <span class="enscript-keyword">return</span> out_string

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetSocketAddrAsString</span>(sockaddr):
    <span class="enscript-keyword">if</span> sockaddr <span class="enscript-keyword">is</span> None :
        <span class="enscript-keyword">return</span> <span class="enscript-string">&quot;(null)&quot;</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    <span class="enscript-keyword">if</span> (sockaddr.sa_family == 0):
        out_string += <span class="enscript-string">&quot;UNSPC &quot;</span>
        GetSocketAddrAsStringUnspec(sockaddr)
    <span class="enscript-keyword">elif</span> (sockaddr.sa_family == 1):
        out_string += <span class="enscript-string">&quot;UNIX &quot;</span>
        out_string += GetSocketAddrAsStringUnix(sockaddr)
    <span class="enscript-keyword">elif</span> (sockaddr.sa_family == 2):
        out_string += <span class="enscript-string">&quot;INET &quot;</span>
        out_string += GetSocketAddrAsStringInet(sockaddr)
    <span class="enscript-keyword">elif</span> (sockaddr.sa_family == 30):
        out_string += <span class="enscript-string">&quot;INET6 &quot;</span>
        out_string += GetSocketAddrAsStringInet6(sockaddr)
    <span class="enscript-keyword">elif</span> (sockaddr.sa_family == 18):
        out_string += <span class="enscript-string">&quot;LINK &quot;</span>
        out_string += GetSocketAddrAsStringLink(sockaddr)
    <span class="enscript-keyword">elif</span> (sockaddr.sa_family == 16):
        out_string += <span class="enscript-string">&quot;ATLK &quot;</span>
        out_string += GetSocketAddrAsStringAT(sockaddr)
    <span class="enscript-keyword">else</span>:
        out_string += <span class="enscript-string">&quot;FAM &quot;</span> + str(sockaddr.sa_family)
        out_string += GetAddressAsStringColonHex(sockaddr.sa_data, sockaddr.sa_len)
    <span class="enscript-keyword">return</span> out_string

<span class="enscript-comment"># Macro: showifaddrs
</span>@lldb_command(<span class="enscript-string">'showifaddrs'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowIfaddrs</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Show the (struct ifnet).if_addrhead list of addresses for the given ifp
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">if</span> cmd_args != None <span class="enscript-keyword">and</span> len(cmd_args) &gt; 0 :
        ifp = kern.GetValueFromAddress(cmd_args[0], <span class="enscript-string">'ifnet *'</span>)
        <span class="enscript-keyword">if</span> <span class="enscript-keyword">not</span> ifp:
            <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Unknown value passed as argument.&quot;</span>
            <span class="enscript-keyword">return</span>
        i = 1
        <span class="enscript-keyword">for</span> ifaddr <span class="enscript-keyword">in</span> IterateTAILQ_HEAD(ifp.if_addrhead, <span class="enscript-string">&quot;ifa_link&quot;</span>):
            format_string = <span class="enscript-string">&quot;\t{0: &lt;d}: 0x{1: &lt;x} {2: &lt;s} [{3: &lt;d}]&quot;</span>
            <span class="enscript-keyword">print</span> format_string.format(i, ifaddr, GetSocketAddrAsString(ifaddr.ifa_addr), ifaddr.ifa_refcnt)
            i += 1
    <span class="enscript-keyword">else</span> :
        <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Missing argument 0 in user function.&quot;</span>
<span class="enscript-comment"># EndMacro: showifaddrs
</span>
<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetIfaddrs</span>(ifp):
    out_string = <span class="enscript-string">&quot;&quot;</span>
    <span class="enscript-keyword">if</span> (ifp != 0):
        i = 1
        <span class="enscript-keyword">for</span> ifaddr <span class="enscript-keyword">in</span> IterateTAILQ_HEAD(ifp.if_addrhead, <span class="enscript-string">&quot;ifa_link&quot;</span>):
            format_string = <span class="enscript-string">&quot;\t{0: &lt;d}: 0x{1: &lt;x} {2: &lt;s} [{3: &lt;d}]&quot;</span>
            out_string += format_string.format(i, ifaddr, GetSocketAddrAsString(ifaddr.ifa_addr), ifaddr.ifa_refcnt) + <span class="enscript-string">&quot;\n&quot;</span>
            i += 1
    <span class="enscript-keyword">else</span>:
        out_string += <span class="enscript-string">&quot;Missing argument 0 in user function.&quot;</span>
    <span class="enscript-keyword">return</span> out_string


<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetCapabilitiesAsString</span>(flags):
    <span class="enscript-string">&quot;&quot;&quot; Return a formatted string description of the interface flags
    &quot;&quot;&quot;</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    i = 0
    num = 1
    <span class="enscript-keyword">while</span> num &lt;= flags:
        <span class="enscript-keyword">if</span> flags &amp; num:
            out_string += if_capenable_strings[i] + <span class="enscript-string">&quot;,&quot;</span> 
        i += 1
        num = num &lt;&lt; 1
    <span class="enscript-keyword">return</span> rstrip(out_string, <span class="enscript-string">&quot;,&quot;</span>)

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetIfEflagsAsString</span>(if_eflags):
    <span class="enscript-string">&quot;&quot;&quot; Return a formatted string description of the interface flags
    &quot;&quot;&quot;</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    flags = unsigned(if_eflags)
    i = 0
    num = 1
    <span class="enscript-keyword">while</span> num &lt;= flags:
        <span class="enscript-keyword">if</span> flags &amp; num:
            out_string += if_eflags_strings[i] + <span class="enscript-string">&quot;,&quot;</span>
        i += 1
        num = num &lt;&lt; 1
    <span class="enscript-keyword">return</span> rstrip(out_string, <span class="enscript-string">&quot;,&quot;</span>)

<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowDlilIfnetConfiguration</span>(dlil_ifnet, show_all) :
    <span class="enscript-string">&quot;&quot;&quot; Formatted display of dlil_ifnet structures
    &quot;&quot;&quot;</span>
    DLIF_INUSE = 0x1
    DLIF_REUSE = 0x2

    <span class="enscript-keyword">if</span> dlil_ifnet <span class="enscript-keyword">is</span> None :
        <span class="enscript-keyword">return</span>

    dlil_iface = Cast(dlil_ifnet, <span class="enscript-string">'dlil_ifnet *'</span>)
    iface = Cast(dlil_ifnet, <span class="enscript-string">'ifnet *'</span>)
    out_string = <span class="enscript-string">&quot;&quot;</span>
    <span class="enscript-keyword">if</span> (dlil_iface.dl_if_flags &amp; DLIF_REUSE) :
        out_string  += <span class="enscript-string">&quot;*&quot;</span>
    format_string = <span class="enscript-string">&quot;{0: &lt;s}: flags={1: &lt;x} &lt;{2: &lt;s}&gt; index {3: &lt;d} mtu {4: &lt;d}&quot;</span>
    extended_flags_format_string = <span class="enscript-string">&quot;\n\teflags={0: &lt;x} &lt;{1: &lt;s}&gt;&quot;</span>
    capenabled_format_string = <span class="enscript-string">&quot;\n\toptions={0: &lt;x} &lt;{1: &lt;s}&gt;&quot;</span>
    <span class="enscript-keyword">if</span> (dlil_iface.dl_if_flags &amp; DLIF_INUSE) :
        out_string += format_string.format(iface.if_xname, (iface.if_flags &amp; 0xffff), GetIfFlagsAsString(iface.if_flags), iface.if_index, iface.if_data.ifi_mtu)
    <span class="enscript-keyword">else</span> :
        out_string += format_string.format(<span class="enscript-string">&quot;[&quot;</span> + str(iface.if_name) + str(int(iface.if_unit)) + <span class="enscript-string">&quot;]&quot;</span>, (iface.if_flags &amp; 0xffff), GetIfFlagsAsString(iface.if_flags), iface.if_index, iface.if_data.ifi_mtu)
    <span class="enscript-keyword">if</span> (iface.if_eflags) :
        out_string += extended_flags_format_string.format(iface.if_eflags, GetIfEflagsAsString(iface.if_eflags))
    <span class="enscript-keyword">if</span> (iface.if_capenable) :
        out_string += capenabled_format_string.format(iface.if_capenable, GetCapabilitiesAsString(iface.if_capenable))
    out_string += <span class="enscript-string">&quot;\n\t(struct ifnet *)&quot;</span> + hex(dlil_ifnet) + <span class="enscript-string">&quot;\n&quot;</span>
    <span class="enscript-keyword">if</span> show_all :
        out_string += GetIfaddrs(iface)
        out_string += <span class="enscript-string">&quot;\n&quot;</span>
    <span class="enscript-keyword">print</span> out_string 

<span class="enscript-comment"># Macro: showifnets
</span>@lldb_command(<span class="enscript-string">'showifnets'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowIfnets</span>(cmd_args=None) :
    <span class="enscript-string">&quot;&quot;&quot; Display ifconfig-like output for all attached and detached interfaces
    &quot;&quot;&quot;</span>                                      
    showall = 0
    <span class="enscript-keyword">if</span> cmd_args != None <span class="enscript-keyword">and</span> len(cmd_args) &gt; 0 :
        showall = 1
    dlil_ifnets = kern.globals.dlil_ifnet_head
    <span class="enscript-keyword">for</span> dlil_ifnet <span class="enscript-keyword">in</span> IterateTAILQ_HEAD(dlil_ifnets, <span class="enscript-string">&quot;dl_if_link&quot;</span>):
        ShowDlilIfnetConfiguration(dlil_ifnet, showall)
<span class="enscript-comment"># EndMacro: showifnets
</span>
<span class="enscript-comment"># Macro: showifmultiaddrs
</span>@lldb_command(<span class="enscript-string">'showifmultiaddrs'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowIfMultiAddrs</span>(cmd_args=None) :
    <span class="enscript-string">&quot;&quot;&quot; Show the list of multicast addresses for the given ifp
    &quot;&quot;&quot;</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    <span class="enscript-keyword">if</span> cmd_args != None <span class="enscript-keyword">and</span> len(cmd_args) &gt; 0 :
        ifp = kern.GetValueFromAddress(cmd_args[0], <span class="enscript-string">'ifnet *'</span>)
        <span class="enscript-keyword">if</span> <span class="enscript-keyword">not</span> ifp:
            <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Unknown value passed as argument.&quot;</span>
            <span class="enscript-keyword">return</span>
        ifmulti = cast(ifp.if_multiaddrs.lh_first, <span class="enscript-string">'ifmultiaddr *'</span>)
        i = 0
        <span class="enscript-keyword">while</span> ifmulti != 0:
            ifma_format_string = <span class="enscript-string">&quot;\t{0: &lt;d}: 0x{1: &lt;x} &quot;</span>
            out_string += (ifma_format_string.format(i + 1, ifmulti))
            <span class="enscript-keyword">if</span> (ifmulti.ifma_addr.sa_family == 2):
                <span class="enscript-keyword">if</span> (ifmulti.ifma_ll != 0):
                    out_string += GetSocketAddrAsStringLink(ifmulti.ifma_ll.ifma_addr) + <span class="enscript-string">&quot; &quot;</span>
                out_string += GetSocketAddrAsStringInet(ifmulti.ifma_addr)
            <span class="enscript-keyword">if</span> (ifmulti.ifma_addr.sa_family == 30):
                <span class="enscript-keyword">if</span> (ifmulti.ifma_ll != 0):
                    out_string += GetSocketAddrAsStringLink(ifmulti.ifma_ll.ifma_addr) + <span class="enscript-string">&quot; &quot;</span>
                out_string += GetSocketAddrAsStringInet6(ifmulti.ifma_addr) + <span class="enscript-string">&quot; &quot;</span>
            <span class="enscript-keyword">if</span> (ifmulti.ifma_addr.sa_family == 18):
                out_string += GetSocketAddrAsStringLink(ifmulti.ifma_addr) + <span class="enscript-string">&quot; &quot;</span>
            <span class="enscript-keyword">if</span> (ifmulti.ifma_addr.sa_family == 0):
                out_string += GetSocketAddrAsStringUnspec(ifmulti.ifma_addr) + <span class="enscript-string">&quot; &quot;</span>
            out_string += <span class="enscript-string">&quot;[&quot;</span> + str(int(ifmulti.ifma_refcount)) + <span class="enscript-string">&quot;]\n&quot;</span>
            ifmulti = cast(ifmulti.ifma_link.le_next, <span class="enscript-string">'ifmultiaddr *'</span>)
            i += 1
        <span class="enscript-keyword">print</span> out_string
    <span class="enscript-keyword">else</span> :
        <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Missing argument 0 in user function.&quot;</span>
<span class="enscript-comment"># EndMacro: showifmultiaddrs
</span>
<span class="enscript-comment"># Macro: showinmultiaddrs
</span>@lldb_command(<span class="enscript-string">'showinmultiaddrs'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowInMultiAddrs</span>(cmd_args=None) :
    <span class="enscript-string">&quot;&quot;&quot; Show the contents of IPv4 multicast address records
    &quot;&quot;&quot;</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    inmultihead = kern.globals.in_multihead
    inmulti = cast(inmultihead.lh_first, <span class="enscript-string">'in_multi *'</span>)
    i = 0
    <span class="enscript-keyword">while</span> inmulti != 0:
        ifp = inmulti.inm_ifp
        inma_format_string = <span class="enscript-string">&quot;\t{0: &lt;d}: 0x{1: &lt;x} &quot;</span>
        out_string += inma_format_string.format(i + 1, inmulti) + <span class="enscript-string">&quot; &quot;</span>
        out_string += GetInAddrAsString(addressof(inmulti.inm_addr)) + <span class="enscript-string">&quot; &quot;</span>
        ifma_format_string = <span class="enscript-string">&quot;(ifp 0x{0: &lt;x} [{1: &lt;s}] ifma {2: &lt;x})&quot;</span>
        out_string += ifma_format_string.format(ifp, ifp.if_xname, inmulti.inm_ifma) + <span class="enscript-string">&quot;\n&quot;</span>
        inmulti = cast(inmulti.inm_link.le_next, <span class="enscript-string">'in_multi *'</span>)
        i += 1
    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: showinmultiaddrs
</span>
<span class="enscript-comment"># Macro: showin6multiaddrs
</span>@lldb_command(<span class="enscript-string">'showin6multiaddrs'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowIn6MultiAddrs</span>(cmd_args=None) :
    <span class="enscript-string">&quot;&quot;&quot; Show the contents of IPv6 multicast address records
    &quot;&quot;&quot;</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    in6multihead = kern.globals.in6_multihead
    in6multi = cast(in6multihead.lh_first, <span class="enscript-string">'in6_multi *'</span>)
    i = 0
    <span class="enscript-keyword">while</span> in6multi != 0:
        ifp = in6multi.in6m_ifp
        inma_format_string = <span class="enscript-string">&quot;\t{0: &lt;d}: 0x{1: &lt;x} &quot;</span>
        out_string += inma_format_string.format(i + 1, in6multi) + <span class="enscript-string">&quot; &quot;</span>
        out_string += GetIn6AddrAsString((in6multi.in6m_addr.__u6_addr.__u6_addr8)) + <span class="enscript-string">&quot; &quot;</span>
        ifma_format_string = <span class="enscript-string">&quot;(ifp 0x{0: &lt;x} [{1: &lt;s}] ifma {2: &lt;x})&quot;</span>
        out_string += ifma_format_string.format(ifp, ifp.if_xname, in6multi.in6m_ifma) + <span class="enscript-string">&quot;\n&quot;</span>
        in6multi = cast(in6multi.in6m_entry.le_next, <span class="enscript-string">'in6_multi *'</span>)
        i += 1
    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: showin6multiaddrs
</span>
<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetTcpState</span>(tcpcb):
    out_string = <span class="enscript-string">&quot;&quot;</span>
    tp = Cast(tcpcb, <span class="enscript-string">'tcpcb *'</span>)
    <span class="enscript-keyword">if</span> (int(tp) != 0):
        <span class="enscript-keyword">if</span> tp.t_state == 0:
            out_string += <span class="enscript-string">&quot;CLOSED\t&quot;</span>
        <span class="enscript-keyword">if</span> tp.t_state == 1:
            out_string += <span class="enscript-string">&quot;LISTEN\t&quot;</span>
        <span class="enscript-keyword">if</span> tp.t_state == 2:
            out_string += <span class="enscript-string">&quot;SYN_SENT\t&quot;</span>
        <span class="enscript-keyword">if</span> tp.t_state == 3:
            out_string += <span class="enscript-string">&quot;SYN_RCVD\t&quot;</span>
        <span class="enscript-keyword">if</span> tp.t_state == 4:
            out_string += <span class="enscript-string">&quot;ESTABLISHED\t&quot;</span>
        <span class="enscript-keyword">if</span> tp.t_state == 5:
            out_string += <span class="enscript-string">&quot;CLOSE_WAIT\t&quot;</span>
        <span class="enscript-keyword">if</span> tp.t_state == 6:
            out_string += <span class="enscript-string">&quot;FIN_WAIT_1\t&quot;</span>
        <span class="enscript-keyword">if</span> tp.t_state == 7:
            out_string += <span class="enscript-string">&quot;CLOSING\t&quot;</span>
        <span class="enscript-keyword">if</span> tp.t_state == 8:
            out_string += <span class="enscript-string">&quot;LAST_ACK\t&quot;</span>
        <span class="enscript-keyword">if</span> tp.t_state == 9:
            out_string += <span class="enscript-string">&quot;FIN_WAIT_2\t&quot;</span>
        <span class="enscript-keyword">if</span> tp.t_state == 10:
            out_string += <span class="enscript-string">&quot;TIME_WAIT\t&quot;</span>
    <span class="enscript-keyword">return</span> out_string

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetSocketProtocolAsString</span>(sock):
    out_string = <span class="enscript-string">&quot;&quot;</span>
    inpcb = Cast(sock.so_pcb, <span class="enscript-string">'inpcb *'</span>)
    <span class="enscript-keyword">if</span> sock.so_proto.pr_protocol == 6:
        out_string += <span class="enscript-string">&quot; TCP &quot;</span>
        out_string += GetTcpState(inpcb.inp_ppcb)
    <span class="enscript-keyword">if</span> sock.so_proto.pr_protocol == 17:
        out_string += <span class="enscript-string">&quot; UDP &quot;</span>
    <span class="enscript-keyword">if</span> sock.so_proto.pr_protocol == 1:
        out_string += <span class="enscript-string">&quot; ICMP &quot;</span>
    <span class="enscript-keyword">if</span> sock.so_proto.pr_protocol == 254:
        out_string += <span class="enscript-string">&quot; DIVERT &quot;</span>
    <span class="enscript-keyword">if</span> sock.so_proto.pr_protocol == 255:
        out_string += <span class="enscript-string">&quot; RAW &quot;</span>
    <span class="enscript-keyword">return</span> out_string

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetInAddr4to6AsString</span>(inaddr):
    out_string = <span class="enscript-string">&quot;&quot;</span>
    <span class="enscript-keyword">if</span> (inaddr <span class="enscript-keyword">is</span> <span class="enscript-keyword">not</span> None):
        ia = Cast(inaddr, <span class="enscript-string">'char *'</span>)
        inaddr_format_string = <span class="enscript-string">&quot;{0: &lt;d}.{1: &lt;d}.{2: &lt;d}.{3: &lt;d}&quot;</span>
        out_string += inaddr_format_string.format(ia[0], ia[1], ia[2], ia[3])
    <span class="enscript-keyword">return</span> out_string

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetInPortAsString</span>(port):
    out_string = <span class="enscript-string">&quot;&quot;</span>
    port_string = Cast(port, <span class="enscript-string">'char *'</span>)
    port_unsigned = dereference(Cast(port, <span class="enscript-string">'unsigned short *'</span>))

    <span class="enscript-keyword">if</span> ((((port_unsigned &amp; 0xff00) &gt;&gt; 8) == port_string[0])) <span class="enscript-keyword">and</span> (((port_unsigned &amp; 0x00ff) == port_string[1])):
        out_string += <span class="enscript-string">&quot;:&quot;</span> + str(int(port_unsigned))
    <span class="enscript-keyword">else</span>:
        out_string += <span class="enscript-string">&quot;:&quot;</span> + str(int(((port_unsigned &amp; 0xff00) &gt;&gt; 8) | ((port_unsigned &amp; 0x00ff) &lt;&lt; 8)))

    <span class="enscript-keyword">return</span> out_string

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetIPv4SocketAsString</span>(sock) :
    out_string = <span class="enscript-string">&quot;&quot;</span>
    pcb = Cast(sock.so_pcb, <span class="enscript-string">'inpcb *'</span>)
    <span class="enscript-keyword">if</span> (pcb == 0):
        out_string += <span class="enscript-string">&quot;inpcb: (null) &quot;</span>
    <span class="enscript-keyword">else</span>:
        out_string += <span class="enscript-string">&quot;inpcb: &quot;</span> + hex(pcb)
        out_string += GetSocketProtocolAsString(sock)
        
        out_string += GetInAddr4to6AsString(addressof(pcb.inp_dependladdr.inp46_local))
        out_string += GetInPortAsString(addressof(pcb.inp_lport))
        out_string += <span class="enscript-string">&quot; -&gt; &quot;</span>
        out_string += GetInAddr4to6AsString(addressof(pcb.inp_dependfaddr.inp46_foreign))
        out_string += GetInPortAsString(addressof(pcb.inp_fport))
    <span class="enscript-keyword">return</span> out_string

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetIPv6SocketAsString</span>(sock) :
    out_string = <span class="enscript-string">&quot;&quot;</span>
    pcb = Cast(sock.so_pcb, <span class="enscript-string">'inpcb *'</span>)
    <span class="enscript-keyword">if</span> (pcb == 0):
        out_string += <span class="enscript-string">&quot;inpcb: (null) &quot;</span>
    <span class="enscript-keyword">else</span>:
        out_string += <span class="enscript-string">&quot;inpcb: &quot;</span> + hex(pcb) + <span class="enscript-string">&quot; &quot;</span>
        out_string += GetSocketProtocolAsString(sock)
 
        out_string += GetIn6AddrAsString((pcb.inp_dependladdr.inp6_local.__u6_addr.__u6_addr8))
        out_string += GetInPortAsString(addressof(pcb.inp_lport))
        out_string += <span class="enscript-string">&quot; -&gt; &quot;</span>
        out_string += GetIn6AddrAsString((pcb.inp_dependfaddr.inp6_foreign.__u6_addr.__u6_addr8))
        out_string += GetInPortAsString(addressof(pcb.inp_fport))
    <span class="enscript-keyword">return</span> out_string

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetUnixDomainSocketAsString</span>(sock) :
    out_string = <span class="enscript-string">&quot;&quot;</span>
    pcb = Cast(sock.so_pcb, <span class="enscript-string">'unpcb *'</span>)
    <span class="enscript-keyword">if</span> (pcb == 0):
        out_string += <span class="enscript-string">&quot;unpcb: (null) &quot;</span>
    <span class="enscript-keyword">else</span>:
        out_string += <span class="enscript-string">&quot;unpcb: &quot;</span> + hex(pcb)  + <span class="enscript-string">&quot; &quot;</span>
        out_string += <span class="enscript-string">&quot;unp_vnode: &quot;</span> + hex(pcb.unp_vnode) + <span class="enscript-string">&quot; &quot;</span>
        out_string += <span class="enscript-string">&quot;unp_conn: &quot;</span> + hex(pcb.unp_conn) + <span class="enscript-string">&quot; &quot;</span>
        out_string += <span class="enscript-string">&quot;unp_addr: &quot;</span> + GetSocketAddrAsStringUnix(pcb.unp_addr)
    <span class="enscript-keyword">return</span> out_string

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetSocket</span>(socket) :
    <span class="enscript-string">&quot;&quot;&quot; Show the contents of a socket
    &quot;&quot;&quot;</span>
    so = kern.GetValueFromAddress(unsigned(socket), <span class="enscript-string">'socket *'</span>)
    <span class="enscript-keyword">if</span> (so):
        out_string = <span class="enscript-string">&quot;&quot;</span>
        sock_format_string = <span class="enscript-string">&quot;so: 0x{0:&lt;x}&quot;</span>
        out_string += sock_format_string.format(so)
        domain = so.so_proto.pr_domain
        domain_name_format_string = <span class="enscript-string">&quot; {0:&lt;s} &quot;</span>
        out_string += domain_name_format_string.format(domain.dom_name)
        <span class="enscript-keyword">if</span> (domain.dom_family == 1):
            out_string += GetUnixDomainSocketAsString(so)
        <span class="enscript-keyword">if</span> (domain.dom_family == 2):
            out_string += GetIPv4SocketAsString(so)
        <span class="enscript-keyword">if</span> (domain.dom_family == 30):
            out_string += GetIPv6SocketAsString(so)
    <span class="enscript-keyword">else</span>:
        out_string += <span class="enscript-string">&quot;(null)&quot;</span>
    <span class="enscript-keyword">return</span> out_string
<span class="enscript-comment"># EndMacro: showsocket
</span>

<span class="enscript-comment"># Macro: showsocket
</span>@lldb_command(<span class="enscript-string">'showsocket'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowSocket</span>(cmd_args=None) :
    <span class="enscript-string">&quot;&quot;&quot; Show the contents of a socket
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">if</span> (cmd_args == None <span class="enscript-keyword">or</span> len(cmd_args) == 0):
            <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Missing argument 0 in user function.&quot;</span>
            <span class="enscript-keyword">return</span>
    so = kern.GetValueFromAddress(cmd_args[0], <span class="enscript-string">'socket *'</span>)
    <span class="enscript-keyword">if</span> (len(str(cmd_args[0])) &gt; 0):
        out_string = <span class="enscript-string">&quot;&quot;</span>
        sock_format_string = <span class="enscript-string">&quot;so: 0x{0:&lt;x}&quot;</span>
        out_string += sock_format_string.format(so)
        domain = so.so_proto.pr_domain
        domain_name_format_string = <span class="enscript-string">&quot; {0:&lt;s} &quot;</span>
        out_string += domain_name_format_string.format(domain.dom_name)
        <span class="enscript-keyword">if</span> (domain.dom_family == 1):
            out_string += GetUnixDomainSocketAsString(so)
        <span class="enscript-keyword">if</span> (domain.dom_family == 2):
            out_string += GetIPv4SocketAsString(so)
        <span class="enscript-keyword">if</span> (domain.dom_family == 30):
            out_string += GetIPv6SocketAsString(so)
        <span class="enscript-keyword">print</span> out_string
    <span class="enscript-keyword">else</span>:
        <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Unknown value passed as argument.&quot;</span>
        <span class="enscript-keyword">return</span>
<span class="enscript-comment"># EndMacro: showsocket
</span>
<span class="enscript-comment"># Macro: showprocsockets
</span>@lldb_command(<span class="enscript-string">'showprocsockets'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowProcSockets</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Given a proc_t pointer, display information about its sockets
    &quot;&quot;&quot;</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    
    <span class="enscript-keyword">if</span> cmd_args != None <span class="enscript-keyword">and</span> len(cmd_args) &gt; 0 :
        proc = kern.GetValueFromAddress(cmd_args[0], <span class="enscript-string">'proc *'</span>)
        proc_fd = proc.p_fd

        <span class="enscript-keyword">if</span> <span class="enscript-keyword">not</span> proc:
            <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Unknown value passed as argument.&quot;</span>
            <span class="enscript-keyword">return</span>
        <span class="enscript-keyword">else</span>:
            count = 0
            fpp = Cast(proc_fd.fd_ofiles, <span class="enscript-string">'fileproc **'</span>)
            <span class="enscript-keyword">while</span> (count &lt; proc_fd.fd_nfiles):
                fp = Cast(dereference(fpp), <span class="enscript-string">'fileproc *'</span>)
                <span class="enscript-keyword">if</span> (fp != 0):
                    fg = Cast(fp.f_fglob, <span class="enscript-string">'fileglob *'</span>)
                    <span class="enscript-keyword">if</span> (int(fg.fg_ops.fo_type) == 2):
                        <span class="enscript-keyword">if</span> (proc_fd.fd_ofileflags[count] &amp; 4):
                            out_string += <span class="enscript-string">&quot;U: &quot;</span>
                        <span class="enscript-keyword">else</span>:
                            out_string += <span class="enscript-string">&quot; &quot;</span>
                        out_string += <span class="enscript-string">&quot;fd = &quot;</span> + str(count) + <span class="enscript-string">&quot; &quot;</span> 
                        <span class="enscript-keyword">if</span> (fg.fg_data != 0):
                            out_string += GetSocket(unsigned(fg.fg_data))
                            out_string += <span class="enscript-string">&quot;\n&quot;</span>
                        <span class="enscript-keyword">else</span>:
                            out_string += <span class="enscript-string">&quot;&quot;</span>
                fpp = kern.GetValueFromAddress(unsigned(fpp + 8), <span class="enscript-string">'fileproc **'</span>)
                count += 1
        <span class="enscript-keyword">print</span> out_string
    <span class="enscript-keyword">else</span>:
        <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Missing argument 0 in user function.&quot;</span>
<span class="enscript-comment"># EndMacro: showprocsockets
</span>
<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetProcSockets</span>(proc):
    <span class="enscript-string">&quot;&quot;&quot; Given a proc_t pointer, display information about its sockets
    &quot;&quot;&quot;</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    proc_fd = proc.p_fd

    <span class="enscript-keyword">if</span> proc <span class="enscript-keyword">is</span> None:
        out_string += <span class="enscript-string">&quot;Unknown value passed as argument.&quot;</span>
    <span class="enscript-keyword">else</span>:
        count = 0
        fpp = Cast(proc_fd.fd_ofiles, <span class="enscript-string">'fileproc **'</span>)
        <span class="enscript-keyword">while</span> (count &lt; proc_fd.fd_nfiles):
            fp = Cast(dereference(fpp), <span class="enscript-string">'fileproc *'</span>)
            <span class="enscript-keyword">if</span> (fp != 0):
                fg = Cast(fp.f_fglob, <span class="enscript-string">'fileglob *'</span>)
                <span class="enscript-keyword">if</span> (int(fg.fg_ops.fo_type) == 2):
                    <span class="enscript-keyword">if</span> (proc_fd.fd_ofileflags[count] &amp; 4):
                        out_string += <span class="enscript-string">&quot;U: &quot;</span>
                    <span class="enscript-keyword">else</span>:
                        out_string += <span class="enscript-string">&quot; &quot;</span>
                    out_string += <span class="enscript-string">&quot;fd = &quot;</span> + str(count) + <span class="enscript-string">&quot; &quot;</span> 
                    <span class="enscript-keyword">if</span> (fg.fg_data != 0):
                        out_string += GetSocket(unsigned(fg.fg_data))
                        out_string += <span class="enscript-string">&quot;\n&quot;</span>
                    <span class="enscript-keyword">else</span>:
                        out_string += <span class="enscript-string">&quot;&quot;</span>
            fpp = kern.GetValueFromAddress(unsigned(fpp + 8), <span class="enscript-string">'fileproc **'</span>)
            count += 1
    <span class="enscript-keyword">return</span> out_string
    
    
<span class="enscript-comment"># Macro: showallprocsockets
</span>@lldb_command(<span class="enscript-string">'showallprocsockets'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowAllProcSockets</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot;Display information about the sockets of all the processes
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">for</span> proc <span class="enscript-keyword">in</span> kern.procs:
        <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;================================================================================&quot;</span>
        <span class="enscript-keyword">print</span> GetProcInfo(proc)
        <span class="enscript-keyword">print</span> GetProcSockets(proc)
<span class="enscript-comment"># EndMacro: showallprocsockets
</span>

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetRtEntryPrDetailsAsString</span>(rte):
    out_string = <span class="enscript-string">&quot;&quot;</span>
    rt = Cast(rte, <span class="enscript-string">'rtentry *'</span>)
    dst = Cast(rt.rt_nodes[0].rn_u.rn_leaf.rn_Key, <span class="enscript-string">'sockaddr *'</span>)
    isv6 = 0
    dst_string_format = <span class="enscript-string">&quot;{0:&lt;18s}&quot;</span>
    <span class="enscript-keyword">if</span> (dst.sa_family == AF_INET):
        out_string += dst_string_format.format(GetSocketAddrAsStringInet(dst)) + <span class="enscript-string">&quot; &quot;</span>
    <span class="enscript-keyword">else</span>: 
        <span class="enscript-keyword">if</span> (dst.sa_family == AF_INET6):
            out_string += dst_string_format.format(GetSocketAddrAsStringInet6(dst)) + <span class="enscript-string">&quot; &quot;</span>
            isv6 = 1
        <span class="enscript-keyword">else</span>:
            <span class="enscript-keyword">if</span> (dst.sa_family == AF_LINK):
                out_string += dst_string_format.format(GetSocketAddrAsStringLink(dst))
                <span class="enscript-keyword">if</span> (isv6 == 1):
                    out_string += <span class="enscript-string">&quot;                       &quot;</span>
                <span class="enscript-keyword">else</span>:
                    out_string += <span class="enscript-string">&quot; &quot;</span>
            <span class="enscript-keyword">else</span>:
                out_string += dst_string_format.format(GetSocketAddrAsStringUnspec(dst)) + <span class="enscript-string">&quot; &quot;</span>

    gw = Cast(rt.rt_gateway, <span class="enscript-string">'sockaddr *'</span>)
    <span class="enscript-keyword">if</span> (gw.sa_family == AF_INET):
        out_string += dst_string_format.format(GetSocketAddrAsStringInet(gw)) + <span class="enscript-string">&quot; &quot;</span>
    <span class="enscript-keyword">else</span>:
        <span class="enscript-keyword">if</span> (gw.sa_family == 30):
            out_string += dst_string_format.format(GetSocketAddrAsStringInet6(gw)) + <span class="enscript-string">&quot; &quot;</span>
            isv6 = 1
        <span class="enscript-keyword">else</span>:
            <span class="enscript-keyword">if</span> (gw.sa_family == 18):
                out_string += dst_string_format.format(GetSocketAddrAsStringLink(gw)) + <span class="enscript-string">&quot; &quot;</span>
                <span class="enscript-keyword">if</span> (isv6 == 1):
                    out_string += <span class="enscript-string">&quot;                       &quot;</span>
                <span class="enscript-keyword">else</span>:
                    out_string += <span class="enscript-string">&quot; &quot;</span>
            <span class="enscript-keyword">else</span>:
                dst_string_format.format(GetSocketAddrAsStringUnspec(gw))

    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_WASCLONED):
        <span class="enscript-keyword">if</span> (kern.ptrsize == 8):
            rt_flags_string_format = <span class="enscript-string">&quot;0x{0:&lt;16x}&quot;</span>
            out_string += rt_flags_string_format.format(rt.rt_parent) + <span class="enscript-string">&quot; &quot;</span>
        <span class="enscript-keyword">else</span>:
            rt_flags_string_format = <span class="enscript-string">&quot;0x{0:&lt;8x}&quot;</span>
            out_string += rt_flags_string_format.format(rt.rt_parent) + <span class="enscript-string">&quot; &quot;</span>
    <span class="enscript-keyword">else</span>:
        <span class="enscript-keyword">if</span> (kern.ptrsize == 8):
            out_string += <span class="enscript-string">&quot;                   &quot;</span>
        <span class="enscript-keyword">else</span>:
            out_string += <span class="enscript-string">&quot;           &quot;</span>

    rt_refcnt_rmx_string_format = <span class="enscript-string">&quot;{0:&lt;d} {1:&gt;10d}  &quot;</span>
    out_string += rt_refcnt_rmx_string_format.format(rt.rt_refcnt, rt.rt_rmx.rmx_pksent) + <span class="enscript-string">&quot;   &quot;</span>

    rtf_string_format = <span class="enscript-string">&quot;{0:&gt;s}&quot;</span>
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_UP):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;U&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_GATEWAY):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;G&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_HOST):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;H&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_REJECT):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;R&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_DYNAMIC):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;D&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_MODIFIED):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;M&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_CLONING):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;C&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_PRCLONING):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;c&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_LLINFO):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;L&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_STATIC):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;S&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_PROTO1):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;1&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_PROTO2):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;2&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_PROTO3):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;3&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_WASCLONED):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;W&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_BROADCAST):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;b&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_MULTICAST):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;m&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_XRESOLVE):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;X&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_BLACKHOLE):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;B&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_IFSCOPE):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;I&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_CONDEMNED):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;Z&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_IFREF):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;i&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_PROXY):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;Y&quot;</span>)
    <span class="enscript-keyword">if</span> (rt.rt_flags &amp; RTF_ROUTER):
        out_string += rtf_string_format.format(<span class="enscript-string">&quot;r&quot;</span>)

    out_string +=  <span class="enscript-string">&quot;/&quot;</span>
    out_string += str(rt.rt_ifp.if_name)
    out_string += str(int(rt.rt_ifp.if_unit))
    out_string += <span class="enscript-string">&quot;\n&quot;</span>
    <span class="enscript-keyword">return</span> out_string
    

RNF_ROOT = 2
<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetRtTableAsString</span>(rt_tables):
    out_string = <span class="enscript-string">&quot;&quot;</span>
    rn = Cast(rt_tables.rnh_treetop, <span class="enscript-string">'radix_node *'</span>)
    rnh_cnt = rt_tables.rnh_cnt

    <span class="enscript-keyword">while</span> (rn.rn_bit &gt;= 0):
        rn = rn.rn_u.rn_node.rn_L

    <span class="enscript-keyword">while</span> 1:
        base = Cast(rn, <span class="enscript-string">'radix_node *'</span>)
        <span class="enscript-keyword">while</span> ((rn.rn_parent.rn_u.rn_node.rn_R == rn) <span class="enscript-keyword">and</span> (rn.rn_flags &amp; RNF_ROOT == 0)):
            rn = rn.rn_parent
        rn = rn.rn_parent.rn_u.rn_node.rn_R
        <span class="enscript-keyword">while</span> (rn.rn_bit &gt;= 0):
            rn = rn.rn_u.rn_node.rn_L
        next_rn = rn
        <span class="enscript-keyword">while</span> (base != 0):
            rn = base
            base = rn.rn_u.rn_leaf.rn_Dupedkey
            <span class="enscript-keyword">if</span> ((rn.rn_flags &amp; RNF_ROOT) == 0):
                rt = Cast(rn, <span class="enscript-string">'rtentry *'</span>)
                <span class="enscript-keyword">if</span> (kern.ptrsize == 8):
                    rtentry_string_format = <span class="enscript-string">&quot;0x{0:&lt;18x}&quot;</span>
                    out_string += rtentry_string_format.format(rt) + <span class="enscript-string">&quot; &quot;</span>
                <span class="enscript-keyword">else</span>:
                    rtentry_string_format = <span class="enscript-string">&quot;0x{0:&lt;10x}&quot;</span>
                    out_string += rtentry_string_format.format(rt) + <span class="enscript-string">&quot; &quot;</span>
                out_string += GetRtEntryPrDetailsAsString(rt) + <span class="enscript-string">&quot; &quot;</span>

        rn = next_rn
        <span class="enscript-keyword">if</span> ((rn.rn_flags &amp; RNF_ROOT) != 0):
            <span class="enscript-keyword">break</span>
    <span class="enscript-keyword">return</span> out_string

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetRtInetAsString</span>():
    rt_tables = kern.globals.rt_tables[2]
    <span class="enscript-keyword">if</span> (kern.ptrsize == 8):
        rt_table_header_format_string = <span class="enscript-string">&quot;{0:&lt;18s} {1: &lt;16s} {2:&lt;20s} {3:&lt;16s} {4:&lt;8s} {5:&lt;8s} {6:&lt;8s}&quot;</span>
        <span class="enscript-keyword">print</span> rt_table_header_format_string.format(<span class="enscript-string">&quot;rtentry&quot;</span>, <span class="enscript-string">&quot; dst&quot;</span>, <span class="enscript-string">&quot;gw&quot;</span>, <span class="enscript-string">&quot;parent&quot;</span>, <span class="enscript-string">&quot;Refs&quot;</span>, <span class="enscript-string">&quot;Use&quot;</span>, <span class="enscript-string">&quot;flags/if&quot;</span>) 
        <span class="enscript-keyword">print</span> rt_table_header_format_string.format(<span class="enscript-string">&quot;-&quot;</span> * 18, <span class="enscript-string">&quot;-&quot;</span> * 16, <span class="enscript-string">&quot;-&quot;</span> * 16, <span class="enscript-string">&quot;-&quot;</span> * 16, <span class="enscript-string">&quot;-&quot;</span> * 8, <span class="enscript-string">&quot;-&quot;</span> * 8, <span class="enscript-string">&quot;-&quot;</span> * 8)
        <span class="enscript-keyword">print</span> GetRtTableAsString(rt_tables)
    <span class="enscript-keyword">else</span>:
        rt_table_header_format_string = <span class="enscript-string">&quot;{0:&lt;8s} {1:&lt;16s} {2:&lt;18s} {3:&lt;8s} {4:&lt;8s} {5:&lt;8s} {6:&lt;8s}&quot;</span>
        <span class="enscript-keyword">print</span> rt_table_header_format_string.format(<span class="enscript-string">&quot;rtentry&quot;</span>, <span class="enscript-string">&quot;dst&quot;</span>, <span class="enscript-string">&quot;gw&quot;</span>, <span class="enscript-string">&quot;parent&quot;</span>, <span class="enscript-string">&quot;Refs&quot;</span>, <span class="enscript-string">&quot;Use&quot;</span>, <span class="enscript-string">&quot;flags/if&quot;</span>) 
        <span class="enscript-keyword">print</span> rt_table_header_format_string.format(<span class="enscript-string">&quot;-&quot;</span> * 8, <span class="enscript-string">&quot;-&quot;</span> * 16, <span class="enscript-string">&quot;-&quot;</span> * 16, <span class="enscript-string">&quot;-&quot;</span> * 8, <span class="enscript-string">&quot;-&quot;</span> * 8, <span class="enscript-string">&quot;-&quot;</span> * 8, <span class="enscript-string">&quot;-&quot;</span> * 8) 
        <span class="enscript-keyword">print</span> GetRtTableAsString(rt_tables)

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetRtInet6AsString</span>():
    rt_tables = kern.globals.rt_tables[30]
    <span class="enscript-keyword">if</span> (kern.ptrsize == 8):
        rt_table_header_format_string = <span class="enscript-string">&quot;{0:&lt;18s} {1: &lt;16s} {2:&lt;20s} {3:&lt;16s} {4:&lt;8s} {5:&lt;8s} {6:&lt;8s}&quot;</span>
        <span class="enscript-keyword">print</span> rt_table_header_format_string.format(<span class="enscript-string">&quot;rtentry&quot;</span>, <span class="enscript-string">&quot; dst&quot;</span>, <span class="enscript-string">&quot;gw&quot;</span>, <span class="enscript-string">&quot;parent&quot;</span>, <span class="enscript-string">&quot;Refs&quot;</span>, <span class="enscript-string">&quot;Use&quot;</span>, <span class="enscript-string">&quot;flags/if&quot;</span>) 
        <span class="enscript-keyword">print</span> rt_table_header_format_string.format(<span class="enscript-string">&quot;-&quot;</span> * 18, <span class="enscript-string">&quot;-&quot;</span> * 16, <span class="enscript-string">&quot;-&quot;</span> * 16, <span class="enscript-string">&quot;-&quot;</span> * 16, <span class="enscript-string">&quot;-&quot;</span> * 8, <span class="enscript-string">&quot;-&quot;</span> * 8, <span class="enscript-string">&quot;-&quot;</span> * 8)
        <span class="enscript-keyword">print</span> GetRtTableAsString(rt_tables)
    <span class="enscript-keyword">else</span>:
        rt_table_header_format_string = <span class="enscript-string">&quot;{0:&lt;8s} {1:&lt;16s} {2:&lt;18s} {3:&lt;8s} {4:&lt;8s} {5:&lt;8s} {6:&lt;8s}&quot;</span>
        <span class="enscript-keyword">print</span> rt_table_header_format_string.format(<span class="enscript-string">&quot;rtentry&quot;</span>, <span class="enscript-string">&quot;dst&quot;</span>, <span class="enscript-string">&quot;gw&quot;</span>, <span class="enscript-string">&quot;parent&quot;</span>, <span class="enscript-string">&quot;Refs&quot;</span>, <span class="enscript-string">&quot;Use&quot;</span>, <span class="enscript-string">&quot;flags/if&quot;</span>) 
        <span class="enscript-keyword">print</span> rt_table_header_format_string.format(<span class="enscript-string">&quot;-&quot;</span> * 8, <span class="enscript-string">&quot;-&quot;</span> * 16, <span class="enscript-string">&quot;-&quot;</span> * 18, <span class="enscript-string">&quot;-&quot;</span> * 8, <span class="enscript-string">&quot;-&quot;</span> * 8, <span class="enscript-string">&quot;-&quot;</span> * 8, <span class="enscript-string">&quot;-&quot;</span> * 8) 
        <span class="enscript-keyword">print</span> GetRtTableAsString(rt_tables)

<span class="enscript-comment"># Macro: show_rt_inet
</span>@lldb_command(<span class="enscript-string">'show_rt_inet'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowRtInet</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Display the IPv4 routing table
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">print</span> GetRtInetAsString() 
<span class="enscript-comment"># EndMacro: show_rt_inet
</span>
<span class="enscript-comment"># Macro: show_rt_inet6
</span>@lldb_command(<span class="enscript-string">'show_rt_inet6'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowRtInet6</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Display the IPv6 routing table
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">print</span> GetRtInet6AsString()
<span class="enscript-comment"># EndMacro: show_rt_inet6
</span>
<span class="enscript-comment"># Macro: rtentry_showdbg
</span>@lldb_command(<span class="enscript-string">'rtentry_showdbg'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowRtEntryDebug</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Print the debug information of a route entry
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">if</span> (cmd_args == None <span class="enscript-keyword">or</span> len(cmd_args) == 0):
            <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Missing argument 0 in user function.&quot;</span>
            <span class="enscript-keyword">return</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    cnt = 0
    rtd = kern.GetValueFromAddress(cmd_args[0], <span class="enscript-string">'rtentry_dbg *'</span>)
    rtd_summary_format_string = <span class="enscript-string">&quot;{0:s} {1:d}&quot;</span>
    out_string += rtd_summary_format_string.format(<span class="enscript-string">&quot;Total holds : &quot;</span>, rtd.rtd_refhold_cnt) + <span class="enscript-string">&quot;\n&quot;</span>
    out_string += rtd_summary_format_string.format(<span class="enscript-string">&quot;Total releases : &quot;</span>, rtd.rtd_refrele_cnt) + <span class="enscript-string">&quot;\n&quot;</span>

    ix = 0
    <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
        kgm_pc = rtd.rtd_alloc.pc[ix]
        <span class="enscript-keyword">if</span> (kgm_pc != 0):
            <span class="enscript-keyword">if</span> (ix == 0):
                out_string += <span class="enscript-string">&quot;\nAlloc: (thread &quot;</span> + hex(rtd.rtd_alloc.th) + <span class="enscript-string">&quot;):\n&quot;</span>
            out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
            out_string += GetSourceInformationForAddress(kgm_pc)
            out_string += <span class="enscript-string">&quot;\n&quot;</span>
        ix += 1

    ix = 0
    <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
        kgm_pc = rtd.rtd_free.pc[ix]
        <span class="enscript-keyword">if</span> (kgm_pc != 0):
            <span class="enscript-keyword">if</span> (ix == 0):
                out_string += <span class="enscript-string">&quot;\nFree: (thread &quot;</span> + hex(rtd.rtd_free.th) + <span class="enscript-string">&quot;):\n&quot;</span>
            out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
            out_string += GetSourceInformationForAddress(kgm_pc)
            out_string += <span class="enscript-string">&quot;\n&quot;</span>
        ix += 1

    <span class="enscript-keyword">while</span> (cnt &lt; RTD_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = rtd.rtd_refhold[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nHold [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(rtd.rtd_refhold[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
    
    cnt = 0
    <span class="enscript-keyword">while</span> (cnt &lt; RTD_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = rtd.rtd_refrele[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nRelease [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(rtd.rtd_refrele[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
 
    out_string += <span class="enscript-string">&quot;\nTotal locks : &quot;</span> + str(int(rtd.rtd_lock_cnt))
    out_string += <span class="enscript-string">&quot;\nTotal unlocks : &quot;</span> + str(int(rtd.rtd_unlock_cnt))

    cnt = 0
    <span class="enscript-keyword">while</span> (cnt &lt; RTD_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = rtd.rtd_lock[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nLock [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(rtd.rtd_lock[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
 
    cnt = 0
    <span class="enscript-keyword">while</span> (cnt &lt; RTD_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = rtd.rtd_unlock[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nUnlock [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(rtd.rtd_unlock[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1

    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: rtentry_showdbg
</span>
<span class="enscript-comment"># Macro: inifa_showdbg
</span>@lldb_command(<span class="enscript-string">'inifa_showdbg'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">InIfaShowDebug</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Print the debug information of an IPv4 interface address
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">if</span> (cmd_args == None <span class="enscript-keyword">or</span> len(cmd_args) == 0):
            <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Missing argument 0 in user function.&quot;</span>
            <span class="enscript-keyword">return</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    cnt = 0
    inifa = kern.GetValueFromAddress(cmd_args[0], <span class="enscript-string">'in_ifaddr_dbg *'</span>)
    in_ifaddr_summary_format_string = <span class="enscript-string">&quot;{0:s} {1:d}&quot;</span>
    out_string += in_ifaddr_summary_format_string.format(<span class="enscript-string">&quot;Total holds : &quot;</span>, inifa.inifa_refhold_cnt) + <span class="enscript-string">&quot;\n&quot;</span>
    out_string += in_ifaddr_summary_format_string.format(<span class="enscript-string">&quot;Total releases : &quot;</span>, inifa.inifa_refrele_cnt) + <span class="enscript-string">&quot;\n&quot;</span>

    ix = 0
    <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
        kgm_pc = inifa.inifa_alloc.pc[ix]
        <span class="enscript-keyword">if</span> (kgm_pc != 0):
            <span class="enscript-keyword">if</span> (ix == 0):
                out_string += <span class="enscript-string">&quot;\nAlloc: (thread &quot;</span> + hex(inifa.inifa_alloc.th) + <span class="enscript-string">&quot;):\n&quot;</span>
            out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
            out_string += GetSourceInformationForAddress(kgm_pc)
            out_string += <span class="enscript-string">&quot;\n&quot;</span>
        ix += 1

    ix = 0
    <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
        kgm_pc = inifa.inifa_free.pc[ix]
        <span class="enscript-keyword">if</span> (kgm_pc != 0):
            <span class="enscript-keyword">if</span> (ix == 0):
                out_string += <span class="enscript-string">&quot;\nFree: (thread &quot;</span> + hex(inifa.inifa_free.th) + <span class="enscript-string">&quot;):\n&quot;</span>
            out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
            out_string += GetSourceInformationForAddress(kgm_pc)
            out_string += <span class="enscript-string">&quot;\n&quot;</span>
        ix += 1

    <span class="enscript-keyword">while</span> (cnt &lt; INIFA_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = inifa.inifa_refhold[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nHold [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(inifa.inifa_refhold[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
    cnt = 0

    <span class="enscript-keyword">while</span> (cnt &lt; INIFA_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = inifa.inifa_refrele[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nRelease [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(inifa.inifa_refrele[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: inifa_showdbg
</span>
<span class="enscript-comment"># Macro: in6ifa_showdbg
</span>@lldb_command(<span class="enscript-string">'in6ifa_showdbg'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">In6IfaShowDebug</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Print the debug information of an IPv6 interface address
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">if</span> (cmd_args == None <span class="enscript-keyword">or</span> len(cmd_args) == 0):
            <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Missing argument 0 in user function.&quot;</span>
            <span class="enscript-keyword">return</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    cnt = 0
    in6ifa = kern.GetValueFromAddress(cmd_args[0], <span class="enscript-string">'in6_ifaddr_dbg *'</span>)
    in6_ifaddr_summary_format_string = <span class="enscript-string">&quot;{0:s} {1:d}&quot;</span>
    <span class="enscript-keyword">print</span> in6_ifaddr_summary_format_string.format(<span class="enscript-string">&quot;Total holds : &quot;</span>, in6ifa.in6ifa_refhold_cnt)
    <span class="enscript-keyword">print</span> in6_ifaddr_summary_format_string.format(<span class="enscript-string">&quot;Total releases : &quot;</span>, in6ifa.in6ifa_refrele_cnt)

    ix = 0
    <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
        kgm_pc = in6ifa.in6ifa_alloc.pc[ix]
        <span class="enscript-keyword">if</span> (kgm_pc != 0):
            <span class="enscript-keyword">if</span> (ix == 0):
                out_string += <span class="enscript-string">&quot;\nAlloc: (thread &quot;</span> + hex(in6ifa.in6ifa_alloc.th) + <span class="enscript-string">&quot;):\n&quot;</span>
            out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
            out_string += GetSourceInformationForAddress(kgm_pc)
            out_string += <span class="enscript-string">&quot;\n&quot;</span>
        ix += 1

    ix = 0
    <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
        kgm_pc = in6ifa.in6ifa_free.pc[ix]
        <span class="enscript-keyword">if</span> (kgm_pc != 0):
            <span class="enscript-keyword">if</span> (ix == 0):
                out_string += <span class="enscript-string">&quot;\nFree: (thread &quot;</span> + hex(in6ifa.in6ifa_free.th) + <span class="enscript-string">&quot;):\n&quot;</span>
            out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
            out_string += GetSourceInformationForAddress(kgm_pc)
            out_string += <span class="enscript-string">&quot;\n&quot;</span>
        ix += 1

    <span class="enscript-keyword">while</span> (cnt &lt; IN6IFA_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = in6ifa.in6ifa_refhold[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nHold [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(in6ifa.in6ifa_refhold[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
    cnt = 0

    <span class="enscript-keyword">while</span> (cnt &lt; IN6IFA_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = in6ifa.in6ifa_refrele[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nRelease [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(in6ifa.in6ifa_refrele[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: in6ifa_showdbg
</span>
<span class="enscript-comment"># Macro: inm_showdbg
</span>@lldb_command(<span class="enscript-string">'inm_showdbg'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">InmShowDebug</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Print the debug information of an IPv4 multicast address
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">if</span> (cmd_args == None <span class="enscript-keyword">or</span> len(cmd_args) == 0):
            <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Missing argument 0 in user function.&quot;</span>
            <span class="enscript-keyword">return</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    cnt = 0
    inm = kern.GetValueFromAddress(cmd_args[0], <span class="enscript-string">'in_multi_dbg *'</span>)
    in_multi_summary_format_string = <span class="enscript-string">&quot;{0:s} {1:d}&quot;</span>
    out_string += in_multi_summary_format_string.format(<span class="enscript-string">&quot;Total holds : &quot;</span>, inm.inm_refhold_cnt)
    out_string += in_multi_summary_format_string.format(<span class="enscript-string">&quot;Total releases : &quot;</span>, inm.inm_refrele_cnt)

    <span class="enscript-keyword">while</span> (cnt &lt; INM_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = inm.inm_refhold[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nHold [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(inm.inm_refhold[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
    cnt = 0
    <span class="enscript-keyword">while</span> (cnt &lt; INM_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = inm.inm_refrele[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nRelease [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(inm.inm_refrele[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: inm_showdbg
</span>
<span class="enscript-comment"># Macro: ifma_showdbg
</span>@lldb_command(<span class="enscript-string">'ifma_showdbg'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">IfmaShowDebug</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Print the debug information of a link multicast address
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">if</span> (cmd_args == None <span class="enscript-keyword">or</span> len(cmd_args) == 0):
            <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Missing argument 0 in user function.&quot;</span>
            <span class="enscript-keyword">return</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    cnt = 0
    ifma = kern.GetValueFromAddress(cmd_args[0], <span class="enscript-string">'ifmultiaddr_dbg *'</span>)
    link_multi_summary_format_string = <span class="enscript-string">&quot;{0:s} {1:d}&quot;</span>
    out_string += link_multi_summary_format_string.format(<span class="enscript-string">&quot;Total holds : &quot;</span>, ifma.ifma_refhold_cnt) + <span class="enscript-string">&quot;\n&quot;</span>
    out_string += link_multi_summary_format_string.format(<span class="enscript-string">&quot;Total releases : &quot;</span>, ifma.ifma_refrele_cnt) + <span class="enscript-string">&quot;\n&quot;</span>

    <span class="enscript-keyword">while</span> (cnt &lt; IFMA_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = ifma.ifma_refhold[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nHold [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(ifma.ifma_refhold[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
    cnt = 0
    <span class="enscript-keyword">while</span> (cnt &lt; IFMA_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = ifma.ifma_refrele[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nRelease [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(ifma.ifma_refrele[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: ifma_showdbg
</span>
<span class="enscript-comment"># Macro: ifpref_showdbg
</span>@lldb_command(<span class="enscript-string">'ifpref_showdbg'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">IfpRefShowDebug</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Print the debug information of an interface ref count
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">if</span> (cmd_args == None <span class="enscript-keyword">or</span> len(cmd_args) == 0):
            <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Missing argument 0 in user function.&quot;</span>
            <span class="enscript-keyword">return</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    cnt = 0
    dl_if = kern.GetValueFromAddress(cmd_args[0], <span class="enscript-string">'dlil_ifnet_dbg *'</span>)
    dl_if_summary_format_string = <span class="enscript-string">&quot;{0:s} {1:d}&quot;</span>
    out_string +=  dl_if_summary_format_string.format(<span class="enscript-string">&quot;Total holds : &quot;</span>, dl_if.dldbg_if_refhold_cnt)
    out_string += dl_if_summary_format_string.format(<span class="enscript-string">&quot;Total releases : &quot;</span>, dl_if.dldbg_if_refrele_cnt)

    <span class="enscript-keyword">while</span> (cnt &lt; IF_REF_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = dl_if.dldbg_if_refhold[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nHold [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(dl_if.dldbg_if_refhold[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
    cnt = 0
    <span class="enscript-keyword">while</span> (cnt &lt; IF_REF_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = dl_if.dldbg_if_refrele[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nRelease [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(dl_if.dldbg_if_refrele[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: ifpref_showdbg
</span>
<span class="enscript-comment"># Macro: ndpr_showdbg
</span>@lldb_command(<span class="enscript-string">'ndpr_showdbg'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ndprShowDebug</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Print the debug information of a nd_prefix structure
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">if</span> (cmd_args == None <span class="enscript-keyword">or</span> len(cmd_args) == 0):
            <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Missing argument 0 in user function.&quot;</span>
            <span class="enscript-keyword">return</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    cnt = 0
    ndpr = kern.GetValueFromAddress(cmd_args[0], <span class="enscript-string">'nd_prefix_dbg *'</span>)
    ndpr_summary_format_string = <span class="enscript-string">&quot;{0:s} {1:d}&quot;</span>
    out_string += ndpr_summary_format_string.format(<span class="enscript-string">&quot;Total holds : &quot;</span>, ndpr.ndpr_refhold_cnt)
    out_string += ndpr_summary_format_string.format(<span class="enscript-string">&quot;Total releases : &quot;</span>, ndpr.ndpr_refrele_cnt)

    <span class="enscript-keyword">while</span> (cnt &lt; NDPR_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = ndpr.ndpr_refhold[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nHold [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(ndpr.ndpr_refhold[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
    cnt = 0
    <span class="enscript-keyword">while</span> (cnt &lt; NDPR_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = ndpr.ndpr_refrele[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nRelease [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(ndpr.ndpr_refrele[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: ndpr_showdbg
</span>
<span class="enscript-comment"># Macro: nddr_showdbg
</span>@lldb_command(<span class="enscript-string">'nddr_showdbg'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">nddrShowDebug</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Print the debug information of a nd_defrouter structure
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">if</span> (cmd_args == None <span class="enscript-keyword">or</span> len(cmd_args) == 0):
            <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Missing argument 0 in user function.&quot;</span>
            <span class="enscript-keyword">return</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    cnt = 0
    nddr = kern.GetValueFromAddress(cmd_args[0], <span class="enscript-string">'nd_defrouter_dbg *'</span>)
    nddr_summary_format_string = <span class="enscript-string">&quot;{0:s} {1:d}&quot;</span>
    out_string += nddr_summary_format_string.format(<span class="enscript-string">&quot;Total holds : &quot;</span>, nddr.nddr_refhold_cnt)
    out_string += nddr_summary_format_string.format(<span class="enscript-string">&quot;Total releases : &quot;</span>, nddr.nddr_refrele_cnt)

    <span class="enscript-keyword">while</span> (cnt &lt; NDDR_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = nddr.nddr_refhold[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nHold [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(nddr.nddr_refhold[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
    cnt = 0
    <span class="enscript-keyword">while</span> (cnt &lt; NDDR_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = nddr.nddr_refrele[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nRelease [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(nddr.nddr_refrele[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: nddr_showdbg
</span>
<span class="enscript-comment"># Macro: imo_showdbg
</span>@lldb_command(<span class="enscript-string">'imo_showdbg'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">IpmOptions</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Print the debug information of a ip_moptions structure
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">if</span> (cmd_args == None <span class="enscript-keyword">or</span> len(cmd_args) == 0):
            <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Missing argument 0 in user function.&quot;</span>
            <span class="enscript-keyword">return</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    cnt = 0
    imo = kern.GetValueFromAddress(cmd_args[0], <span class="enscript-string">'ip_moptions_dbg *'</span>)
    imo_summary_format_string = <span class="enscript-string">&quot;{0:s} {1:d}&quot;</span>
    out_string += imo_summary_format_string.format(<span class="enscript-string">&quot;Total holds : &quot;</span>, imo.imo_refhold_cnt)
    out_string += imo_summary_format_string.format(<span class="enscript-string">&quot;Total releases : &quot;</span>, imo.imo_refrele_cnt)

    <span class="enscript-keyword">while</span> (cnt &lt; IMO_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = imo.imo_refhold[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nHold [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(imo.imo_refhold[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
    cnt = 0
    <span class="enscript-keyword">while</span> (cnt &lt; IMO_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = imo.imo_refrele[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nRelease [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(imo.imo_refrele[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: imo_showdbg
</span>
<span class="enscript-comment"># Macro: im6o_showdbg
</span>@lldb_command(<span class="enscript-string">'im6o_showdbg'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">IpmOptions</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Print the debug information of a ip6_moptions structure
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">if</span> (cmd_args == None <span class="enscript-keyword">or</span> len(cmd_args) == 0):
            <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Missing argument 0 in user function.&quot;</span>
            <span class="enscript-keyword">return</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    cnt = 0
    im6o = kern.GetValueFromAddress(cmd_args[0], <span class="enscript-string">'ip6_moptions_dbg *'</span>)
    im6o_summary_format_string = <span class="enscript-string">&quot;{0:s} {1:d}&quot;</span>
    out_string += im6o_summary_format_string.format(<span class="enscript-string">&quot;Total holds : &quot;</span>, im6o.im6o_refhold_cnt)
    out_string += im6o_summary_format_string.format(<span class="enscript-string">&quot;Total releases : &quot;</span>, im6o.im6o_refrele_cnt)

    <span class="enscript-keyword">while</span> (cnt &lt; IM6O_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = im6o.im6o_refhold[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nHold [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(im6o.im6o_refhold[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
    cnt = 0
    <span class="enscript-keyword">while</span> (cnt &lt; IM6O_TRACE_HIST_SIZE):
        ix = 0
        <span class="enscript-keyword">while</span> (ix &lt; CTRACE_STACK_SIZE):
            kgm_pc = im6o.im6o_refrele[cnt].pc[ix]
            <span class="enscript-keyword">if</span> (kgm_pc != 0):
                <span class="enscript-keyword">if</span> (ix == 0):
                    out_string += <span class="enscript-string">&quot;\nRelease [&quot;</span> + str(int(cnt)) + <span class="enscript-string">&quot;] (thread &quot;</span> + hex(im6o.im6o_refrele[cnt].th) + <span class="enscript-string">&quot;):\n&quot;</span>
                out_string += str(int(ix + 1)) + <span class="enscript-string">&quot;: &quot;</span>
                out_string += GetSourceInformationForAddress(kgm_pc)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
            ix += 1
        cnt += 1
    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: im6o_showdbg
</span>
<span class="enscript-comment"># Macro: rtentry_trash
</span>@lldb_command(<span class="enscript-string">'rtentry_trash'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">RtEntryTrash</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Walk the list of trash route entries
    &quot;&quot;&quot;</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    rt_trash_head = kern.globals.rttrash_head
    rtd = Cast(rt_trash_head.tqh_first, <span class="enscript-string">'rtentry_dbg *'</span>)
    rt_trash_format_string = <span class="enscript-string">&quot;{0:4d}: {1:x} {2:3d} {3:6d} {4:6d}&quot;</span>
    cnt = 0
    <span class="enscript-keyword">while</span> (int(rtd) != 0):
        <span class="enscript-keyword">if</span> (cnt == 0):
            <span class="enscript-keyword">if</span> (kern.ptrsize == 8):
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;                rtentry ref   hold   rele             dst    gw             parent flags/if\n&quot;</span>
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;      ----------------- --- ------ ------ --------------- ----- ------------------ -----------\n&quot;</span>
            <span class="enscript-keyword">else</span>:
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;        rtentry ref   hold   rele             dst    gw     parent flags/if\n&quot;</span>
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;      --------- --- ------ ------ --------------- ----- ---------- -----------\n&quot;</span>
        out_string += rt_trash_format_string.format(cnt, rtd, rtd.rtd_refhold_cnt - rtd.rtd_refrele_cnt, rtd.rtd_refhold_cnt, rtd.rtd_refrele_cnt) + <span class="enscript-string">&quot;   &quot;</span>
        out_string += GetRtEntryPrDetailsAsString(rtd) + <span class="enscript-string">&quot;\n&quot;</span>
        rtd = rtd.rtd_trash_link.tqe_next
        cnt += 1
    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: rtentry_trash
</span>
<span class="enscript-comment"># Macro: show_rtentry
</span>@lldb_command(<span class="enscript-string">'show_rtentry'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShRtEntry</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Print rtentry.
    &quot;&quot;&quot;</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    rt = kern.GetValueFromAddress(cmd_args[0], <span class="enscript-string">'rtentry *'</span>)
    out_string += GetRtEntryPrDetailsAsString(rt) + <span class="enscript-string">&quot;\n&quot;</span>
    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: show_rtentry
</span>
<span class="enscript-comment"># Macro: inifa_trash
</span>@lldb_command(<span class="enscript-string">'inifa_trash'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">InIfaTrash</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Walk the list of trash in_ifaddr entries
    &quot;&quot;&quot;</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    ifa_trash_head = kern.globals.inifa_trash_head
    ifa = Cast(ifa_trash_head.tqh_first, <span class="enscript-string">'in_ifaddr_dbg *'</span>)
    inifa_trash_format_string = <span class="enscript-string">&quot;{0:4d}: {1:x} {2:3d} {3:6d} {4:6d}&quot;</span>
    cnt = 0
    <span class="enscript-keyword">while</span> (int(ifa) != 0):
        <span class="enscript-keyword">if</span> (cnt == 0):
            <span class="enscript-keyword">if</span> (kern.ptrsize == 8):
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;                  in_ifa  ref   hold   rele&quot;</span>
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;      ------------------  ---  ------  ----&quot;</span>
            <span class="enscript-keyword">else</span>:
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;          in_ifa  ref   hold   rele&quot;</span>
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;      ----------  ---  ----- ------&quot;</span>
        out_string += inifa_trash_format_string.format(cnt + 1, ifa, ifa.inifa_refhold_cnt - ifa.inifa_refrele_cnt, ifa.inifa_refhold_cnt, ifa.inifa_refrele_cnt) + <span class="enscript-string">&quot;   &quot;</span>
        out_string += GetSocketAddrAsStringInet(ifa.inifa.ia_ifa.ifa_addr) + <span class="enscript-string">&quot;\n&quot;</span>
        ifa = ifa.inifa_trash_link.tqe_next
        cnt += 1
    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: inifa_trash
</span>
<span class="enscript-comment"># Macro: in6ifa_trash
</span>@lldb_command(<span class="enscript-string">'in6ifa_trash'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">In6IfaTrash</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Walk the list of trash in6_ifaddr entries
    &quot;&quot;&quot;</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    in6ifa_trash_head = kern.globals.in6ifa_trash_head
    ifa = Cast(in6ifa_trash_head.tqh_first, <span class="enscript-string">'in6_ifaddr_dbg *'</span>)
    in6ifa_trash_format_string = <span class="enscript-string">&quot;{0:4d}: 0x{1:x} {2:3d} {3:6d} {4:6d}&quot;</span>
    cnt = 0
    <span class="enscript-keyword">while</span> (int(ifa) != 0):
        <span class="enscript-keyword">if</span> (cnt == 0):
            <span class="enscript-keyword">if</span> (kern.ptrsize == 8):
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;                 in6_ifa  ref   hold   rele&quot;</span>
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;      ------------------  --- ------ ------&quot;</span>
            <span class="enscript-keyword">else</span>:
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;         in6_ifa  ref   hold   rele&quot;</span>
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;      ----------  --- ------ ------&quot;</span>
        out_string += in6ifa_trash_format_string.format(cnt + 1, ifa, ifa.in6ifa_refhold_cnt - ifa.in6ifa_refrele_cnt, ifa.in6ifa_refhold_cnt, ifa.in6ifa_refrele_cnt) + <span class="enscript-string">&quot;   &quot;</span>
        out_string += GetSocketAddrAsStringInet6(ifa.in6ifa.ia_ifa.ifa_addr) + <span class="enscript-string">&quot;\n&quot;</span>
        ifa = ifa.in6ifa_trash_link.tqe_next
        cnt += 1
    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: in6ifa_trash
</span>
<span class="enscript-comment"># Macro: inm_trash
</span>@lldb_command(<span class="enscript-string">'inm_trash'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">InmTrash</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Walk the list of trash in_multi entries
    &quot;&quot;&quot;</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    inm_trash_head = kern.globals.inm_trash_head
    inm = Cast(inm_trash_head.tqh_first, <span class="enscript-string">'in_multi_dbg *'</span>)
    inm_trash_format_string = <span class="enscript-string">&quot;{0:4d}: {1:x} {2:3d} {3:6d} {4:6d}&quot;</span>
    cnt = 0
    <span class="enscript-keyword">while</span> (int(inm) != 0):
        <span class="enscript-keyword">if</span> (cnt == 0):
            <span class="enscript-keyword">if</span> (kern.ptrsize == 8):
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;                     inm  ref   hold   rele&quot;</span>
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;      ------------------  --- ------ ------&quot;</span>
            <span class="enscript-keyword">else</span>:
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;             inm  ref   hold   rele&quot;</span>
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;      ----------  --- ------ ------&quot;</span>
        out_string += inm_trash_format_string.format(cnt + 1, inm, inm.inm_refhold_cnt - inm.inm_refrele_cnt, inm.inm_refhold_cnt, inm.inm_refrele_cnt) + <span class="enscript-string">&quot;   &quot;</span>
        out_string += GetInAddrAsString(addressof(inm.inm.inm_addr)) + <span class="enscript-string">&quot;\n&quot;</span>
        inm = inm.inm_trash_link.tqe_next
        cnt += 1
    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: inm_trash
</span>
<span class="enscript-comment"># Macro: in6m_trash
</span>@lldb_command(<span class="enscript-string">'in6m_trash'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">In6mTrash</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Walk the list of trash in6_multi entries
    &quot;&quot;&quot;</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    in6m_trash_head = kern.globals.in6m_trash_head
    in6m = Cast(in6m_trash_head.tqh_first, <span class="enscript-string">'in6_multi_dbg *'</span>)
    in6m_trash_format_string = <span class="enscript-string">&quot;{0:4d}: {1:x} {2:3d} {3:6d} {4:6d}&quot;</span>
    cnt = 0
    <span class="enscript-keyword">while</span> (int(in6m) != 0):
        <span class="enscript-keyword">if</span> (cnt == 0):
            <span class="enscript-keyword">if</span> (kern.ptrsize == 8):
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;                    in6m  ref   hold   rele&quot;</span>
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;      ------------------  --- ------ ------&quot;</span>
            <span class="enscript-keyword">else</span>:
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;            in6m  ref   hold   rele&quot;</span>
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;      ----------  --- ------ ------&quot;</span>
        out_string += in6m_trash_format_string.format(cnt + 1, in6m, in6m.in6m_refhold_cnt - in6m.in6m_refrele_cnt, in6m.in6m_refhold_cnt, in6m.in6m_refrele_cnt) + <span class="enscript-string">&quot;   &quot;</span>
        out_string += GetIn6AddrAsString(addressof(in6m.in6m.in6m_addr)) + <span class="enscript-string">&quot;\n&quot;</span>
        in6m = in6m.in6m_trash_link.tqe_next
        cnt += 1
    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: in6m_trash
</span>
<span class="enscript-comment"># Macro: ifma_trash
</span>@lldb_command(<span class="enscript-string">'ifma_trash'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">IfmaTrash</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Walk the list of trash ifmultiaddr entries
    &quot;&quot;&quot;</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    ifma_trash_head = kern.globals.ifma_trash_head
    ifma = Cast(ifma_trash_head.tqh_first, <span class="enscript-string">'ifmultiaddr_dbg *'</span>)
    ifma_trash_format_string = <span class="enscript-string">&quot;{0:4d}: {1:x} {2:3d} {3:6d} {4:6d}&quot;</span>
    cnt = 0
    <span class="enscript-keyword">while</span> (int(ifma) != 0):
        <span class="enscript-keyword">if</span> (cnt == 0):
            <span class="enscript-keyword">if</span> (kern.ptrsize == 8):
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;                    ifma  ref   hold   rele&quot;</span>
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;      ------------------  --- ------ ------&quot;</span>
            <span class="enscript-keyword">else</span>:
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;            ifma  ref   hold   rele&quot;</span>
                <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;      ----------  --- ------ ------&quot;</span>
        out_string += ifma_trash_format_string.format(cnt + 1, ifma, ifma.ifma_refhold_cnt - ifma.ifma_refrele_cnt, ifma.ifma_refhold_cnt, ifma.ifma_refrele_cnt) + <span class="enscript-string">&quot;   &quot;</span>
        out_string += GetSocketAddrAsString(ifma.ifma.ifma_addr) + <span class="enscript-string">&quot;\n&quot;</span>
        out_string += <span class="enscript-string">&quot; @ &quot;</span> + ifma.ifma.ifma_ifp.if_xname
        ifma = ifma.ifma_trash_link.tqe_next
        cnt += 1
    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: ifma_trash
</span>
<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetInPcb</span>(pcb, proto):
    out_string = <span class="enscript-string">&quot;&quot;</span>
    out_string += hex(pcb)

    <span class="enscript-keyword">if</span> (proto == IPPROTO_TCP):
        out_string +=  <span class="enscript-string">&quot; tcp&quot;</span>
    <span class="enscript-keyword">else</span>:
        <span class="enscript-keyword">if</span> (proto == IPPROTO_UDP):
            out_string += <span class="enscript-string">&quot; udp&quot;</span>
        <span class="enscript-keyword">else</span>:
            out_string += str(proto) +  <span class="enscript-string">&quot;.&quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_vflag &amp; INP_IPV4):
        out_string += <span class="enscript-string">&quot;4 &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_vflag &amp; INP_IPV6):
        out_string += <span class="enscript-string">&quot;6 &quot;</span>

    <span class="enscript-keyword">if</span> (pcb.inp_vflag &amp; INP_IPV4):
        out_string += <span class="enscript-string">&quot;                                      &quot;</span>
        out_string += GetInAddrAsString(addressof(pcb.inp_dependladdr.inp46_local.ia46_addr4))
    <span class="enscript-keyword">else</span>:
        out_string += GetIn6AddrAsString((pcb.inp_dependladdr.inp6_local.__u6_addr.__u6_addr8))

    out_string += <span class="enscript-string">&quot; &quot;</span>
    out_string += Getntohs(pcb.inp_lport)
    out_string += <span class="enscript-string">&quot; &quot;</span>

    <span class="enscript-keyword">if</span> (pcb.inp_vflag &amp; INP_IPV4):
        out_string += <span class="enscript-string">&quot;                                      &quot;</span>
        out_string += GetInAddrAsString(addressof(pcb.inp_dependfaddr.inp46_foreign.ia46_addr4))
    <span class="enscript-keyword">else</span>:
        out_string += GetIn6AddrAsString((pcb.inp_dependfaddr.inp6_foreign.__u6_addr.__u6_addr8))

    out_string += <span class="enscript-string">&quot; &quot;</span>
    out_string += Getntohs(pcb.inp_fport)
    out_string += <span class="enscript-string">&quot; &quot;</span>

    <span class="enscript-keyword">if</span> (proto == IPPROTO_TCP):
        out_string += GetTcpState(pcb.inp_ppcb)

    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_RECVOPTS):
        out_string += <span class="enscript-string">&quot;recvopts &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_RECVRETOPTS):
        out_string += <span class="enscript-string">&quot;recvretopts &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_RECVDSTADDR):
        out_string += <span class="enscript-string">&quot;recvdstaddr &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_HDRINCL):
        out_string += <span class="enscript-string">&quot;hdrincl &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_HIGHPORT):
        out_string += <span class="enscript-string">&quot;highport &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_LOWPORT):
        out_string += <span class="enscript-string">&quot;lowport &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_ANONPORT):
        out_string += <span class="enscript-string">&quot;anonport &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_RECVIF):
        out_string += <span class="enscript-string">&quot;recvif &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_MTUDISC):
        out_string += <span class="enscript-string">&quot;mtudisc &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_STRIPHDR):
        out_string += <span class="enscript-string">&quot;striphdr &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_RECV_ANYIF):
        out_string += <span class="enscript-string">&quot;recv_anyif &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_INADDR_ANY):
        out_string += <span class="enscript-string">&quot;inaddr_any &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_RECVTTL):
        out_string += <span class="enscript-string">&quot;recvttl &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_UDP_NOCKSUM):
        out_string += <span class="enscript-string">&quot;nocksum &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_BOUND_IF):
        out_string += <span class="enscript-string">&quot;boundif &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; IN6P_IPV6_V6ONLY):
        out_string += <span class="enscript-string">&quot;v6only &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; IN6P_PKTINFO):
        out_string += <span class="enscript-string">&quot;pktinfo &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; IN6P_HOPLIMIT):
        out_string += <span class="enscript-string">&quot;hoplimit &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; IN6P_HOPOPTS):
        out_string += <span class="enscript-string">&quot;hopopts &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; IN6P_DSTOPTS):
        out_string += <span class="enscript-string">&quot;dstopts &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; IN6P_RTHDR):
        out_string += <span class="enscript-string">&quot;rthdr &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; IN6P_RTHDRDSTOPTS):
        out_string += <span class="enscript-string">&quot;rthdrdstopts &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; IN6P_TCLASS):
        out_string += <span class="enscript-string">&quot;rcv_tclass &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; IN6P_AUTOFLOWLABEL):
        out_string += <span class="enscript-string">&quot;autoflowlabel &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; IN6P_BINDV6ONLY):
        out_string += <span class="enscript-string">&quot;bindv6only &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; IN6P_RFC2292):
        out_string += <span class="enscript-string">&quot;RFC2292 &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; IN6P_MTU):
        out_string += <span class="enscript-string">&quot;rcv_pmtu &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_PKTINFO):
        out_string += <span class="enscript-string">&quot;pktinfo &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_FLOW_SUSPENDED):
        out_string += <span class="enscript-string">&quot;suspended &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_NO_IFT_CELLULAR):
        out_string += <span class="enscript-string">&quot;nocellular &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_FLOW_CONTROLLED):
        out_string += <span class="enscript-string">&quot;flowctld &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags &amp; INP_FC_FEEDBACK):
        out_string += <span class="enscript-string">&quot;fcfeedback &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags2 &amp; INP2_TIMEWAIT):
        out_string += <span class="enscript-string">&quot;timewait &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags2 &amp; INP2_IN_FCTREE):
        out_string += <span class="enscript-string">&quot;in_fctree &quot;</span>
    <span class="enscript-keyword">if</span> (pcb.inp_flags2 &amp; INP2_WANT_APP_POLICY):
        out_string += <span class="enscript-string">&quot;want_app_policy &quot;</span>
          
    so = pcb.inp_socket
    <span class="enscript-keyword">if</span> (so != 0):
        out_string += <span class="enscript-string">&quot;[so=&quot;</span> + str(so) + <span class="enscript-string">&quot; s=&quot;</span> + str(int(so.so_snd.sb_cc)) + <span class="enscript-string">&quot; r=&quot;</span> + str(int(so.so_rcv.sb_cc)) + <span class="enscript-string">&quot; usecnt=&quot;</span> + str(int(so.so_usecount)) + <span class="enscript-string">&quot;] &quot;</span>

    <span class="enscript-keyword">if</span> (pcb.inp_state == 0 <span class="enscript-keyword">or</span> pcb.inp_state == INPCB_STATE_INUSE):
        out_string += <span class="enscript-string">&quot;inuse, &quot;</span>
    <span class="enscript-keyword">else</span>:
        <span class="enscript-keyword">if</span> (pcb.inp_state == INPCB_STATE_DEAD):
            out_string += <span class="enscript-string">&quot;dead, &quot;</span>
        <span class="enscript-keyword">else</span>:
            out_string += <span class="enscript-string">&quot;unknown (&quot;</span> + str(int(pcb.inp_state)) + <span class="enscript-string">&quot;), &quot;</span>

    <span class="enscript-keyword">return</span> out_string

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetPcbInfo</span>(pcbi, proto):
    out_string = <span class="enscript-string">&quot;&quot;</span>
    snd_cc = 0
    snd_buf = unsigned(0)
    rcv_cc = 0
    rcv_buf = unsigned(0)
    pcbseen = 0
    out_string += <span class="enscript-string">&quot;lastport &quot;</span> + str(int(pcbi.ipi_lastport)) + <span class="enscript-string">&quot; lastlow &quot;</span> + str(int(pcbi.ipi_lastlow)) + <span class="enscript-string">&quot; lasthi &quot;</span> + str(int(pcbi.ipi_lasthi)) + <span class="enscript-string">&quot;\n&quot;</span>
    out_string += <span class="enscript-string">&quot;active pcb count is &quot;</span> + str(int(pcbi.ipi_count)) + <span class="enscript-string">&quot;\n&quot;</span>
    hashsize = pcbi.ipi_hashmask + 1
    out_string += <span class="enscript-string">&quot;hash size is &quot;</span> + str(int(hashsize)) + <span class="enscript-string">&quot;\n&quot;</span>
    out_string += str(pcbi.ipi_hashbase) + <span class="enscript-string">&quot; has the following inpcb(s):\n&quot;</span>
    <span class="enscript-keyword">if</span> (kern.ptrsize == 8):
        out_string += <span class="enscript-string">&quot;pcb            proto  source                     address  port  destination               address  port\n&quot;</span>
    <span class="enscript-keyword">else</span>:
        out_string += <span class="enscript-string">&quot;pcb            proto  source           address  port  destination         address  port\n\n&quot;</span>

    i = 0
    hashbase = pcbi.ipi_hashbase
    <span class="enscript-keyword">while</span> (i &lt; hashsize):
        head = hashbase[i]
        pcb = cast(head.lh_first, <span class="enscript-string">'inpcb *'</span>)
        <span class="enscript-keyword">while</span> pcb != 0:
            pcbseen += 1
            out_string += GetInPcb(pcb, proto) + <span class="enscript-string">&quot;\n&quot;</span>
            so = pcb.inp_socket
            <span class="enscript-keyword">if</span> so != 0:
                snd_cc += so.so_snd.sb_cc
                mp = so.so_snd.sb_mb
                <span class="enscript-keyword">while</span> mp != 0:
                    snd_buf += 256
                    <span class="enscript-keyword">if</span> (mp.m_hdr.mh_flags &amp; 0x01):
                        snd_buf = mp.M_dat.MH.MH_dat.MH_ext.ext_size
                    mp = mp.m_hdr.mh_next
                rcv_cc += so.so_rcv.sb_cc
                mp = so.so_rcv.sb_mb
                <span class="enscript-keyword">while</span> mp != 0:
                    rcv_buf += 256
                    <span class="enscript-keyword">if</span> (mp.m_hdr.mh_flags &amp; 0x01):
                        rcv_buf += mp.M_dat.MH.MH_dat.MH_ext.ext_size
                    mp = mp.m_hdr.mh_next
            pcb = cast(pcb.inp_hash.le_next, <span class="enscript-string">'inpcb *'</span>)
        i += 1
    
    out_string += <span class="enscript-string">&quot;total seen &quot;</span> + str(int(pcbseen)) + <span class="enscript-string">&quot; snd_cc &quot;</span> + str(int(snd_cc)) + <span class="enscript-string">&quot; rcv_cc &quot;</span> + str(int(rcv_cc)) + <span class="enscript-string">&quot;\n&quot;</span>
    out_string += <span class="enscript-string">&quot;total snd_buf &quot;</span> + str(int(snd_buf)) + <span class="enscript-string">&quot; rcv_buf &quot;</span> + str(int(rcv_buf)) + <span class="enscript-string">&quot;\n&quot;</span>
    out_string  += <span class="enscript-string">&quot;port hash base is &quot;</span> + hex(pcbi.ipi_porthashbase) + <span class="enscript-string">&quot;\n&quot;</span>
    
    i = 0
    hashbase = pcbi.ipi_porthashbase
    <span class="enscript-keyword">while</span> (i &lt; hashsize):
        head = hashbase[i]
        pcb = cast(head.lh_first, <span class="enscript-string">'inpcbport *'</span>)
        <span class="enscript-keyword">while</span> pcb != 0:
            out_string += <span class="enscript-string">&quot;\t&quot;</span>
            out_string += GetInPcbPort(pcb)
            out_string += <span class="enscript-string">&quot;\n&quot;</span>
            pcb = cast(pcb.phd_hash.le_next, <span class="enscript-string">'inpcbport *'</span>)
        i += 1

    <span class="enscript-keyword">return</span> out_string

<span class="enscript-keyword">def</span> <span class="enscript-function-name">GetInPcbPort</span>(ppcb):
    out_string = <span class="enscript-string">&quot;&quot;</span>
    out_string += hex(ppcb) + <span class="enscript-string">&quot;: lport &quot;</span>
    out_string += Getntohs(ppcb.phd_port)
    <span class="enscript-keyword">return</span> out_string
    

<span class="enscript-keyword">def</span> <span class="enscript-function-name">Getntohs</span>(port):
    out_string = <span class="enscript-string">&quot;&quot;</span>
    <span class="enscript-comment">#p = unsigned(int(port) &amp; 0x0000ffff)
</span>    p = ((port &amp; 0x0000ff00) &gt;&gt; 8)
    p |= ((port &amp; 0x000000ff) &lt;&lt; 8)
    <span class="enscript-keyword">return</span> str(p)

<span class="enscript-comment"># Macro: show_kern_event_pcbinfo
</span><span class="enscript-keyword">def</span> <span class="enscript-function-name">GetKernEventPcbInfo</span>(kev_pcb_head):
    out_string = <span class="enscript-string">&quot;&quot;</span>
    pcb = Cast(kev_pcb_head.lh_first, <span class="enscript-string">'kern_event_pcb *'</span>)
    <span class="enscript-keyword">if</span> (kern.ptrsize == 8):
        kev_pcb_format_string = <span class="enscript-string">&quot;0x{0:&lt;16x} {1:12d} {2:16d} {3:16d}&quot;</span>
        out_string += <span class="enscript-string">&quot;  evp socket         vendor code      class filter      subclass filter\n&quot;</span>
        out_string += <span class="enscript-string">&quot;--------------       -----------      ------------      ---------------\n&quot;</span>
    <span class="enscript-keyword">else</span>:
        kev_pcb_format_string = <span class="enscript-string">&quot;0x{0:&lt;8x} {1:12d} {2:16d} {3:16d}&quot;</span>
        out_string += <span class="enscript-string">&quot;evp socket       vendor code      class filter      subclass filter\n&quot;</span>
        out_string += <span class="enscript-string">&quot;----------       -----------      ------------      ---------------\n&quot;</span>
    <span class="enscript-keyword">while</span> (pcb != 0):
        out_string += kev_pcb_format_string.format(pcb.evp_socket, pcb.evp_vendor_code_filter, pcb.evp_class_filter, pcb.evp_subclass_filter)
        out_string += <span class="enscript-string">&quot;\n&quot;</span>
        pcb = pcb.evp_link.le_next
    <span class="enscript-keyword">return</span> out_string

@lldb_command(<span class="enscript-string">'show_kern_event_pcbinfo'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowKernEventPcbInfo</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Display the list of Kernel Event protocol control block information
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">print</span> GetKernEventPcbInfo(addressof(kern.globals.kern_event_head))
<span class="enscript-comment"># EndMacro:  show_kern_event_pcbinfo
</span>
<span class="enscript-comment"># Macro: show_kern_control_pcbinfo
</span><span class="enscript-keyword">def</span> <span class="enscript-function-name">GetKernControlPcbInfo</span>(ctl_head):
    out_string = <span class="enscript-string">&quot;&quot;</span>
    kctl = Cast(ctl_head.tqh_first, <span class="enscript-string">'kctl *'</span>)
    <span class="enscript-keyword">if</span> (kern.ptrsize == 8):    
        kcb_format_string = <span class="enscript-string">&quot;0x{0:&lt;16x} {1:4d} {2:10d}\n&quot;</span>
    <span class="enscript-keyword">else</span>:
        kcb_format_string = <span class="enscript-string">&quot;0x{0:&lt;8x} {1:4d} {2:10d}\n&quot;</span>
    <span class="enscript-keyword">while</span> unsigned(kctl) != 0:
        kctl_name = <span class="enscript-string">&quot;controller: &quot;</span> + str(kctl.name) + <span class="enscript-string">&quot;\n&quot;</span>
        out_string += kctl_name
        kcb = Cast(kctl.kcb_head.tqh_first, <span class="enscript-string">'ctl_cb *'</span>)
        <span class="enscript-keyword">if</span> unsigned(kcb) != 0:
            <span class="enscript-keyword">if</span> (kern.ptrsize == 8):
                out_string += <span class="enscript-string">&quot;socket               unit       usecount\n&quot;</span>
                out_string += <span class="enscript-string">&quot;------               ----       --------\n&quot;</span>
            <span class="enscript-keyword">else</span>:
                out_string += <span class="enscript-string">&quot;socket       unit       usecount\n&quot;</span>
                out_string += <span class="enscript-string">&quot;------       ----       --------\n&quot;</span>
        <span class="enscript-keyword">while</span> unsigned(kcb) != 0:
            out_string += kcb_format_string.format(kcb.so, kcb.unit, kcb.usecount)   
            kcb = kcb.next.tqe_next
        out_string += <span class="enscript-string">&quot;\n&quot;</span>
        kctl = kctl.next.tqe_next
    <span class="enscript-keyword">return</span> out_string

@lldb_command(<span class="enscript-string">'show_kern_control_pcbinfo'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowKernControlPcbInfo</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Display the list of Kernel Control protocol control block information
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">print</span> GetKernControlPcbInfo(addressof(kern.globals.ctl_head))
<span class="enscript-comment"># EndMacro:  show_kern_control_pcbinfo
</span>
<span class="enscript-comment"># Macro: show_tcp_pcbinfo
</span>@lldb_command(<span class="enscript-string">'show_tcp_pcbinfo'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowTcpPcbInfo</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Display the list of TCP protocol control block information
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">print</span> GetPcbInfo(addressof(kern.globals.tcbinfo), IPPROTO_TCP)
<span class="enscript-comment"># EndMacro:  show_tcp_pcbinfo
</span>
<span class="enscript-comment"># Macro: show_udp_pcbinfo
</span>@lldb_command(<span class="enscript-string">'show_udp_pcbinfo'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowUdpPcbInfo</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Display the list of UDP protocol control block information
    &quot;&quot;&quot;</span>
    <span class="enscript-keyword">print</span> GetPcbInfo(addressof(kern.globals.udbinfo), IPPROTO_UDP)
<span class="enscript-comment"># EndMacro:  show_udp_pcbinfo
</span>
<span class="enscript-comment"># Macro: show_tcp_timewaitslots
</span>@lldb_command(<span class="enscript-string">'show_tcp_timewaitslots'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowTcpTimeWaitSlots</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Display the list of the TCP protocol control blocks in TIMEWAIT
    &quot;&quot;&quot;</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    slot = -1
    _all = 0

    <span class="enscript-keyword">if</span> len(cmd_args) &gt; 0:
        <span class="enscript-keyword">if</span> (int(cmd_args[0]) == -1):
            _all = 1
        <span class="enscript-keyword">else</span>:
            slot = int(cmd_args[0])

    out_string += <span class="enscript-string">&quot;time wait slot size &quot;</span> + str(N_TIME_WAIT_SLOTS) + <span class="enscript-string">&quot; cur_tw_slot &quot;</span> + str(int(kern.globals.cur_tw_slot)) + <span class="enscript-string">&quot;\n&quot;</span>
    i = 0

    <span class="enscript-keyword">while</span> (i &lt; N_TIME_WAIT_SLOTS):
        perslot = 0
        head = kern.globals.time_wait_slots[i]
        <span class="enscript-keyword">if</span> (i == slot <span class="enscript-keyword">or</span> slot == -1):
            pcb0 = cast(head.lh_first, <span class="enscript-string">'inpcb *'</span>)
            <span class="enscript-keyword">while</span> (pcb0 != 0):
                perslot += 1
                pcb0 = pcb0.inp_list.le_next

            out_string += <span class="enscript-string">&quot;  slot &quot;</span> + str(i) + <span class="enscript-string">&quot; count &quot;</span> + str(perslot) + <span class="enscript-string">&quot;\n&quot;</span>

        <span class="enscript-keyword">if</span> (_all <span class="enscript-keyword">or</span> i == slot):
            pcb0 = cast(head.lh_first, <span class="enscript-string">'inpcb *'</span>)
            <span class="enscript-keyword">while</span> (pcb0 != 0):
                out_string += <span class="enscript-string">&quot;\t&quot;</span>
                out_string += GetInPcb(pcb0, IPPROTO_TCP)
                out_string += <span class="enscript-string">&quot;\n&quot;</span>
                pcb0 = pcb0.inp_list.le_next

        i += 1
    <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: show_tcp_timewaitslots
</span>
<span class="enscript-comment"># Macro: show_domains
</span>@lldb_command(<span class="enscript-string">'show_domains'</span>)
<span class="enscript-keyword">def</span> <span class="enscript-function-name">ShowDomains</span>(cmd_args=None):
    <span class="enscript-string">&quot;&quot;&quot; Display the list of the domains
    &quot;&quot;&quot;</span>
    out_string = <span class="enscript-string">&quot;&quot;</span>
    domains = kern.globals.domains
    dp = Cast(domains.tqh_first, <span class="enscript-string">'domain *'</span>)
    ifma_trash_format_string = <span class="enscript-string">&quot;{0:4d}: {1:x} {2:3d} {3:6d} {4:6d}&quot;</span>
    cnt = 0
    <span class="enscript-keyword">while</span> (dp != 0):
        out_string += <span class="enscript-string">&quot;\&quot;&quot;</span> + str(dp.dom_name) + <span class="enscript-string">&quot;\&quot;&quot;</span> + <span class="enscript-string">&quot;[&quot;</span> + str(int(dp.dom_refs)) + <span class="enscript-string">&quot; refs] domain &quot;</span> + hex(dp) + <span class="enscript-string">&quot;\n&quot;</span>
        out_string += <span class="enscript-string">&quot;    family:\t&quot;</span> + str(int(dp.dom_family)) + <span class="enscript-string">&quot;\n&quot;</span>
        out_string += <span class="enscript-string">&quot;    flags:0x\t&quot;</span> + str(int(dp.dom_flags)) + <span class="enscript-string">&quot;\n&quot;</span>
        out_string += <span class="enscript-string">&quot;    rtparams:\toff=&quot;</span> + str(int(dp.dom_rtoffset)) + <span class="enscript-string">&quot;, maxrtkey=&quot;</span> + str(int(dp.dom_maxrtkey)) + <span class="enscript-string">&quot;\n&quot;</span>

        <span class="enscript-keyword">if</span> (dp.dom_init):
            out_string += <span class="enscript-string">&quot;    init:\t&quot;</span>
            out_string += GetSourceInformationForAddress(dp.dom_init) + <span class="enscript-string">&quot;\n&quot;</span>
        <span class="enscript-keyword">if</span> (dp.dom_externalize):
            out_string += <span class="enscript-string">&quot;    externalize:\t&quot;</span>
            out_string += GetSourceInformationForAddress(dp.dom_externalize) + <span class="enscript-string">&quot;\n&quot;</span>
        <span class="enscript-keyword">if</span> (dp.dom_dispose):
            out_string += <span class="enscript-string">&quot;    dispose:\t&quot;</span>
            out_string += GetSourceInformationForAddress(dp.dom_dispose) + <span class="enscript-string">&quot;\n&quot;</span>
        <span class="enscript-keyword">if</span> (dp.dom_rtattach):
            out_string += <span class="enscript-string">&quot;    rtattach:\t&quot;</span>
            out_string += GetSourceInformationForAddress(dp.dom_rtattach) + <span class="enscript-string">&quot;\n&quot;</span>
        <span class="enscript-keyword">if</span> (dp.dom_old):
            out_string += <span class="enscript-string">&quot;    old:\t&quot;</span>
            out_string += GetSourceInformationForAddress(dp.dom_old) + <span class="enscript-string">&quot;\n&quot;</span>

        pr = Cast(dp.dom_protosw.tqh_first, <span class="enscript-string">'protosw *'</span>)
        <span class="enscript-keyword">while</span> pr != 0:
            pru = pr.pr_usrreqs
            out_string += <span class="enscript-string">&quot;\ttype &quot;</span> + str(int(pr.pr_type)) + <span class="enscript-string">&quot;, protocol &quot;</span> + str(int(pr.pr_protocol)) + <span class="enscript-string">&quot;, protosw &quot;</span> + hex(pr) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    flags:0x\t&quot;</span> + hex(pr.pr_flags) + <span class="enscript-string">&quot;\n&quot;</span>
            <span class="enscript-keyword">if</span> (pr.pr_input):
                out_string += <span class="enscript-string">&quot;\t    input:\t&quot;</span>
                out_string += GetSourceInformationForAddress(pr.pr_input) + <span class="enscript-string">&quot;\n&quot;</span>
            <span class="enscript-keyword">if</span> (pr.pr_output):
                out_string += <span class="enscript-string">&quot;\t    output:\t&quot;</span>
                out_string += GetSourceInformationForAddress(pr.pr_output) + <span class="enscript-string">&quot;\n&quot;</span>
            <span class="enscript-keyword">if</span> (pr.pr_ctlinput):
                out_string += <span class="enscript-string">&quot;\t    ctlinput:\t&quot;</span>
                out_string += GetSourceInformationForAddress(pr.pr_ctlinput) + <span class="enscript-string">&quot;\n&quot;</span>
            <span class="enscript-keyword">if</span> (pr.pr_ctloutput):
                out_string += <span class="enscript-string">&quot;\t    ctloutput:\t&quot;</span>
                out_string += GetSourceInformationForAddress(pr.pr_ctloutput) + <span class="enscript-string">&quot;\n&quot;</span>
            <span class="enscript-keyword">if</span> (pr.pr_init):
                out_string += <span class="enscript-string">&quot;\t    init:\t&quot;</span>
                out_string += GetSourceInformationForAddress(pr.pr_init) + <span class="enscript-string">&quot;\n&quot;</span>
            <span class="enscript-keyword">if</span> (pr.pr_drain):
                out_string += <span class="enscript-string">&quot;\t    drain:\t&quot;</span>
                out_string += GetSourceInformationForAddress(pr.pr_drain) + <span class="enscript-string">&quot;\n&quot;</span>
            <span class="enscript-keyword">if</span> (pr.pr_sysctl):
                out_string += <span class="enscript-string">&quot;\t    sysctl:\t&quot;</span>
                out_string += GetSourceInformationForAddress(pr.pr_sysctl) + <span class="enscript-string">&quot;\n&quot;</span>
            <span class="enscript-keyword">if</span> (pr.pr_lock):
                out_string += <span class="enscript-string">&quot;\t    lock:\t&quot;</span>
                out_string += GetSourceInformationForAddress(pr.pr_lock) + <span class="enscript-string">&quot;\n&quot;</span>
            <span class="enscript-keyword">if</span> (pr.pr_unlock):
                out_string += <span class="enscript-string">&quot;\t    unlock:\t&quot;</span>
                out_string += GetSourceInformationForAddress(pr.pr_unlock) + <span class="enscript-string">&quot;\n&quot;</span>
            <span class="enscript-keyword">if</span> (pr.pr_getlock):
                out_string += <span class="enscript-string">&quot;\t    getlock:\t&quot;</span>
                out_string += GetSourceInformationForAddress(pr.pr_getlock) + <span class="enscript-string">&quot;\n&quot;</span>
            <span class="enscript-keyword">if</span> (pr.pr_old):
                out_string += <span class="enscript-string">&quot;\t    old:\t&quot;</span>
                out_string += GetSourceInformationForAddress(pr.pr_old) + <span class="enscript-string">&quot;\n&quot;</span>

            out_string += <span class="enscript-string">&quot;\t    pru_flags:0x\t&quot;</span> + hex(pru.pru_flags) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    abort:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_abort) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    accept:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_accept) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    attach:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_attach) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    bind:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_bind) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    connect:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_connect) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    connect2:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_connect2) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    connectx:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_connectx) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    control:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_control) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    detach:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_detach) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    disconnect:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_disconnect) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    listen:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_listen) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    peeloff:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_peeloff) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    peeraddr:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_peeraddr) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    rcvd:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_rcvd) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    rcvoob:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_rcvoob) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    send:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_send) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    sense:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_sense) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    shutdown:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_shutdown) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    sockaddr:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_sockaddr) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    sopoll:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_sopoll) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    soreceive:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_soreceive) + <span class="enscript-string">&quot;\n&quot;</span>
            out_string += <span class="enscript-string">&quot;\t    sosend:\t&quot;</span>
            out_string += GetSourceInformationForAddress(pru.pru_sosend) + <span class="enscript-string">&quot;\n&quot;</span>
            pr = pr.pr_entry.tqe_next
        dp = dp.dom_entry.tqe_next

        <span class="enscript-keyword">print</span> out_string
<span class="enscript-comment"># EndMacro: show_domains
</span></pre>
<hr />
</body></html>