<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>syntax_checker.py</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">syntax_checker.py&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">#!/usr/bin/env python
</span>
helpdoc = <span class="enscript-string">&quot;&quot;&quot;
A simple utility that verifies the syntax for python scripts.
The checks it does are :
  * Check for 'tab' characters in .py files
  * Compile errors in py sources
Usage:
  python syntax_checker.py &lt;python_source_file&gt; [&lt;python_source_file&gt; ..] 
&quot;&quot;&quot;</span>
<span class="enscript-keyword">import</span> py_compile
<span class="enscript-keyword">import</span> sys
<span class="enscript-keyword">import</span> os
<span class="enscript-keyword">import</span> re

tabs_search_rex = re.compile(<span class="enscript-string">&quot;^\s*\t+&quot;</span>,re.MULTILINE|re.DOTALL)

<span class="enscript-keyword">if</span> __name__ == <span class="enscript-string">&quot;__main__&quot;</span>:
    <span class="enscript-keyword">if</span> len(sys.argv) &lt; 2:
        <span class="enscript-keyword">print</span> &gt;&gt;sys.stderr, <span class="enscript-string">&quot;Error: Unknown arguments&quot;</span>
        <span class="enscript-keyword">print</span> helpdoc
        sys.exit(1)
    <span class="enscript-keyword">for</span> fname <span class="enscript-keyword">in</span> sys.argv[1:]:
        <span class="enscript-keyword">if</span> <span class="enscript-keyword">not</span> os.path.exists(fname):
            <span class="enscript-keyword">print</span> &gt;&gt;sys.stderr, <span class="enscript-string">&quot;Error: Cannot recognize %s as a file&quot;</span> % fname
            sys.exit(1)
        <span class="enscript-keyword">if</span> fname.split(<span class="enscript-string">'.'</span>)[-1] != <span class="enscript-string">'py'</span>:
            <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Note: %s is not a valid python file. Skipping.&quot;</span> % fname
            <span class="enscript-keyword">continue</span>
        fh = open(fname)
        strdata = fh.readlines()
        lineno = 0
        tab_check_status = True
        <span class="enscript-keyword">for</span> linedata <span class="enscript-keyword">in</span> strdata:
            lineno += 1
            <span class="enscript-keyword">if</span> len(tabs_search_rex.findall(linedata)) &gt; 0 :
                <span class="enscript-keyword">print</span> &gt;&gt;sys.stderr, <span class="enscript-string">&quot;Error: Found a TAB character at %s:%d&quot;</span> % (fname, lineno)
                tab_check_status = False
        <span class="enscript-keyword">if</span> tab_check_status == False:
            <span class="enscript-keyword">print</span> &gt;&gt;sys.stderr, <span class="enscript-string">&quot;Error: Syntax check failed. Please fix the errors and try again.&quot;</span>
            sys.exit(1)
        <span class="enscript-comment">#now check for error in compilation
</span>        <span class="enscript-keyword">try</span>:
            compile_result = py_compile.compile(fname, cfile=<span class="enscript-string">&quot;/dev/null&quot;</span>, doraise=True)
        <span class="enscript-keyword">except</span> py_compile.PyCompileError as exc:
            <span class="enscript-keyword">print</span> str(exc)
            <span class="enscript-keyword">print</span> &gt;&gt;sys.stderr, <span class="enscript-string">&quot;Error: Compilation failed. Please fix the errors and try again.&quot;</span>
            sys.exit(1)
        <span class="enscript-keyword">print</span> <span class="enscript-string">&quot;Success: Checked %s. No syntax errors found.&quot;</span> % fname
    sys.exit(0)

</pre>
<hr />
</body></html>