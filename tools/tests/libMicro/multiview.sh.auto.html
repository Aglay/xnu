<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>multiview.sh</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">multiview.sh&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-reference">#!/bin/sh
</span><span class="enscript-comment">#
</span><span class="enscript-comment"># CDDL HEADER START
</span><span class="enscript-comment">#
</span><span class="enscript-comment"># The contents of this file are subject to the terms
</span><span class="enscript-comment"># of the Common Development and Distribution License
</span><span class="enscript-comment"># (the &quot;License&quot;).  You may not use this file except
</span><span class="enscript-comment"># in compliance with the License.
</span><span class="enscript-comment">#
</span><span class="enscript-comment"># You can obtain a copy of the license at
</span><span class="enscript-comment"># src/OPENSOLARIS.LICENSE
</span><span class="enscript-comment"># or <a href="http://www.opensolaris.org/os/licensing.">http://www.opensolaris.org/os/licensing.</a>
</span><span class="enscript-comment"># See the License for the specific language governing
</span><span class="enscript-comment"># permissions and limitations under the License.
</span><span class="enscript-comment">#
</span><span class="enscript-comment"># When distributing Covered Code, include this CDDL
</span><span class="enscript-comment"># HEADER in each file and include the License file at
</span><span class="enscript-comment"># usr/src/OPENSOLARIS.LICENSE.  If applicable,
</span><span class="enscript-comment"># add the following below this CDDL HEADER, with the
</span><span class="enscript-comment"># fields enclosed by brackets &quot;[]&quot; replaced with your
</span><span class="enscript-comment"># own identifying information: Portions Copyright [yyyy]
</span><span class="enscript-comment"># [name of copyright owner]
</span><span class="enscript-comment">#
</span><span class="enscript-comment"># CDDL HEADER END
</span><span class="enscript-comment">#
</span>
<span class="enscript-comment">#
</span><span class="enscript-comment"># Copyright 2005 Sun Microsystems, Inc.  All rights reserved.
</span><span class="enscript-comment"># Use is subject to license terms.
</span><span class="enscript-comment">#
</span>
<span class="enscript-comment">#
</span><span class="enscript-comment"># output html comparison of several libmicro output data files
</span><span class="enscript-comment"># usage: multiview file1 file2 file3 file4 ...
</span><span class="enscript-comment">#
</span><span class="enscript-comment">#	relative ranking is calculated using first as reference
</span><span class="enscript-comment">#	color interpolation is done to indicate relative performance;
</span><span class="enscript-comment">#	the redder the color, the slower the result, the greener the
</span><span class="enscript-comment">#       faster
</span> 
awk '	BEGIN { 
  benchmark_count = 0;
  header_count = 0;
}
/^<span class="enscript-comment">#/ {
</span>	next;
	}
/errors/ {
	next;
	}
/^\!/ { 
	split($0, A_header, <span class="enscript-string">&quot;:&quot;</span>); 
	name = substr(A_header[1],2);
	headers[name]=name; 
	header_data[name,FILENAME] = substr($0, length(name) + 3);
	<span class="enscript-keyword">if</span> (header_names[name] == 0) {
		header_names[name] = ++header_count;
		headers[header_count] = name;
	}
	next;
}

	{ 
	<span class="enscript-keyword">if</span>(NF &gt;= 7) {
	      	<span class="enscript-keyword">if</span> (benchmark_names[$1] == 0) {
			benchmark_names[$1] = ++benchmark_count;
			benchmarks[benchmark_count] = $1;
		}
		<span class="enscript-keyword">if</span> ($6 == 0)
		   	benchmark_data[$1,FILENAME] = $4;
		<span class="enscript-keyword">else</span> 
			benchmark_data[$1,FILENAME] = -1;
	}
}	    

END { 
	printf(<span class="enscript-string">&quot;&lt;!DOCTYPE html PUBLIC \&quot;-//W3C//DTD XHTML 1.0 Transitional//EN\&quot;\n&quot;</span>);
	printf(<span class="enscript-string">&quot;\&quot;<a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</a>\&quot;&gt;\n&quot;</span>);
	printf(<span class="enscript-string">&quot;&lt;html xmlns=\&quot;<a href="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</a>\&quot;&gt;\n&quot;</span>);
	printf(<span class="enscript-string">&quot;&lt;head&gt;\n&quot;</span>);
	printf(<span class="enscript-string">&quot;&lt;meta http-equiv=\&quot;content-type\&quot; content=\&quot;text/html; charset=ISO-8859-1\&quot; /&gt;\n&quot;</span>);
	printf(<span class="enscript-string">&quot;&lt;meta name=\&quot;author\&quot; content=\&quot;autogen\&quot; /&gt;\n&quot;</span>);
	printf(<span class="enscript-string">&quot;&lt;title&gt;multiview comparison&lt;/title&gt;\n&quot;</span>)
	printf(<span class="enscript-string">&quot;&lt;style type=\&quot;text/css\&quot;&gt;\n&quot;</span>);
	printf(<span class="enscript-string">&quot;body { font-family: sans-serif; }\n&quot;</span>);
	printf(<span class="enscript-string">&quot;table { border-collapse: collapse; }\n&quot;</span>);
	printf(<span class="enscript-string">&quot;td { padding: 0.1em; border: 1px solid #ccc; text-align: right; }\n&quot;</span>);
	printf(<span class="enscript-string">&quot;td.header { text-align: left; }\n&quot;</span>);
	printf(<span class="enscript-string">&quot;pre { margin-top: 0em; margin-bottom: 0em; }\n&quot;</span>);
	printf(<span class="enscript-string">&quot;&lt;/style&gt;\n&quot;</span>);
	printf(<span class="enscript-string">&quot;&lt;/head&gt;\n&quot;</span>);
	printf(<span class="enscript-string">&quot;&lt;body bgcolor=\&quot;#ffffff\&quot; link=\&quot;#0000ee\&quot; vlink=\&quot;#cc0000\&quot; alink=\&quot;#0000ee\&quot;&gt;\n&quot;</span>);
	printf(<span class="enscript-string">&quot;&lt;table border=\&quot;1\&quot; cellspacing=\&quot;1\&quot;&gt;\n&quot;</span>);
	printf(<span class="enscript-string">&quot;&lt;tbody&gt;\n&quot;</span>);
	<span class="enscript-keyword">for</span>(i = 1; i &lt;= header_count; i++) {
		hname = headers[i];
		printf(<span class="enscript-string">&quot;&lt;tr&gt;&lt;td class=\&quot;header\&quot;&gt;%s&lt;/td&gt;\n&quot;</span>, hname);
		
		<span class="enscript-keyword">for</span> (j = 1; j &lt; ARGC; j++) {
			sub(<span class="enscript-string">&quot;^[\t ]+&quot;</span>, <span class="enscript-string">&quot;&quot;</span>, header_data[hname, ARGV[j]]);
			printf(<span class="enscript-string">&quot;&lt;td class=\&quot;header\&quot;&gt;%s&lt;/td&gt;\n&quot;</span>, header_data[hname, ARGV[j]]);
		}
		printf(<span class="enscript-string">&quot;&lt;/tr&gt;\n&quot;</span>);
	}
	printf(<span class="enscript-string">&quot;&lt;tr&gt;\n&quot;</span>);
	printf(<span class="enscript-string">&quot;&lt;th&gt;BENCHMARK&lt;/th&gt;\n&quot;</span>);
	printf(<span class="enscript-string">&quot;&lt;th align=\&quot;right\&quot;&gt;USECS&lt;/th&gt;\n&quot;</span>);

	<span class="enscript-keyword">for</span> (i = 2; i &lt; ARGC; i++) 
		printf(<span class="enscript-string">&quot;&lt;th align=\&quot;right\&quot;&gt;USECS [percentage]&lt;/th&gt;\n&quot;</span>);

	printf(<span class="enscript-string">&quot;&lt;/tr&gt;\n&quot;</span>);
	<span class="enscript-keyword">for</span>(i = 1; i &lt; benchmark_count; i++) {
	  <span class="enscript-keyword">for</span>(j = 1; j &lt; benchmark_count; j++) {
	    <span class="enscript-keyword">if</span> (benchmarks[j] &gt; benchmarks[j + 1]) {
	      tmp = benchmarks[j]; 
	      benchmarks[j] =  benchmarks[j+1];
	      benchmarks[j+1] = tmp;
	    }
	  }
	}

	<span class="enscript-keyword">for</span>(i = 1; i &lt;= benchmark_count; i++) {
		name = benchmarks[i];
		a = benchmark_data[name, ARGV[1]];

		printf(<span class="enscript-string">&quot;&lt;tr&gt;\n&quot;</span>);
		printf(<span class="enscript-string">&quot;&lt;td&gt;%s&lt;/td&gt;\n&quot;</span>, name);
		<span class="enscript-keyword">if</span> (a &gt; 0)
			printf(<span class="enscript-string">&quot;&lt;td&gt;&lt;pre&gt;%f&lt;/pre&gt;&lt;/td&gt;\n&quot;</span>, a);
		<span class="enscript-keyword">else</span> {
			<span class="enscript-keyword">if</span> (a &lt; 0)
				printf(<span class="enscript-string">&quot;&lt;td bgcolor=\&quot;#ff0000\&quot;&gt;%s&lt;/td&gt;\n&quot;</span>, <span class="enscript-string">&quot;ERRORS&quot;</span>);
			<span class="enscript-keyword">else</span> 
				printf(<span class="enscript-string">&quot;&lt;td&gt;%s&lt;/td&gt;\n&quot;</span>, <span class="enscript-string">&quot;missing&quot;</span>);
				
			<span class="enscript-keyword">for</span> (j = 2; j &lt; ARGC; j++) 
				printf(<span class="enscript-string">&quot;&lt;td&gt;%s&lt;/td&gt;\n&quot;</span>, <span class="enscript-string">&quot;not computed&quot;</span>);
			<span class="enscript-keyword">continue</span>;
		}

		<span class="enscript-keyword">for</span> (j = 2; j &lt; ARGC; j++) {
			b = benchmark_data[name, ARGV[j]];
			<span class="enscript-keyword">if</span> (b &gt; 0) {
				factor = b/a;
				bgcolor = colormap(factor);
				<span class="enscript-keyword">if</span> (factor &gt; 1)
				  percentage = -(factor * 100 - 100);
				<span class="enscript-keyword">if</span> (factor &lt;= 1)
				  percentage = 100/factor - 100;
				
				printf(<span class="enscript-string">&quot;&lt;td bgcolor=\&quot;%s\&quot;&gt;&lt;pre&gt;%11.5f[%#+7.1f%%]&lt;/pre&gt;&lt;/td&gt;\n&quot;</span>, 
					bgcolor, b, percentage);
			}
			
			<span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (b &lt; 0) 
				printf(<span class="enscript-string">&quot;&lt;td bgcolor=\&quot;#ff0000\&quot;&gt;%s&lt;/td&gt;\n&quot;</span>, <span class="enscript-string">&quot;ERRORS&quot;</span>);
			<span class="enscript-keyword">else</span>
				printf(<span class="enscript-string">&quot;&lt;td&gt;%25s&lt;/td&gt;\n&quot;</span>, <span class="enscript-string">&quot;missing&quot;</span>);
			
		}
		printf(<span class="enscript-string">&quot;&lt;/tr&gt;\n&quot;</span>);

	}
	printf(<span class="enscript-string">&quot;&lt;/tbody&gt;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;\n&quot;</span>);

} 

function colormap(value, bgcolor, r, g, b) 
{	
	<span class="enscript-keyword">if</span> (value &lt;= .2)
		value = .2;
	<span class="enscript-keyword">if</span> (value &gt; 5)
		value = 5;

	<span class="enscript-keyword">if</span> (value &lt; .9) {
		r = colorcalc(.2, value, .9, 0, 255);
		g = colorcalc(.2, value, .9, 153, 255);
		b = colorcalc(.2, value, .9, 0, 255);
		bgcolor=sprintf(<span class="enscript-string">&quot;#%2.2x%2.2x%2.2x&quot;</span>,  r, g, b);
	}
	<span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (value &lt; 1.1)
		bgcolor=<span class="enscript-string">&quot;#ffffff&quot;</span>;
	<span class="enscript-keyword">else</span> {
		r = 255;
		g = colorcalc(1.1, value, 5, 255, 0);
		b = colorcalc(1.1, value, 5, 255, 0);
		bgcolor=sprintf(<span class="enscript-string">&quot;#%2.2x%2.2x%2.2x&quot;</span>,  r, g, b);
	}

	<span class="enscript-keyword">return</span> (bgcolor);
}

function colorcalc(min, value, max, mincolor, maxcolor)
{
        <span class="enscript-keyword">return</span>((value - min)/(max-min) * (maxcolor-mincolor) + mincolor);
}

' <span class="enscript-string">&quot;$@&quot;</span>


</pre>
<hr />
</body></html>