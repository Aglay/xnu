<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>device_tree.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">device_tree.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>

<span class="enscript-comment">/*
 * Copyright (c) 2000 Apple Computer, Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_PEXPERT_DEVICE_TREE_H_</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_PEXPERT_DEVICE_TREE_H_</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/appleapiopts.h&gt;</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__APPLE_API_PRIVATE</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__cplusplus</span>
<span class="enscript-type">extern</span> <span class="enscript-string">&quot;C&quot;</span> {
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*
-------------------------------------------------------------------------------
 Foundation Types
-------------------------------------------------------------------------------
*/</span>
<span class="enscript-type">enum</span> {
	kDTPathNameSeparator	= <span class="enscript-string">'/'</span>				<span class="enscript-comment">/* 0x2F */</span>
};


<span class="enscript-comment">/* Property Name Definitions (Property Names are C-Strings)*/</span>
<span class="enscript-type">enum</span> {
	kDTMaxPropertyNameLength=31	<span class="enscript-comment">/* Max length of Property Name (terminator not included) */</span>
};

<span class="enscript-type">typedef</span> <span class="enscript-type">char</span> DTPropertyNameBuf[32];


<span class="enscript-comment">/* Entry Name Definitions (Entry Names are C-Strings)*/</span>
<span class="enscript-type">enum</span> {
	kDTMaxEntryNameLength		= 63	<span class="enscript-comment">/* Max length of a C-String Entry Name (terminator not included) */</span>
};

<span class="enscript-comment">/* length of DTEntryNameBuf = kDTMaxEntryNameLength +1*/</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">char</span> DTEntryNameBuf[kDTMaxEntryNameLength+1];


<span class="enscript-comment">/* Entry*/</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> OpaqueDTEntry* DTEntry;

<span class="enscript-comment">/* Entry Iterator*/</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> OpaqueDTEntryIterator* DTEntryIterator;

<span class="enscript-comment">/* Property Iterator*/</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> OpaqueDTPropertyIterator* DTPropertyIterator;


<span class="enscript-comment">/* status values*/</span>
<span class="enscript-type">enum</span> {
		kError = -1,
		kIterationDone = 0,
		kSuccess = 1
};

<span class="enscript-comment">/*

Structures for a Flattened Device Tree
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kPropNameLength</span>	32

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> DeviceTreeNodeProperty {
    <span class="enscript-type">char</span>		name[kPropNameLength];	<span class="enscript-comment">// NUL terminated property name
</span>    uint32_t		length;		<span class="enscript-comment">// Length (bytes) of folloing prop value
</span><span class="enscript-comment">//  unsigned long	value[1];	// Variable length value of property
</span>					<span class="enscript-comment">// Padded to a multiple of a longword?
</span>} DeviceTreeNodeProperty;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> OpaqueDTEntry {
    uint32_t		nProperties;	<span class="enscript-comment">// Number of props[] elements (0 =&gt; end)
</span>    uint32_t		nChildren;	<span class="enscript-comment">// Number of children[] elements
</span><span class="enscript-comment">//  DeviceTreeNodeProperty	props[];// array size == nProperties
</span><span class="enscript-comment">//  DeviceTreeNode	children[];	// array size == nChildren
</span>} DeviceTreeNode;


#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">__MWERKS__</span>
<span class="enscript-comment">/*
-------------------------------------------------------------------------------
 Device Tree Calls
-------------------------------------------------------------------------------
*/</span>

<span class="enscript-comment">/* Used to initalize the device tree functions. */</span>
<span class="enscript-comment">/* base is the base address of the flatened device tree */</span>
<span class="enscript-type">void</span> <span class="enscript-function-name">DTInit</span>(<span class="enscript-type">void</span> *base);

<span class="enscript-comment">/*
-------------------------------------------------------------------------------
 Entry Handling
-------------------------------------------------------------------------------
*/</span>
<span class="enscript-comment">/* Compare two Entry's for equality. */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">DTEntryIsEqual</span>(<span class="enscript-type">const</span> DTEntry ref1, <span class="enscript-type">const</span> DTEntry ref2);

<span class="enscript-comment">/*
-------------------------------------------------------------------------------
 LookUp Entry by Name
-------------------------------------------------------------------------------
*/</span>
<span class="enscript-comment">/*
 DTFindEntry:
 Find the device tree entry that contains propName=propValue.
 It currently  searches the entire
 tree.  This function should eventually go in DeviceTree.c.
 Returns:    kSuccess = entry was found.  Entry is in entryH.
             kError   = entry was not found
*/</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">DTFindEntry</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *propName, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *propValue, DTEntry *entryH);

<span class="enscript-comment">/*
 Lookup Entry
 Locates an entry given a specified subroot (searchPoint) and path name.  If the
 searchPoint pointer is NULL, the path name is assumed to be an absolute path
 name rooted to the root of the device tree.
*/</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">DTLookupEntry</span>(<span class="enscript-type">const</span> DTEntry searchPoint, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *pathName, DTEntry *foundEntry);

<span class="enscript-comment">/*
-------------------------------------------------------------------------------
 Entry Iteration
-------------------------------------------------------------------------------
*/</span>
<span class="enscript-comment">/*
 An Entry Iterator maintains three variables that are of interest to clients.
 First is an &quot;OutermostScope&quot; which defines the outer boundry of the iteration.
 This is defined by the starting entry and includes that entry plus all of it's
 embedded entries. Second is a &quot;currentScope&quot; which is the entry the iterator is
 currently in. And third is a &quot;currentPosition&quot; which is the last entry returned
 during an iteration.

 Create Entry Iterator
 Create the iterator structure. The outermostScope and currentScope of the iterator
 are set to &quot;startEntry&quot;.  If &quot;startEntry&quot; = NULL, the outermostScope and
 currentScope are set to the root entry.  The currentPosition for the iterator is
 set to &quot;nil&quot;.
*/</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">DTCreateEntryIterator</span>(<span class="enscript-type">const</span> DTEntry startEntry, DTEntryIterator *iterator);

<span class="enscript-comment">/* Dispose Entry Iterator*/</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">DTDisposeEntryIterator</span>(DTEntryIterator iterator);

<span class="enscript-comment">/*
 Enter Child Entry
 Move an Entry Iterator into the scope of a specified child entry.  The
 currentScope of the iterator is set to the entry specified in &quot;childEntry&quot;.  If
 &quot;childEntry&quot; is nil, the currentScope is set to the entry specified by the
 currentPosition of the iterator.
*/</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">DTEnterEntry</span>(DTEntryIterator iterator, DTEntry childEntry);

<span class="enscript-comment">/*
 Exit to Parent Entry
 Move an Entry Iterator out of the current entry back into the scope of it's parent
 entry. The currentPosition of the iterator is reset to the current entry (the
 previous currentScope), so the next iteration call will continue where it left off.
 This position is returned in parameter &quot;currentPosition&quot;.
*/</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">DTExitEntry</span>(DTEntryIterator iterator, DTEntry *currentPosition);

<span class="enscript-comment">/*
 Iterate Entries 
 Iterate and return entries contained within the entry defined by the current
 scope of the iterator.  Entries are returned one at a time. When
 int == kIterationDone, all entries have been exhausted, and the
 value of nextEntry will be Nil. 
*/</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">DTIterateEntries</span>(DTEntryIterator iterator, DTEntry *nextEntry);

<span class="enscript-comment">/*
 Restart Entry Iteration
 Restart an iteration within the current scope.  The iterator is reset such that
 iteration of the contents of the currentScope entry can be restarted. The
 outermostScope and currentScope of the iterator are unchanged. The currentPosition
 for the iterator is set to &quot;nil&quot;.
*/</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">DTRestartEntryIteration</span>(DTEntryIterator iterator);

<span class="enscript-comment">/*
-------------------------------------------------------------------------------
 Get Property Values
-------------------------------------------------------------------------------
*/</span>
<span class="enscript-comment">/*
 Get the value of the specified property for the specified entry.  

 Get Property
*/</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">DTGetProperty</span>(<span class="enscript-type">const</span> DTEntry entry, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *propertyName, <span class="enscript-type">void</span> **propertyValue, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> *propertySize);

<span class="enscript-comment">/*
-------------------------------------------------------------------------------
 Iterating Properties
-------------------------------------------------------------------------------
*/</span>
<span class="enscript-comment">/*
 Create Property Iterator
 Create the property iterator structure. The target entry is defined by entry.
*/</span>

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">DTCreatePropertyIterator</span>(<span class="enscript-type">const</span> DTEntry entry,
					DTPropertyIterator *iterator);

<span class="enscript-comment">/* Dispose Property Iterator*/</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">DTDisposePropertyIterator</span>(DTPropertyIterator iterator);

<span class="enscript-comment">/*
 Iterate Properites
 Iterate and return properties for given entry.  
 When int == kIterationDone, all properties have been exhausted.
*/</span>

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">DTIterateProperties</span>(DTPropertyIterator iterator,
						<span class="enscript-type">char</span> **foundProperty);

<span class="enscript-comment">/*
 Restart Property Iteration
 Used to re-iterate over a list of properties.  The Property Iterator is
 reset to the beginning of the list of properties for an entry.
*/</span>

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">DTRestartPropertyIteration</span>(DTPropertyIterator iterator);

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__cplusplus</span>
}
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* __MWERKS__ */</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* __APPLE_API_PRIVATE */</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* _PEXPERT_DEVICE_TREE_H_ */</span>
</pre>
<hr />
</body></html>