<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>mld6_var.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">mld6_var.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000-2012 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>

<span class="enscript-comment">/*	$FreeBSD: src/sys/netinet6/mld6_var.h,v 1.1.2.1 2000/07/15 07:14:36 kris Exp $	*/</span>
<span class="enscript-comment">/*	$KAME: mld6_var.h,v 1.4 2000/03/25 07:23:54 sumikawa Exp $	*/</span>

<span class="enscript-comment">/*
 * Copyright (C) 1998 WIDE Project.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the project nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE PROJECT AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE PROJECT OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_NETINET6_MLD6_VAR_H_</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_NETINET6_MLD6_VAR_H_</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/appleapiopts.h&gt;</span>

<span class="enscript-comment">/*
 * Multicast Listener Discovery (MLD)
 * implementation-specific definitions.
 */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
<span class="enscript-comment">/*
 * Per-link MLD state.
 */</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
<span class="enscript-type">struct</span> mld_ifinfo {
#<span class="enscript-reference">else</span>
<span class="enscript-type">struct</span> mld_ifinfo_u {
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>
	uint32_t mli_ifindex;	<span class="enscript-comment">/* interface this instance belongs to */</span>
	uint32_t mli_version;	<span class="enscript-comment">/* MLDv1 Host Compatibility Mode */</span>
	uint32_t mli_v1_timer;	<span class="enscript-comment">/* MLDv1 Querier Present timer (s) */</span>
	uint32_t mli_v2_timer;	<span class="enscript-comment">/* MLDv2 General Query (interface) timer (s)*/</span>
	uint32_t mli_flags;	<span class="enscript-comment">/* MLD per-interface flags */</span>
	uint32_t mli_rv;	<span class="enscript-comment">/* MLDv2 Robustness Variable */</span>
	uint32_t mli_qi;	<span class="enscript-comment">/* MLDv2 Query Interval (s) */</span>
	uint32_t mli_qri;	<span class="enscript-comment">/* MLDv2 Query Response Interval (s) */</span>
	uint32_t mli_uri;	<span class="enscript-comment">/* MLDv2 Unsolicited Report Interval (s) */</span>
	uint32_t _pad;
};

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLIF_SILENT</span>	0x00000001	<span class="enscript-comment">/* Do not use MLD on this ifp */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLIF_USEALLOW</span>	0x00000002	<span class="enscript-comment">/* Use ALLOW/BLOCK for joins/leaves */</span>

<span class="enscript-comment">/*
 * MLD version tag.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_VERSION_NONE</span>		0 <span class="enscript-comment">/* Invalid */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_VERSION_1</span>			1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_VERSION_2</span>			2 <span class="enscript-comment">/* Default */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/syslog.h&gt;</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_DEBUG</span> 1
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">MLD_DEBUG</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> mld_debug;
#<span class="enscript-reference">define</span> <span class="enscript-function-name">MLD_PRINTF</span>(x)	do { if (mld_debug) printf x; } while (0)
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MLD_PRINTF</span>(x)
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">MLD_RANDOM_DELAY</span>(X)		(RandomULong() % (X) + 1)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_MAX_STATE_CHANGES</span>		24 <span class="enscript-comment">/* Max pending changes per group */</span>

<span class="enscript-comment">/*
 * MLD per-group states.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_NOT_MEMBER</span>			0 <span class="enscript-comment">/* Can garbage collect group */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_SILENT_MEMBER</span>		1 <span class="enscript-comment">/* Do not perform MLD for group */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_REPORTING_MEMBER</span>		2 <span class="enscript-comment">/* MLDv1 we are reporter */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_IDLE_MEMBER</span>			3 <span class="enscript-comment">/* MLDv1 we reported last */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_LAZY_MEMBER</span>			4 <span class="enscript-comment">/* MLDv1 other member reporting */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_SLEEPING_MEMBER</span>		5 <span class="enscript-comment">/* MLDv1 start query response */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_AWAKENING_MEMBER</span>		6 <span class="enscript-comment">/* MLDv1 group timer will start */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_G_QUERY_PENDING_MEMBER</span>	7 <span class="enscript-comment">/* MLDv2 group query pending */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_SG_QUERY_PENDING_MEMBER</span>	8 <span class="enscript-comment">/* MLDv2 source query pending */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_LEAVING_MEMBER</span>		9 <span class="enscript-comment">/* MLDv2 dying gasp (pending last */</span>
					  <span class="enscript-comment">/* retransmission of INCLUDE {}) */</span>
<span class="enscript-comment">/*
 * MLDv2 protocol control variables.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_RV_INIT</span>		2	<span class="enscript-comment">/* Robustness Variable */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_RV_MIN</span>		1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_RV_MAX</span>		7

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_QI_INIT</span>		125	<span class="enscript-comment">/* Query Interval (s) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_QI_MIN</span>		1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_QI_MAX</span>		255

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_QRI_INIT</span>		10	<span class="enscript-comment">/* Query Response Interval (s) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_QRI_MIN</span>		1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_QRI_MAX</span>		255

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_URI_INIT</span>		3	<span class="enscript-comment">/* Unsolicited Report Interval (s) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_URI_MIN</span>		0
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_URI_MAX</span>		10

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_MAX_GS_SOURCES</span>		256 <span class="enscript-comment">/* # of sources in rx GS query */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_MAX_G_GS_PACKETS</span>		8 <span class="enscript-comment">/* # of packets to answer G/GS */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_MAX_STATE_CHANGE_PACKETS</span>	8 <span class="enscript-comment">/* # of packets per state change */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_MAX_RESPONSE_PACKETS</span>	16 <span class="enscript-comment">/* # of packets for general query */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_MAX_RESPONSE_BURST</span>		4 <span class="enscript-comment">/* # of responses to send at once */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MLD_RESPONSE_BURST_INTERVAL</span>	1 <span class="enscript-comment">/* 1 second */</span>

<span class="enscript-comment">/*
 * MLD-specific mbuf flags.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">M_MLDV1</span>		M_PROTO1	<span class="enscript-comment">/* Packet is MLDv1 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">M_GROUPREC</span>	M_PROTO3	<span class="enscript-comment">/* mbuf chain is a group record */</span>

<span class="enscript-comment">/*
 * Leading space for MLDv2 reports inside MTU.
 *
 * NOTE: This differs from IGMPv3 significantly. KAME IPv6 requires
 * that a fully formed mbuf chain *without* the Router Alert option
 * is passed to ip6_output(), however we must account for it in the
 * MTU if we need to split an MLDv2 report into several packets.
 *
 * We now put the MLDv2 report header in the initial mbuf containing
 * the IPv6 header.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MLD_MTUSPACE</span>	(sizeof(struct ip6_hdr) + sizeof(struct mld_raopt) + \
			 <span class="enscript-keyword">sizeof</span>(<span class="enscript-type">struct</span> icmp6_hdr))

<span class="enscript-type">struct</span> mld_ifinfo {
	decl_lck_mtx_data(, mli_lock);
	uint32_t mli_refcnt;	<span class="enscript-comment">/* reference count */</span>
	uint32_t mli_debug;	<span class="enscript-comment">/* see ifa_debug flags */</span>
	LIST_ENTRY(mld_ifinfo) mli_link;
	<span class="enscript-type">struct</span> ifnet *mli_ifp;	<span class="enscript-comment">/* interface this instance belongs to */</span>
	uint32_t mli_version;	<span class="enscript-comment">/* MLDv1 Host Compatibility Mode */</span>
	uint32_t mli_v1_timer;	<span class="enscript-comment">/* MLDv1 Querier Present timer (s) */</span>
	uint32_t mli_v2_timer;	<span class="enscript-comment">/* MLDv2 General Query (interface) timer (s)*/</span>
	uint32_t mli_flags;	<span class="enscript-comment">/* MLD per-interface flags */</span>
	uint32_t mli_rv;	<span class="enscript-comment">/* MLDv2 Robustness Variable */</span>
	uint32_t mli_qi;	<span class="enscript-comment">/* MLDv2 Query Interval (s) */</span>
	uint32_t mli_qri;	<span class="enscript-comment">/* MLDv2 Query Response Interval (s) */</span>
	uint32_t mli_uri;	<span class="enscript-comment">/* MLDv2 Unsolicited Report Interval (s) */</span>
	SLIST_HEAD(,in6_multi)	mli_relinmhead; <span class="enscript-comment">/* released groups */</span>
	<span class="enscript-type">struct</span> ifqueue	 mli_gq;	<span class="enscript-comment">/* queue of general query responses */</span>
	<span class="enscript-type">struct</span> ifqueue   mli_v1q; <span class="enscript-comment">/* MLDv1 message queue */</span>
};

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MLI_LOCK_ASSERT_HELD</span>(_mli)					\
	lck_mtx_assert(&amp;(_mli)-&gt;mli_lock, LCK_MTX_ASSERT_OWNED)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MLI_LOCK_ASSERT_NOTHELD</span>(_mli)					\
	lck_mtx_assert(&amp;(_mli)-&gt;mli_lock, LCK_MTX_ASSERT_NOTOWNED)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MLI_LOCK</span>(_mli)							\
	lck_mtx_lock(&amp;(_mli)-&gt;mli_lock)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MLI_LOCK_SPIN</span>(_mli)						\
	lck_mtx_lock_spin(&amp;(_mli)-&gt;mli_lock)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MLI_CONVERT_LOCK</span>(_mli) do {					\
	MLI_LOCK_ASSERT_HELD(_mli);					\
	lck_mtx_convert_spin(&amp;(_mli)-&gt;mli_lock);			\
} <span class="enscript-keyword">while</span> (0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MLI_UNLOCK</span>(_mli)						\
	lck_mtx_unlock(&amp;(_mli)-&gt;mli_lock)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MLI_ADDREF</span>(_mli)						\
	mli_addref(_mli, 0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MLI_ADDREF_LOCKED</span>(_mli)						\
	mli_addref(_mli, 1)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MLI_REMREF</span>(_mli)						\
	mli_remref(_mli)

<span class="enscript-comment">/*
 * Per-link MLD context.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">MLD_IFINFO</span>(ifp)	((ifp)-&gt;if_mli)

<span class="enscript-comment">/*
 * MLD timer schedule parameters
 */</span>
<span class="enscript-type">struct</span> mld_tparams {
	<span class="enscript-type">int</span>	qpt;	<span class="enscript-comment">/* querier_present_timers_running6 */</span>
	<span class="enscript-type">int</span>	it;	<span class="enscript-comment">/* interface_timers_running6 */</span>
	<span class="enscript-type">int</span>	cst;	<span class="enscript-comment">/* current_state_timers_running6 */</span>
	<span class="enscript-type">int</span>	sct;	<span class="enscript-comment">/* state_change_timers_running6 */</span>
};

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">mld_change_state</span>(<span class="enscript-type">struct</span> in6_multi *, <span class="enscript-type">struct</span> mld_tparams *,
    <span class="enscript-type">const</span> <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> mld_ifinfo *<span class="enscript-function-name">mld_domifattach</span>(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">mld_domifreattach</span>(<span class="enscript-type">struct</span> mld_ifinfo *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">mld_domifdetach</span>(<span class="enscript-type">struct</span> ifnet *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">mld_fasttimo</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">mld_ifdetach</span>(<span class="enscript-type">struct</span> ifnet *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">mld_input</span>(<span class="enscript-type">struct</span> mbuf *, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">mld_init</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">mld_set_timeout</span>(<span class="enscript-type">struct</span> mld_tparams *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">mli_addref</span>(<span class="enscript-type">struct</span> mld_ifinfo *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">mli_remref</span>(<span class="enscript-type">struct</span> mld_ifinfo *);
__private_extern__ <span class="enscript-type">void</span> mld6_initsilent(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">struct</span> mld_ifinfo *);

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">SYSCTL_DECL</span>
<span class="enscript-function-name">SYSCTL_DECL</span>(_net_inet6_mld);
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* _NETINET6_MLD6_VAR_H_ */</span>
</pre>
<hr />
</body></html>