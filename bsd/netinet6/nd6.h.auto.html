<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>nd6.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">nd6.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000-2015 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 *
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 *
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 *
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*
 * Copyright (C) 1995, 1996, 1997, and 1998 WIDE Project.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the project nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE PROJECT AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE PROJECT OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_NETINET6_ND6_H_</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_NETINET6_ND6_H_</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/appleapiopts.h&gt;</span>

<span class="enscript-comment">/* see net/route.h, or net/if_inarp.h */</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">RTF_ANNOUNCE</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_ANNOUNCE</span>	RTF_PROTO2
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/queue.h&gt;</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;net/flowadv.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;kern/locks.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/tree.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;netinet6/nd6_var.h&gt;</span>

<span class="enscript-type">struct</span>	llinfo_nd6 {
	<span class="enscript-comment">/*
	 * The following are protected by rnh_lock
	 */</span>
	<span class="enscript-type">struct</span>	llinfo_nd6 *ln_next;
	<span class="enscript-type">struct</span>	llinfo_nd6 *ln_prev;
	<span class="enscript-type">struct</span>	rtentry *ln_rt;
	<span class="enscript-comment">/*
	 * The following are protected by rt_lock
	 */</span>
	<span class="enscript-type">struct</span> ifnet *ln_exclifp; <span class="enscript-comment">/* excluded interface (prefix proxy) */</span>
	<span class="enscript-type">struct</span>	mbuf *ln_hold;	<span class="enscript-comment">/* last packet until resolved/timeout */</span>
	uint32_t ln_asked;	<span class="enscript-comment">/* # of queries already sent for this addr */</span>
	<span class="enscript-type">short</span>	ln_state;	<span class="enscript-comment">/* reachability state */</span>
	<span class="enscript-type">short</span>	ln_router;	<span class="enscript-comment">/* 2^0: ND6 router bit */</span>
	u_int32_t ln_flags;	<span class="enscript-comment">/* flags; see below */</span>
	u_int64_t ln_expire;	<span class="enscript-comment">/* lifetime for NDP state transition */</span>
	u_int64_t ln_lastused;	<span class="enscript-comment">/* last used timestamp */</span>
	<span class="enscript-type">struct</span>	if_llreach *ln_llreach;	<span class="enscript-comment">/* link-layer reachability record */</span>
};

<span class="enscript-comment">/* Values for ln_flags */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_LNF_TIMER_SKIP</span>	0x1	<span class="enscript-comment">/* modified by nd6_timer() */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_LNF_IN_USE</span>		0x2	<span class="enscript-comment">/* currently in llinfo_nd6 list */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_LLINFO_PURGE</span>	-3
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_LLINFO_NOSTATE</span>	-2
<span class="enscript-comment">/*
 * We don't need the WAITDELETE state any more, but we keep the definition
 * in a comment line instead of removing it. This is necessary to avoid
 * unintentionally reusing the value for another purpose, which might
 * affect backward compatibility with old applications.
 * (20000711 <a href="mailto:jinmei@kame.net">jinmei@kame.net</a>)
 */</span>
<span class="enscript-comment">/* #define	ND6_LLINFO_WAITDELETE	-1 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_LLINFO_INCOMPLETE</span>	0
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_LLINFO_REACHABLE</span>	1
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_LLINFO_STALE</span>	2
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_LLINFO_DELAY</span>	3
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_LLINFO_PROBE</span>	4

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">ND6_IS_LLINFO_PROBREACH</span>(n) ((n)-&gt;ln_state &gt; ND6_LLINFO_INCOMPLETE)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">ND6_LLINFO_PERMANENT</span>(n) \
	(((n)-&gt;ln_expire == 0) &amp;&amp; ((n)-&gt;ln_state &gt; ND6_LLINFO_INCOMPLETE))

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_EUI64_GBIT</span>	0x01
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_EUI64_UBIT</span>	0x02

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">ND6_EUI64_TO_IFID</span>(in6) \
	<span class="enscript-keyword">do</span> {(in6)-&gt;s6_addr[8] ^= ND6_EUI64_UBIT; } <span class="enscript-keyword">while</span> (0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">ND6_EUI64_GROUP</span>(in6)		((in6)-&gt;s6_addr[8] &amp; ND6_EUI64_GBIT)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">ND6_EUI64_INDIVIDUAL</span>(in6)	(!ND6_EUI64_GROUP(in6))
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">ND6_EUI64_LOCAL</span>(in6)		((in6)-&gt;s6_addr[8] &amp; ND6_EUI64_UBIT)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">ND6_EUI64_UNIVERSAL</span>(in6)	(!ND6_EUI64_LOCAL(in6))
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">ND6_IFID_LOCAL</span>(in6)		(!ND6_EUI64_LOCAL(in6))
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">ND6_IFID_UNIVERSAL</span>(in6)		(!ND6_EUI64_UNIVERSAL(in6))
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>)
<span class="enscript-type">struct</span> nd_ifinfo {
#<span class="enscript-reference">else</span>
<span class="enscript-comment">/* For binary compatibility, this structure must not change */</span>
<span class="enscript-comment">/* NOTE: nd_ifinfo is defined in nd6_var.h */</span>
<span class="enscript-type">struct</span> nd_ifinfo_compat {
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !BSD_KERNEL_PRIVATE */</span>
	u_int32_t linkmtu;		<span class="enscript-comment">/* LinkMTU */</span>
	u_int32_t maxmtu;		<span class="enscript-comment">/* Upper bound of LinkMTU */</span>
	u_int32_t basereachable;	<span class="enscript-comment">/* BaseReachableTime */</span>
	u_int32_t reachable;		<span class="enscript-comment">/* Reachable Time */</span>
	u_int32_t retrans;		<span class="enscript-comment">/* Retrans Timer */</span>
	u_int32_t flags;		<span class="enscript-comment">/* Flags */</span>
	<span class="enscript-type">int</span> recalctm;			<span class="enscript-comment">/* BaseReacable re-calculation timer */</span>
	u_int8_t chlim;			<span class="enscript-comment">/* CurHopLimit */</span>
	u_int8_t receivedra;
	<span class="enscript-comment">/* the following 3 members are for privacy extension for addrconf */</span>
	u_int8_t randomseed0[8]; <span class="enscript-comment">/* upper 64 bits of SHA1 digest */</span>
	u_int8_t randomseed1[8]; <span class="enscript-comment">/* lower 64 bits (usually the EUI64 IFID) */</span>
	u_int8_t randomid[8];	<span class="enscript-comment">/* current random ID */</span>
};

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_IFF_PERFORMNUD</span>		0x1
#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">PRIVATE</span>)

<span class="enscript-comment">/*
 * APPLE: not used. Interface specific router advertisements are handled with a
 * specific ifnet flag: IFEF_ACCEPT_RTADVD
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_IFF_ACCEPT_RTADV</span>		0x2

<span class="enscript-comment">/* APPLE: NOT USED not related to ND. */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_IFF_PREFER_SOURCE</span>		0x4

<span class="enscript-comment">/* IPv6 operation is disabled due to * DAD failure.  (XXX: not ND-specific) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_IFF_IFDISABLED</span>		0x8

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_IFF_DONT_SET_IFROUTE</span>	0x10 <span class="enscript-comment">/* NOT USED */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_IFF_PROXY_PREFIXES</span>		0x20
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_IFF_IGNORE_NA</span>		0x40
#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">PRIVATE</span>)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_IFF_INSECURE</span>		0x80
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_IFF_REPLICATED</span>		0x100	<span class="enscript-comment">/* sleep proxy registered */</span>

<span class="enscript-type">struct</span> in6_nbrinfo {
	<span class="enscript-type">char</span> ifname[IFNAMSIZ];	<span class="enscript-comment">/* if name, e.g. &quot;en0&quot; */</span>
	<span class="enscript-type">struct</span> in6_addr addr;	<span class="enscript-comment">/* IPv6 address of the neighbor */</span>
	<span class="enscript-type">long</span>	asked;		<span class="enscript-comment">/* # of queries already sent for this addr */</span>
	<span class="enscript-type">int</span>	isrouter;	<span class="enscript-comment">/* if it acts as a router */</span>
	<span class="enscript-type">int</span>	state;		<span class="enscript-comment">/* reachability state */</span>
	<span class="enscript-type">int</span>	expire;		<span class="enscript-comment">/* lifetime for NDP state transition */</span>
};

#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>)
<span class="enscript-type">struct</span> in6_nbrinfo_32 {
	<span class="enscript-type">char</span> ifname[IFNAMSIZ];
	<span class="enscript-type">struct</span> in6_addr addr;
	u_int32_t asked;
	<span class="enscript-type">int</span>	isrouter;
	<span class="enscript-type">int</span>	state;
	<span class="enscript-type">int</span>	expire;
};

<span class="enscript-type">struct</span> in6_nbrinfo_64 {
	<span class="enscript-type">char</span> ifname[IFNAMSIZ];
	<span class="enscript-type">struct</span> in6_addr addr;
	<span class="enscript-type">long</span>	asked;
	<span class="enscript-type">int</span>	isrouter	__attribute__((aligned(8)));
	<span class="enscript-type">int</span>	state;
	<span class="enscript-type">int</span>	expire;
} __attribute__((aligned(8)));
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">DRLSTSIZ</span> 10
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PRLSTSIZ</span> 10

<span class="enscript-type">struct</span>	in6_drlist {
	<span class="enscript-type">char</span> ifname[IFNAMSIZ];
	<span class="enscript-type">struct</span> {
		<span class="enscript-type">struct</span>	in6_addr rtaddr;
		u_char	flags;
		u_short	rtlifetime;
		u_long	expire;
		u_short if_index;
	} defrouter[DRLSTSIZ];
};

#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>)
<span class="enscript-type">struct</span>	in6_drlist_32 {
	<span class="enscript-type">char</span> ifname[IFNAMSIZ];
	<span class="enscript-type">struct</span> {
		<span class="enscript-type">struct</span>	in6_addr rtaddr;
		u_char	flags;
		u_short	rtlifetime;
		u_int32_t expire;
		u_short if_index;
	} defrouter[DRLSTSIZ];
};

<span class="enscript-type">struct</span>	in6_drlist_64 {
	<span class="enscript-type">char</span> ifname[IFNAMSIZ];
	<span class="enscript-type">struct</span> {
		<span class="enscript-type">struct</span>	in6_addr rtaddr;
		u_char	flags;
		u_short	rtlifetime;
		u_long	expire		__attribute__((aligned(8)));
		u_short if_index	__attribute__((aligned(8)));
	} defrouter[DRLSTSIZ] __attribute__((aligned(8)));
};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>

<span class="enscript-comment">/* valid values for stateflags */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NDDRF_INSTALLED</span>	0x1	<span class="enscript-comment">/* installed in the routing table */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NDDRF_IFSCOPE</span>	0x2	<span class="enscript-comment">/* installed as a scoped route */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NDDRF_STATIC</span>	0x4	<span class="enscript-comment">/* for internal use only */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NDDRF_PROCESSED</span>	0x10
#<span class="enscript-reference">endif</span>

<span class="enscript-type">struct</span>	in6_defrouter {
	<span class="enscript-type">struct</span>	sockaddr_in6 rtaddr;
	u_char	flags;
	u_char	stateflags;
	u_short	rtlifetime;
	u_long	expire;
	u_short if_index;
};

#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>)
<span class="enscript-type">struct</span>	in6_defrouter_32 {
	<span class="enscript-type">struct</span>	sockaddr_in6 rtaddr;
	u_char	flags;
	u_char	stateflags;
	u_short	rtlifetime;
	u_int32_t expire;
	u_short if_index;
};

<span class="enscript-type">struct</span>	in6_defrouter_64 {
	<span class="enscript-type">struct</span>	sockaddr_in6 rtaddr;
	u_char	flags;
	u_char	stateflags;
	u_short	rtlifetime;
	u_long	expire		__attribute__((aligned(8)));
	u_short if_index	__attribute__((aligned(8)));
} __attribute__((aligned(8)));
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>

<span class="enscript-type">struct</span>	in6_prlist {
	<span class="enscript-type">char</span> ifname[IFNAMSIZ];
	<span class="enscript-type">struct</span> {
		<span class="enscript-type">struct</span>	in6_addr prefix;
		<span class="enscript-type">struct</span> prf_ra raflags;
		u_char	prefixlen;
		u_char	origin;
		u_long	vltime;
		u_long	pltime;
		u_long	expire;
		u_short if_index;
		u_short advrtrs; <span class="enscript-comment">/* number of advertisement routers */</span>
		<span class="enscript-type">struct</span>	in6_addr advrtr[DRLSTSIZ]; <span class="enscript-comment">/* XXX: explicit limit */</span>
	} prefix[PRLSTSIZ];
};

#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>)
<span class="enscript-type">struct</span>	in6_prlist_32 {
	<span class="enscript-type">char</span> ifname[IFNAMSIZ];
	<span class="enscript-type">struct</span> {
		<span class="enscript-type">struct</span>	in6_addr prefix;
		<span class="enscript-type">struct</span> prf_ra raflags;
		u_char	prefixlen;
		u_char	origin;
		u_int32_t vltime;
		u_int32_t pltime;
		u_int32_t expire;
		u_short if_index;
		u_short advrtrs;
		<span class="enscript-type">struct</span>	in6_addr advrtr[DRLSTSIZ];
	} prefix[PRLSTSIZ];
};

<span class="enscript-type">struct</span>	in6_prlist_64 {
	<span class="enscript-type">char</span> ifname[IFNAMSIZ];
	<span class="enscript-type">struct</span> {
		<span class="enscript-type">struct</span>	in6_addr prefix;
		<span class="enscript-type">struct</span> prf_ra raflags;
		u_char	prefixlen;
		u_char	origin;
		u_long	vltime	__attribute__((aligned(8)));
		u_long	pltime	__attribute__((aligned(8)));
		u_long	expire	__attribute__((aligned(8)));
		u_short if_index;
		u_short advrtrs;
		u_int32_t pad;
		<span class="enscript-type">struct</span>	in6_addr advrtr[DRLSTSIZ];
	} prefix[PRLSTSIZ];
};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>

<span class="enscript-type">struct</span> in6_prefix {
	<span class="enscript-type">struct</span>	sockaddr_in6 prefix;
	<span class="enscript-type">struct</span> prf_ra raflags;
	u_char	prefixlen;
	u_char	origin;
	u_long	vltime;
	u_long	pltime;
	u_long	expire;
	u_int32_t flags;
	<span class="enscript-type">int</span> refcnt;
	u_short if_index;
	u_short advrtrs; <span class="enscript-comment">/* number of advertisement routers */</span>
	<span class="enscript-comment">/* struct sockaddr_in6 advrtr[] */</span>
};

#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>)
<span class="enscript-type">struct</span> in6_prefix_32 {
	<span class="enscript-type">struct</span>	sockaddr_in6 prefix;
	<span class="enscript-type">struct</span> prf_ra raflags;
	u_char	prefixlen;
	u_char	origin;
	u_int32_t vltime;
	u_int32_t pltime;
	u_int32_t expire;
	u_int32_t flags;
	<span class="enscript-type">int</span> refcnt;
	u_short if_index;
	u_short advrtrs; <span class="enscript-comment">/* number of advertisement routers */</span>
	<span class="enscript-comment">/* struct sockaddr_in6 advrtr[] */</span>
};

<span class="enscript-type">struct</span> in6_prefix_64 {
	<span class="enscript-type">struct</span>	sockaddr_in6 prefix;
	<span class="enscript-type">struct</span> prf_ra raflags;
	u_char	prefixlen;
	u_char	origin;
	u_long	vltime	__attribute__((aligned(8)));
	u_long	pltime	__attribute__((aligned(8)));
	u_long	expire	__attribute__((aligned(8)));
	u_int32_t flags	__attribute__((aligned(8)));
	<span class="enscript-type">int</span> refcnt;
	u_short if_index;
	u_short advrtrs;
	<span class="enscript-comment">/* struct sockaddr_in6 advrtr[] */</span>
};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>

<span class="enscript-type">struct</span>	in6_ondireq {
	<span class="enscript-type">char</span> ifname[IFNAMSIZ];
	<span class="enscript-type">struct</span> {
		u_int32_t linkmtu;	<span class="enscript-comment">/* LinkMTU */</span>
		u_int32_t maxmtu;	<span class="enscript-comment">/* Upper bound of LinkMTU */</span>
		u_int32_t basereachable; <span class="enscript-comment">/* BaseReachableTime */</span>
		u_int32_t reachable;	<span class="enscript-comment">/* Reachable Time */</span>
		u_int32_t retrans;	<span class="enscript-comment">/* Retrans Timer */</span>
		u_int32_t flags;	<span class="enscript-comment">/* Flags */</span>
		<span class="enscript-type">int</span> recalctm;		<span class="enscript-comment">/* BaseReacable re-calculation timer */</span>
		u_int8_t chlim;		<span class="enscript-comment">/* CurHopLimit */</span>
		u_int8_t receivedra;
	} ndi;
};

#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>)
<span class="enscript-type">struct</span>	in6_ndireq {
	<span class="enscript-type">char</span> ifname[IFNAMSIZ];
	<span class="enscript-type">struct</span> nd_ifinfo ndi;
};
#<span class="enscript-reference">else</span>
<span class="enscript-type">struct</span>	in6_ndireq {
	<span class="enscript-type">char</span> ifname[IFNAMSIZ];
	<span class="enscript-type">struct</span> nd_ifinfo_compat ndi;
};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !BSD_KERNEL_PRIVATE */</span>

<span class="enscript-type">struct</span>	in6_ndifreq {
	<span class="enscript-type">char</span> ifname[IFNAMSIZ];
	u_long ifindex;
};

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAX_RTR_SOLICITATION_DELAY</span>	1	<span class="enscript-comment">/* 1sec */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTR_SOLICITATION_INTERVAL</span>	4	<span class="enscript-comment">/* 4sec */</span>

#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>)
<span class="enscript-type">struct</span>	in6_ndifreq_32 {
	<span class="enscript-type">char</span> ifname[IFNAMSIZ];
	u_int32_t ifindex;
};

<span class="enscript-type">struct</span>	in6_ndifreq_64 {
	<span class="enscript-type">char</span> ifname[IFNAMSIZ];
	u_long ifindex	__attribute__((aligned(8)));
};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>

<span class="enscript-comment">/* Prefix status */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NDPRF_ONLINK</span>		0x1
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NDPRF_DETACHED</span>		0x2
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NDPRF_STATIC</span>		0x100
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NDPRF_IFSCOPE</span>		0x1000
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NDPRF_PRPROXY</span>		0x2000
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NDPRF_PROCESSED_ONLINK</span>	0x08000
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NDPRF_PROCESSED_SERVICE</span>	0x10000
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NDPRF_DEFUNCT</span>		0x20000
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/* protocol constants */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAX_RTR_SOLICITATION_DELAY</span>	1	<span class="enscript-comment">/* 1sec */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTR_SOLICITATION_INTERVAL</span>	4	<span class="enscript-comment">/* 4sec */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAX_RTR_SOLICITATIONS</span>		3

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_INFINITE_LIFETIME</span>		0xffffffff
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_MAX_LIFETIME</span>		0x7fffffff

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">ND_IFINFO</span>(ifp)				\
    ((ifp == NULL) ? NULL :			\
     ((IN6_IFEXTRA(ifp) == NULL) ? NULL :	\
      (&amp;IN6_IFEXTRA(ifp)-&gt;nd_ifinfo)))

<span class="enscript-comment">/*
 * In a more readable form, we derive linkmtu based on:
 *
 * if (ifp == NULL)
 *         linkmtu = IPV6_MMTU
 * else if (ND_IFINFO(ifp) == NULL || !ND_IFINFO(ifp)-&gt;initialized)
 *         linkmtu = ifp-&gt;if_mtu;
 * else if (ND_IFINFO(ifp)-&gt;linkmtu &amp;&amp; ND_IFINFO(ifp)-&gt;linkmtu &lt; ifp-&gt;if_mtu)
 *         linkmtu = ND_IFINFO(ifp)-&gt;linkmtu;
 * else if ((ND_IFINFO(ifp)-&gt;maxmtu &amp;&amp; ND_IFINFO(ifp)-&gt;maxmtu &lt; ifp-&gt;if_mtu))
 *         linkmtu = ND_IFINFO(ifp)-&gt;maxmtu;
 * else
 *         linkmtu = ifp-&gt;if_mtu;
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">IN6_LINKMTU</span>(ifp)						      \
	(ifp == NULL ? IPV6_MMTU :					      \
	(ND_IFINFO(ifp) == NULL || !ND_IFINFO(ifp)-&gt;initialized) ?	      \
	(ifp)-&gt;if_mtu :	((ND_IFINFO(ifp)-&gt;linkmtu &amp;&amp;			      \
	ND_IFINFO(ifp)-&gt;linkmtu &lt; (ifp)-&gt;if_mtu) ? ND_IFINFO(ifp)-&gt;linkmtu :  \
	((ND_IFINFO(ifp)-&gt;maxmtu &amp;&amp; ND_IFINFO(ifp)-&gt;maxmtu &lt; (ifp)-&gt;if_mtu) ? \
	ND_IFINFO(ifp)-&gt;maxmtu : (ifp)-&gt;if_mtu)))

<span class="enscript-comment">/* node constants */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAX_REACHABLE_TIME</span>		3600000	<span class="enscript-comment">/* msec */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">REACHABLE_TIME</span>			30000	<span class="enscript-comment">/* msec */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RETRANS_TIMER</span>			1000	<span class="enscript-comment">/* msec */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MIN_RANDOM_FACTOR</span>		512	<span class="enscript-comment">/* 1024 * 0.5 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAX_RANDOM_FACTOR</span>		1536	<span class="enscript-comment">/* 1024 * 1.5 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">DEF_TEMP_VALID_LIFETIME</span>		604800	<span class="enscript-comment">/* 1 week */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">DEF_TEMP_PREFERRED_LIFETIME</span>	86400	<span class="enscript-comment">/* 1 day */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TEMPADDR_REGEN_ADVANCE</span>		5	<span class="enscript-comment">/* sec */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAX_TEMP_DESYNC_FACTOR</span>		600	<span class="enscript-comment">/* 10 min */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">ND_COMPUTE_RTIME</span>(x) \
		(((MIN_RANDOM_FACTOR * (x &gt;&gt; 10)) + (RandomULong() &amp; \
		((MAX_RANDOM_FACTOR - MIN_RANDOM_FACTOR) * (x &gt;&gt; 10)))) /1000)

<span class="enscript-comment">/* prefix expiry times */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_PREFIX_EXPIRY_UNSPEC</span>	-1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">ND6_PREFIX_EXPIRY_NEVER</span>		0

<span class="enscript-function-name">TAILQ_HEAD</span>(nd_drhead, nd_defrouter);
<span class="enscript-type">struct</span>	nd_defrouter {
	decl_lck_mtx_data(, nddr_lock);
	TAILQ_ENTRY(nd_defrouter) dr_entry;
	<span class="enscript-type">struct</span> in6_addr	rtaddr;
	u_int32_t	nddr_refcount;
	u_int32_t	nddr_debug;
	u_int64_t	expire;
	u_int64_t	base_calendartime;	<span class="enscript-comment">/* calendar time at creation */</span>
	u_int64_t	base_uptime;		<span class="enscript-comment">/* uptime at creation */</span>
	u_char		flags;			<span class="enscript-comment">/* flags on RA message */</span>
	u_char		stateflags;
	u_short		rtlifetime;
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	genid;
	<span class="enscript-type">int</span>		err;
	<span class="enscript-type">struct</span> ifnet	*ifp;
	<span class="enscript-type">void</span> (*nddr_trace)(<span class="enscript-type">struct</span> nd_defrouter *, <span class="enscript-type">int</span>); <span class="enscript-comment">/* trace callback fn */</span>
};

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDDR_LOCK_ASSERT_HELD</span>(_nddr)					\
	lck_mtx_assert(&amp;(_nddr)-&gt;nddr_lock, LCK_MTX_ASSERT_OWNED)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDDR_LOCK_ASSERT_NOTHELD</span>(_nddr)					\
	lck_mtx_assert(&amp;(_nddr)-&gt;nddr_lock, LCK_MTX_ASSERT_NOTOWNED)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDDR_LOCK</span>(_nddr)						\
	lck_mtx_lock(&amp;(_nddr)-&gt;nddr_lock)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDDR_LOCK_SPIN</span>(_nddr)						\
	lck_mtx_lock_spin(&amp;(_nddr)-&gt;nddr_lock)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDDR_CONVERT_LOCK</span>(_nddr) do {					\
	NDPR_LOCK_ASSERT_HELD(_nddr);					\
	lck_mtx_convert_spin(&amp;(_nddr)-&gt;nddr_lock);			\
} <span class="enscript-keyword">while</span> (0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDDR_UNLOCK</span>(_nddr)						\
	lck_mtx_unlock(&amp;(_nddr)-&gt;nddr_lock)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDDR_ADDREF</span>(_nddr)						\
	nddr_addref(_nddr, 0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDDR_ADDREF_LOCKED</span>(_nddr)					\
	nddr_addref(_nddr, 1)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDDR_REMREF</span>(_nddr) do {						\
	(<span class="enscript-type">void</span>) nddr_remref(_nddr, 0);					\
} <span class="enscript-keyword">while</span> (0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDDR_REMREF_LOCKED</span>(_nddr)					\
	nddr_remref(_nddr, 1)

<span class="enscript-comment">/* define struct prproxy_sols_tree */</span>
<span class="enscript-function-name">RB_HEAD</span>(prproxy_sols_tree, nd6_prproxy_soltgt);

<span class="enscript-type">struct</span> nd_prefix {
	decl_lck_mtx_data(, ndpr_lock);
	u_int32_t	ndpr_refcount;	<span class="enscript-comment">/* reference count */</span>
	u_int32_t	ndpr_debug;	<span class="enscript-comment">/* see ifa_debug flags */</span>
	<span class="enscript-type">struct</span> ifnet	 *ndpr_ifp;
	<span class="enscript-type">struct</span> rtentry	 *ndpr_rt;
	LIST_ENTRY(nd_prefix) ndpr_entry;
	<span class="enscript-type">struct</span> sockaddr_in6 ndpr_prefix; <span class="enscript-comment">/* prefix */</span>
	<span class="enscript-type">struct</span> in6_addr ndpr_mask; <span class="enscript-comment">/* netmask derived from the prefix */</span>
	<span class="enscript-type">struct</span> in6_addr ndpr_addr; <span class="enscript-comment">/* address that is derived from the prefix */</span>
	u_int32_t	ndpr_vltime;	<span class="enscript-comment">/* advertised valid lifetime */</span>
	u_int32_t	ndpr_pltime;	<span class="enscript-comment">/* advertised preferred lifetime */</span>
	u_int64_t	ndpr_preferred; <span class="enscript-comment">/* preferred time of the prefix */</span>
	u_int64_t	ndpr_expire;	<span class="enscript-comment">/* expiration time of the prefix */</span>
	u_int64_t	ndpr_lastupdate; <span class="enscript-comment">/* rx time of last advertisement */</span>
	u_int64_t	ndpr_base_calendartime;	<span class="enscript-comment">/* calendar time at creation */</span>
	u_int64_t	ndpr_base_uptime;	<span class="enscript-comment">/* uptime at creation */</span>
	<span class="enscript-type">struct</span> prf_ra	ndpr_flags;
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	ndpr_genid;	<span class="enscript-comment">/* protects ndpr_advrtrs */</span>
	u_int32_t	ndpr_stateflags; <span class="enscript-comment">/* actual state flags */</span>
	<span class="enscript-comment">/* list of routers that advertise the prefix: */</span>
	LIST_HEAD(pr_rtrhead, nd_pfxrouter) ndpr_advrtrs;
	u_char		ndpr_plen;
	<span class="enscript-type">int</span>		ndpr_addrcnt;	<span class="enscript-comment">/* reference counter from addresses */</span>
	u_int32_t	ndpr_allmulti_cnt;	<span class="enscript-comment">/* total all-multi reqs */</span>
	u_int32_t	ndpr_prproxy_sols_cnt;	<span class="enscript-comment">/* total # of proxied NS */</span>
	<span class="enscript-type">struct</span> prproxy_sols_tree ndpr_prproxy_sols; <span class="enscript-comment">/* tree of proxied NS */</span>
	<span class="enscript-type">void</span> (*ndpr_trace)(<span class="enscript-type">struct</span> nd_prefix *, <span class="enscript-type">int</span>); <span class="enscript-comment">/* trace callback fn */</span>
};

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ndpr_next</span>		ndpr_entry.le_next

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ndpr_raf</span>		ndpr_flags
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ndpr_raf_onlink</span>		ndpr_flags.onlink
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ndpr_raf_auto</span>		ndpr_flags.autonomous
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ndpr_raf_router</span>		ndpr_flags.router
<span class="enscript-comment">/*
 * We keep expired prefix for certain amount of time, for validation purposes.
 * 1800s = MaxRtrAdvInterval
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NDPR_KEEP_EXPIRED</span>	(1800 * 2)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDPR_LOCK_ASSERT_HELD</span>(_ndpr)					\
	lck_mtx_assert(&amp;(_ndpr)-&gt;ndpr_lock, LCK_MTX_ASSERT_OWNED)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDPR_LOCK_ASSERT_NOTHELD</span>(_ndpr)					\
	lck_mtx_assert(&amp;(_ndpr)-&gt;ndpr_lock, LCK_MTX_ASSERT_NOTOWNED)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDPR_LOCK</span>(_ndpr)						\
	lck_mtx_lock(&amp;(_ndpr)-&gt;ndpr_lock)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDPR_LOCK_SPIN</span>(_ndpr)						\
	lck_mtx_lock_spin(&amp;(_ndpr)-&gt;ndpr_lock)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDPR_CONVERT_LOCK</span>(_ndpr) do {					\
	NDPR_LOCK_ASSERT_HELD(_ndpr);					\
	lck_mtx_convert_spin(&amp;(_ndpr)-&gt;ndpr_lock);			\
} <span class="enscript-keyword">while</span> (0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDPR_UNLOCK</span>(_ndpr)						\
	lck_mtx_unlock(&amp;(_ndpr)-&gt;ndpr_lock)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDPR_ADDREF</span>(_ndpr)						\
	ndpr_addref(_ndpr, 0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDPR_ADDREF_LOCKED</span>(_ndpr)					\
	ndpr_addref(_ndpr, 1)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDPR_REMREF</span>(_ndpr) do {						\
	(<span class="enscript-type">void</span>) ndpr_remref(_ndpr, 0);					\
} <span class="enscript-keyword">while</span> (0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NDPR_REMREF_LOCKED</span>(_ndpr)					\
	ndpr_remref(_ndpr, 1)

<span class="enscript-comment">/*
 * Message format for use in obtaining information about prefixes
 * from inet6 sysctl function
 */</span>
<span class="enscript-type">struct</span> inet6_ndpr_msghdr {
	u_short	inpm_msglen;	<span class="enscript-comment">/* to skip over non-understood messages */</span>
	u_char	inpm_version;	<span class="enscript-comment">/* future binary compatibility */</span>
	u_char	inpm_type;	<span class="enscript-comment">/* message type */</span>
	<span class="enscript-type">struct</span> in6_addr inpm_prefix;
	u_int32_t	prm_vltim;
	u_int32_t	prm_pltime;
	u_int32_t	prm_expire;
	u_int32_t	prm_preferred;
	<span class="enscript-type">struct</span> in6_prflags prm_flags;
	u_short	prm_index;	<span class="enscript-comment">/* index for associated ifp */</span>
	u_char	prm_plen;	<span class="enscript-comment">/* length of prefix in bits */</span>
};

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">prm_raf_onlink</span>		prm_flags.prf_ra.onlink
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">prm_raf_auto</span>		prm_flags.prf_ra.autonomous

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">prm_statef_onlink</span>	prm_flags.prf_state.onlink

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">prm_rrf_decrvalid</span>	prm_flags.prf_rr.decrvalid
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">prm_rrf_decrprefd</span>	prm_flags.prf_rr.decrprefd

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">ifpr2ndpr</span>(ifpr)	((struct nd_prefix *)(ifpr))
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">ndpr2ifpr</span>(ndpr)	((struct ifprefix *)(ndpr))

<span class="enscript-type">struct</span> nd_pfxrouter {
	LIST_ENTRY(nd_pfxrouter) pfr_entry;
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">pfr_next</span> pfr_entry.le_next
	<span class="enscript-type">struct</span> nd_defrouter *router;
};

<span class="enscript-function-name">LIST_HEAD</span>(nd_prhead, nd_prefix);

<span class="enscript-type">struct</span> nd_prefix_list {
	<span class="enscript-type">struct</span> nd_prefix_list *next;
	<span class="enscript-type">struct</span> nd_prefix pr;
};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">PRIVATE</span>)
<span class="enscript-type">struct</span> kev_nd6_ndfailure {
	<span class="enscript-type">struct</span> net_event_data link_data;
};

<span class="enscript-type">struct</span> kev_nd6_ndalive {
	<span class="enscript-type">struct</span> net_event_data link_data;
};

<span class="enscript-comment">/* ND6 kernel event subclass value */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KEV_ND6_SUBCLASS</span>                7

<span class="enscript-comment">/* ND6 kernel event action type */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KEV_ND6_RA</span>                      1
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KEV_ND6_NDFAILURE</span>               2 <span class="enscript-comment">/* IPv6 neighbor cache entry expiry */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KEV_ND6_NDALIVE</span>                 3 <span class="enscript-comment">/* IPv6 neighbor reachable */</span>

<span class="enscript-comment">/* ND6 RA L2 source address length */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_ROUTER_LL_SIZE</span>		64

<span class="enscript-type">struct</span> nd6_ra_prefix {
	<span class="enscript-type">struct</span> sockaddr_in6 prefix;
	<span class="enscript-type">struct</span> prf_ra raflags;
	u_int32_t prefixlen;
	u_int32_t origin;
	u_int64_t vltime;
	u_int64_t pltime;
	u_int64_t expire;
	u_int32_t flags;
	u_int32_t refcnt;
	u_int32_t if_index;
	u_int32_t pad;
};

<span class="enscript-comment">/* ND6 router advertisement valid bits */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KEV_ND6_DATA_VALID_MTU</span>		(0x1 &lt;&lt; 0)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KEV_ND6_DATA_VALID_PREFIX</span>	(0x1 &lt;&lt; 1)

<span class="enscript-type">struct</span> kev_nd6_ra_data {
	u_int8_t lladdr[ND6_ROUTER_LL_SIZE];
	u_int32_t lladdrlen;
	u_int32_t mtu;
	u_int32_t list_index;
	u_int32_t list_length;
	u_int32_t flags;
	<span class="enscript-type">struct</span> nd6_ra_prefix prefix;
	u_int32_t pad;
};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>)
<span class="enscript-comment">/* nd6.c */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> nd6_prune;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> nd6_prune_lazy;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> nd6_delay;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> nd6_umaxtries;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> nd6_mmaxtries;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> nd6_useloopback;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> nd6_accept_6to4;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> nd6_maxnudhint;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> nd6_gctimer;
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> llinfo_nd6 llinfo_nd6;
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> nd_drhead nd_defrouter;
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> nd_prhead nd_prefix;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> nd6_debug;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> nd6_onlink_ns_rfc4861;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> nd6_optimistic_dad;

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">nd6log</span>(x)	do { if (nd6_debug &gt;= 1) log x; } while (0)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">nd6log2</span>(x)	do { if (nd6_debug &gt;= 2) log x; } while (0)

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_OPTIMISTIC_DAD_LINKLOCAL</span>	(1 &lt;&lt; 0)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_OPTIMISTIC_DAD_AUTOCONF</span>	(1 &lt;&lt; 1)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_OPTIMISTIC_DAD_TEMPORARY</span>	(1 &lt;&lt; 2)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_OPTIMISTIC_DAD_DYNAMIC</span>	(1 &lt;&lt; 3)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_OPTIMISTIC_DAD_SECURED</span>	(1 &lt;&lt; 4)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_OPTIMISTIC_DAD_MANUAL</span>	(1 &lt;&lt; 5)

<span class="enscript-comment">/* nd6_rtr.c */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> nd6_defifindex;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> ip6_desync_factor;	<span class="enscript-comment">/* seconds */</span>
<span class="enscript-comment">/* ND6_INFINITE_LIFETIME does not apply to temporary addresses */</span>
<span class="enscript-type">extern</span> u_int32_t ip6_temp_preferred_lifetime; <span class="enscript-comment">/* seconds */</span>
<span class="enscript-type">extern</span> u_int32_t ip6_temp_valid_lifetime; <span class="enscript-comment">/* seconds */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> ip6_temp_regen_advance; <span class="enscript-comment">/* seconds */</span>

<span class="enscript-type">union</span> nd_opts {
	<span class="enscript-type">struct</span> nd_opt_hdr *nd_opt_array[8];	<span class="enscript-comment">/* max = target address list */</span>
	<span class="enscript-type">struct</span> {
		<span class="enscript-type">struct</span> nd_opt_hdr *zero;
		<span class="enscript-type">struct</span> nd_opt_hdr *src_lladdr;
		<span class="enscript-type">struct</span> nd_opt_hdr *tgt_lladdr;
		<span class="enscript-type">struct</span> nd_opt_prefix_info *pi_beg; <span class="enscript-comment">/* multiple opts, start */</span>
		<span class="enscript-type">struct</span> nd_opt_rd_hdr *rh;
		<span class="enscript-type">struct</span> nd_opt_mtu *mtu;
		<span class="enscript-type">struct</span> nd_opt_hdr *search;	<span class="enscript-comment">/* multiple opts */</span>
		<span class="enscript-type">struct</span> nd_opt_hdr *last;	<span class="enscript-comment">/* multiple opts */</span>
		<span class="enscript-type">int</span> done;
		<span class="enscript-type">struct</span> nd_opt_prefix_info *pi_end; <span class="enscript-comment">/* multiple opts, end */</span>
	} nd_opt_each;
};
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">nd_opts_src_lladdr</span>	nd_opt_each.src_lladdr
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">nd_opts_tgt_lladdr</span>	nd_opt_each.tgt_lladdr
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">nd_opts_pi</span>		nd_opt_each.pi_beg
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">nd_opts_pi_end</span>		nd_opt_each.pi_end
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">nd_opts_rh</span>		nd_opt_each.rh
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">nd_opts_mtu</span>		nd_opt_each.mtu
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">nd_opts_search</span>		nd_opt_each.search
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">nd_opts_last</span>		nd_opt_each.last
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">nd_opts_done</span>		nd_opt_each.done

<span class="enscript-comment">/* XXX: need nd6_var.h?? */</span>
<span class="enscript-comment">/* nd6.c */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> nd6_sched_timeout_want;
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_sched_timeout</span>(<span class="enscript-type">struct</span> timeval *, <span class="enscript-type">struct</span> timeval *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_init</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_ifreset</span>(<span class="enscript-type">struct</span> ifnet *ifp);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_ifattach</span>(<span class="enscript-type">struct</span> ifnet *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">nd6_is_addr_neighbor</span>(<span class="enscript-type">struct</span> sockaddr_in6 *, <span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_option_init</span>(<span class="enscript-type">void</span> *, <span class="enscript-type">int</span>, <span class="enscript-type">union</span> nd_opts *);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> nd_opt_hdr *<span class="enscript-function-name">nd6_option</span>(<span class="enscript-type">union</span> nd_opts *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">nd6_options</span>(<span class="enscript-type">union</span> nd_opts *);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> rtentry *<span class="enscript-function-name">nd6_lookup</span>(<span class="enscript-type">struct</span> in6_addr *, <span class="enscript-type">int</span>, <span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_setmtu</span>(<span class="enscript-type">struct</span> ifnet *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_purge</span>(<span class="enscript-type">struct</span> ifnet *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_free</span>(<span class="enscript-type">struct</span> rtentry *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_nud_hint</span>(<span class="enscript-type">struct</span> rtentry *, <span class="enscript-type">struct</span> in6_addr *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">nd6_resolve</span>(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">struct</span> rtentry *,
    <span class="enscript-type">struct</span> mbuf *, <span class="enscript-type">struct</span> sockaddr *, u_char *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_rtrequest</span>(<span class="enscript-type">int</span>, <span class="enscript-type">struct</span> rtentry *, <span class="enscript-type">struct</span> sockaddr *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">nd6_ioctl</span>(u_long, caddr_t, <span class="enscript-type">struct</span> ifnet *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_cache_lladdr</span>(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">struct</span> in6_addr *,
    <span class="enscript-type">char</span> *, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">nd6_output_list</span>(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">struct</span> mbuf *,
    <span class="enscript-type">struct</span> sockaddr_in6 *, <span class="enscript-type">struct</span> rtentry *, <span class="enscript-type">struct</span> flowadv *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">nd6_output</span>(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">struct</span> mbuf *,
    <span class="enscript-type">struct</span> sockaddr_in6 *, <span class="enscript-type">struct</span> rtentry *, <span class="enscript-type">struct</span> flowadv *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">nd6_storelladdr</span>(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">struct</span> rtentry *, <span class="enscript-type">struct</span> mbuf *,
    <span class="enscript-type">struct</span> sockaddr *, u_char *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">nd6_need_cache</span>(<span class="enscript-type">struct</span> ifnet *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_drain</span>(<span class="enscript-type">void</span> *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_post_msg</span>(u_int32_t, <span class="enscript-type">struct</span> nd_prefix_list *, u_int32_t,
    u_int32_t, <span class="enscript-type">char</span> *, u_int32_t);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">nd6_setifinfo</span>(<span class="enscript-type">struct</span> ifnet *, u_int32_t, u_int32_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">ln_setexpire</span>(<span class="enscript-type">struct</span> llinfo_nd6 *, uint64_t);

<span class="enscript-comment">/* nd6_nbr.c */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_nbr_init</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_na_input</span>(<span class="enscript-type">struct</span> mbuf *, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_na_output</span>(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">const</span> <span class="enscript-type">struct</span> in6_addr *,
    <span class="enscript-type">const</span> <span class="enscript-type">struct</span> in6_addr *, u_int32_t, <span class="enscript-type">int</span>, <span class="enscript-type">struct</span> sockaddr *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_ns_input</span>(<span class="enscript-type">struct</span> mbuf *, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_ns_output</span>(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">const</span> <span class="enscript-type">struct</span> in6_addr *,
    <span class="enscript-type">const</span> <span class="enscript-type">struct</span> in6_addr *, <span class="enscript-type">struct</span> llinfo_nd6 *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> caddr_t <span class="enscript-function-name">nd6_ifptomac</span>(<span class="enscript-type">struct</span> ifnet *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_dad_start</span>(<span class="enscript-type">struct</span> ifaddr *, <span class="enscript-type">int</span> *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_dad_stop</span>(<span class="enscript-type">struct</span> ifaddr *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_dad_duplicated</span>(<span class="enscript-type">struct</span> ifaddr *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_llreach_alloc</span>(<span class="enscript-type">struct</span> rtentry *, <span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">void</span> *,
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>, boolean_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_llreach_set_reachable</span>(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">void</span> *, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_llreach_use</span>(<span class="enscript-type">struct</span> llinfo_nd6 *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_alt_node_addr_decompose</span>(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">struct</span> sockaddr *,
    <span class="enscript-type">struct</span> sockaddr_dl *, <span class="enscript-type">struct</span> sockaddr_in6 *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_alt_node_present</span>(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">struct</span> sockaddr_in6 *,
    <span class="enscript-type">struct</span> sockaddr_dl *, int32_t, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_alt_node_absent</span>(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">struct</span> sockaddr_in6 *);

<span class="enscript-comment">/* nd6_rtr.c */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_rtr_init</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_rs_input</span>(<span class="enscript-type">struct</span> mbuf *, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_ra_input</span>(<span class="enscript-type">struct</span> mbuf *, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">prelist_del</span>(<span class="enscript-type">struct</span> nd_prefix *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">defrouter_select</span>(<span class="enscript-type">struct</span> ifnet *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">defrouter_reset</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">defrtrlist_ioctl</span>(u_long, caddr_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">defrtrlist_del</span>(<span class="enscript-type">struct</span> nd_defrouter *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">defrtrlist_add_static</span>(<span class="enscript-type">struct</span> nd_defrouter *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">defrtrlist_del_static</span>(<span class="enscript-type">struct</span> nd_defrouter *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">prelist_remove</span>(<span class="enscript-type">struct</span> nd_prefix *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">prelist_update</span>(<span class="enscript-type">struct</span> nd_prefix *, <span class="enscript-type">struct</span> nd_defrouter *,
    <span class="enscript-type">struct</span> mbuf *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">nd6_prelist_add</span>(<span class="enscript-type">struct</span> nd_prefix *, <span class="enscript-type">struct</span> nd_defrouter *,
    <span class="enscript-type">struct</span> nd_prefix **, boolean_t);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">nd6_prefix_onlink</span>(<span class="enscript-type">struct</span> nd_prefix *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">nd6_prefix_onlink_scoped</span>(<span class="enscript-type">struct</span> nd_prefix *, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">nd6_prefix_offlink</span>(<span class="enscript-type">struct</span> nd_prefix *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">pfxlist_onlink_check</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> nd_defrouter *<span class="enscript-function-name">defrouter_lookup</span>(<span class="enscript-type">struct</span> in6_addr *, <span class="enscript-type">struct</span> ifnet *);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> nd_prefix *<span class="enscript-function-name">nd6_prefix_lookup</span>(<span class="enscript-type">struct</span> nd_prefix *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">in6_init_prefix_ltimes</span>(<span class="enscript-type">struct</span> nd_prefix *ndpr);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rt6_flush</span>(<span class="enscript-type">struct</span> in6_addr *, <span class="enscript-type">struct</span> ifnet *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">nd6_setdefaultiface</span>(<span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">in6_tmpifadd</span>(<span class="enscript-type">const</span> <span class="enscript-type">struct</span> in6_ifaddr *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nddr_addref</span>(<span class="enscript-type">struct</span> nd_defrouter *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> nd_defrouter *<span class="enscript-function-name">nddr_remref</span>(<span class="enscript-type">struct</span> nd_defrouter *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> uint64_t <span class="enscript-function-name">nddr_getexpire</span>(<span class="enscript-type">struct</span> nd_defrouter *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">ndpr_addref</span>(<span class="enscript-type">struct</span> nd_prefix *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> nd_prefix *<span class="enscript-function-name">ndpr_remref</span>(<span class="enscript-type">struct</span> nd_prefix *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> uint64_t <span class="enscript-function-name">ndpr_getexpire</span>(<span class="enscript-type">struct</span> nd_prefix *);

<span class="enscript-comment">/* nd6_prproxy.c */</span>
<span class="enscript-type">struct</span> ip6_hdr;
<span class="enscript-type">extern</span> u_int32_t nd6_prproxy;
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_prproxy_init</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">nd6_if_prproxy</span>(<span class="enscript-type">struct</span> ifnet *, boolean_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_prproxy_prelist_update</span>(<span class="enscript-type">struct</span> nd_prefix *, <span class="enscript-type">struct</span> nd_prefix *);
<span class="enscript-type">extern</span> boolean_t <span class="enscript-function-name">nd6_prproxy_ifaddr</span>(<span class="enscript-type">struct</span> in6_ifaddr *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_proxy_find_fwdroute</span>(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">struct</span> route_in6 *);
<span class="enscript-type">extern</span> boolean_t <span class="enscript-function-name">nd6_prproxy_isours</span>(<span class="enscript-type">struct</span> mbuf *, <span class="enscript-type">struct</span> ip6_hdr *,
    <span class="enscript-type">struct</span> route_in6 *, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_prproxy_ns_output</span>(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">struct</span> ifnet *,
    <span class="enscript-type">struct</span> in6_addr *, <span class="enscript-type">struct</span> in6_addr *, <span class="enscript-type">struct</span> llinfo_nd6 *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_prproxy_ns_input</span>(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">struct</span> in6_addr *,
    <span class="enscript-type">char</span> *, <span class="enscript-type">int</span>, <span class="enscript-type">struct</span> in6_addr *, <span class="enscript-type">struct</span> in6_addr *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_prproxy_na_input</span>(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">struct</span> in6_addr *,
    <span class="enscript-type">struct</span> in6_addr *, <span class="enscript-type">struct</span> in6_addr *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_prproxy_sols_reap</span>(<span class="enscript-type">struct</span> nd_prefix *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">nd6_prproxy_sols_prune</span>(<span class="enscript-type">struct</span> nd_prefix *, u_int32_t);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">nd6_if_disable</span>(<span class="enscript-type">struct</span> ifnet *, boolean_t);
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>

<span class="enscript-comment">/*
 *	@function nd6_lookup_ipv6
 *	@discussion This function will check the routing table for a cached
 *		neighbor discovery entry or trigger an neighbor discovery query
 *		to resolve the IPv6 address to a link-layer address.
 *		nd entries are stored in the routing table. This function will
 *		lookup the IPv6 destination in the routing table. If the
 *		destination requires forwarding to a gateway, the route of the
 *		gateway will be looked up. The route entry is inspected to
 *		determine if the link layer destination address is known. If
 *		unknown, neighbor discovery will be used to resolve the entry.
 *	@param interface The interface the packet is being sent on.
 *	@param ip6_dest The IPv6 destination of the packet.
 *	@param ll_dest On output, the link-layer destination.
 *	@param ll_dest_len The length of the buffer for ll_dest.
 *	@param hint Any routing hint passed down from the protocol.
 *	@param packet The packet being transmitted.
 *	@result May return an error such as EHOSTDOWN or ENETUNREACH. If
 *		this function returns EJUSTRETURN, the packet has been queued
 *		and will be sent when the address is resolved. If any other
 *		value is returned, the caller is responsible for disposing of
 *		the packet.
 */</span>
<span class="enscript-type">extern</span> errno_t <span class="enscript-function-name">nd6_lookup_ipv6</span>(ifnet_t interface,
    <span class="enscript-type">const</span> <span class="enscript-type">struct</span> sockaddr_in6 *ip6_dest, <span class="enscript-type">struct</span> sockaddr_dl *ll_dest,
    size_t ll_dest_len, route_t hint, mbuf_t packet);

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL */</span>

<span class="enscript-comment">/* nd6_send.c */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>
<span class="enscript-comment">/*
 * nd6_send_opmode
 *
 *      value	using CGA	tx SEND		rx SEND
 *   --------	---------	-------		-------
 *   DISABLED	       NO	     NO		     NO
 *      QUIET	      YES	     NO		     NO
 */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> nd6_send_opstate;

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_SEND_OPMODE_DISABLED</span>	0
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ND6_SEND_OPMODE_CGA_QUIET</span>	1

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* _NETINET6_ND6_H_ */</span>
</pre>
<hr />
</body></html>