<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>ip_compat.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">ip_compat.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000 Apple Computer, Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*
 * Copyright (C) 1993-1997 by Darren Reed.
 *
 * Redistribution and use in source and binary forms are permitted
 * provided that this notice is preserved and due credit is given
 * to the original author and the contributors.
 *
 * @(#)ip_compat.h	1.8 1/14/96
 */</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/appleapiopts.h&gt;</span>

#<span class="enscript-reference">if</span> 0

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">__IP_COMPAT_H__</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">__IP_COMPAT_H__</span>

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">__STDC__</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">const</span>
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">SOLARIS</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOLARIS</span>	(defined(sun) &amp;&amp; (defined(__svr4__) || defined(__SVR4)))
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_KERNEL</span>) &amp;&amp; !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">KERNEL</span>)
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">KERNEL</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">KERNEL</span>) &amp;&amp; !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_KERNEL</span>)
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">_KERNEL</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">if!defined(__KERNEL__)</span> &amp;&amp; <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">KERNEL</span>)
# <span class="enscript-reference">define</span> 	<span class="enscript-variable-name">__KERNEL__</span>
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__SVR4</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__svr4__</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__sgi</span>)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">index</span>   strchr
# <span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_KERNEL</span>)
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">bzero</span>(a,b)	memset(a,0,b)
#  <span class="enscript-reference">define</span>	<span class="enscript-variable-name">bcmp</span>		memcmp
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">bcopy</span>(a,b,c)	memmove(b,a,c)
# <span class="enscript-reference">endif</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-type">struct</span>  ether_addr {
        u_char  ether_addr_octet[6];
};

#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">linux</span>
# <span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/sysmacros.h&gt;</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">if</span>	<span class="enscript-variable-name">SOLARIS</span>
# <span class="enscript-reference">define</span>	<span class="enscript-function-name">MTYPE</span>(m)	((m)-&gt;b_datap-&gt;db_type)
# <span class="enscript-reference">include</span>	<span class="enscript-string">&lt;sys/ioccom.h&gt;</span>
# <span class="enscript-reference">include</span>	<span class="enscript-string">&lt;sys/sysmacros.h&gt;</span>
# <span class="enscript-reference">include</span>	<span class="enscript-string">&lt;sys/kmem.h&gt;</span>
<span class="enscript-comment">/*
 * because Solaris 2 defines these in two places :-/
 */</span>
# <span class="enscript-reference">undef</span>	<span class="enscript-variable-name">IPOPT_EOL</span>
# <span class="enscript-reference">undef</span>	<span class="enscript-variable-name">IPOPT_NOP</span>
# <span class="enscript-reference">undef</span>	<span class="enscript-variable-name">IPOPT_LSRR</span>
# <span class="enscript-reference">undef</span>	<span class="enscript-variable-name">IPOPT_RR</span>
# <span class="enscript-reference">undef</span>	<span class="enscript-variable-name">IPOPT_SSRR</span>
# <span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">_KERNEL</span>
#  <span class="enscript-reference">define</span>	<span class="enscript-variable-name">_KERNEL</span>
#  <span class="enscript-reference">undef</span>	<span class="enscript-variable-name">RES_INIT</span>
#  <span class="enscript-reference">include</span> <span class="enscript-string">&lt;inet/common.h&gt;</span>
#  <span class="enscript-reference">include</span> <span class="enscript-string">&lt;inet/ip.h&gt;</span>
#  <span class="enscript-reference">include</span> <span class="enscript-string">&lt;inet/ip_ire.h&gt;</span>
#  <span class="enscript-reference">undef</span>	<span class="enscript-variable-name">_KERNEL</span>
# <span class="enscript-reference">else</span> <span class="enscript-comment">/* _KERNEL */</span>
#  <span class="enscript-reference">include</span> <span class="enscript-string">&lt;inet/common.h&gt;</span>
#  <span class="enscript-reference">include</span> <span class="enscript-string">&lt;inet/ip.h&gt;</span>
#  <span class="enscript-reference">include</span> <span class="enscript-string">&lt;inet/ip_ire.h&gt;</span>
# <span class="enscript-reference">endif</span> <span class="enscript-comment">/* _KERNEL */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* SOLARIS */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">IPMINLEN</span>(i, h)	((i)-&gt;ip_len &gt;= ((i)-&gt;ip_hl * 4 + sizeof(struct h)))

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IP_OFFMASK</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IP_OFFMASK</span>	0x1fff
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span>	<span class="enscript-variable-name">BSD</span> &gt; 199306
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">USE_QUAD_T</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">U_QUAD_T</span>	u_quad_t
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">QUAD_T</span>		quad_t
#<span class="enscript-reference">else</span> <span class="enscript-comment">/* BSD &gt; 199306 */</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">U_QUAD_T</span>	u_int32_t
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">QUAD_T</span>		long
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD &gt; 199306 */</span>

<span class="enscript-comment">/*
 * These operating systems already take care of the problem for us.
 */</span>
#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__NetBSD__</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__OpenBSD__</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__FreeBSD__</span>) || \
    defined(__sgi)
<span class="enscript-type">typedef</span> u_int32_t       u_32_t;
#<span class="enscript-reference">else</span>
<span class="enscript-comment">/*
 * Really, any arch where sizeof(long) != sizeof(int).
 */</span>
# <span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__alpha__</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__alpha</span>)
<span class="enscript-type">typedef</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>    u_32_t;
# <span class="enscript-reference">else</span>
<span class="enscript-type">typedef</span> u_int32_t   u_32_t;
# <span class="enscript-reference">endif</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* __NetBSD__ || __OpenBSD__ || __FreeBSD__ || __sgi */</span>

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">MAX</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MAX</span>(a,b)	(((a) &gt; (b)) ? (a) : (b))
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*
 * Security Options for Intenet Protocol (IPSO) as defined in RFC 1108.
 *
 * Basic Option
 *
 * 00000001   -   (Reserved 4)
 * 00111101   -   Top Secret
 * 01011010   -   Secret
 * 10010110   -   Confidential
 * 01100110   -   (Reserved 3)
 * 11001100   -   (Reserved 2)
 * 10101011   -   Unclassified
 * 11110001   -   (Reserved 1)
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPSO_CLASS_RES4</span>		0x01
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPSO_CLASS_TOPS</span>		0x3d
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPSO_CLASS_SECR</span>		0x5a
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPSO_CLASS_CONF</span>		0x96
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPSO_CLASS_RES3</span>		0x66
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPSO_CLASS_RES2</span>		0xcc
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPSO_CLASS_UNCL</span>		0xab
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPSO_CLASS_RES1</span>		0xf1

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPSO_AUTH_GENSER</span>	0x80
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPSO_AUTH_ESI</span>		0x40
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPSO_AUTH_SCI</span>		0x20
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPSO_AUTH_NSA</span>		0x10
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPSO_AUTH_DOE</span>		0x08
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPSO_AUTH_UN</span>		0x06
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPSO_AUTH_FTE</span>		0x01

<span class="enscript-comment">/*
 * IP option #defines
 */</span>
<span class="enscript-comment">/*#define	IPOPT_RR	7 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_ZSU</span>	10	<span class="enscript-comment">/* ZSU */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_MTUP</span>	11	<span class="enscript-comment">/* MTUP */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_MTUR</span>	12	<span class="enscript-comment">/* MTUR */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_ENCODE</span>	15	<span class="enscript-comment">/* ENCODE */</span>
<span class="enscript-comment">/*#define	IPOPT_TS	68 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_TR</span>	82	<span class="enscript-comment">/* TR */</span>
<span class="enscript-comment">/*#define	IPOPT_SECURITY	130 */</span>
<span class="enscript-comment">/*#define	IPOPT_LSRR	131 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_E_SEC</span>	133	<span class="enscript-comment">/* E-SEC */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_CIPSO</span>	134	<span class="enscript-comment">/* CIPSO */</span>
<span class="enscript-comment">/*#define	IPOPT_SATID	136 */</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPOPT_SID</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_SID</span>	IPOPT_SATID
#<span class="enscript-reference">endif</span>
<span class="enscript-comment">/*#define	IPOPT_SSRR	137 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_ADDEXT</span>	147	<span class="enscript-comment">/* ADDEXT */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_VISA</span>	142	<span class="enscript-comment">/* VISA */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_IMITD</span>	144	<span class="enscript-comment">/* IMITD */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_EIP</span>	145	<span class="enscript-comment">/* EIP */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_FINN</span>	205	<span class="enscript-comment">/* FINN */</span>


#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__FreeBSD__</span>) &amp;&amp; <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">KERNEL</span>)
# <span class="enscript-reference">if</span> <span class="enscript-variable-name">__FreeBSD__</span> &lt; 3
#  <span class="enscript-reference">include</span> <span class="enscript-string">&lt;machine/spl.h&gt;</span>
# <span class="enscript-reference">endif</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* __FreeBSD__ &amp;&amp; KERNEL */</span>

<span class="enscript-comment">/*
 * Build some macros and #defines to enable the same code to compile anywhere
 * Well, that's the idea, anyway :-)
 */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>
# <span class="enscript-reference">if</span> <span class="enscript-variable-name">SOLARIS</span>
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">MUTEX_ENTER</span>(x)	mutex_enter(x)
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">MUTEX_EXIT</span>(x)	mutex_exit(x)
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">MTOD</span>(m,t)	(t)((m)-&gt;b_rptr)
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">IRCOPY</span>(a,b,c)	copyin((a), (b), (c))
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">IWCOPY</span>(a,b,c)	copyout((a), (b), (c))
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">FREE_MB_T</span>(m)	freemsg(m)
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">SPL_NET</span>(x)	;
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">SPL_IMP</span>(x)	;
#  <span class="enscript-reference">undef</span>	<span class="enscript-variable-name">SPL_X</span>
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">SPL_X</span>(x)	;
#  <span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">sparc</span>
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">ntohs</span>(x)	(x)
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">ntohl</span>(x)	(x)
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">htons</span>(x)	(x)
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">htonl</span>(x)	(x)
#  <span class="enscript-reference">endif</span> <span class="enscript-comment">/* sparc */</span>
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">KMALLOC</span>(a,b,c)	(a) = (b)kmem_alloc((c), KM_NOSLEEP)
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">GET_MINOR</span>(x)	getminor(x)
<span class="enscript-type">typedef</span>	<span class="enscript-type">struct</span>	qif	{
	<span class="enscript-type">struct</span>	qif	*qf_next;
	ill_t	*qf_ill;
	kmutex_t	qf_lock;
	<span class="enscript-type">void</span>	*qf_iptr;
	<span class="enscript-type">void</span>	*qf_optr;
	queue_t	*qf_in;
	queue_t	*qf_out;
	<span class="enscript-type">struct</span>	qinit	*qf_wqinfo;
	<span class="enscript-type">struct</span>	qinit	*qf_rqinfo;
	<span class="enscript-type">struct</span>	qinit	qf_wqinit;
	<span class="enscript-type">struct</span>	qinit	qf_rqinit;
	mblk_t	*qf_m;	<span class="enscript-comment">/* These three fields are for passing data up from */</span>
	queue_t	*qf_q;	<span class="enscript-comment">/* fr_qin and fr_qout to the packet processing. */</span>
	<span class="enscript-type">int</span>	qf_off;
	<span class="enscript-type">int</span>	qf_len;	<span class="enscript-comment">/* this field is used for in ipfr_fastroute */</span>
	<span class="enscript-type">char</span>	qf_name[8];
	<span class="enscript-comment">/*
	 * in case the ILL has disappeared...
	 */</span>
	<span class="enscript-type">int</span>	qf_hl;	<span class="enscript-comment">/* header length */</span>
} qif_t;
<span class="enscript-type">extern</span>	ill_t	*get_unit(<span class="enscript-type">char</span> *);
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">GETUNIT</span>(n)	get_unit((n))
# <span class="enscript-reference">else</span> <span class="enscript-comment">/* SOLARIS */</span>
#  <span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__sgi</span>)
#   <span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/ksynch.h&gt;</span>
#   <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPF_LOCK_PL</span>	plhi
#   <span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/sema.h&gt;</span>
#<span class="enscript-reference">undef</span> <span class="enscript-variable-name">kmutex_t</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
	lock_t *l;
	<span class="enscript-type">int</span> pl;
} kmutex_t;
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">MUTEX_ENTER</span>(x)	(x)-&gt;pl = LOCK((x)-&gt;l, IPF_LOCK_PL);
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">MUTEX_EXIT</span>(x)	UNLOCK((x)-&gt;l, (x)-&gt;pl);
#  <span class="enscript-reference">else</span> <span class="enscript-comment">/* __sgi */</span>
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">MUTEX_ENTER</span>(x)	;
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">MUTEX_EXIT</span>(x)	;
#  <span class="enscript-reference">endif</span> <span class="enscript-comment">/* __sgi */</span>
#  <span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">linux</span>
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">FREE_MB_T</span>(m)	m_freem(m)
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">MTOD</span>(m,t)	mtod(m,t)
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">IRCOPY</span>(a,b,c)	bcopy((a), (b), (c))
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">IWCOPY</span>(a,b,c)	bcopy((a), (b), (c))
#  <span class="enscript-reference">endif</span> <span class="enscript-comment">/* !linux */</span>
# <span class="enscript-reference">endif</span> <span class="enscript-comment">/* SOLARIS */</span>

# <span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">sun</span>
#  <span class="enscript-reference">if</span> !<span class="enscript-variable-name">SOLARIS</span>
#   <span class="enscript-reference">include</span>	<span class="enscript-string">&lt;sys/kmem_alloc.h&gt;</span>
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">GETUNIT</span>(n)	ifunit((n), IFNAMSIZ)
#  <span class="enscript-reference">endif</span>
# <span class="enscript-reference">else</span>
#  <span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">linux</span>
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">GETUNIT</span>(n)	ifunit((n))
#  <span class="enscript-reference">endif</span>
# <span class="enscript-reference">endif</span> <span class="enscript-comment">/* sun */</span>

# <span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">sun</span>) &amp;&amp; !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">linux</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__sgi</span>)
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">UIOMOVE</span>(a,b,c,d)	uiomove((caddr_t)a,b,c,d)
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">SLEEP</span>(id, n)	sleep((id), PZERO+1)
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">WAKEUP</span>(id)	wakeup(id)
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">KFREE</span>(x)	kmem_free((char *)(x), sizeof(*(x)))
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">KFREES</span>(x,s)	kmem_free((char *)(x), (s))
#  <span class="enscript-reference">if</span> !<span class="enscript-variable-name">SOLARIS</span>
<span class="enscript-type">extern</span>	<span class="enscript-type">void</span>	m_copydata(<span class="enscript-type">struct</span> mbuf *, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>, caddr_t);
<span class="enscript-type">extern</span>	<span class="enscript-type">void</span>	m_copyback(<span class="enscript-type">struct</span> mbuf *, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>, caddr_t);
#  <span class="enscript-reference">endif</span>
#  <span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__sgi</span>
#   <span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/kmem.h&gt;</span>
#   <span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/ddi.h&gt;</span>
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">KMALLOC</span>(a,b,c)	(a) = (b)kmem_alloc((c), KM_NOSLEEP)
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">GET_MINOR</span>(x)	getminor(x)
#  <span class="enscript-reference">else</span>
#   <span class="enscript-reference">if</span> !<span class="enscript-variable-name">SOLARIS</span>
#    <span class="enscript-reference">define</span>	<span class="enscript-function-name">KMALLOC</span>(a,b,c)	(a) = (b)new_kmem_alloc((c), KMEM_NOSLEEP)
#   <span class="enscript-reference">endif</span> <span class="enscript-comment">/* SOLARIS */</span>
#  <span class="enscript-reference">endif</span> <span class="enscript-comment">/* __sgi */</span>
# <span class="enscript-reference">endif</span> <span class="enscript-comment">/* sun &amp;&amp; !linux */</span>
# <span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">GET_MINOR</span>
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">GET_MINOR</span>(x)	minor(x)
# <span class="enscript-reference">endif</span>
# <span class="enscript-reference">if</span> (<span class="enscript-variable-name">BSD</span> &gt;= 199306) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__FreeBSD__</span>)
#  <span class="enscript-reference">include</span> <span class="enscript-string">&lt;vm/vm.h&gt;</span>
#  <span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__FreeBSD__</span>) || (<span class="enscript-variable-name">defined</span> (<span class="enscript-variable-name">__FreeBSD__</span>) &amp;&amp; <span class="enscript-variable-name">__FreeBSD__</span>&gt;=3)
#   <span class="enscript-reference">include</span> <span class="enscript-string">&lt;vm/vm_extern.h&gt;</span>
#   <span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/proc.h&gt;</span>
<span class="enscript-type">extern</span>	vm_map_t	kmem_map;
#  <span class="enscript-reference">else</span> <span class="enscript-comment">/* !__FreeBSD__ || (__FreeBSD__ &amp;&amp; __FreeBSD__&gt;=3) */</span>
#   <span class="enscript-reference">include</span> <span class="enscript-string">&lt;vm/vm_kern.h&gt;</span>
#  <span class="enscript-reference">endif</span> <span class="enscript-comment">/* !__FreeBSD__ || (__FreeBSD__ &amp;&amp; __FreeBSD__&gt;=3) */</span>
#  <span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">M_PFIL</span>
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">KMALLOC</span>(a, b, c)	MALLOC((a), b, (c), M_PFIL, M_NOWAIT)
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">KFREE</span>(x)	FREE((x), M_PFIL)
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">KFREES</span>(x,s)	FREE((x), M_PFIL)
#  <span class="enscript-reference">else</span>
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">KMALLOC</span>(a, b, c)	MALLOC((a), b, (c), M_TEMP, M_NOWAIT)
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">KFREE</span>(x)	FREE((x), M_TEMP)
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">KFREES</span>(x,s)	FREE((x), M_TEMP)
#  <span class="enscript-reference">endif</span> <span class="enscript-comment">/* M_PFIL */</span>
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">UIOMOVE</span>(a,b,c,d)	uiomove(a,b,d)
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">SLEEP</span>(id, n)	tsleep((id), PPAUSE|PCATCH, n, 0)
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">WAKEUP</span>(id)	wakeup(id)
# <span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD */</span>
# <span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">NetBSD</span>) &amp;&amp; <span class="enscript-variable-name">NetBSD</span> &lt;= 1991011 &amp;&amp; <span class="enscript-variable-name">NetBSD</span> &gt;= 199407
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">SPL_NET</span>(x)	x = splsoftnet()
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">SPL_X</span>(x)	(void) splx(x)
# <span class="enscript-reference">else</span>
#  <span class="enscript-reference">if</span> !<span class="enscript-variable-name">SOLARIS</span> &amp;&amp; !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">linux</span>)
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">SPL_IMP</span>(x)	x = splimp()
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">SPL_NET</span>(x)	x = splnet()
#   <span class="enscript-reference">define</span>	<span class="enscript-function-name">SPL_X</span>(x)	(void) splx(x)
#  <span class="enscript-reference">endif</span>
# <span class="enscript-reference">endif</span> <span class="enscript-comment">/* NetBSD &amp;&amp; NetBSD &lt;= 1991011 &amp;&amp; NetBSD &gt;= 199407 */</span>
# <span class="enscript-reference">define</span>	<span class="enscript-function-name">PANIC</span>(x,y)	if (x) panic y
#<span class="enscript-reference">else</span> <span class="enscript-comment">/* KERNEL */</span>
# <span class="enscript-reference">define</span>	<span class="enscript-function-name">SLEEP</span>(x,y)	;
# <span class="enscript-reference">define</span>	<span class="enscript-function-name">WAKEUP</span>(x)	;
# <span class="enscript-reference">define</span>	<span class="enscript-function-name">PANIC</span>(x,y)	;
# <span class="enscript-reference">define</span>	<span class="enscript-function-name">MUTEX_ENTER</span>(x)	;
# <span class="enscript-reference">define</span>	<span class="enscript-function-name">MUTEX_EXIT</span>(x)	;
# <span class="enscript-reference">define</span>	<span class="enscript-function-name">SPL_NET</span>(x)	;
# <span class="enscript-reference">define</span>	<span class="enscript-function-name">SPL_IMP</span>(x)	;
# <span class="enscript-reference">undef</span>		<span class="enscript-variable-name">SPL_X</span>
# <span class="enscript-reference">define</span>	<span class="enscript-function-name">SPL_X</span>(x)	;
<span class="enscript-comment">/*# define	KMALLOC(a,b,c)	(a) = (b)malloc(c) */</span>
# <span class="enscript-reference">define</span>	<span class="enscript-function-name">KFREE</span>(x)	FREE(x)
# <span class="enscript-reference">define</span>	<span class="enscript-function-name">KFREES</span>(x,s)	FREE(x)
# <span class="enscript-reference">define</span>	<span class="enscript-function-name">GETUNIT</span>(x)	get_unit(x)
# <span class="enscript-reference">define</span>	<span class="enscript-function-name">IRCOPY</span>(a,b,c)	bcopy((a), (b), (c))
# <span class="enscript-reference">define</span>	<span class="enscript-function-name">IWCOPY</span>(a,b,c)	bcopy((a), (b), (c))
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL */</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">SOLARIS</span>
<span class="enscript-type">typedef</span> mblk_t mb_t;
#<span class="enscript-reference">else</span>
# <span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">linux</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> sk_buff mb_t;
# <span class="enscript-reference">else</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> mbuf mb_t;
# <span class="enscript-reference">endif</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* SOLARIS */</span>

#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">linux</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__sgi</span>)
<span class="enscript-comment">/*
 * These #ifdef's are here mainly for linux, but who knows, they may
 * not be in other places or maybe one day linux will grow up and some
 * of these will turn up there too.
 */</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">ICMP_MINLEN</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">ICMP_MINLEN</span>	8
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">ICMP_UNREACH</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">ICMP_UNREACH</span>	ICMP_DEST_UNREACH
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">ICMP_SOURCEQUENCH</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">ICMP_SOURCEQUENCH</span>	ICMP_SOURCE_QUENCH
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">ICMP_TIMXCEED</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">ICMP_TIMXCEED</span>	ICMP_TIME_EXCEEDED
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">ICMP_PARAMPROB</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">ICMP_PARAMPROB</span>	ICMP_PARAMETERPROB
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">ICMP_TSTAMP</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">ICMP_TSTAMP</span>	ICMP_TIMESTAMP
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">ICMP_TSTAMPREPLY</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">ICMP_TSTAMPREPLY</span>	ICMP_TIMESTAMPREPLY
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">ICMP_IREQ</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">ICMP_IREQ</span>	ICMP_INFO_REQUEST
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">ICMP_IREQREPLY</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">ICMP_IREQREPLY</span>	ICMP_INFO_REPLY
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">ICMP_MASKREQ</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">ICMP_MASKREQ</span>	ICMP_ADDRESS
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">ICMP_MASKREPLY</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">ICMP_MASKREPLY</span>	ICMP_ADDRESSREPLY
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPVERSION</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPVERSION</span>	4
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPOPT_MINOFF</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_MINOFF</span>	4
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPOPT_COPIED</span>
# <span class="enscript-reference">define</span>	<span class="enscript-function-name">IPOPT_COPIED</span>(x)	((x)&amp;0x80)
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPOPT_EOL</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_EOL</span>	0
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPOPT_NOP</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_NOP</span>	1
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IP_MF</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IP_MF</span>	((u_short)0x2000)
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">ETHERTYPE_IP</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">ETHERTYPE_IP</span>	((u_short)0x0800)
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">TH_FIN</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">TH_FIN</span>	0x01
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">TH_SYN</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">TH_SYN</span>	0x02
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">TH_RST</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">TH_RST</span>	0x04
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">TH_PUSH</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">TH_PUSH</span>	0x08
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">TH_ACK</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">TH_ACK</span>	0x10
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">TH_URG</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">TH_URG</span>	0x20
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPOPT_EOL</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_EOL</span>	0
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPOPT_NOP</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_NOP</span>	1
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPOPT_RR</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_RR</span>	7
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPOPT_TS</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_TS</span>	68
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPOPT_SECURITY</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_SECURITY</span>	130
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPOPT_LSRR</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_LSRR</span>	131
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPOPT_SATID</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_SATID</span>	136
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPOPT_SSRR</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_SSRR</span>	137
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPOPT_SECUR_UNCLASS</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_SECUR_UNCLASS</span>	((u_short)0x0000)
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPOPT_SECUR_CONFID</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_SECUR_CONFID</span>	((u_short)0xf135)
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPOPT_SECUR_EFTO</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_SECUR_EFTO</span>	((u_short)0x789a)
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPOPT_SECUR_MMMM</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_SECUR_MMMM</span>	((u_short)0xbc4d)
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPOPT_SECUR_RESTR</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_SECUR_RESTR</span>	((u_short)0xaf13)
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">IPOPT_SECUR_SECRET</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_SECUR_SECRET</span>	((u_short)0xd788)
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">IPOPT_SECUR_TOPSECRET</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_SECUR_TOPSECRET</span>	((u_short)0x6bc5)
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">IPOPT_OLEN</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">IPOPT_OLEN</span>	1
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* linux || __sgi */</span>

#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">linux</span>
<span class="enscript-comment">/*
 * TCP States
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPS_CLOSED</span>		0	<span class="enscript-comment">/* closed */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPS_LISTEN</span>		1	<span class="enscript-comment">/* listening for connection */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPS_SYN_SENT</span>		2	<span class="enscript-comment">/* active, have sent syn */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPS_SYN_RECEIVED</span>	3	<span class="enscript-comment">/* have send and received syn */</span>
<span class="enscript-comment">/* states &lt; TCPS_ESTABLISHED are those where connections not established */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPS_ESTABLISHED</span>	4	<span class="enscript-comment">/* established */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPS_CLOSE_WAIT</span>		5	<span class="enscript-comment">/* rcvd fin, waiting for close */</span>
<span class="enscript-comment">/* states &gt; TCPS_CLOSE_WAIT are those where user has closed */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPS_FIN_WAIT_1</span>		6	<span class="enscript-comment">/* have closed, sent fin */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPS_CLOSING</span>		7	<span class="enscript-comment">/* closed xchd FIN; await FIN ACK */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPS_LAST_ACK</span>		8	<span class="enscript-comment">/* had fin and close; await FIN ACK */</span>
<span class="enscript-comment">/* states &gt; TCPS_CLOSE_WAIT &amp;&amp; &lt; TCPS_FIN_WAIT_2 await ACK of FIN */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPS_FIN_WAIT_2</span>		9	<span class="enscript-comment">/* have closed, fin is acked */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPS_TIME_WAIT</span>		10	<span class="enscript-comment">/* in 2*msl quiet wait after close */</span>

<span class="enscript-comment">/*
 * file flags.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">FWRITE</span>	WRITE
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">FREAD</span>	READ
<span class="enscript-comment">/*
 * mbuf related problems.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">mtod</span>(m,t)	(t)((m)-&gt;data)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">m_len</span>		len
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">m_next</span>		next

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IP_DF</span>		0x8000

<span class="enscript-type">typedef</span>	<span class="enscript-type">struct</span>	{
	__u16	th_sport;
	__u16	th_dport;
	__u32	th_seq;
	__u32	th_ack;
# <span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__i386__</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__MIPSEL__</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__alpha__</span>) ||\
    defined(vax)
	__u8	th_res:4;
	__u8	th_off:4;
#<span class="enscript-reference">else</span>
	__u8	th_off:4;
	__u8	th_res:4;
#<span class="enscript-reference">endif</span>
	__u8	th_flags;
	__u16	th_win;
	__u16	th_sum;
	__u16	th_urp;
} tcphdr_t;

<span class="enscript-type">typedef</span>	<span class="enscript-type">struct</span>	{
	__u16	uh_sport;
	__u16	uh_dport;
	__u16	uh_ulen;
	__u16	uh_sum;
} udphdr_t;

<span class="enscript-type">typedef</span>	<span class="enscript-type">struct</span>	{
# <span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__i386__</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__MIPSEL__</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__alpha__</span>) ||\
    defined(vax)
	__u8	ip_hl:4;
	__u8	ip_v:4;
# <span class="enscript-reference">else</span>
	__u8	ip_hl:4;
	__u8	ip_v:4;
# <span class="enscript-reference">endif</span>
	__u8	ip_tos;
	__u16	ip_len;
	__u16	ip_id;
	__u16	ip_off;
	__u8	ip_ttl;
	__u8	ip_p;
	__u16	ip_sum;
	<span class="enscript-type">struct</span>	in_addr	ip_src;
	<span class="enscript-type">struct</span>	in_addr	ip_dst;
} ip_t;

<span class="enscript-comment">/*
 * Structure of an icmp header.
 */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> icmp {
	u_char	icmp_type;		<span class="enscript-comment">/* type of message, see below */</span>
	u_char	icmp_code;		<span class="enscript-comment">/* type sub code */</span>
	u_short	icmp_cksum;		<span class="enscript-comment">/* ones complement cksum of struct */</span>
	<span class="enscript-type">union</span> {
		u_char ih_pptr;			<span class="enscript-comment">/* ICMP_PARAMPROB */</span>
		<span class="enscript-type">struct</span> in_addr ih_gwaddr;	<span class="enscript-comment">/* ICMP_REDIRECT */</span>
		<span class="enscript-type">struct</span> ih_idseq {
			n_short	icd_id;
			n_short	icd_seq;
		} ih_idseq;
		<span class="enscript-type">int</span> ih_void;
	} icmp_hun;
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">icmp_pptr</span>	icmp_hun.ih_pptr
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">icmp_gwaddr</span>	icmp_hun.ih_gwaddr
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">icmp_id</span>		icmp_hun.ih_idseq.icd_id
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">icmp_seq</span>	icmp_hun.ih_idseq.icd_seq
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">icmp_void</span>	icmp_hun.ih_void
	<span class="enscript-type">union</span> {
		<span class="enscript-type">struct</span> id_ts {
			n_time its_otime;
			n_time its_rtime;
			n_time its_ttime;
		} id_ts;
		<span class="enscript-type">struct</span> id_ip  {
			ip_t idi_ip;
			<span class="enscript-comment">/* options and then 64 bits of data */</span>
		} id_ip;
		u_int32_t	id_mask;
		<span class="enscript-type">char</span>	id_data[1];
	} icmp_dun;
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">icmp_otime</span>	icmp_dun.id_ts.its_otime
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">icmp_rtime</span>	icmp_dun.id_ts.its_rtime
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">icmp_ttime</span>	icmp_dun.id_ts.its_ttime
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">icmp_ip</span>		icmp_dun.id_ip.idi_ip
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">icmp_mask</span>	icmp_dun.id_mask
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">icmp_data</span>	icmp_dun.id_data
} icmphdr_t;

# <span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">LINUX_IPOVLY</span>
#  <span class="enscript-reference">define</span> <span class="enscript-variable-name">LINUX_IPOVLY</span>
<span class="enscript-type">struct</span> ipovly {
	caddr_t	ih_next, ih_prev;	<span class="enscript-comment">/* for protocol sequence q's */</span>
	u_char	ih_x1;			<span class="enscript-comment">/* (unused) */</span>
	u_char	ih_pr;			<span class="enscript-comment">/* protocol */</span>
	<span class="enscript-type">short</span>	ih_len;			<span class="enscript-comment">/* protocol length */</span>
	<span class="enscript-type">struct</span>	in_addr ih_src;		<span class="enscript-comment">/* source internet address */</span>
	<span class="enscript-type">struct</span>	in_addr ih_dst;		<span class="enscript-comment">/* destination internet address */</span>
};
# <span class="enscript-reference">endif</span>

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span>  {
	__u8	ether_dhost[6];
	__u8	ether_shost[6];
	__u16	ether_type;
} ether_header_t;

<span class="enscript-type">typedef</span>	<span class="enscript-type">struct</span>	uio	{
	<span class="enscript-type">int</span>	uio_resid;
	<span class="enscript-type">int</span>	uio_rw;
	caddr_t	uio_buf;
} uio_t;

# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">UIO_READ</span>	0
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">UIO_WRITE</span>	1
# <span class="enscript-reference">define</span>	<span class="enscript-function-name">UIOMOVE</span>(a, b, c, d)	uiomove(a,b,c,d)

<span class="enscript-comment">/*
 * For masking struct ifnet onto struct device
 */</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">if_name</span>	name

# <span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">KERNEL</span>
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">GETUNIT</span>(x)	dev_get(x)
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">FREE_MB_T</span>(m)	kfree_skb(m, FREE_WRITE)
#  <span class="enscript-reference">define</span>	<span class="enscript-variable-name">uniqtime</span>	do_gettimeofday
#  <span class="enscript-reference">undef</span> <span class="enscript-variable-name">INT_MAX</span>
#  <span class="enscript-reference">undef</span> <span class="enscript-variable-name">UINT_MAX</span>
#  <span class="enscript-reference">undef</span> <span class="enscript-variable-name">LONG_MAX</span>
#  <span class="enscript-reference">undef</span> <span class="enscript-variable-name">ULONG_MAX</span>
#  <span class="enscript-reference">include</span> <span class="enscript-string">&lt;linux/netdevice.h&gt;</span>
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">SPL_X</span>(x)
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">SPL_NET</span>(x)
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">SPL_IMP</span>(x)
 
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">bcmp</span>(a,b,c)	memcmp(a,b,c)
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">bcopy</span>(a,b,c)	memcpy(b,a,c)
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">bzero</span>(a,c)	memset(a,0,c)

#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">UNITNAME</span>(n)	dev_get((n))

#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">KMALLOC</span>(a,b,c)	(a) = (b)kmalloc((c), GFP_ATOMIC)
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">KFREE</span>(x)	kfree_s((x), sizeof(*(x)))
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">KFREES</span>(x,s)	kfree_s((x), (s))
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">IRCOPY</span>(a,b,c)	{ \
				 error = verify_area(VERIFY_READ, (a) ,(c)); \
				 <span class="enscript-keyword">if</span> (!error) \
					memcpy_fromfs((b), (a), (c)); \
				}
#  <span class="enscript-reference">define</span>	<span class="enscript-function-name">IWCOPY</span>(a,b,c)	{ \
				 error = verify_area(VERIFY_WRITE, (b), (c)); \
				 <span class="enscript-keyword">if</span> (!error) \
					memcpy_tofs((b), (a), (c)); \
				}
# <span class="enscript-reference">else</span>
#  <span class="enscript-reference">define</span>	<span class="enscript-variable-name">__KERNEL__</span>
#  <span class="enscript-reference">undef</span> <span class="enscript-variable-name">INT_MAX</span>
#  <span class="enscript-reference">undef</span> <span class="enscript-variable-name">UINT_MAX</span>
#  <span class="enscript-reference">undef</span> <span class="enscript-variable-name">LONG_MAX</span>
#  <span class="enscript-reference">undef</span> <span class="enscript-variable-name">ULONG_MAX</span>
#  <span class="enscript-reference">define</span>	<span class="enscript-variable-name">s8</span> __s8
#  <span class="enscript-reference">define</span>	<span class="enscript-variable-name">u8</span> __u8
#  <span class="enscript-reference">define</span>	<span class="enscript-variable-name">s16</span> __s16
#  <span class="enscript-reference">define</span>	<span class="enscript-variable-name">u16</span> __u16
#  <span class="enscript-reference">define</span>	<span class="enscript-variable-name">s32</span> __s32
#  <span class="enscript-reference">define</span>	<span class="enscript-variable-name">u32</span> __u32
#  <span class="enscript-reference">include</span> <span class="enscript-string">&lt;linux/netdevice.h&gt;</span>
#  <span class="enscript-reference">undef</span>	<span class="enscript-variable-name">__KERNEL__</span>
# <span class="enscript-reference">endif</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">ifnet</span>	device
#<span class="enscript-reference">else</span>
<span class="enscript-type">typedef</span>	<span class="enscript-type">struct</span>	tcphdr	tcphdr_t;
<span class="enscript-type">typedef</span>	<span class="enscript-type">struct</span>	udphdr	udphdr_t;
<span class="enscript-type">typedef</span>	<span class="enscript-type">struct</span>	icmp	icmphdr_t;
<span class="enscript-type">typedef</span>	<span class="enscript-type">struct</span>	ip	ip_t;
<span class="enscript-type">typedef</span>	<span class="enscript-type">struct</span>	ether_header	ether_header_t;
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* linux */</span>
<span class="enscript-type">typedef</span>	<span class="enscript-type">struct</span>	tcpiphdr	tcpiphdr_t;

#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">hpux</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">linux</span>)
<span class="enscript-type">struct</span>	ether_addr	{
	<span class="enscript-type">char</span>	ether_addr_octet[6];
};
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*
 * XXX - This is one of those *awful* hacks which nobody likes
 */</span>
#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">ultrix</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">A_A</span>
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">A_A</span>	&amp;
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">ICMP_ROUTERADVERT</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">ICMP_ROUTERADVERT</span>	9
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">ICMP_ROUTERSOLICIT</span>
# <span class="enscript-reference">define</span>	<span class="enscript-variable-name">ICMP_ROUTERSOLICIT</span>	10
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* __IP_COMPAT_H__ */</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* #if 0 */</span>
</pre>
<hr />
</body></html>