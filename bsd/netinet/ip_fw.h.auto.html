<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>ip_fw.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">ip_fw.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2008-2013 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*
 * Copyright (c) 1993 Daniel Boulet
 * Copyright (c) 1994 Ugen J.S.Antsilevich
 *
 * Redistribution and use in source forms, with and without modification,
 * are permitted provided that this entire comment appears intact.
 *
 * Redistribution in binary form may occur without any restrictions.
 * Obviously, it would be nice if you gave credit where credit is due
 * but requiring it would be too onerous.
 *
 * This software is provided ``AS IS'' without any warranties of any kind.
 *
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_IP_FW_H</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_IP_FW_H</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__APPLE_API_OBSOLETE</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/appleapiopts.h&gt;</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">IPFW2</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;netinet/ip_fw2.h&gt;</span>
#<span class="enscript-reference">else</span> <span class="enscript-comment">/* !IPFW2, good old ipfw */</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/queue.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/types.h&gt;</span>		<span class="enscript-comment">/* u_ types */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_CURRENT_API_VERSION</span> 20	<span class="enscript-comment">/* Version of this API */</span>


<span class="enscript-comment">/*
 * This union structure identifies an interface, either explicitly
 * by name or implicitly by IP address. The flags IP_FW_F_IIFNAME
 * and IP_FW_F_OIFNAME say how to interpret this structure. An
 * interface unit number of -1 matches any unit number, while an
 * IP address of 0.0.0.0 indicates matches any interface.
 *
 * The receive and transmit interfaces are only compared against the
 * the packet if the corresponding bit (IP_FW_F_IIFACE or IP_FW_F_OIFACE)
 * is set. Note some packets lack a receive or transmit interface
 * (in which case the missing &quot;interface&quot; never matches).
 */</span>

<span class="enscript-type">union</span> ip_fw_if {
    <span class="enscript-type">struct</span> in_addr fu_via_ip;	<span class="enscript-comment">/* Specified by IP address */</span>
    <span class="enscript-type">struct</span> {			<span class="enscript-comment">/* Specified by interface name */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">FW_IFNLEN</span>     10 <span class="enscript-comment">/* need room ! was IFNAMSIZ */</span>
	    <span class="enscript-type">char</span>  name[FW_IFNLEN];
	    <span class="enscript-type">short</span> unit;		<span class="enscript-comment">/* -1 means match any unit */</span>
    } fu_via_if;
};

<span class="enscript-comment">/*
 * Format of an IP firewall descriptor
 *
 * fw_src, fw_dst, fw_smsk, fw_dmsk are always stored in network byte order.
 * fw_flg and fw_n*p are stored in host byte order (of course).
 * Port numbers are stored in HOST byte order.
 */</span>

<span class="enscript-type">struct</span> ip_fw {
	u_int32_t version;		<span class="enscript-comment">/* Version of this structure.  Should always be */</span>
							<span class="enscript-comment">/* set to IP_FW_CURRENT_API_VERSION by clients. */</span>
	<span class="enscript-type">void</span> *context;			<span class="enscript-comment">/* Context that is usable by user processes to */</span>
							<span class="enscript-comment">/* identify this rule. */</span>
    u_int64_t fw_pcnt,fw_bcnt;		<span class="enscript-comment">/* Packet and byte counters */</span>
    <span class="enscript-type">struct</span> in_addr fw_src, fw_dst;	<span class="enscript-comment">/* Source and destination IP addr */</span>
    <span class="enscript-type">struct</span> in_addr fw_smsk, fw_dmsk;	<span class="enscript-comment">/* Mask for src and dest IP addr */</span>
    u_short fw_number;			<span class="enscript-comment">/* Rule number */</span>
    u_int fw_flg;			<span class="enscript-comment">/* Flags word */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_MAX_PORTS</span>	10		<span class="enscript-comment">/* A reasonable maximum */</span>
	<span class="enscript-type">union</span> {
	u_short fw_pts[IP_FW_MAX_PORTS];	<span class="enscript-comment">/* Array of port numbers to match */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_ICMPTYPES_MAX</span>	128
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_ICMPTYPES_DIM</span>	(IP_FW_ICMPTYPES_MAX / (sizeof(unsigned) * 8))
	<span class="enscript-type">unsigned</span> fw_icmptypes[IP_FW_ICMPTYPES_DIM]; <span class="enscript-comment">/* ICMP types bitmap */</span>
	} fw_uar;
    u_int fw_ipflg;			<span class="enscript-comment">/* IP flags word */</span>
    u_char fw_ipopt,fw_ipnopt;		<span class="enscript-comment">/* IP options set/unset */</span>
    u_char fw_tcpopt,fw_tcpnopt;	<span class="enscript-comment">/* TCP options set/unset */</span>
    u_char fw_tcpf,fw_tcpnf;		<span class="enscript-comment">/* TCP flags set/unset */</span>
    <span class="enscript-type">long</span> timestamp;			<span class="enscript-comment">/* timestamp (tv_sec) of last match */</span>
    <span class="enscript-type">union</span> ip_fw_if fw_in_if, fw_out_if;	<span class="enscript-comment">/* Incoming and outgoing interfaces */</span>
    <span class="enscript-type">union</span> {
	u_short fu_divert_port;		<span class="enscript-comment">/* Divert/tee port (options IPDIVERT) */</span>
	u_short fu_pipe_nr;		<span class="enscript-comment">/* queue number (option DUMMYNET) */</span>
	u_short fu_skipto_rule;		<span class="enscript-comment">/* SKIPTO command rule number */</span>
	u_short fu_reject_code;		<span class="enscript-comment">/* REJECT response code */</span>
	<span class="enscript-type">struct</span> sockaddr_in fu_fwd_ip;
    } fw_un;
    u_char fw_prot;			<span class="enscript-comment">/* IP protocol */</span>
	<span class="enscript-comment">/*
	 * N'of src ports and # of dst ports in ports array (dst ports
	 * follow src ports; max of 10 ports in all; count of 0 means
	 * match all ports)
	 */</span>
    u_char fw_nports;
    <span class="enscript-type">void</span> *pipe_ptr;                    <span class="enscript-comment">/* flow_set ptr for dummynet pipe */</span>
    <span class="enscript-type">void</span> *next_rule_ptr ;              <span class="enscript-comment">/* next rule in case of match */</span>
    uid_t fw_uid;			<span class="enscript-comment">/* uid to match */</span>
    <span class="enscript-type">int</span> fw_logamount;			<span class="enscript-comment">/* amount to log */</span>
    u_int64_t fw_loghighest;		<span class="enscript-comment">/* highest number packet to log */</span>
};

<span class="enscript-comment">/*
 * extended ipfw structure... some fields in the original struct
 * can be used to pass parameters up/down, namely pointers
 *     void *pipe_ptr
 *     void *next_rule_ptr 
 * some others can be used to pass parameters down, namely counters etc.
 *     u_int64_t fw_pcnt,fw_bcnt;
 *     long timestamp;
 */</span>

<span class="enscript-type">struct</span> ip_fw_ext {             <span class="enscript-comment">/* extended structure */</span>
    <span class="enscript-type">struct</span> ip_fw rule;      <span class="enscript-comment">/* must be at offset 0 */</span>
    <span class="enscript-type">long</span>    dont_match_prob;        <span class="enscript-comment">/* 0x7fffffff means 1.0, always fail */</span>
    u_int   dyn_type;  <span class="enscript-comment">/* type for dynamic rule */</span>
};

#<span class="enscript-reference">define</span> <span class="enscript-function-name">IP_FW_GETNSRCP</span>(rule)		((rule)-&gt;fw_nports &amp; 0x0f)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">IP_FW_SETNSRCP</span>(rule, n)		do {				\
					  (rule)-&gt;fw_nports &amp;= ~0x0f;	\
					  (rule)-&gt;fw_nports |= (n);	\
					} <span class="enscript-keyword">while</span> (0)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">IP_FW_GETNDSTP</span>(rule)		((rule)-&gt;fw_nports &gt;&gt; 4)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">IP_FW_SETNDSTP</span>(rule, n)		do {				\
					  (rule)-&gt;fw_nports &amp;= ~0xf0;	\
					  (rule)-&gt;fw_nports |= (n) &lt;&lt; 4;\
					} <span class="enscript-keyword">while</span> (0)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">fw_divert_port</span>	fw_un.fu_divert_port
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">fw_skipto_rule</span>	fw_un.fu_skipto_rule
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">fw_reject_code</span>	fw_un.fu_reject_code
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">fw_pipe_nr</span>	fw_un.fu_pipe_nr
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">fw_fwd_ip</span>	fw_un.fu_fwd_ip

<span class="enscript-type">struct</span> ip_fw_chain {
	LIST_ENTRY(ip_fw_chain) next;
	<span class="enscript-type">struct</span> ip_fw *rule;
};

<span class="enscript-comment">/*
 * Flow mask/flow id for each queue.
 */</span>
<span class="enscript-type">struct</span> ipfw_flow_id {
    u_int32_t dst_ip, src_ip ;
    u_int16_t dst_port, src_port ; 
    u_int8_t proto ;    
    u_int8_t flags ;    <span class="enscript-comment">/* protocol-specific flags */</span>
} ;

<span class="enscript-comment">/*
 * dynamic ipfw rule
 */</span>
<span class="enscript-type">struct</span> ipfw_dyn_rule {
    <span class="enscript-type">struct</span> ipfw_dyn_rule *next ;

    <span class="enscript-type">struct</span> ipfw_flow_id id ;
    <span class="enscript-type">struct</span> ipfw_flow_id mask ;
    <span class="enscript-type">struct</span> ip_fw_chain *chain ;		<span class="enscript-comment">/* pointer to parent rule	*/</span>
    u_int32_t type ;			<span class="enscript-comment">/* rule type			*/</span>
    u_int32_t expire ;			<span class="enscript-comment">/* expire time			*/</span>
    u_int64_t pcnt, bcnt;		<span class="enscript-comment">/* match counters		*/</span>
    u_int32_t bucket ;			<span class="enscript-comment">/* which bucket in hash table	*/</span>
    u_int32_t state ;			<span class="enscript-comment">/* state of this rule (typ. a   */</span>
					<span class="enscript-comment">/* combination of TCP flags)	*/</span>
} ;

<span class="enscript-comment">/*
 * Values for &quot;flags&quot; field .
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_COMMAND</span> 0x000000ff	<span class="enscript-comment">/* Mask for type of chain entry:	*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_DENY</span>	0x00000000	<span class="enscript-comment">/* This is a deny rule			*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_REJECT</span>	0x00000001	<span class="enscript-comment">/* Deny and send a response packet	*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_ACCEPT</span>	0x00000002	<span class="enscript-comment">/* This is an accept rule		*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_COUNT</span>	0x00000003	<span class="enscript-comment">/* This is a count rule			*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_DIVERT</span>	0x00000004	<span class="enscript-comment">/* This is a divert rule		*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_TEE</span>	0x00000005	<span class="enscript-comment">/* This is a tee rule			*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_SKIPTO</span>	0x00000006	<span class="enscript-comment">/* This is a skipto rule		*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_FWD</span>	0x00000007	<span class="enscript-comment">/* This is a &quot;change forwarding address&quot; rule */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_PIPE</span>	0x00000008	<span class="enscript-comment">/* This is a dummynet rule */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_QUEUE</span>	0x00000009	<span class="enscript-comment">/* This is a dummynet queue */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_IN</span>	0x00000100	<span class="enscript-comment">/* Check inbound packets		*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_OUT</span>	0x00000200	<span class="enscript-comment">/* Check outbound packets		*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_IIFACE</span>	0x00000400	<span class="enscript-comment">/* Apply inbound interface test		*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_OIFACE</span>	0x00000800	<span class="enscript-comment">/* Apply outbound interface test	*/</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_PRN</span>	0x00001000	<span class="enscript-comment">/* Print if this rule matches		*/</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_SRNG</span>	0x00002000	<span class="enscript-comment">/* The first two src ports are a min	*
					 * and max range (stored in host byte	*
					 * order).				*/</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_DRNG</span>	0x00004000	<span class="enscript-comment">/* The first two dst ports are a min	*
					 * and max range (stored in host byte	*
					 * order).				*/</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_FRAG</span>	0x00008000	<span class="enscript-comment">/* Fragment				*/</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_IIFNAME</span>	0x00010000	<span class="enscript-comment">/* In interface by name/unit (not IP)	*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_OIFNAME</span>	0x00020000	<span class="enscript-comment">/* Out interface by name/unit (not IP)	*/</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_INVSRC</span>	0x00040000	<span class="enscript-comment">/* Invert sense of src check		*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_INVDST</span>	0x00080000	<span class="enscript-comment">/* Invert sense of dst check		*/</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_ICMPBIT</span> 0x00100000	<span class="enscript-comment">/* ICMP type bitmap is valid		*/</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_UID</span>	0x00200000	<span class="enscript-comment">/* filter by uid			*/</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_RND_MATCH</span> 0x00800000	<span class="enscript-comment">/* probabilistic rule match		*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_SMSK</span>	0x01000000	<span class="enscript-comment">/* src-port + mask 			*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_DMSK</span>	0x02000000	<span class="enscript-comment">/* dst-port + mask 			*/</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IP_FW_BRIDGED</span>	0x04000000	<span class="enscript-comment">/* only match bridged packets		*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_KEEP_S</span>	0x08000000	<span class="enscript-comment">/* keep state	 			*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_CHECK_S</span>	0x10000000	<span class="enscript-comment">/* check state	 			*/</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_SME</span>	0x20000000	<span class="enscript-comment">/* source = me				*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_DME</span>	0x40000000	<span class="enscript-comment">/* destination = me			*/</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_F_MASK</span>	0x7FFFFFFF	<span class="enscript-comment">/* All possible flag bits mask		*/</span>

<span class="enscript-comment">/*
 * Flags for the 'fw_ipflg' field, for comparing values of ip and its protocols.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IP_FW_IF_TCPEST</span>	0x00000020	<span class="enscript-comment">/* established TCP connection */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IP_FW_IF_TCPMSK</span>	0x00000020	<span class="enscript-comment">/* mask of all TCP values */</span>

<span class="enscript-comment">/*
 * For backwards compatibility with rules specifying &quot;via iface&quot; but
 * not restricted to only &quot;in&quot; or &quot;out&quot; packets, we define this combination
 * of bits to represent this configuration.
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IF_FW_F_VIAHACK</span>	(IP_FW_F_IN|IP_FW_F_OUT|IP_FW_F_IIFACE|IP_FW_F_OIFACE)

<span class="enscript-comment">/*
 * Definitions for REJECT response codes.
 * Values less than 256 correspond to ICMP unreachable codes.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_REJECT_RST</span>	0x0100		<span class="enscript-comment">/* TCP packets: send RST */</span>

<span class="enscript-comment">/*
 * Definitions for IP option names.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_IPOPT_LSRR</span>	0x01
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_IPOPT_SSRR</span>	0x02
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_IPOPT_RR</span>		0x04
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_IPOPT_TS</span>		0x08

<span class="enscript-comment">/*
 * Definitions for TCP option names.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_TCPOPT_MSS</span>	0x01
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_TCPOPT_WINDOW</span>	0x02
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_TCPOPT_SACK</span>	0x04
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_TCPOPT_TS</span>		0x08
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_TCPOPT_CC</span>		0x10

<span class="enscript-comment">/*
 * Definitions for TCP flags.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_TCPF_FIN</span>		TH_FIN
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_TCPF_SYN</span>		TH_SYN
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_TCPF_RST</span>		TH_RST
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_TCPF_PSH</span>		TH_PUSH
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_TCPF_ACK</span>		TH_ACK
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_TCPF_URG</span>		TH_URG

<span class="enscript-comment">/*
 * Main firewall chains definitions and global var's definitions.
 */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IP_FW_PORT_DYNT_FLAG</span>	0x10000
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IP_FW_PORT_TEE_FLAG</span>	0x20000
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IP_FW_PORT_DENY_FLAG</span>	0x40000

<span class="enscript-comment">/*
 * Function definitions.
 */</span>
<span class="enscript-type">void</span> <span class="enscript-function-name">ip_fw_init</span>(<span class="enscript-type">void</span>);

<span class="enscript-comment">/* Firewall hooks */</span>
<span class="enscript-type">struct</span> ip;
<span class="enscript-type">struct</span> sockopt;
<span class="enscript-type">typedef</span>	<span class="enscript-type">int</span> ip_fw_chk_t(<span class="enscript-type">struct</span> ip **, <span class="enscript-type">int</span>, <span class="enscript-type">struct</span> ifnet *, u_int16_t *,
	     <span class="enscript-type">struct</span> mbuf **, <span class="enscript-type">struct</span> ip_fw_chain **, <span class="enscript-type">struct</span> sockaddr_in **);
<span class="enscript-type">typedef</span>	<span class="enscript-type">int</span> ip_fw_ctl_t(<span class="enscript-type">struct</span> sockopt *);
<span class="enscript-type">extern</span>	ip_fw_chk_t *ip_fw_chk_ptr;
<span class="enscript-type">extern</span>	ip_fw_ctl_t *ip_fw_ctl_ptr;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> fw_one_pass;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> fw_enable;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IPFW_LOADED</span>     (ip_fw_chk_ptr != NULL)
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> ipfw_flow_id last_pkt ;
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !IPFW2 */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* __APPLE_API_OBSOLETE */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* _IP_FW_H */</span>
</pre>
<hr />
</body></html>