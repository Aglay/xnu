<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>tcp.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">tcp.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000-2014 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 *
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 *
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 *
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*
 * Copyright (c) 1982, 1986, 1993
 *	The Regents of the University of California.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *	@(#)tcp.h	8.1 (Berkeley) 6/10/93
 * $FreeBSD: src/sys/netinet/tcp.h,v 1.13.2.3 2001/03/01 22:08:42 jlemon Exp $
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_NETINET_TCP_H_</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_NETINET_TCP_H_</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/types.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/appleapiopts.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;machine/endian.h&gt;</span>

#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
<span class="enscript-type">typedef</span>	__uint32_t tcp_seq;
<span class="enscript-type">typedef</span> __uint32_t tcp_cc;		<span class="enscript-comment">/* connection count per rfc1644 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">tcp6_seq</span>	tcp_seq	<span class="enscript-comment">/* for KAME src sync over BSD*'s */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">tcp6hdr</span>		tcphdr	<span class="enscript-comment">/* for KAME src sync over BSD*'s */</span>

<span class="enscript-comment">/*
 * TCP header.
 * Per RFC 793, September, 1981.
 */</span>
<span class="enscript-type">struct</span> tcphdr {
	<span class="enscript-type">unsigned</span> <span class="enscript-type">short</span>	th_sport;	<span class="enscript-comment">/* source port */</span>
	<span class="enscript-type">unsigned</span> <span class="enscript-type">short</span>	th_dport;	<span class="enscript-comment">/* destination port */</span>
	tcp_seq	th_seq;			<span class="enscript-comment">/* sequence number */</span>
	tcp_seq	th_ack;			<span class="enscript-comment">/* acknowledgement number */</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">__DARWIN_BYTE_ORDER</span> == <span class="enscript-variable-name">__DARWIN_LITTLE_ENDIAN</span>
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	th_x2:4,	<span class="enscript-comment">/* (unused) */</span>
			<span class="enscript-reference">th_off</span>:4;	<span class="enscript-comment">/* data offset */</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">__DARWIN_BYTE_ORDER</span> == <span class="enscript-variable-name">__DARWIN_BIG_ENDIAN</span>
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	th_off:4,	<span class="enscript-comment">/* data offset */</span>
			<span class="enscript-reference">th_x2</span>:4;	<span class="enscript-comment">/* (unused) */</span>
#<span class="enscript-reference">endif</span>
	<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>	th_flags;
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TH_FIN</span>	0x01
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TH_SYN</span>	0x02
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TH_RST</span>	0x04
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TH_PUSH</span>	0x08
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TH_ACK</span>	0x10
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TH_URG</span>	0x20
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TH_ECE</span>	0x40
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TH_CWR</span>	0x80
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TH_FLAGS</span>	(TH_FIN|TH_SYN|TH_RST|TH_ACK|TH_URG|TH_ECE|TH_CWR)

	<span class="enscript-type">unsigned</span> <span class="enscript-type">short</span>	th_win;		<span class="enscript-comment">/* window */</span>
	<span class="enscript-type">unsigned</span> <span class="enscript-type">short</span>	th_sum;		<span class="enscript-comment">/* checksum */</span>
	<span class="enscript-type">unsigned</span> <span class="enscript-type">short</span>	th_urp;		<span class="enscript-comment">/* urgent pointer */</span>
};

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPOPT_EOL</span>		0
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPOPT_NOP</span>		1
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPOPT_MAXSEG</span>		2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPOLEN_MAXSEG</span>		4
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPOPT_WINDOW</span>		3
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPOLEN_WINDOW</span>		3
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPOPT_SACK_PERMITTED</span>	4		<span class="enscript-comment">/* Experimental */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPOLEN_SACK_PERMITTED</span>	2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPOPT_SACK</span>		5		<span class="enscript-comment">/* Experimental */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPOLEN_SACK</span>		8		<span class="enscript-comment">/* len of sack block */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPOPT_TIMESTAMP</span>	8
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPOLEN_TIMESTAMP</span>	10
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPOLEN_TSTAMP_APPA</span>		(TCPOLEN_TIMESTAMP+2) <span class="enscript-comment">/* appendix A */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPOPT_TSTAMP_HDR</span>		\
    (TCPOPT_NOP&lt;&lt;24|TCPOPT_NOP&lt;&lt;16|TCPOPT_TIMESTAMP&lt;&lt;8|TCPOLEN_TIMESTAMP)

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAX_TCPOPTLEN</span>		40	<span class="enscript-comment">/* Absolute maximum TCP options len */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPOPT_CC</span>		11		<span class="enscript-comment">/* CC options: RFC-1644 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPOPT_CCNEW</span>		12
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPOPT_CCECHO</span>		13
#<span class="enscript-reference">define</span>	   <span class="enscript-variable-name">TCPOLEN_CC</span>			6
#<span class="enscript-reference">define</span>	   <span class="enscript-variable-name">TCPOLEN_CC_APPA</span>		(TCPOLEN_CC+2)
#<span class="enscript-reference">define</span>	   <span class="enscript-function-name">TCPOPT_CC_HDR</span>(ccopt)		\
    (TCPOPT_NOP&lt;&lt;24|TCPOPT_NOP&lt;&lt;16|(ccopt)&lt;&lt;8|TCPOLEN_CC)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPOPT_SIGNATURE</span>		19	<span class="enscript-comment">/* Keyed MD5: RFC 2385 */</span>
#<span class="enscript-reference">define</span>	   <span class="enscript-variable-name">TCPOLEN_SIGNATURE</span>		18
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">MPTCP</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPOPT_MULTIPATH</span>  		30
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPOPT_FASTOPEN</span>			34
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPOLEN_FASTOPEN_REQ</span>		2

<span class="enscript-comment">/* Option definitions */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPOPT_SACK_PERMIT_HDR</span>	\
(TCPOPT_NOP&lt;&lt;24|TCPOPT_NOP&lt;&lt;16|TCPOPT_SACK_PERMITTED&lt;&lt;8|TCPOLEN_SACK_PERMITTED)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPOPT_SACK_HDR</span>		(TCPOPT_NOP&lt;&lt;24|TCPOPT_NOP&lt;&lt;16|TCPOPT_SACK&lt;&lt;8)
<span class="enscript-comment">/* Miscellaneous constants */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAX_SACK_BLKS</span>	6	<span class="enscript-comment">/* Max # SACK blocks stored at sender side */</span>

<span class="enscript-comment">/*
 * A SACK option that specifies n blocks will have a length of (8*n + 2)
 * bytes, so the 40 bytes available for TCP options can specify a
 * maximum of 4 blocks.
 */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCP_MAX_SACK</span>	4	<span class="enscript-comment">/* MAX # SACKs sent in any segment */</span>


<span class="enscript-comment">/*
 * Default maximum segment size for TCP.
 * With an IP MTU of 576, this is 536,
 * but 512 is probably more convenient.
 * This should be defined as MIN(512, IP_MSS - sizeof (struct tcpiphdr)).
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCP_MSS</span>	512

<span class="enscript-comment">/*
 * TCP_MINMSS is defined to be 216 which is fine for the smallest
 * link MTU (256 bytes, SLIP interface) in the Internet.
 * However it is very unlikely to come across such low MTU interfaces
 * these days (anno dato 2004).
 * Probably it can be set to 512 without ill effects. But we play safe.
 * See tcp_subr.c tcp_minmss SYSCTL declaration for more comments.
 * Setting this to &quot;0&quot; disables the minmss check.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCP_MINMSS</span> 216

<span class="enscript-comment">/*
 * Default maximum segment size for TCP6.
 * With an IP6 MSS of 1280, this is 1220,
 * but 1024 is probably more convenient. (xxx kazu in doubt)
 * This should be defined as MIN(1024, IP6_MSS - sizeof (struct tcpip6hdr))
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCP6_MSS</span>	1024

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCP_MAXWIN</span>	65535	<span class="enscript-comment">/* largest value for (unscaled) window */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TTCP_CLIENT_SND_WND</span>	4096	<span class="enscript-comment">/* dflt send window for T/TCP client */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCP_MAX_WINSHIFT</span>	14	<span class="enscript-comment">/* maximum window shift */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCP_MAXHLEN</span>	(0xf&lt;&lt;2)	<span class="enscript-comment">/* max length of header in bytes */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCP_MAXOLEN</span>	(TCP_MAXHLEN - sizeof(struct tcphdr))
					<span class="enscript-comment">/* max space left for options */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* (_POSIX_C_SOURCE &amp;&amp; !_DARWIN_C_SOURCE) */</span>

<span class="enscript-comment">/*
 * User-settable options (used with setsockopt).
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCP_NODELAY</span>             0x01    <span class="enscript-comment">/* don't delay send to coalesce packets */</span>
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCP_MAXSEG</span>              0x02    <span class="enscript-comment">/* set maximum segment size */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCP_NOPUSH</span>              0x04    <span class="enscript-comment">/* don't push last block of write */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCP_NOOPT</span>               0x08    <span class="enscript-comment">/* don't use TCP options */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCP_KEEPALIVE</span>           0x10    <span class="enscript-comment">/* idle time used when SO_KEEPALIVE is enabled */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCP_CONNECTIONTIMEOUT</span>   0x20    <span class="enscript-comment">/* connection timeout */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PERSIST_TIMEOUT</span>		0x40	<span class="enscript-comment">/* time after which a connection in
					 *  persist timeout will terminate.
					 *  see draft-ananth-tcpm-persist-02.txt
					 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCP_RXT_CONNDROPTIME</span>	0x80	<span class="enscript-comment">/* time after which tcp retransmissions will be 
					 * stopped and the connection will be dropped
					 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCP_RXT_FINDROP</span>		0x100	<span class="enscript-comment">/* when this option is set, drop a connection 
					 * after retransmitting the FIN 3 times. It will
					 * prevent holding too many mbufs in socket 
					 * buffer queues.
					 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCP_KEEPINTVL</span>		0x101	<span class="enscript-comment">/* interval between keepalives */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCP_KEEPCNT</span>		0x102	<span class="enscript-comment">/* number of keepalives before close */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCP_SENDMOREACKS</span>	0x103	<span class="enscript-comment">/* always ack every other packet */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCP_ENABLE_ECN</span>		0x104	<span class="enscript-comment">/* Enable ECN on a connection */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCP_FASTOPEN</span>		0x105	<span class="enscript-comment">/* Enable/Disable TCP Fastopen on this socket */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCP_CONNECTION_INFO</span>	0x106	<span class="enscript-comment">/* State of TCP connection */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCP_INFO</span>		0x200	<span class="enscript-comment">/* retrieve tcp_info structure */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCP_MEASURE_SND_BW</span>	0x202	<span class="enscript-comment">/* Measure sender's bandwidth for this connection */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>


#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCP_NOTSENT_LOWAT</span>	0x201	<span class="enscript-comment">/* Low water mark for TCP unsent data */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCP_MEASURE_BW_BURST</span>	0x203	<span class="enscript-comment">/* Burst size to use for bandwidth measurement */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCP_PEER_PID</span>		0x204	<span class="enscript-comment">/* Lookup pid of the process we're connected to */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCP_ADAPTIVE_READ_TIMEOUT</span>	0x205	<span class="enscript-comment">/* Read timeout used as a multiple of RTT */</span>	
<span class="enscript-comment">/*
 * Enable message delivery on a socket, this feature is currently unsupported and
 * is subjected to change in future.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCP_ENABLE_MSGS</span> 0x206
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCP_ADAPTIVE_WRITE_TIMEOUT</span>	0x207	<span class="enscript-comment">/* Write timeout used as a multiple of RTT */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCP_NOTIMEWAIT</span>		0x208	<span class="enscript-comment">/* Avoid going into time-wait */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCP_DISABLE_BLACKHOLE_DETECTION</span>	0x209	<span class="enscript-comment">/* disable PMTU blackhole detection */</span>

<span class="enscript-comment">/*
 * The TCP_INFO socket option is a private API and is subject to change
 */</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">pack</span>(4)

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPI_OPT_TIMESTAMPS</span>	0x01
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPI_OPT_SACK</span>		0x02
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPI_OPT_WSCALE</span>		0x04
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TCPI_OPT_ECN</span>		0x08

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPI_FLAG_LOSSRECOVERY</span>	0x01	<span class="enscript-comment">/* Currently in loss recovery */</span>

<span class="enscript-type">struct</span> tcp_conn_status {
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	probe_activated : 1;
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	write_probe_failed : 1;
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	read_probe_failed : 1;
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	conn_probe_failed : 1;
};

<span class="enscript-comment">/*
 * Add new fields to this structure at the end only. This will preserve
 * binary compatibility.
 */</span>
<span class="enscript-type">struct</span> tcp_info {
	u_int8_t	tcpi_state;			<span class="enscript-comment">/* TCP FSM state. */</span>
	u_int8_t	tcpi_options;		<span class="enscript-comment">/* Options enabled on conn. */</span>
	u_int8_t	tcpi_snd_wscale;	<span class="enscript-comment">/* RFC1323 send shift value. */</span>
	u_int8_t	tcpi_rcv_wscale;	<span class="enscript-comment">/* RFC1323 recv shift value. */</span>

	u_int32_t	tcpi_flags;			<span class="enscript-comment">/* extra flags (TCPI_FLAG_xxx) */</span>

	u_int32_t	tcpi_rto;			<span class="enscript-comment">/* Retransmission timeout in milliseconds */</span>
	u_int32_t	tcpi_snd_mss;		<span class="enscript-comment">/* Max segment size for send. */</span>
	u_int32_t	tcpi_rcv_mss;		<span class="enscript-comment">/* Max segment size for receive. */</span>

	u_int32_t	tcpi_rttcur;		<span class="enscript-comment">/* Most recent value of RTT */</span>
	u_int32_t	tcpi_srtt;			<span class="enscript-comment">/* Smoothed RTT */</span>
	u_int32_t	tcpi_rttvar;		<span class="enscript-comment">/* RTT variance */</span>
	u_int32_t	tcpi_rttbest;		<span class="enscript-comment">/* Best RTT we've seen */</span>

	u_int32_t	tcpi_snd_ssthresh;	<span class="enscript-comment">/* Slow start threshold. */</span>
	u_int32_t	tcpi_snd_cwnd;		<span class="enscript-comment">/* Send congestion window. */</span>

	u_int32_t	tcpi_rcv_space;		<span class="enscript-comment">/* Advertised recv window. */</span>

	u_int32_t	tcpi_snd_wnd;		<span class="enscript-comment">/* Advertised send window. */</span>
	u_int32_t	tcpi_snd_nxt;		<span class="enscript-comment">/* Next egress seqno */</span>
	u_int32_t	tcpi_rcv_nxt;		<span class="enscript-comment">/* Next ingress seqno */</span>
	
	int32_t		tcpi_last_outif;	<span class="enscript-comment">/* if_index of interface used to send last */</span>
	u_int32_t	tcpi_snd_sbbytes;	<span class="enscript-comment">/* bytes in snd buffer including data inflight */</span>
	
	u_int64_t	tcpi_txpackets __attribute__((aligned(8)));	<span class="enscript-comment">/* total packets sent */</span>
	u_int64_t	tcpi_txbytes __attribute__((aligned(8)));
									<span class="enscript-comment">/* total bytes sent */</span>	
	u_int64_t	tcpi_txretransmitbytes __attribute__((aligned(8)));
									<span class="enscript-comment">/* total bytes retransmitted */</span>	
	u_int64_t	tcpi_txunacked __attribute__((aligned(8)));
									<span class="enscript-comment">/* current number of bytes not acknowledged */</span>	
	u_int64_t	tcpi_rxpackets __attribute__((aligned(8)));	<span class="enscript-comment">/* total packets received */</span>
	u_int64_t	tcpi_rxbytes __attribute__((aligned(8)));
									<span class="enscript-comment">/* total bytes received */</span>
	u_int64_t	tcpi_rxduplicatebytes __attribute__((aligned(8)));
									<span class="enscript-comment">/* total duplicate bytes received */</span>
	u_int64_t	tcpi_rxoutoforderbytes __attribute__((aligned(8)));
									<span class="enscript-comment">/* total out of order bytes received */</span>
	u_int64_t	tcpi_snd_bw __attribute__((aligned(8)));	<span class="enscript-comment">/* measured send bandwidth in bits/sec */</span>
	u_int8_t	tcpi_synrexmits;	<span class="enscript-comment">/* Number of syn retransmits before connect */</span>
	u_int8_t	tcpi_unused1;
	u_int16_t	tcpi_unused2;
	u_int64_t	tcpi_cell_rxpackets __attribute((aligned(8)));	<span class="enscript-comment">/* packets received over cellular */</span>
	u_int64_t	tcpi_cell_rxbytes __attribute((aligned(8)));	<span class="enscript-comment">/* bytes received over cellular */</span>
	u_int64_t	tcpi_cell_txpackets __attribute((aligned(8)));	<span class="enscript-comment">/* packets transmitted over cellular */</span>
	u_int64_t	tcpi_cell_txbytes __attribute((aligned(8)));	<span class="enscript-comment">/* bytes transmitted over cellular */</span>
	u_int64_t	tcpi_wifi_rxpackets __attribute((aligned(8)));	<span class="enscript-comment">/* packets received over Wi-Fi */</span>
	u_int64_t	tcpi_wifi_rxbytes __attribute((aligned(8)));	<span class="enscript-comment">/* bytes received over Wi-Fi */</span>
	u_int64_t	tcpi_wifi_txpackets __attribute((aligned(8)));	<span class="enscript-comment">/* packets transmitted over Wi-Fi */</span>
	u_int64_t	tcpi_wifi_txbytes __attribute((aligned(8)));	<span class="enscript-comment">/* bytes transmitted over Wi-Fi */</span>
	u_int64_t	tcpi_wired_rxpackets __attribute((aligned(8)));	<span class="enscript-comment">/* packets received over Wired */</span>
	u_int64_t	tcpi_wired_rxbytes __attribute((aligned(8)));	<span class="enscript-comment">/* bytes received over Wired */</span>
	u_int64_t	tcpi_wired_txpackets __attribute((aligned(8)));	<span class="enscript-comment">/* packets transmitted over Wired */</span>
	u_int64_t	tcpi_wired_txbytes __attribute((aligned(8)));	<span class="enscript-comment">/* bytes transmitted over Wired */</span>
	<span class="enscript-type">struct</span> tcp_conn_status	tcpi_connstatus; <span class="enscript-comment">/* status of connection probes */</span>

	u_int16_t	<span class="enscript-comment">/* Client-side information */</span>
		<span class="enscript-reference">tcpi_tfo_cookie_req</span>:1, <span class="enscript-comment">/* Cookie requested? */</span>
		<span class="enscript-reference">tcpi_tfo_cookie_rcv</span>:1, <span class="enscript-comment">/* Cookie received? */</span>
		<span class="enscript-reference">tcpi_tfo_syn_loss</span>:1,   <span class="enscript-comment">/* Fallback to reg. TCP after SYN-loss */</span>
		<span class="enscript-reference">tcpi_tfo_syn_data_sent</span>:1, <span class="enscript-comment">/* SYN+data has been sent out */</span>
		<span class="enscript-reference">tcpi_tfo_syn_data_acked</span>:1, <span class="enscript-comment">/* SYN+data has been fully acknowledged */</span>
		<span class="enscript-comment">/* And the following are for server-side information (must be set on the listener socket) */</span>
		<span class="enscript-reference">tcpi_tfo_syn_data_rcv</span>:1, <span class="enscript-comment">/* Server received SYN+data with a valid cookie */</span>
		<span class="enscript-reference">tcpi_tfo_cookie_req_rcv</span>:1, <span class="enscript-comment">/* Server received cookie-request */</span>
		<span class="enscript-reference">tcpi_tfo_cookie_sent</span>:1, <span class="enscript-comment">/* Server announced cookie */</span>
		<span class="enscript-reference">tcpi_tfo_cookie_invalid</span>:1; <span class="enscript-comment">/* Server received an invalid cookie */</span>
};

<span class="enscript-type">struct</span> tcp_measure_bw_burst {
	u_int32_t	min_burst_size; <span class="enscript-comment">/* Minimum number of packets to use */</span>
	u_int32_t	max_burst_size; <span class="enscript-comment">/* Maximum number of packets to use */</span>
};

<span class="enscript-comment">/*
 * Note that IPv6 link local addresses should have the appropriate scope ID
 */</span>

<span class="enscript-type">struct</span> info_tuple {
	u_int8_t	itpl_proto;
	<span class="enscript-type">union</span> {
		<span class="enscript-type">struct</span> sockaddr		_itpl_sa;
		<span class="enscript-type">struct</span> sockaddr_in	_itpl_sin;
		<span class="enscript-type">struct</span> sockaddr_in6	_itpl_sin6;
	} itpl_localaddr;
	<span class="enscript-type">union</span> {
		<span class="enscript-type">struct</span> sockaddr		_itpl_sa;
		<span class="enscript-type">struct</span> sockaddr_in	_itpl_sin;
		<span class="enscript-type">struct</span> sockaddr_in6	_itpl_sin6;
	} itpl_remoteaddr;
};

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">itpl_local_sa</span>		itpl_localaddr._itpl_sa
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">itpl_local_sin</span> 		itpl_localaddr._itpl_sin
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">itpl_local_sin6</span>		itpl_localaddr._itpl_sin6
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">itpl_remote_sa</span> 		itpl_remoteaddr._itpl_sa
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">itpl_remote_sin</span>		itpl_remoteaddr._itpl_sin
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">itpl_remote_sin6</span>	itpl_remoteaddr._itpl_sin6

<span class="enscript-comment">/*
 * TCP connection info auxiliary data (CIAUX_TCP)
 *
 * Do not add new fields to this structure, just add them to tcp_info 
 * structure towards the end. This will preserve binary compatibility.
 */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> conninfo_tcp {
	pid_t			tcpci_peer_pid;	<span class="enscript-comment">/* loopback peer PID if &gt; 0 */</span>
	<span class="enscript-type">struct</span> tcp_info		tcpci_tcp_info;	<span class="enscript-comment">/* TCP info */</span>
} conninfo_tcp_t;

#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">pack</span>()

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

<span class="enscript-type">struct</span> tcp_connection_info {
        u_int8_t	tcpi_state;     <span class="enscript-comment">/* connection state */</span>
        u_int8_t	tcpi_snd_wscale; <span class="enscript-comment">/* Window scale for send window */</span>
        u_int8_t	tcpi_rcv_wscale; <span class="enscript-comment">/* Window scale for receive window */</span>
        u_int8_t	__pad1;
        u_int32_t	tcpi_options;   <span class="enscript-comment">/* TCP options supported */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPCI_OPT_TIMESTAMPS</span>	0x00000001 <span class="enscript-comment">/* Timestamps enabled */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPCI_OPT_SACK</span>		0x00000002 <span class="enscript-comment">/* SACK enabled */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPCI_OPT_WSCALE</span>	0x00000004 <span class="enscript-comment">/* Window scaling enabled */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPCI_OPT_ECN</span>		0x00000008 <span class="enscript-comment">/* ECN enabled */</span>
        u_int32_t	tcpi_flags;     <span class="enscript-comment">/* flags */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPCI_FLAG_LOSSRECOVERY</span> 0x00000001
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TCPCI_FLAG_REORDERING_DETECTED</span>  0x00000002
        u_int32_t	tcpi_rto;       <span class="enscript-comment">/* retransmit timeout in ms */</span>
        u_int32_t	tcpi_maxseg;    <span class="enscript-comment">/* maximum segment size supported */</span>
        u_int32_t	tcpi_snd_ssthresh; <span class="enscript-comment">/* slow start threshold in bytes */</span>
        u_int32_t	tcpi_snd_cwnd;  <span class="enscript-comment">/* send congestion window in bytes */</span>
        u_int32_t	tcpi_snd_wnd;   <span class="enscript-comment">/* send widnow in bytes */</span>
        u_int32_t	tcpi_snd_sbbytes; <span class="enscript-comment">/* bytes in send socket buffer, including in-flight data */</span>
        u_int32_t	tcpi_rcv_wnd;   <span class="enscript-comment">/* receive window in bytes*/</span>
        u_int32_t	tcpi_rttcur;    <span class="enscript-comment">/* most recent RTT in ms */</span>
        u_int32_t	tcpi_srtt;      <span class="enscript-comment">/* average RTT in ms */</span>
        u_int32_t	tcpi_rttvar;    <span class="enscript-comment">/* RTT variance */</span>
	u_int32_t
			<span class="enscript-comment">/* Client-side information */</span>
			<span class="enscript-reference">tcpi_tfo_cookie_req</span>:1, <span class="enscript-comment">/* Cookie requested? */</span>
			<span class="enscript-reference">tcpi_tfo_cookie_rcv</span>:1, <span class="enscript-comment">/* Cookie received? */</span>
			<span class="enscript-reference">tcpi_tfo_syn_loss</span>:1,   <span class="enscript-comment">/* Fallback to reg. TCP after SYN-loss */</span>
			<span class="enscript-reference">tcpi_tfo_syn_data_sent</span>:1, <span class="enscript-comment">/* SYN+data has been sent out */</span>
			<span class="enscript-reference">tcpi_tfo_syn_data_acked</span>:1, <span class="enscript-comment">/* SYN+data has been fully acknowledged */</span>
			<span class="enscript-comment">/* And the following are for server-side information (must be set on the listener socket) */</span>
			<span class="enscript-reference">tcpi_tfo_syn_data_rcv</span>:1, <span class="enscript-comment">/* Server received SYN+data with a valid cookie */</span>
			<span class="enscript-reference">tcpi_tfo_cookie_req_rcv</span>:1, <span class="enscript-comment">/* Server received cookie-request */</span>
			<span class="enscript-reference">tcpi_tfo_cookie_sent</span>:1, <span class="enscript-comment">/* Server announced cookie */</span>
			<span class="enscript-reference">tcpi_tfo_cookie_invalid</span>:1, <span class="enscript-comment">/* Server received an invalid cookie */</span>
			<span class="enscript-reference">__pad2</span>:23;
        u_int64_t	tcpi_txpackets __attribute__((aligned(8)));
        u_int64_t	tcpi_txbytes __attribute__((aligned(8)));
        u_int64_t	tcpi_txretransmitbytes __attribute__((aligned(8)));
        u_int64_t	tcpi_rxpackets __attribute__((aligned(8)));
        u_int64_t	tcpi_rxbytes __attribute__((aligned(8)));
        u_int64_t	tcpi_rxoutoforderbytes __attribute__((aligned(8)));
};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* (_POSIX_C_SOURCE &amp;&amp; !_DARWIN_C_SOURCE) */</span>

#<span class="enscript-reference">endif</span>
</pre>
<hr />
</body></html>