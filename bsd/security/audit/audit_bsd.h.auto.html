<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>audit_bsd.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">audit_bsd.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*-
 * Copyright (c) 2008-2009, Apple Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1.  Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 * 2.  Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 * 3.  Neither the name of Apple Inc. (&quot;Apple&quot;) nor the names of
 *     its contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS &quot;AS IS&quot; AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_SECURITY_AUDIT_AUDIT_BSD_H</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_SECURITY_AUDIT_AUDIT_BSD_H</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/cdefs.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;machine/endian.h&gt;</span>

#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_KERNEL</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">KERNEL</span>)

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">DIAGNOSTIC</span> 
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KASSERT</span>
#<span class="enscript-reference">undef</span> <span class="enscript-variable-name">KASSERT</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">AUDIT_KASSERT_DEBUG</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">KASSERT</span>(exp, msg) do {						\
	<span class="enscript-keyword">if</span> (__builtin_expect(!(exp), 0)) {				\
		printf(<span class="enscript-string">&quot;%s:%d KASSERT failed: &quot;</span>, __FILE__, __LINE__);	\
		printf msg;						\
		printf(<span class="enscript-string">&quot;\n&quot;</span>);						\
	}								\
} <span class="enscript-keyword">while</span> (0)
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">KASSERT</span>(exp, msg) do {						\
	<span class="enscript-keyword">if</span> (__builtin_expect(!(exp), 0)) 				\
		panic msg;						\
} <span class="enscript-keyword">while</span> (0)
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* DIAGNOSTIC */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AU_MAX_LCK_NAME</span>	32	

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">__DARWIN_BYTE_ORDER</span> == <span class="enscript-variable-name">__DARWIN_BIG_ENDIAN</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">be16enc</span>(p, d)   *(p) = (d)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">be32enc</span>(p, d)   *(p) = (d)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">be64enc</span>(p, d)   *(p) = (d)

#<span class="enscript-reference">else</span> <span class="enscript-comment">/* __DARWIN_BYTE_ORDER == __DARWIN_LITTLE_ENDIAN */</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;libkern/OSByteOrder.h&gt;</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">be16enc</span>(p, d)   OSWriteSwapInt16(p, 0, d)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">be32enc</span>(p, d)   OSWriteSwapInt32(p, 0, d)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">be64enc</span>(p, d)   OSWriteSwapInt64(p, 0, d)
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* __DARWIN_BYTE_ORDER == __DARWIN_LITTLE_ENDIAN */</span>

<span class="enscript-comment">/*
 * BSD kernel memory allocation. 
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AUDIT_MALLOC_DEBUG</span>	 0	<span class="enscript-comment">/* Change to 1 for malloc debugging. */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">M_AUDITUNKNOWN</span>		 0
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">M_AUDITDATA</span>		 1
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">M_AUDITPATH</span>		 2
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">M_AUDITTEXT</span>		 3
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">M_AUDITBSM</span>		 4
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">M_AUDITEVCLASS</span>		 5
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">M_AUDIT_PIPE</span>		 6
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">M_AUDIT_PIPE_ENTRY</span>	 7
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">M_AUDIT_PIPE_PRESELECT</span>	 8
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">M_AU_SESSION</span>		 9
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">M_AU_EV_PLIST</span>		10

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NUM_MALLOC_TYPES</span>	11

#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">M_WAITOK</span>
#<span class="enscript-reference">undef</span> 	<span class="enscript-variable-name">M_WAITOK</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">M_WAITOK</span>	0x0000	<span class="enscript-comment">/* ok to block */</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">M_NOWAIT</span>
#<span class="enscript-reference">undef</span> 	<span class="enscript-variable-name">M_NOWAIT</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">M_NOWAIT</span>	0x0001	<span class="enscript-comment">/* do not block */</span>
#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">M_ZERO</span>
#<span class="enscript-reference">undef</span>	<span class="enscript-variable-name">M_ZERO</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">M_ZERO</span>		0x0004	<span class="enscript-comment">/* bzero the allocation */</span>

#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">M_MAGIC</span>
#<span class="enscript-reference">undef</span>	<span class="enscript-variable-name">M_MAGIC</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">M_MAGIC</span>		877983977

#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">MALLOC_DEFINE</span>
#<span class="enscript-reference">undef</span>	<span class="enscript-variable-name">MALLOC_DEFINE</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">AUDIT_MALLOC_DEBUG</span>
<span class="enscript-type">struct</span>	au_malloc_type {
	SInt64 	 	 mt_size;
	SInt64 	 	 mt_maxsize;
	SInt32		 mt_inuse;
	SInt32		 mt_maxused;
	<span class="enscript-type">unsigned</span>	 mt_type;
	<span class="enscript-type">unsigned</span>	 mt_magic;
	<span class="enscript-type">const</span> <span class="enscript-type">char</span>	*mt_shortdesc;
	<span class="enscript-type">const</span> <span class="enscript-type">char</span>	*mt_lastcaller;
};
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> au_malloc_type	au_malloc_type_t;

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MALLOC_DEFINE</span>(type, shortdesc, longdesc)		\
    	au_malloc_type_t  audit_##type[1] = {			\
		{ 0, 0, 0, 0, (type &lt; NUM_MALLOC_TYPES) ? type :\
		  M_AUDITUNKNOWN, M_MAGIC, shortdesc, NULL }	\
	}

<span class="enscript-type">extern</span> au_malloc_type_t	*audit_malloc_types[];

#<span class="enscript-reference">else</span>

<span class="enscript-type">struct</span>	au_malloc_type {
	uint32_t	 mt_magic;
	<span class="enscript-type">const</span> <span class="enscript-type">char</span>	*mt_shortdesc;	
};
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> au_malloc_type	au_malloc_type_t;

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MALLOC_DEFINE</span>(type, shortdesc, longdesc)		\
    	au_malloc_type_t  audit_##type[1] = {			\
		{M_MAGIC, shortdesc }				\
	}

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* AUDIT_MALLOC_DEBUG */</span>

#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">MALLOC_DECLARE</span>
#<span class="enscript-reference">undef</span>	<span class="enscript-variable-name">MALLOC_DECLARE</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MALLOC_DECLARE</span>(type) \
	<span class="enscript-type">extern</span> au_malloc_type_t audit_##type[]

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">AUDIT_MALLOC_DEBUG</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">malloc</span>(sz, tp, fl)	_audit_malloc(sz, audit_##tp, fl, __FUNCTION__)
<span class="enscript-type">void</span> *<span class="enscript-function-name">_audit_malloc</span>(size_t size, au_malloc_type_t *type, <span class="enscript-type">int</span> flags,
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *fn);
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">malloc</span>(sz, tp, fl)	_audit_malloc(sz, audit_##tp, fl)
<span class="enscript-type">void</span> *<span class="enscript-function-name">_audit_malloc</span>(size_t size, au_malloc_type_t *type, <span class="enscript-type">int</span> flags);
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">free</span>(ad, tp)		_audit_free(ad, audit_##tp)
<span class="enscript-type">void</span> <span class="enscript-function-name">_audit_free</span>(<span class="enscript-type">void</span> *addr, au_malloc_type_t *type);

<span class="enscript-comment">/*
 * BSD condition variable.
 */</span>
<span class="enscript-type">struct</span> cv {
	<span class="enscript-type">const</span> <span class="enscript-type">char</span>	*cv_description;
	<span class="enscript-type">int</span>		 cv_waiters;
};

<span class="enscript-comment">/*
 * BSD mutex.
 */</span>
<span class="enscript-type">struct</span> mtx {
	lck_mtx_t	*mtx_lock;
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">DIAGNOSTIC</span>
	<span class="enscript-type">char</span>		 mtx_name[AU_MAX_LCK_NAME];
#<span class="enscript-reference">endif</span>
};

<span class="enscript-comment">/*
 * BSD rw lock.
 */</span>
<span class="enscript-type">struct</span> rwlock {
	lck_rw_t	*rw_lock;
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">DIAGNOSTIC</span>
	<span class="enscript-type">char</span>		 rw_name[AU_MAX_LCK_NAME];
#<span class="enscript-reference">endif</span>
};

<span class="enscript-comment">/*
 * Sleep lock.
 */</span>
<span class="enscript-type">struct</span> slck {
	lck_mtx_t	*sl_mtx;
	<span class="enscript-type">int</span>		 sl_locked;
	<span class="enscript-type">int</span>		 sl_waiting;
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">DIAGNOSTIC</span>
	<span class="enscript-type">char</span>		 sl_name[AU_MAX_LCK_NAME];
#<span class="enscript-reference">endif</span>
};

<span class="enscript-comment">/*
 * Recursive lock.
 */</span>
<span class="enscript-type">struct</span> rlck {
	lck_mtx_t	*rl_mtx;
	uint32_t	 rl_recurse;
	thread_t	 rl_thread;
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">DIAGNOSTIC</span>
	<span class="enscript-type">char</span>		 rl_name[AU_MAX_LCK_NAME];
#<span class="enscript-reference">endif</span>
};
	
<span class="enscript-comment">/*
 * BSD condition variables functions.
 */</span>
<span class="enscript-type">void</span>    <span class="enscript-function-name">_audit_cv_init</span>(<span class="enscript-type">struct</span> cv *cvp, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *desc);
<span class="enscript-type">void</span>    <span class="enscript-function-name">_audit_cv_destroy</span>(<span class="enscript-type">struct</span> cv *cvp);
<span class="enscript-type">void</span>    <span class="enscript-function-name">_audit_cv_signal</span>(<span class="enscript-type">struct</span> cv *cvp);
<span class="enscript-type">void</span>    <span class="enscript-function-name">_audit_cv_broadcast</span>(<span class="enscript-type">struct</span> cv *cvp);
<span class="enscript-type">void</span>    <span class="enscript-function-name">_audit_cv_wait</span>(<span class="enscript-type">struct</span> cv *cvp, lck_mtx_t *mp, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *desc);
<span class="enscript-type">int</span>     <span class="enscript-function-name">_audit_cv_wait_sig</span>(<span class="enscript-type">struct</span> cv *cvp, lck_mtx_t *mp, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *desc);
<span class="enscript-type">int</span>	_audit_cv_wait_continuation(<span class="enscript-type">struct</span> cv *cvp, lck_mtx_t *mp,
	    thread_continue_t function);
#<span class="enscript-reference">define</span> <span class="enscript-function-name">cv_init</span>(cvp, desc)	  _audit_cv_init(cvp, desc)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">cv_destroy</span>(cvp)		  _audit_cv_destroy(cvp)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">cv_signal</span>(cvp)		  _audit_cv_signal(cvp)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">cv_broadcast</span>(cvp)	  _audit_cv_broadcast(cvp)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">cv_broadcastpri</span>(cvp, pri) _audit_cv_broadcast(cvp)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">cv_wait</span>(cvp, mp)	  _audit_cv_wait(cvp, (mp)-&gt;mtx_lock, #cvp)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">cv_wait_sig</span>(cvp, mp)	  _audit_cv_wait_sig(cvp, (mp)-&gt;mtx_lock, #cvp)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">cv_wait_continuation</span>(cvp,mp,f) \
    _audit_cv_wait_continuation(cvp, (mp)-&gt;mtx_lock, f)

<span class="enscript-comment">/*
 * BSD Mutexes.
 */</span>
<span class="enscript-type">void</span>	_audit_mtx_init(<span class="enscript-type">struct</span> mtx *mp, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *name);
<span class="enscript-type">void</span>	_audit_mtx_destroy(<span class="enscript-type">struct</span> mtx *mp);
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">mtx_init</span>(mp, name, type, opts) \
				_audit_mtx_init(mp, name)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">mtx_lock</span>(mp)		lck_mtx_lock((mp)-&gt;mtx_lock)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">mtx_unlock</span>(mp)		lck_mtx_unlock((mp)-&gt;mtx_lock)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">mtx_destroy</span>(mp)		_audit_mtx_destroy(mp)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">mtx_yield</span>(mp)		lck_mtx_yield((mp)-&gt;mtx_lock)

<span class="enscript-comment">/*
 * Sleep lock functions.
 */</span>
<span class="enscript-type">void</span>		_audit_slck_init(<span class="enscript-type">struct</span> slck *lp, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *grpname);
wait_result_t	_audit_slck_lock(<span class="enscript-type">struct</span> slck *lp, <span class="enscript-type">int</span> intr);
<span class="enscript-type">void</span>		_audit_slck_unlock(<span class="enscript-type">struct</span> slck *lp);
<span class="enscript-type">int</span>		_audit_slck_trylock(<span class="enscript-type">struct</span> slck *lp);
<span class="enscript-type">void</span>		_audit_slck_assert(<span class="enscript-type">struct</span> slck *lp, u_int assert);
<span class="enscript-type">void</span>		_audit_slck_destroy(<span class="enscript-type">struct</span> slck *lp);
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">slck_init</span>(lp, name)	_audit_slck_init((lp), (name))
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">slck_lock</span>(lp)		_audit_slck_lock((lp), 0)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">slck_lock_sig</span>(lp)	(_audit_slck_lock((lp), 1) != THREAD_AWAKENED)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">slck_unlock</span>(lp)		_audit_slck_unlock((lp))
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">slck_destroy</span>(lp)	_audit_slck_destroy((lp))

<span class="enscript-comment">/*
 * Recursive lock functions.
 */</span>
<span class="enscript-type">void</span>		_audit_rlck_init(<span class="enscript-type">struct</span> rlck *lp, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *grpname);
<span class="enscript-type">void</span>		_audit_rlck_lock(<span class="enscript-type">struct</span> rlck *lp);
<span class="enscript-type">void</span>		_audit_rlck_unlock(<span class="enscript-type">struct</span> rlck *lp);
<span class="enscript-type">void</span>		_audit_rlck_assert(<span class="enscript-type">struct</span> rlck *lp, u_int assert);
<span class="enscript-type">void</span>		_audit_rlck_destroy(<span class="enscript-type">struct</span> rlck *lp);
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">rlck_init</span>(lp, name)	_audit_rlck_init((lp), (name))
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">rlck_lock</span>(lp)		_audit_rlck_lock((lp))
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">rlck_unlock</span>(lp)		_audit_rlck_unlock((lp))
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">rlck_destroy</span>(lp)	_audit_rlck_destroy((lp))

<span class="enscript-comment">/*
 * BSD rw locks.
 */</span>
<span class="enscript-type">void</span>	_audit_rw_init(<span class="enscript-type">struct</span> rwlock *lp, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *name);
<span class="enscript-type">void</span>	_audit_rw_destroy(<span class="enscript-type">struct</span> rwlock *lp);
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">rw_init</span>(lp, name)	_audit_rw_init(lp, name)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">rw_rlock</span>(lp)		lck_rw_lock_shared((lp)-&gt;rw_lock)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">rw_runlock</span>(lp)		lck_rw_unlock_shared((lp)-&gt;rw_lock)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">rw_wlock</span>(lp)		lck_rw_lock_exclusive((lp)-&gt;rw_lock)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">rw_wunlock</span>(lp)		lck_rw_unlock_exclusive((lp)-&gt;rw_lock)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">rw_destroy</span>(lp)		_audit_rw_destroy(lp)
	
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MA_OWNED</span>		LCK_MTX_ASSERT_OWNED
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RA_LOCKED</span>		LCK_RW_ASSERT_HELD
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RA_RLOCKED</span>		LCK_RW_ASSERT_SHARED
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RA_WLOCKED</span>		LCK_RW_ASSERT_EXCLUSIVE
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SA_LOCKED</span>		LCK_RW_ASSERT_HELD
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SA_XLOCKED</span>		LCK_RW_ASSERT_EXCLUSIVE
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SL_OWNED</span>		LCK_MTX_ASSERT_OWNED
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SL_NOTOWNED</span>		LCK_MTX_ASSERT_NOTOWNED
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">DIAGNOSTIC</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">mtx_assert</span>(mp, wht)	lck_mtx_assert((mp)-&gt;mtx_lock, wht)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">rw_assert</span>(lp, wht)	lck_rw_assert((lp)-&gt;rw_lock, wht)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">sx_assert</span>(lp, wht)	lck_rw_assert((lp)-&gt;sx_lock, wht)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">rlck_assert</span>(lp, wht)	_audit_rlck_assert((lp), wht)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">slck_assert</span>(lp, wht)	_audit_slck_assert((lp), wht)
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">mtx_assert</span>(mp, wht)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">rw_assert</span>(lp, wht)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">sx_assert</span>(lp, wht)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">rlck_assert</span>(lp, wht)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">slck_assert</span>(lp, wht)	
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* DIAGNOSTIC */</span>

<span class="enscript-comment">/*
 * Synchronization initialization.
 */</span>
<span class="enscript-type">void</span>	_audit_lck_grp_init(<span class="enscript-type">void</span>);

<span class="enscript-comment">/*
 * BSD (IPv6) event rate limiter.
 */</span> 
<span class="enscript-type">int</span> <span class="enscript-function-name">_audit_ppsratecheck</span>(<span class="enscript-type">struct</span> timeval *lasttime, <span class="enscript-type">int</span> *curpps, <span class="enscript-type">int</span> maxpps);
#<span class="enscript-reference">define</span> <span class="enscript-function-name">ppsratecheck</span>(tv, cr, mr)	_audit_ppsratecheck(tv, cr, mr)

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* defined(_KERNEL) || defined(KERNEL) */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* _SECURITY_AUDIT_AUDIT_BSD_H */</span>
</pre>
<hr />
</body></html>