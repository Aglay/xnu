<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>hfs_format.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">hfs_format.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000-2013 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">__HFS_FORMAT__</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">__HFS_FORMAT__</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/types.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/appleapiopts.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;hfs/hfs_unistr.h&gt;</span>

<span class="enscript-comment">/*
 * hfs_format.h
 *
 * This file describes the on-disk format for HFS and HFS Plus volumes.
 * The HFS Plus volume format is desciibed in detail in Apple Technote 1150.
 *
 * <a href="http://developer.apple.com/technotes/tn/tn1150.html">http://developer.apple.com/technotes/tn/tn1150.html</a>
 *
 * Note: Starting 10.9, definition of struct HFSUniStr255 exists in hfs_unitstr.h
 *
 */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__cplusplus</span>
<span class="enscript-type">extern</span> <span class="enscript-string">&quot;C&quot;</span> {
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/* some on-disk hfs structures have 68K alignment (misaligned) */</span>

<span class="enscript-comment">/* Signatures used to differentiate between HFS and HFS Plus volumes */</span>
<span class="enscript-type">enum</span> {
	kHFSSigWord		= 0x4244,	<span class="enscript-comment">/* 'BD' in ASCII */</span>
	kHFSPlusSigWord		= 0x482B,	<span class="enscript-comment">/* 'H+' in ASCII */</span>
	kHFSXSigWord		= 0x4858,	<span class="enscript-comment">/* 'HX' in ASCII */</span>

	kHFSPlusVersion		= 0x0004,	<span class="enscript-comment">/* 'H+' volumes are version 4 only */</span>
	kHFSXVersion		= 0x0005,	<span class="enscript-comment">/* 'HX' volumes start with version 5 */</span>

	kHFSPlusMountVersion	= 0x31302E30,	<span class="enscript-comment">/* '10.0' for Mac OS X */</span>
	kHFSJMountVersion	= 0x4846534a,	<span class="enscript-comment">/* 'HFSJ' for journaled HFS+ on OS X */</span>
	kFSKMountVersion	= 0x46534b21	<span class="enscript-comment">/* 'FSK!' for failed journal replay */</span>
};


#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__APPLE_API_PRIVATE</span>
<span class="enscript-comment">/*
 * Mac OS X has two special directories on HFS+ volumes for hardlinked files
 * and hardlinked directories as well as for open-unlinked files.
 *
 * These directories and their contents are not exported from the filesystem
 * under Mac OS X.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">HFSPLUSMETADATAFOLDER</span>       <span class="enscript-string">&quot;\xE2\x90\x80\xE2\x90\x80\xE2\x90\x80\xE2\x90\x80HFS+ Private Data&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">HFSPLUS_DIR_METADATA_FOLDER</span> <span class="enscript-string">&quot;.HFS+ Private Directory Data\xd&quot;</span>

<span class="enscript-comment">/*
 * Files in the &quot;HFS+ Private Data&quot; folder have one of the following prefixes
 * followed by a decimal number (no leading zeros) for the file ID.
 *
 * Note: Earlier version of Mac OS X used a 32 bit random number for the link
 * ref number instead of the file id.
 *
 * e.g.  iNode7182000 and temp3296
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">HFS_INODE_PREFIX</span>	<span class="enscript-string">&quot;iNode&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">HFS_DELETE_PREFIX</span>	<span class="enscript-string">&quot;temp&quot;</span>

<span class="enscript-comment">/*
 * Files in the &quot;.HFS+ Private Directory Data&quot; folder have the following 
 * prefix followed by a decimal number (no leading zeros) for the file ID.
 *
 * e.g. dir_555
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">HFS_DIRINODE_PREFIX</span>	<span class="enscript-string">&quot;dir_&quot;</span>

<span class="enscript-comment">/*
 * Hardlink inodes save the head of the link chain in
 * an extended attribute named FIRST_LINK_XATTR_NAME.
 * The attribute data is the decimal value in ASCII
 * of the cnid for the first link in the chain.
 *
 * This extended attribute is private (i.e. its not
 * exported in the getxattr/listxattr POSIX APIs).
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">FIRST_LINK_XATTR_NAME</span>	<span class="enscript-string">&quot;com.apple.system.hfs.firstlink&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">FIRST_LINK_XATTR_REC_SIZE</span> (sizeof(HFSPlusAttrData) - 2 + 12)

<span class="enscript-comment">/*
 * The name space ID for generating an HFS volume UUID
 *
 * B3E20F39-F292-11D6-97A4-00306543ECAC
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">HFS_UUID_NAMESPACE_ID</span>  <span class="enscript-string">&quot;\xB3\xE2\x0F\x39\xF2\x92\x11\xD6\x97\xA4\x00\x30\x65\x43\xEC\xAC&quot;</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* __APPLE_API_PRIVATE */</span>

<span class="enscript-comment">/*
 * Indirect link files (hard links) have the following type/creator.
 */</span>
<span class="enscript-type">enum</span> {
	kHardLinkFileType = 0x686C6E6B,  <span class="enscript-comment">/* 'hlnk' */</span>
	kHFSPlusCreator   = 0x6866732B   <span class="enscript-comment">/* 'hfs+' */</span>
};


<span class="enscript-comment">/*
 *	File type and creator for symbolic links
 */</span>
<span class="enscript-type">enum</span> {
      kSymLinkFileType  = 0x736C6E6B, <span class="enscript-comment">/* 'slnk' */</span>
      kSymLinkCreator   = 0x72686170  <span class="enscript-comment">/* 'rhap' */</span>
};


<span class="enscript-type">enum</span> {
	kHFSMaxVolumeNameChars		= 27,
	kHFSMaxFileNameChars		= 31,
	kHFSPlusMaxFileNameChars	= 255
};


<span class="enscript-comment">/* Extent overflow file data structures */</span>

<span class="enscript-comment">/* HFS Extent key */</span>
<span class="enscript-type">struct</span> HFSExtentKey {
	u_int8_t 	keyLength;	<span class="enscript-comment">/* length of key, excluding this field */</span>
	u_int8_t 	forkType;	<span class="enscript-comment">/* 0 = data fork, FF = resource fork */</span>
	u_int32_t 	fileID;		<span class="enscript-comment">/* file ID */</span>
	u_int16_t 	startBlock;	<span class="enscript-comment">/* first file allocation block number in this extent */</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSExtentKey HFSExtentKey;

<span class="enscript-comment">/* HFS Plus Extent key */</span>
<span class="enscript-type">struct</span> HFSPlusExtentKey {
	u_int16_t 	keyLength;		<span class="enscript-comment">/* length of key, excluding this field */</span>
	u_int8_t 	forkType;		<span class="enscript-comment">/* 0 = data fork, FF = resource fork */</span>
	u_int8_t 	pad;			<span class="enscript-comment">/* make the other fields align on 32-bit boundary */</span>
	u_int32_t 	fileID;			<span class="enscript-comment">/* file ID */</span>
	u_int32_t 	startBlock;		<span class="enscript-comment">/* first file allocation block number in this extent */</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSPlusExtentKey HFSPlusExtentKey;

<span class="enscript-comment">/* Number of extent descriptors per extent record */</span>
<span class="enscript-type">enum</span> {
	kHFSExtentDensity	= 3,
	kHFSPlusExtentDensity	= 8
};

<span class="enscript-comment">/* HFS extent descriptor */</span>
<span class="enscript-type">struct</span> HFSExtentDescriptor {
	u_int16_t 	startBlock;		<span class="enscript-comment">/* first allocation block */</span>
	u_int16_t 	blockCount;		<span class="enscript-comment">/* number of allocation blocks */</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSExtentDescriptor HFSExtentDescriptor;

<span class="enscript-comment">/* HFS Plus extent descriptor */</span>
<span class="enscript-type">struct</span> HFSPlusExtentDescriptor {
	u_int32_t 	startBlock;		<span class="enscript-comment">/* first allocation block */</span>
	u_int32_t 	blockCount;		<span class="enscript-comment">/* number of allocation blocks */</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSPlusExtentDescriptor HFSPlusExtentDescriptor;

<span class="enscript-comment">/* HFS extent record */</span>
<span class="enscript-type">typedef</span> HFSExtentDescriptor HFSExtentRecord[3];

<span class="enscript-comment">/* HFS Plus extent record */</span>
<span class="enscript-type">typedef</span> HFSPlusExtentDescriptor HFSPlusExtentRecord[8];


<span class="enscript-comment">/* Finder information */</span>
<span class="enscript-type">struct</span> FndrFileInfo {
	u_int32_t 	fdType;		<span class="enscript-comment">/* file type */</span>
	u_int32_t 	fdCreator;	<span class="enscript-comment">/* file creator */</span>
	u_int16_t 	fdFlags;	<span class="enscript-comment">/* Finder flags */</span>
	<span class="enscript-type">struct</span> {
	    int16_t	v;		<span class="enscript-comment">/* file's location */</span>
	    int16_t	h;
	} fdLocation;
	int16_t 	opaque;
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> FndrFileInfo FndrFileInfo;

<span class="enscript-type">struct</span> FndrDirInfo {
	<span class="enscript-type">struct</span> {			<span class="enscript-comment">/* folder's window rectangle */</span>
	    int16_t	top;
	    int16_t	left;
	    int16_t	bottom;
	    int16_t	right;
	} frRect;
	<span class="enscript-type">unsigned</span> <span class="enscript-type">short</span> 	frFlags;	<span class="enscript-comment">/* Finder flags */</span>
	<span class="enscript-type">struct</span> {
	    u_int16_t	v;		<span class="enscript-comment">/* folder's location */</span>
	    u_int16_t	h;
	} frLocation;
	int16_t 	opaque;
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> FndrDirInfo FndrDirInfo;

<span class="enscript-type">struct</span> FndrOpaqueInfo {
	int8_t opaque[16];
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> FndrOpaqueInfo FndrOpaqueInfo;

<span class="enscript-type">struct</span> FndrExtendedDirInfo {
	u_int32_t document_id;
	u_int32_t date_added;
	u_int16_t extended_flags;
	u_int16_t reserved3;
	u_int32_t write_gen_counter;
} __attribute__((aligned(2), packed));

<span class="enscript-type">struct</span> FndrExtendedFileInfo {
	u_int32_t document_id;
	u_int32_t date_added;
	u_int16_t extended_flags;
	u_int16_t reserved2;
	u_int32_t write_gen_counter;
} __attribute__((aligned(2), packed));

<span class="enscript-comment">/* HFS Plus Fork data info - 80 bytes */</span>
<span class="enscript-type">struct</span> HFSPlusForkData {
	u_int64_t 		logicalSize;	<span class="enscript-comment">/* fork's logical size in bytes */</span>
	u_int32_t 		clumpSize;	<span class="enscript-comment">/* fork's clump size in bytes */</span>
	u_int32_t 		totalBlocks;	<span class="enscript-comment">/* total blocks used by this fork */</span>
	HFSPlusExtentRecord 	extents;	<span class="enscript-comment">/* initial set of extents */</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSPlusForkData HFSPlusForkData;


<span class="enscript-comment">/* Mac OS X has 16 bytes worth of &quot;BSD&quot; info.
 *
 * Note:  Mac OS 9 implementations and applications
 * should preserve, but not change, this information.
 */</span>
<span class="enscript-type">struct</span> HFSPlusBSDInfo {
	u_int32_t 	ownerID;	<span class="enscript-comment">/* user-id of owner or hard link chain previous link */</span>
	u_int32_t 	groupID;	<span class="enscript-comment">/* group-id of owner or hard link chain next link */</span>
	u_int8_t 	adminFlags;	<span class="enscript-comment">/* super-user changeable flags */</span>
	u_int8_t 	ownerFlags;	<span class="enscript-comment">/* owner changeable flags */</span>
	u_int16_t 	fileMode;	<span class="enscript-comment">/* file type and permission bits */</span>
	<span class="enscript-type">union</span> {
	    u_int32_t	iNodeNum;	<span class="enscript-comment">/* indirect node number (hard links only) */</span>
	    u_int32_t	linkCount;	<span class="enscript-comment">/* links that refer to this indirect node */</span>
	    u_int32_t	rawDevice;	<span class="enscript-comment">/* special file device (FBLK and FCHR only) */</span>
	} special;
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSPlusBSDInfo HFSPlusBSDInfo;

<span class="enscript-comment">/*
 * Hardlink &quot;links&quot; resolve to an inode
 * and the actual uid/gid comes from that
 * inode.
 *
 * We repurpose the links's uid/gid fields
 * for the hardlink link chain. The chain
 * consists of a doubly linked list of file
 * ids.
 */</span>
 
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">hl_firstLinkID</span>     reserved1         <span class="enscript-comment">/* Valid only if HasLinkChain flag is set (indirect nodes only) */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">hl_prevLinkID</span>      bsdInfo.ownerID   <span class="enscript-comment">/* Valid only if HasLinkChain flag is set */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">hl_nextLinkID</span>      bsdInfo.groupID   <span class="enscript-comment">/* Valid only if HasLinkChain flag is set */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">hl_linkReference</span>   bsdInfo.special.iNodeNum
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">hl_linkCount</span>       bsdInfo.special.linkCount


<span class="enscript-comment">/* Catalog file data structures */</span>

<span class="enscript-type">enum</span> {
	kHFSRootParentID		= 1,	<span class="enscript-comment">/* Parent ID of the root folder */</span>
	kHFSRootFolderID		= 2,	<span class="enscript-comment">/* Folder ID of the root folder */</span>
	kHFSExtentsFileID		= 3,	<span class="enscript-comment">/* File ID of the extents file */</span>
	kHFSCatalogFileID		= 4,	<span class="enscript-comment">/* File ID of the catalog file */</span>
	kHFSBadBlockFileID		= 5,	<span class="enscript-comment">/* File ID of the bad allocation block file */</span>
	kHFSAllocationFileID		= 6,	<span class="enscript-comment">/* File ID of the allocation file (HFS Plus only) */</span>
	kHFSStartupFileID		= 7,	<span class="enscript-comment">/* File ID of the startup file (HFS Plus only) */</span>
	kHFSAttributesFileID		= 8,	<span class="enscript-comment">/* File ID of the attribute file (HFS Plus only) */</span>
	kHFSAttributeDataFileID         = 13,	<span class="enscript-comment">/* Used in Mac OS X runtime for extent based attributes */</span>
	                                        <span class="enscript-comment">/* kHFSAttributeDataFileID is never stored on disk. */</span>
	kHFSRepairCatalogFileID		= 14,	<span class="enscript-comment">/* Used when rebuilding Catalog B-tree */</span>
	kHFSBogusExtentFileID		= 15,	<span class="enscript-comment">/* Used for exchanging extents in extents file */</span>
	kHFSFirstUserCatalogNodeID	= 16
};

<span class="enscript-comment">/* HFS catalog key */</span>
<span class="enscript-type">struct</span> HFSCatalogKey {
	u_int8_t 	keyLength;		<span class="enscript-comment">/* key length (in bytes) */</span>
	u_int8_t 	reserved;		<span class="enscript-comment">/* reserved (set to zero) */</span>
	u_int32_t 	parentID;		<span class="enscript-comment">/* parent folder ID */</span>
	u_int8_t 	nodeName[kHFSMaxFileNameChars + 1]; <span class="enscript-comment">/* catalog node name */</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSCatalogKey HFSCatalogKey;

<span class="enscript-comment">/* HFS Plus catalog key */</span>
<span class="enscript-type">struct</span> HFSPlusCatalogKey {
	u_int16_t 		keyLength;	<span class="enscript-comment">/* key length (in bytes) */</span>
	u_int32_t 		parentID;	<span class="enscript-comment">/* parent folder ID */</span>
	HFSUniStr255 		nodeName;	<span class="enscript-comment">/* catalog node name */</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSPlusCatalogKey HFSPlusCatalogKey;

<span class="enscript-comment">/* Catalog record types */</span>
<span class="enscript-type">enum</span> {
	<span class="enscript-comment">/* HFS Catalog Records */</span>
	kHFSFolderRecord		= 0x0100,	<span class="enscript-comment">/* Folder record */</span>
	kHFSFileRecord			= 0x0200,	<span class="enscript-comment">/* File record */</span>
	kHFSFolderThreadRecord		= 0x0300,	<span class="enscript-comment">/* Folder thread record */</span>
	kHFSFileThreadRecord		= 0x0400,	<span class="enscript-comment">/* File thread record */</span>

	<span class="enscript-comment">/* HFS Plus Catalog Records */</span>
	kHFSPlusFolderRecord		= 1,		<span class="enscript-comment">/* Folder record */</span>
	kHFSPlusFileRecord		= 2,		<span class="enscript-comment">/* File record */</span>
	kHFSPlusFolderThreadRecord	= 3,		<span class="enscript-comment">/* Folder thread record */</span>
	kHFSPlusFileThreadRecord	= 4		<span class="enscript-comment">/* File thread record */</span>
};


<span class="enscript-comment">/* Catalog file record flags */</span>
<span class="enscript-type">enum</span> {
	kHFSFileLockedBit	= 0x0000,	<span class="enscript-comment">/* file is locked and cannot be written to */</span>
	kHFSFileLockedMask	= 0x0001,

	kHFSThreadExistsBit	= 0x0001,	<span class="enscript-comment">/* a file thread record exists for this file */</span>
	kHFSThreadExistsMask	= 0x0002,

	kHFSHasAttributesBit	= 0x0002,	<span class="enscript-comment">/* object has extended attributes */</span>
	kHFSHasAttributesMask	= 0x0004,

	kHFSHasSecurityBit	= 0x0003,	<span class="enscript-comment">/* object has security data (ACLs) */</span>
	kHFSHasSecurityMask	= 0x0008,

	kHFSHasFolderCountBit	= 0x0004,	<span class="enscript-comment">/* only for HFSX, folder maintains a separate sub-folder count */</span>
	kHFSHasFolderCountMask	= 0x0010,	<span class="enscript-comment">/* (sum of folder records and directory hard links) */</span>

	kHFSHasLinkChainBit	= 0x0005,	<span class="enscript-comment">/* has hardlink chain (inode or link) */</span>
	kHFSHasLinkChainMask	= 0x0020,

	kHFSHasChildLinkBit	= 0x0006,	<span class="enscript-comment">/* folder has a child that's a dir link */</span>
	kHFSHasChildLinkMask	= 0x0040,

	kHFSHasDateAddedBit     = 0x0007,	<span class="enscript-comment">/* File/Folder has the date-added stored in the finder info. */</span>
	kHFSHasDateAddedMask    = 0x0080, 

	kHFSFastDevPinnedBit    = 0x0008,       <span class="enscript-comment">/* this file has been pinned to the fast-device by the hot-file code on cooperative fusion */</span>
	kHFSFastDevPinnedMask   = 0x0100,

	kHFSDoNotFastDevPinBit  = 0x0009,       <span class="enscript-comment">/* this file can not be pinned to the fast-device */</span>
	kHFSDoNotFastDevPinMask = 0x0200,

	kHFSFastDevCandidateBit  = 0x000a,      <span class="enscript-comment">/* this item is a potential candidate for fast-dev pinning (as are any of its descendents */</span>
	kHFSFastDevCandidateMask = 0x0400,

	kHFSAutoCandidateBit     = 0x000b,      <span class="enscript-comment">/* this item was automatically marked as a fast-dev candidate by the kernel */</span>
	kHFSAutoCandidateMask    = 0x0800

	<span class="enscript-comment">// There are only 4 flag bits remaining: 0x1000, 0x2000, 0x4000, 0x8000
</span>
};


<span class="enscript-comment">/* HFS catalog folder record - 70 bytes */</span>
<span class="enscript-type">struct</span> HFSCatalogFolder {
	int16_t 		recordType;		<span class="enscript-comment">/* == kHFSFolderRecord */</span>
	u_int16_t 		flags;			<span class="enscript-comment">/* folder flags */</span>
	u_int16_t 		valence;		<span class="enscript-comment">/* folder valence */</span>
	u_int32_t		folderID;		<span class="enscript-comment">/* folder ID */</span>
	u_int32_t 		createDate;		<span class="enscript-comment">/* date and time of creation */</span>
	u_int32_t 		modifyDate;		<span class="enscript-comment">/* date and time of last modification */</span>
	u_int32_t 		backupDate;		<span class="enscript-comment">/* date and time of last backup */</span>
	FndrDirInfo 		userInfo;		<span class="enscript-comment">/* Finder information */</span>
	FndrOpaqueInfo		finderInfo;		<span class="enscript-comment">/* additional Finder information */</span>
	u_int32_t 		reserved[4];		<span class="enscript-comment">/* reserved - initialized as zero */</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSCatalogFolder HFSCatalogFolder;

<span class="enscript-comment">/* HFS Plus catalog folder record - 88 bytes */</span>
<span class="enscript-type">struct</span> HFSPlusCatalogFolder {
	int16_t 		recordType;		<span class="enscript-comment">/* == kHFSPlusFolderRecord */</span>
	u_int16_t 		flags;			<span class="enscript-comment">/* file flags */</span>
	u_int32_t 		valence;		<span class="enscript-comment">/* folder's item count */</span>
	u_int32_t 		folderID;		<span class="enscript-comment">/* folder ID */</span>
	u_int32_t 		createDate;		<span class="enscript-comment">/* date and time of creation */</span>
	u_int32_t 		contentModDate;		<span class="enscript-comment">/* date and time of last content modification */</span>
	u_int32_t 		attributeModDate;	<span class="enscript-comment">/* date and time of last attribute modification */</span>
	u_int32_t 		accessDate;		<span class="enscript-comment">/* date and time of last access (MacOS X only) */</span>
	u_int32_t 		backupDate;		<span class="enscript-comment">/* date and time of last backup */</span>
	HFSPlusBSDInfo		bsdInfo;		<span class="enscript-comment">/* permissions (for MacOS X) */</span>
	FndrDirInfo 		userInfo;		<span class="enscript-comment">/* Finder information */</span>
	FndrOpaqueInfo	 	finderInfo;		<span class="enscript-comment">/* additional Finder information */</span>
	u_int32_t 		textEncoding;		<span class="enscript-comment">/* hint for name conversions */</span>
	u_int32_t 		folderCount;		<span class="enscript-comment">/* number of enclosed folders, active when HasFolderCount is set */</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSPlusCatalogFolder HFSPlusCatalogFolder;

<span class="enscript-comment">/* HFS catalog file record - 102 bytes */</span>
<span class="enscript-type">struct</span> HFSCatalogFile {
	int16_t 		recordType;		<span class="enscript-comment">/* == kHFSFileRecord */</span>
	u_int8_t 		flags;			<span class="enscript-comment">/* file flags */</span>
	int8_t 			fileType;		<span class="enscript-comment">/* file type (unused ?) */</span>
	FndrFileInfo 		userInfo;		<span class="enscript-comment">/* Finder information */</span>
	u_int32_t 		fileID;			<span class="enscript-comment">/* file ID */</span>
	u_int16_t 		dataStartBlock;		<span class="enscript-comment">/* not used - set to zero */</span>
	int32_t 		dataLogicalSize;	<span class="enscript-comment">/* logical EOF of data fork */</span>
	int32_t 		dataPhysicalSize;	<span class="enscript-comment">/* physical EOF of data fork */</span>
	u_int16_t		rsrcStartBlock;		<span class="enscript-comment">/* not used - set to zero */</span>
	int32_t			rsrcLogicalSize;	<span class="enscript-comment">/* logical EOF of resource fork */</span>
	int32_t			rsrcPhysicalSize;	<span class="enscript-comment">/* physical EOF of resource fork */</span>
	u_int32_t		createDate;		<span class="enscript-comment">/* date and time of creation */</span>
	u_int32_t		modifyDate;		<span class="enscript-comment">/* date and time of last modification */</span>
	u_int32_t		backupDate;		<span class="enscript-comment">/* date and time of last backup */</span>
	FndrOpaqueInfo		finderInfo;		<span class="enscript-comment">/* additional Finder information */</span>
	u_int16_t		clumpSize;		<span class="enscript-comment">/* file clump size (not used) */</span>
	HFSExtentRecord		dataExtents;		<span class="enscript-comment">/* first data fork extent record */</span>
	HFSExtentRecord		rsrcExtents;		<span class="enscript-comment">/* first resource fork extent record */</span>
	u_int32_t		reserved;		<span class="enscript-comment">/* reserved - initialized as zero */</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSCatalogFile HFSCatalogFile;

<span class="enscript-comment">/* HFS Plus catalog file record - 248 bytes */</span>
<span class="enscript-type">struct</span> HFSPlusCatalogFile {
	int16_t 		recordType;		<span class="enscript-comment">/* == kHFSPlusFileRecord */</span>
	u_int16_t 		flags;			<span class="enscript-comment">/* file flags */</span>
	u_int32_t 		reserved1;		<span class="enscript-comment">/* reserved - initialized as zero */</span>
	u_int32_t 		fileID;			<span class="enscript-comment">/* file ID */</span>
	u_int32_t 		createDate;		<span class="enscript-comment">/* date and time of creation */</span>
	u_int32_t 		contentModDate;		<span class="enscript-comment">/* date and time of last content modification */</span>
	u_int32_t 		attributeModDate;	<span class="enscript-comment">/* date and time of last attribute modification */</span>
	u_int32_t 		accessDate;		<span class="enscript-comment">/* date and time of last access (MacOS X only) */</span>
	u_int32_t 		backupDate;		<span class="enscript-comment">/* date and time of last backup */</span>
	HFSPlusBSDInfo 		bsdInfo;		<span class="enscript-comment">/* permissions (for MacOS X) */</span>
	FndrFileInfo 		userInfo;		<span class="enscript-comment">/* Finder information */</span>
	FndrOpaqueInfo	 	finderInfo;		<span class="enscript-comment">/* additional Finder information */</span>
	u_int32_t 		textEncoding;		<span class="enscript-comment">/* hint for name conversions */</span>
	u_int32_t 		reserved2;		<span class="enscript-comment">/* reserved - initialized as zero */</span>

	<span class="enscript-comment">/* Note: these start on double long (64 bit) boundary */</span>
	HFSPlusForkData 	dataFork;		<span class="enscript-comment">/* size and block data for data fork */</span>
	HFSPlusForkData 	resourceFork;		<span class="enscript-comment">/* size and block data for resource fork */</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSPlusCatalogFile HFSPlusCatalogFile;

<span class="enscript-comment">/* HFS catalog thread record - 46 bytes */</span>
<span class="enscript-type">struct</span> HFSCatalogThread {
	int16_t 	recordType;		<span class="enscript-comment">/* == kHFSFolderThreadRecord or kHFSFileThreadRecord */</span>
	int32_t 	reserved[2];		<span class="enscript-comment">/* reserved - initialized as zero */</span>
	u_int32_t 	parentID;		<span class="enscript-comment">/* parent ID for this catalog node */</span>
	u_int8_t 	nodeName[kHFSMaxFileNameChars + 1]; <span class="enscript-comment">/* name of this catalog node */</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSCatalogThread HFSCatalogThread;

<span class="enscript-comment">/* HFS Plus catalog thread record -- 264 bytes */</span>
<span class="enscript-type">struct</span> HFSPlusCatalogThread {
	int16_t 	recordType;		<span class="enscript-comment">/* == kHFSPlusFolderThreadRecord or kHFSPlusFileThreadRecord */</span>
	int16_t 	reserved;		<span class="enscript-comment">/* reserved - initialized as zero */</span>
	u_int32_t 	parentID;		<span class="enscript-comment">/* parent ID for this catalog node */</span>
	HFSUniStr255 	nodeName;		<span class="enscript-comment">/* name of this catalog node (variable length) */</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSPlusCatalogThread HFSPlusCatalogThread;

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__APPLE_API_UNSTABLE</span>
<span class="enscript-comment">/*
 * 	These are the types of records in the attribute B-tree.  The values were
 * 	chosen so that they wouldn't conflict with the catalog record types.
 */</span>
<span class="enscript-type">enum</span> {
	kHFSPlusAttrInlineData	= 0x10,   <span class="enscript-comment">/* attributes whose data fits in a b-tree node */</span>
	kHFSPlusAttrForkData	= 0x20,   <span class="enscript-comment">/* extent based attributes (data lives in extents) */</span>
	kHFSPlusAttrExtents	= 0x30    <span class="enscript-comment">/* overflow extents for large attributes */</span>
};


<span class="enscript-comment">/*
 *  	HFSPlusAttrForkData
 * 	For larger attributes, whose value is stored in allocation blocks.
 * 	If the attribute has more than 8 extents, there will be additional
 * 	records (of type HFSPlusAttrExtents) for this attribute.
 */</span>
<span class="enscript-type">struct</span> HFSPlusAttrForkData {
	u_int32_t 	recordType;		<span class="enscript-comment">/* == kHFSPlusAttrForkData*/</span>
	u_int32_t 	reserved;
	HFSPlusForkData theFork;		<span class="enscript-comment">/* size and first extents of value*/</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSPlusAttrForkData HFSPlusAttrForkData;

<span class="enscript-comment">/*
 * 	HFSPlusAttrExtents
 * 	This record contains information about overflow extents for large,
 * 	fragmented attributes.
 */</span>
<span class="enscript-type">struct</span> HFSPlusAttrExtents {
	u_int32_t 		recordType;	<span class="enscript-comment">/* == kHFSPlusAttrExtents*/</span>
	u_int32_t 		reserved;
	HFSPlusExtentRecord	extents;	<span class="enscript-comment">/* additional extents*/</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSPlusAttrExtents HFSPlusAttrExtents;

<span class="enscript-comment">/*
 * Atrributes B-tree Data Record
 *
 * For small attributes, whose entire value is stored
 * within a single B-tree record.
 */</span>
<span class="enscript-type">struct</span> HFSPlusAttrData {
	u_int32_t    recordType;   <span class="enscript-comment">/* == kHFSPlusAttrInlineData */</span>
	u_int32_t    reserved[2];
	u_int32_t    attrSize;     <span class="enscript-comment">/* size of attribute data in bytes */</span>
	u_int8_t     attrData[2];  <span class="enscript-comment">/* variable length */</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSPlusAttrData HFSPlusAttrData;


<span class="enscript-comment">/* HFSPlusAttrInlineData is obsolete use HFSPlusAttrData instead */</span>
<span class="enscript-type">struct</span> HFSPlusAttrInlineData {
	u_int32_t 	recordType;
	u_int32_t 	reserved;
	u_int32_t 	logicalSize;
	u_int8_t 	userData[2];
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSPlusAttrInlineData HFSPlusAttrInlineData;


<span class="enscript-comment">/* A generic Attribute Record */</span>
<span class="enscript-type">union</span> HFSPlusAttrRecord {
	u_int32_t 		recordType;
	HFSPlusAttrInlineData 	inlineData;   <span class="enscript-comment">/* NOT USED */</span>
	HFSPlusAttrData 	attrData;
	HFSPlusAttrForkData 	forkData;
	HFSPlusAttrExtents 	overflowExtents;
};
<span class="enscript-type">typedef</span> <span class="enscript-type">union</span> HFSPlusAttrRecord HFSPlusAttrRecord;

<span class="enscript-comment">/* Attribute key */</span>
<span class="enscript-type">enum</span> { kHFSMaxAttrNameLen = 127 };
<span class="enscript-type">struct</span> HFSPlusAttrKey {
	u_int16_t     keyLength;       <span class="enscript-comment">/* key length (in bytes) */</span>
	u_int16_t     pad;	       <span class="enscript-comment">/* set to zero */</span>
	u_int32_t     fileID;          <span class="enscript-comment">/* file associated with attribute */</span>
	u_int32_t     startBlock;      <span class="enscript-comment">/* first allocation block number for extents */</span>
	u_int16_t     attrNameLen;     <span class="enscript-comment">/* number of unicode characters */</span>
	u_int16_t     attrName[kHFSMaxAttrNameLen];   <span class="enscript-comment">/* attribute name (Unicode) */</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSPlusAttrKey HFSPlusAttrKey;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kHFSPlusAttrKeyMaximumLength</span>   (sizeof(HFSPlusAttrKey) - sizeof(u_int16_t))
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kHFSPlusAttrKeyMinimumLength</span>   (kHFSPlusAttrKeyMaximumLength - kHFSMaxAttrNameLen*sizeof(u_int16_t))

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* __APPLE_API_UNSTABLE */</span>


<span class="enscript-comment">/* Key and node lengths */</span>
<span class="enscript-type">enum</span> {
	kHFSPlusExtentKeyMaximumLength = <span class="enscript-keyword">sizeof</span>(HFSPlusExtentKey) - <span class="enscript-keyword">sizeof</span>(u_int16_t),
	kHFSExtentKeyMaximumLength	= <span class="enscript-keyword">sizeof</span>(HFSExtentKey) - <span class="enscript-keyword">sizeof</span>(u_int8_t),
	kHFSPlusCatalogKeyMaximumLength = <span class="enscript-keyword">sizeof</span>(HFSPlusCatalogKey) - <span class="enscript-keyword">sizeof</span>(u_int16_t),
	kHFSPlusCatalogKeyMinimumLength = kHFSPlusCatalogKeyMaximumLength - <span class="enscript-keyword">sizeof</span>(HFSUniStr255) + <span class="enscript-keyword">sizeof</span>(u_int16_t),
	kHFSCatalogKeyMaximumLength	= <span class="enscript-keyword">sizeof</span>(HFSCatalogKey) - <span class="enscript-keyword">sizeof</span>(u_int8_t),
	kHFSCatalogKeyMinimumLength	= kHFSCatalogKeyMaximumLength - (kHFSMaxFileNameChars + 1) + <span class="enscript-keyword">sizeof</span>(u_int8_t),
	kHFSPlusCatalogMinNodeSize	= 4096,
	kHFSPlusExtentMinNodeSize	= 512,
	kHFSPlusAttrMinNodeSize		= 4096
};

<span class="enscript-comment">/* HFS and HFS Plus volume attribute bits */</span>
<span class="enscript-type">enum</span> {
	<span class="enscript-comment">/* Bits 0-6 are reserved (always cleared by MountVol call) */</span>
	kHFSVolumeHardwareLockBit	= 7,		<span class="enscript-comment">/* volume is locked by hardware */</span>
	kHFSVolumeUnmountedBit		= 8,		<span class="enscript-comment">/* volume was successfully unmounted */</span>
	kHFSVolumeSparedBlocksBit	= 9,		<span class="enscript-comment">/* volume has bad blocks spared */</span>
	kHFSVolumeNoCacheRequiredBit = 10,		<span class="enscript-comment">/* don't cache volume blocks (i.e. RAM or ROM disk) */</span>
	kHFSBootVolumeInconsistentBit = 11,		<span class="enscript-comment">/* boot volume is inconsistent (System 7.6 and later) */</span>
	kHFSCatalogNodeIDsReusedBit = 12,
	kHFSVolumeJournaledBit = 13,			<span class="enscript-comment">/* this volume has a journal on it */</span>
	kHFSVolumeInconsistentBit = 14,			<span class="enscript-comment">/* serious inconsistencies detected at runtime */</span>
	kHFSVolumeSoftwareLockBit	= 15,		<span class="enscript-comment">/* volume is locked by software */</span>
	<span class="enscript-comment">/*
	 * HFS only has 16 bits of attributes in the MDB, but HFS Plus has 32 bits.
	 * Therefore, bits 16-31 can only be used on HFS Plus.
	 */</span>
	kHFSUnusedNodeFixBit = 31,				<span class="enscript-comment">/* Unused nodes in the Catalog B-tree have been zero-filled.  See Radar #6947811. */</span>
	kHFSContentProtectionBit = 30,			<span class="enscript-comment">/* Volume has per-file content protection */</span>

	<span class="enscript-comment">/***  Keep these in sync with the bits above ! ****/</span>
	kHFSVolumeHardwareLockMask		= 0x00000080,
	kHFSVolumeUnmountedMask			= 0x00000100,
	kHFSVolumeSparedBlocksMask		= 0x00000200,
	kHFSVolumeNoCacheRequiredMask 	= 0x00000400,
	kHFSBootVolumeInconsistentMask	= 0x00000800,
	kHFSCatalogNodeIDsReusedMask 	= 0x00001000,
	kHFSVolumeJournaledMask			= 0x00002000,
	kHFSVolumeInconsistentMask 		= 0x00004000,
	kHFSVolumeSoftwareLockMask		= 0x00008000,
	
	<span class="enscript-comment">/* Bits 16-31 are allocated from high to low */</span>

	kHFSContentProtectionMask 		= 0x40000000,
	kHFSUnusedNodeFixMask 			= 0x80000000,
	
	kHFSMDBAttributesMask			= 0x8380
};

<span class="enscript-type">enum</span> {
	kHFSUnusedNodesFixDate = 0xc5ef2480		<span class="enscript-comment">/* March 25, 2009 */</span>
};

<span class="enscript-comment">/* HFS Master Directory Block - 162 bytes */</span>
<span class="enscript-comment">/* Stored at sector #2 (3rd sector) and second-to-last sector. */</span>
<span class="enscript-type">struct</span> HFSMasterDirectoryBlock {
	u_int16_t 		drSigWord;	<span class="enscript-comment">/* == kHFSSigWord */</span>
	u_int32_t 		drCrDate;	<span class="enscript-comment">/* date and time of volume creation */</span>
	u_int32_t 		drLsMod;	<span class="enscript-comment">/* date and time of last modification */</span>
	u_int16_t 		drAtrb;		<span class="enscript-comment">/* volume attributes */</span>
	u_int16_t 		drNmFls;	<span class="enscript-comment">/* number of files in root folder */</span>
	u_int16_t 		drVBMSt;	<span class="enscript-comment">/* first block of volume bitmap */</span>
	u_int16_t 		drAllocPtr;	<span class="enscript-comment">/* start of next allocation search */</span>
	u_int16_t 		drNmAlBlks;	<span class="enscript-comment">/* number of allocation blocks in volume */</span>
	u_int32_t 		drAlBlkSiz;	<span class="enscript-comment">/* size (in bytes) of allocation blocks */</span>
	u_int32_t 		drClpSiz;	<span class="enscript-comment">/* default clump size */</span>
	u_int16_t 		drAlBlSt;	<span class="enscript-comment">/* first allocation block in volume */</span>
	u_int32_t 		drNxtCNID;	<span class="enscript-comment">/* next unused catalog node ID */</span>
	u_int16_t 		drFreeBks;	<span class="enscript-comment">/* number of unused allocation blocks */</span>
	u_int8_t 		drVN[kHFSMaxVolumeNameChars + 1];  <span class="enscript-comment">/* volume name */</span>
	u_int32_t 		drVolBkUp;	<span class="enscript-comment">/* date and time of last backup */</span>
	u_int16_t 		drVSeqNum;	<span class="enscript-comment">/* volume backup sequence number */</span>
	u_int32_t 		drWrCnt;	<span class="enscript-comment">/* volume write count */</span>
	u_int32_t 		drXTClpSiz;	<span class="enscript-comment">/* clump size for extents overflow file */</span>
	u_int32_t 		drCTClpSiz;	<span class="enscript-comment">/* clump size for catalog file */</span>
	u_int16_t 		drNmRtDirs;	<span class="enscript-comment">/* number of directories in root folder */</span>
	u_int32_t 		drFilCnt;	<span class="enscript-comment">/* number of files in volume */</span>
	u_int32_t 		drDirCnt;	<span class="enscript-comment">/* number of directories in volume */</span>
	u_int32_t 		drFndrInfo[8];	<span class="enscript-comment">/* information used by the Finder */</span>
	u_int16_t 		drEmbedSigWord;	<span class="enscript-comment">/* embedded volume signature (formerly drVCSize) */</span>
	HFSExtentDescriptor	drEmbedExtent;	<span class="enscript-comment">/* embedded volume location and size (formerly drVBMCSize and drCtlCSize) */</span>
	u_int32_t		drXTFlSize;	<span class="enscript-comment">/* size of extents overflow file */</span>
	HFSExtentRecord		drXTExtRec;	<span class="enscript-comment">/* extent record for extents overflow file */</span>
	u_int32_t 		drCTFlSize;	<span class="enscript-comment">/* size of catalog file */</span>
	HFSExtentRecord 	drCTExtRec;	<span class="enscript-comment">/* extent record for catalog file */</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSMasterDirectoryBlock	HFSMasterDirectoryBlock;


#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__APPLE_API_UNSTABLE</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">SET_HFS_TEXT_ENCODING</span>(hint)  \
	(0x656e6300 | ((hint) &amp; 0xff))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">GET_HFS_TEXT_ENCODING</span>(hint)  \
	(((hint) &amp; 0xffffff00) == 0x656e6300 ? (hint) &amp; 0x000000ff : 0xffffffffU)
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* __APPLE_API_UNSTABLE */</span>


<span class="enscript-comment">/* HFS Plus Volume Header - 512 bytes */</span>
<span class="enscript-comment">/* Stored at sector #2 (3rd sector) and second-to-last sector. */</span>
<span class="enscript-type">struct</span> HFSPlusVolumeHeader {
	u_int16_t 	signature;		<span class="enscript-comment">/* == kHFSPlusSigWord */</span>
	u_int16_t 	version;		<span class="enscript-comment">/* == kHFSPlusVersion */</span>
	u_int32_t 	attributes;		<span class="enscript-comment">/* volume attributes */</span>
	u_int32_t 	lastMountedVersion;	<span class="enscript-comment">/* implementation version which last mounted volume */</span>
	u_int32_t 	journalInfoBlock;	<span class="enscript-comment">/* block addr of journal info (if volume is journaled, zero otherwise) */</span>

	u_int32_t 	createDate;		<span class="enscript-comment">/* date and time of volume creation */</span>
	u_int32_t 	modifyDate;		<span class="enscript-comment">/* date and time of last modification */</span>
	u_int32_t 	backupDate;		<span class="enscript-comment">/* date and time of last backup */</span>
	u_int32_t 	checkedDate;		<span class="enscript-comment">/* date and time of last disk check */</span>

	u_int32_t 	fileCount;		<span class="enscript-comment">/* number of files in volume */</span>
	u_int32_t 	folderCount;		<span class="enscript-comment">/* number of directories in volume */</span>

	u_int32_t 	blockSize;		<span class="enscript-comment">/* size (in bytes) of allocation blocks */</span>
	u_int32_t 	totalBlocks;		<span class="enscript-comment">/* number of allocation blocks in volume (includes this header and VBM*/</span>
	u_int32_t 	freeBlocks;		<span class="enscript-comment">/* number of unused allocation blocks */</span>

	u_int32_t 	nextAllocation;		<span class="enscript-comment">/* start of next allocation search */</span>
	u_int32_t 	rsrcClumpSize;		<span class="enscript-comment">/* default resource fork clump size */</span>
	u_int32_t 	dataClumpSize;		<span class="enscript-comment">/* default data fork clump size */</span>
	u_int32_t 	nextCatalogID;		<span class="enscript-comment">/* next unused catalog node ID */</span>

	u_int32_t 	writeCount;		<span class="enscript-comment">/* volume write count */</span>
	u_int64_t 	encodingsBitmap;	<span class="enscript-comment">/* which encodings have been use  on this volume */</span>

	u_int8_t 	finderInfo[32];		<span class="enscript-comment">/* information used by the Finder */</span>

	HFSPlusForkData	 allocationFile;	<span class="enscript-comment">/* allocation bitmap file */</span>
	HFSPlusForkData  extentsFile;		<span class="enscript-comment">/* extents B-tree file */</span>
	HFSPlusForkData  catalogFile;		<span class="enscript-comment">/* catalog B-tree file */</span>
	HFSPlusForkData  attributesFile;	<span class="enscript-comment">/* extended attributes B-tree file */</span>
	HFSPlusForkData	 startupFile;		<span class="enscript-comment">/* boot file (secondary loader) */</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> HFSPlusVolumeHeader HFSPlusVolumeHeader;


<span class="enscript-comment">/* B-tree structures */</span>

<span class="enscript-type">enum</span> BTreeKeyLimits{
	kMaxKeyLength	= 520
};

<span class="enscript-type">union</span> BTreeKey{
	u_int8_t	length8;
	u_int16_t	length16;
	u_int8_t	rawData [kMaxKeyLength+2];
};
<span class="enscript-type">typedef</span> <span class="enscript-type">union</span> BTreeKey BTreeKey;

<span class="enscript-comment">/* BTNodeDescriptor -- Every B-tree node starts with these fields. */</span>
<span class="enscript-type">struct</span> BTNodeDescriptor {
	u_int32_t	fLink;			<span class="enscript-comment">/* next node at this level*/</span>
	u_int32_t 	bLink;			<span class="enscript-comment">/* previous node at this level*/</span>
	int8_t 		kind;			<span class="enscript-comment">/* kind of node (leaf, index, header, map)*/</span>
	u_int8_t 	height;			<span class="enscript-comment">/* zero for header, map; child is one more than parent*/</span>
	u_int16_t 	numRecords;		<span class="enscript-comment">/* number of records in this node*/</span>
	u_int16_t 	reserved;		<span class="enscript-comment">/* reserved - initialized as zero */</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> BTNodeDescriptor BTNodeDescriptor;

<span class="enscript-comment">/* Constants for BTNodeDescriptor kind */</span>
<span class="enscript-type">enum</span> {
	kBTLeafNode	= -1,
	kBTIndexNode	= 0,
	kBTHeaderNode	= 1,
	kBTMapNode	= 2
};

<span class="enscript-comment">/* BTHeaderRec -- The first record of a B-tree header node */</span>
<span class="enscript-type">struct</span> BTHeaderRec {
	u_int16_t	treeDepth;		<span class="enscript-comment">/* maximum height (usually leaf nodes) */</span>
	u_int32_t 	rootNode;		<span class="enscript-comment">/* node number of root node */</span>
	u_int32_t 	leafRecords;		<span class="enscript-comment">/* number of leaf records in all leaf nodes */</span>
	u_int32_t 	firstLeafNode;		<span class="enscript-comment">/* node number of first leaf node */</span>
	u_int32_t 	lastLeafNode;		<span class="enscript-comment">/* node number of last leaf node */</span>
	u_int16_t 	nodeSize;		<span class="enscript-comment">/* size of a node, in bytes */</span>
	u_int16_t 	maxKeyLength;		<span class="enscript-comment">/* reserved */</span>
	u_int32_t 	totalNodes;		<span class="enscript-comment">/* total number of nodes in tree */</span>
	u_int32_t 	freeNodes;		<span class="enscript-comment">/* number of unused (free) nodes in tree */</span>
	u_int16_t 	reserved1;		<span class="enscript-comment">/* unused */</span>
	u_int32_t 	clumpSize;		<span class="enscript-comment">/* reserved */</span>
	u_int8_t 	btreeType;		<span class="enscript-comment">/* reserved */</span>
	u_int8_t 	keyCompareType;		<span class="enscript-comment">/* Key string Comparison Type */</span>
	u_int32_t 	attributes;		<span class="enscript-comment">/* persistent attributes about the tree */</span>
	u_int32_t 	reserved3[16];		<span class="enscript-comment">/* reserved */</span>
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> BTHeaderRec BTHeaderRec;

<span class="enscript-comment">/* Constants for BTHeaderRec attributes */</span>
<span class="enscript-type">enum</span> {
	kBTBadCloseMask		 = 0x00000001,	<span class="enscript-comment">/* reserved */</span>
	kBTBigKeysMask		 = 0x00000002,	<span class="enscript-comment">/* key length field is 16 bits */</span>
	kBTVariableIndexKeysMask = 0x00000004	<span class="enscript-comment">/* keys in index nodes are variable length */</span>
};


<span class="enscript-comment">/* Catalog Key Name Comparison Type */</span>
<span class="enscript-type">enum</span> {
	kHFSCaseFolding   = 0xCF,  <span class="enscript-comment">/* case folding (case-insensitive) */</span>
	kHFSBinaryCompare = 0xBC  <span class="enscript-comment">/* binary compare (case-sensitive) */</span>
};

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;uuid/uuid.h&gt;</span>

<span class="enscript-comment">/* JournalInfoBlock - Structure that describes where our journal lives */</span>

<span class="enscript-comment">// the original size of the reserved field in the JournalInfoBlock was
</span><span class="enscript-comment">// 32*sizeof(u_int32_t).  To keep the total size of the structure the 
</span><span class="enscript-comment">// same we subtract the size of new fields (currently: ext_jnl_uuid and
</span><span class="enscript-comment">// machine_uuid).  If you add additional fields, place them before the
</span><span class="enscript-comment">// reserved field and subtract their size in this macro.
</span><span class="enscript-comment">//
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JIB_RESERVED_SIZE</span>  ((32*sizeof(u_int32_t)) - sizeof(uuid_string_t) - 48)

<span class="enscript-type">struct</span> JournalInfoBlock {
	u_int32_t	flags;
    	u_int32_t       device_signature[8];  <span class="enscript-comment">// signature used to locate our device.
</span>	u_int64_t       offset;               <span class="enscript-comment">// byte offset to the journal on the device
</span>	u_int64_t       size;                 <span class="enscript-comment">// size in bytes of the journal
</span>	uuid_string_t   ext_jnl_uuid;
	<span class="enscript-type">char</span>            machine_serial_num[48];
	<span class="enscript-type">char</span>    	reserved[JIB_RESERVED_SIZE];
} __attribute__((aligned(2), packed));
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> JournalInfoBlock JournalInfoBlock;

<span class="enscript-type">enum</span> {
    kJIJournalInFSMask          = 0x00000001,
    kJIJournalOnOtherDeviceMask = 0x00000002,
    kJIJournalNeedInitMask      = 0x00000004
};

<span class="enscript-comment">//
</span><span class="enscript-comment">// This the content type uuid for &quot;external journal&quot; GPT 
</span><span class="enscript-comment">// partitions.  Each instance of a partition also has a
</span><span class="enscript-comment">// uuid that uniquely identifies that instance.
</span><span class="enscript-comment">//
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EXTJNL_CONTENT_TYPE_UUID</span> <span class="enscript-string">&quot;4A6F7572-6E61-11AA-AA11-00306543ECAC&quot;</span>


#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__cplusplus</span>
}
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* __HFS_FORMAT__ */</span>
</pre>
<hr />
</body></html>