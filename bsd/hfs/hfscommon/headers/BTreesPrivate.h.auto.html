<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>BTreesPrivate.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">BTreesPrivate.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000-2014 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*
	File:		BTreesPrivate.h

	Contains:	Private interface file for the BTree Module.

	Version:	xxx put the technology version here xxx

	Written by:	Gordon Sheridan and Bill Bruffey

	Copyright:	© 1992-1999 by Apple Computer, Inc., all rights reserved.

	File Ownership:

		DRI:				Don Brady

		Other Contact:		Mark Day

		Technology:			File Systems

	Writers:

		(msd)	Mark Day
		(DSH)	Deric Horn
		(djb)	Don Brady
		(ser)	Scott Roberts
		(dkh)	Dave Heller

	Change History (most recent first):
	   &lt;MacOSX&gt;	 3/19/99	djb		Disable MoveRecordsLeft/Right macros since bcopy is broken.
	
	   &lt;MacOSX&gt;	 8/10/98	djb		Removed unused BTreeIterator from BTreeControlBlock, fixed alignment.

	   &lt;CS5&gt;	  9/4/97	djb		Convert MoveRecordsLeft and GetLeftSiblingNode to macros.
	   &lt;CS4&gt;	 7/24/97	djb		Add macro for GetRecordAddress (was a function before).
	   &lt;CS3&gt;	 7/21/97	msd		GetRecordByIndex now returns an OSStatus.
	   &lt;CS2&gt;	 7/16/97	DSH		FilesInternal.i renamed FileMgrInternal.i to avoid name
									collision
	   &lt;CS1&gt;	 4/23/97	djb		first checked in

	  &lt;HFS6&gt;	 3/17/97	DSH		Added a refCon field to BTreeControlBlock, for DFA use, to point
									to additional data.  Fixed Panic macros for use with SC.
	  &lt;HFS5&gt;	 2/19/97	djb		Add InsertKey struct. Moved on-disk definitions to
									HFSBTreesPriv.h
	  &lt;HFS4&gt;	 1/27/97	djb		InsertTree and DeleteTree are now recursive and support variable
									sized index keys.
	  &lt;HFS3&gt;	 1/15/97	djb		Move GetFileRefNumFromFCB macro to FilesInternal.h. Added
									kBTVariableIndexKeysMask.
	  &lt;HFS2&gt;	  1/3/97	djb		Added support for large keys.
	  &lt;HFS1&gt;	12/19/96	djb		first checked in

	History applicable to original Scarecrow Design:

		 &lt;7&gt;	10/25/96	ser		Changing for new VFPI
		 &lt;6&gt;	10/18/96	ser		Converting over VFPI changes
		 &lt;5&gt;	 9/17/96	dkh		More BTree statistics
		 &lt;4&gt;	 9/16/96	dkh		Revised BTree statistics
		 &lt;3&gt;	 6/20/96	dkh		Radar #1358740. Switch from using Pools to debug MemAllocators.
		 &lt;2&gt;	 12/7/95	dkh		D10E2 build. Changed usage of Ref data type to LogicalAddress.
		 &lt;1&gt;	10/18/95	rst		Moved from Scarecrow project.

		&lt;19&gt;	11/22/94	djb		Add prototype for GetMapNode
		&lt;18&gt;	11/16/94	prp		Add IsItAHint routine prototype.
		&lt;17&gt;	 9/30/94	prp		Get in sync with D2 interface changes.
		&lt;16&gt;	 7/25/94	wjk		Eliminate usage of BytePtr in favor of UInt8 *.
		&lt;15&gt;	 7/22/94	wjk		Convert to the new set of header files.
		&lt;14&gt;	 5/31/94	srs		Moved Btree types to public interface
		&lt;13&gt;	 12/9/93	wjk		Add 68k alignment pragma's around persistent structures.
		&lt;12&gt;	11/30/93	wjk		Move from Makefiles to BuildFiles. Fit into the ModernOS and
									NRCmds environments.
		&lt;11&gt;	11/23/93	wjk		Changes required to compile on the RS6000.
		&lt;10&gt;	 8/30/93	CH		Removed the M_ExitOnError and M_ReturnErrorIf macros which were
									already defined in FileSystemPriv.h (included here).
		 &lt;9&gt;	 8/30/93	CH		Added parens around the M_ReturnErrorIf macro.
		 &lt;8&gt;	 5/21/93	gs		Add kBadClose flag. Add some prototypes for internal routines.
		 &lt;7&gt;	 5/10/93	gs		Change Ptr to BytePtr. Move BTreeTypes to BTree.h. Add
									DeleteTree prototype.
		 &lt;6&gt;	 3/23/93	gs		Remove mysterious &quot;flags&quot; field from HeaderRec structure. Move
									prototypes of private functions to top of respective source
									files.
		 &lt;5&gt;	  2/8/93	gs		Update to use FSAgent.h Get/Release/SetEOF/SetBlockSize
									procPtrs. Add UpdateNode routine.
		 &lt;4&gt;	12/10/92	gs		Add Key Descriptor function declarations.
		 &lt;3&gt;	 12/8/92	gs		Add HeaderRec structure and incorporate review feedback.
		 &lt;2&gt;	 12/2/92	gs		Add GetNode and ReleaseNode callback procptrs to BTree CB, and
									add internal function declarations.
		 &lt;1&gt;	11/15/92	gs		first checked in

*/</span>

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">__BTREESPRIVATE__</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">__BTREESPRIVATE__</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/appleapiopts.h&gt;</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__APPLE_API_PRIVATE</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;../../hfs_macos_defs.h&quot;</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">__FILEMGRINTERNAL__</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;FileMgrInternal.h&quot;</span>
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">__BTREESINTERNAL__</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;BTreesInternal.h&quot;</span>
#<span class="enscript-reference">endif</span>


<span class="enscript-comment">/////////////////////////////////// Constants ///////////////////////////////////
</span>
#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">kBTreeVersion</span>		  1
#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">kMaxTreeDepth</span>		 16


#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">kHeaderNodeNum</span>		  0
#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">kKeyDescRecord</span>		  1


<span class="enscript-comment">// Header Node Record Offsets
</span><span class="enscript-type">enum</span> {
	kHeaderRecOffset	=	0x000E,
	kKeyDescRecOffset	=	0x0078,
	kHeaderMapRecOffset	=	0x00F8
};

#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">kMinNodeSize</span>		512

#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">kMinRecordSize</span>		  6
										<span class="enscript-comment">// where is minimum record size enforced?
</span>
<span class="enscript-comment">// miscellaneous BTree constants
</span><span class="enscript-type">enum</span> {
			kOffsetSize				= 2
};

<span class="enscript-comment">// Insert Operations
</span><span class="enscript-type">typedef</span> <span class="enscript-type">enum</span> {
			kInsertRecord			= 0,
			kReplaceRecord			= 1
} InsertType;

<span class="enscript-comment">// illegal string attribute bits set in mask
</span>#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">kBadStrAttribMask</span>		0xCF



<span class="enscript-comment">//////////////////////////////////// Macros /////////////////////////////////////
</span>
#<span class="enscript-reference">define</span>		<span class="enscript-function-name">M_NodesInMap</span>(mapSize)				((mapSize) &lt;&lt; 3)

#<span class="enscript-reference">define</span>		<span class="enscript-function-name">M_ClearBitNum</span>(integer,bitNumber) 	((integer) &amp;= (~(1&lt;&lt;(bitNumber))))
#<span class="enscript-reference">define</span>		<span class="enscript-function-name">M_SetBitNum</span>(integer,bitNumber) 		((integer) |= (1&lt;&lt;(bitNumber)))
#<span class="enscript-reference">define</span>		<span class="enscript-function-name">M_IsOdd</span>(integer) 					(((integer) &amp; 1) != 0)
#<span class="enscript-reference">define</span>		<span class="enscript-function-name">M_IsEven</span>(integer) 					(((integer) &amp; 1) == 0)

#<span class="enscript-reference">define</span>		<span class="enscript-function-name">M_MapRecordSize</span>(nodeSize)			(nodeSize - sizeof (BTNodeDescriptor) - 6)
#<span class="enscript-reference">define</span>		<span class="enscript-function-name">M_HeaderMapRecordSize</span>(nodeSize)		(nodeSize - sizeof(BTNodeDescriptor) - sizeof(BTHeaderRec) - 128 - 8)

#<span class="enscript-reference">define</span>		<span class="enscript-function-name">M_SWAP_BE16_ClearBitNum</span>(integer,bitNumber)  ((integer) &amp;= SWAP_BE16(~(1&lt;&lt;(bitNumber))))
#<span class="enscript-reference">define</span>		<span class="enscript-function-name">M_SWAP_BE16_SetBitNum</span>(integer,bitNumber)    ((integer) |= SWAP_BE16(1&lt;&lt;(bitNumber)))

<span class="enscript-comment">///////////////////////////////////// Types /////////////////////////////////////
</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> BTreeControlBlock {					<span class="enscript-comment">// fields specific to BTree CBs
</span>
	u_int8_t		keyCompareType;   <span class="enscript-comment">/* Key string Comparison Type */</span>
	u_int8_t					 btreeType;
	u_int16_t					 treeDepth;
	FileReference				 fileRefNum;		<span class="enscript-comment">// refNum of btree file
</span>	KeyCompareProcPtr			 keyCompareProc;
	u_int32_t					 rootNode;
	u_int32_t					 leafRecords;
	u_int32_t					 firstLeafNode;
	u_int32_t					 lastLeafNode;
	u_int16_t					 nodeSize;
	u_int16_t					 maxKeyLength;
	u_int32_t					 totalNodes;
	u_int32_t					 freeNodes;

	u_int16_t					 reserved3;			<span class="enscript-comment">// 4-byte alignment
</span>
	<span class="enscript-comment">// new fields
</span>	int16_t						 version;
	u_int32_t					 flags;				<span class="enscript-comment">// dynamic flags
</span>	u_int32_t					 attributes;		<span class="enscript-comment">// persistent flags
</span>	u_int32_t					 writeCount;
	u_int32_t					 lastfsync;		<span class="enscript-comment">/* Last time that this was fsynced  */</span>

	GetBlockProcPtr			 	 getBlockProc;
	ReleaseBlockProcPtr			 releaseBlockProc;
	SetEndOfForkProcPtr			 setEndOfForkProc;

	<span class="enscript-comment">// statistical information
</span>	u_int32_t					 numGetNodes;
	u_int32_t					 numGetNewNodes;
	u_int32_t					 numReleaseNodes;
	u_int32_t					 numUpdateNodes;
	u_int32_t					 numMapNodesRead;	<span class="enscript-comment">// map nodes beyond header node
</span>	u_int32_t					 numHintChecks;
	u_int32_t					 numPossibleHints;	<span class="enscript-comment">// Looks like a formated hint
</span>	u_int32_t					 numValidHints;		<span class="enscript-comment">// Hint used to find correct record.
</span>	u_int32_t					reservedNodes;
	BTreeIterator   iterator; <span class="enscript-comment">// useable when holding exclusive b-tree lock
</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">DEBUG</span>
	<span class="enscript-type">void</span>						*madeDirtyBy[2];
#<span class="enscript-reference">endif</span>
} BTreeControlBlock, *BTreeControlBlockPtr;

u_int32_t <span class="enscript-function-name">CalcKeySize</span>(<span class="enscript-type">const</span> BTreeControlBlock *btcb, <span class="enscript-type">const</span> BTreeKey *key);
#<span class="enscript-reference">define</span> <span class="enscript-function-name">CalcKeySize</span>(btcb, key)			( ((btcb)-&gt;attributes &amp; kBTBigKeysMask) ? ((key)-&gt;length16 + 2) : ((key)-&gt;length8 + 1) )

u_int32_t <span class="enscript-function-name">KeyLength</span>(<span class="enscript-type">const</span> BTreeControlBlock *btcb, <span class="enscript-type">const</span> BTreeKey *key);
#<span class="enscript-reference">define</span> <span class="enscript-function-name">KeyLength</span>(btcb, key)			( ((btcb)-&gt;attributes &amp; kBTBigKeysMask) ? (key)-&gt;length16 : (key)-&gt;length8 )



<span class="enscript-type">typedef</span> <span class="enscript-type">enum</span> {
					kBTHeaderDirty	= 0x00000001
}	BTreeFlags;

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">M_BTreeHeaderDirty</span>(BTreeControlBlock *bt) {
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">DEBUG</span>
	bt-&gt;madeDirtyBy[0] = __builtin_return_address(0);
	bt-&gt;madeDirtyBy[1] = __builtin_return_address(1);
#<span class="enscript-reference">endif</span>
	bt-&gt;flags |= kBTHeaderDirty;
}

<span class="enscript-type">typedef</span>	int8_t				*NodeBuffer;
<span class="enscript-type">typedef</span> BlockDescriptor		 NodeRec, *NodePtr;		<span class="enscript-comment">// remove this someday...
</span>



<span class="enscript-comment">//// Tree Path Table - constructed by SearchTree, used by InsertTree and DeleteTree
</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
	u_int32_t				node;				<span class="enscript-comment">// node number
</span>	u_int16_t				index;
	u_int16_t				reserved;			<span class="enscript-comment">// align size to a power of 2
</span>} TreePathRecord, *TreePathRecordPtr;

<span class="enscript-type">typedef</span> TreePathRecord		TreePathTable [kMaxTreeDepth];


<span class="enscript-comment">//// InsertKey - used by InsertTree, InsertLevel and InsertNode
</span>
<span class="enscript-type">struct</span> InsertKey {
	BTreeKeyPtr		keyPtr;
	u_int8_t *		recPtr;
	u_int16_t		keyLength;
	u_int16_t		recSize;
	Boolean			replacingKey;
	Boolean			skipRotate;
};

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> InsertKey InsertKey;


<span class="enscript-comment">//// For Notational Convenience
</span>
<span class="enscript-type">typedef</span>	BTNodeDescriptor*	 NodeDescPtr;
<span class="enscript-type">typedef</span> u_int8_t			*RecordPtr;
<span class="enscript-type">typedef</span> BTreeKeyPtr			 KeyPtr;


<span class="enscript-comment">//////////////////////////////////// Globals ////////////////////////////////////
</span>

<span class="enscript-comment">//////////////////////////////////// Macros /////////////////////////////////////
</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">DEBUG_BUILD</span>
	#define Panic( message )					DebugStr( message )
	#define PanicIf( condition, message )		<span class="enscript-keyword">do</span> { <span class="enscript-keyword">if</span> ( condition != 0 )	DebugStr( message ); } <span class="enscript-keyword">while</span>(0)
#<span class="enscript-reference">else</span>
	#define Panic( message )				<span class="enscript-keyword">do</span> { } <span class="enscript-keyword">while</span>(0)
	#define PanicIf( condition, message )	<span class="enscript-keyword">do</span> { } <span class="enscript-keyword">while</span>(0)
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">//	Exit function on error
</span>#<span class="enscript-reference">define</span> <span class="enscript-function-name">M_ExitOnError</span>( result )	do { if ( ( result ) != noErr )	goto ErrorExit; } while(0)

<span class="enscript-comment">//	Test for passed condition and return if true
</span>#<span class="enscript-reference">define</span>	<span class="enscript-function-name">M_ReturnErrorIf</span>( condition, error )	do { if ( condition )	return( error ); } while(0)

<span class="enscript-comment">//////////////////////////////// Key Operations /////////////////////////////////
</span>
int32_t		CompareKeys				(BTreeControlBlockPtr	 btreePtr,
									 KeyPtr					 searchKey,
									 KeyPtr					 trialKey );

<span class="enscript-comment">//////////////////////////////// Map Operations /////////////////////////////////
</span>
OSStatus	AllocateNode			(BTreeControlBlockPtr	 btreePtr,
									 u_int32_t				*nodeNum);

OSStatus	FreeNode				(BTreeControlBlockPtr	 btreePtr,
									 u_int32_t				 nodeNum);

OSStatus	ExtendBTree				(BTreeControlBlockPtr	 btreePtr,
									 u_int32_t				 nodes );

u_int32_t	CalcMapBits				(BTreeControlBlockPtr	 btreePtr);


<span class="enscript-type">void</span> 		BTUpdateReserve				(BTreeControlBlockPtr btreePtr,
                                                         <span class="enscript-type">int</span> nodes);

<span class="enscript-comment">//////////////////////////////// Misc Operations ////////////////////////////////
</span>
u_int16_t	CalcKeyRecordSize		(u_int16_t				 keySize,
									 u_int16_t				 recSize );

OSStatus	VerifyHeader			(FCB					*filePtr,
									 BTHeaderRec				*header );

OSStatus	UpdateHeader			(BTreeControlBlockPtr	 btreePtr,
						 Boolean forceWrite );

OSStatus	FindIteratorPosition	(BTreeControlBlockPtr	 btreePtr,
									 BTreeIteratorPtr		 iterator,
									 BlockDescriptor		*left,
									 BlockDescriptor		*middle,
									 BlockDescriptor		*right,
									 u_int32_t				*nodeNum,
									 u_int16_t				*index,
									 Boolean				*foundRecord );

OSStatus	CheckInsertParams		(FCB					*filePtr,
									 BTreeIterator			*iterator,
									 FSBufferDescriptor		*record,
									 u_int16_t				 recordLen );

OSStatus	TrySimpleReplace		(BTreeControlBlockPtr	 btreePtr,
									 NodeDescPtr			 nodePtr,
									 BTreeIterator			*iterator,
									 FSBufferDescriptor		*record,
									 u_int16_t				 recordLen,
									 Boolean				*recordInserted );

OSStatus	IsItAHint				(BTreeControlBlockPtr 	 btreePtr, 
									 BTreeIterator 			*iterator, 
									 Boolean 				*answer );

<span class="enscript-type">extern</span> OSStatus <span class="enscript-function-name">TreeIsDirty</span>(BTreeControlBlockPtr btreePtr);

<span class="enscript-comment">//////////////////////////////// Node Operations ////////////////////////////////
</span>
<span class="enscript-comment">//// Node Operations
</span>
OSStatus	GetNode					(BTreeControlBlockPtr	 btreePtr,
									 u_int32_t				 nodeNum,
									 u_int32_t 				 flags, 
									 NodeRec				*returnNodePtr );

<span class="enscript-comment">/* Flags for GetNode() */</span>
#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">kGetNodeHint</span>	0x1		<span class="enscript-comment">/* If set, the node is being looked up using a hint */</span>

OSStatus	GetLeftSiblingNode		(BTreeControlBlockPtr	 btreePtr,
									 NodeDescPtr			 node,
									 NodeRec				*left );

#<span class="enscript-reference">define</span>		<span class="enscript-function-name">GetLeftSiblingNode</span>(btree,node,left)			GetNode ((btree), ((NodeDescPtr)(node))-&gt;bLink, 0, (left))

OSStatus	GetRightSiblingNode		(BTreeControlBlockPtr	 btreePtr,
									 NodeDescPtr			 node,
									 NodeRec				*right );

#<span class="enscript-reference">define</span>		<span class="enscript-function-name">GetRightSiblingNode</span>(btree,node,right)		GetNode ((btree), ((NodeDescPtr)(node))-&gt;fLink, 0, (right))


OSStatus	GetNewNode				(BTreeControlBlockPtr	 btreePtr,
									 u_int32_t				 nodeNum,
									 NodeRec				*returnNodePtr );

OSStatus	ReleaseNode				(BTreeControlBlockPtr	 btreePtr,
									 NodePtr				 nodePtr );

OSStatus	TrashNode				(BTreeControlBlockPtr	 btreePtr,
									 NodePtr				 nodePtr );

OSStatus	UpdateNode				(BTreeControlBlockPtr	 btreePtr,
									 NodePtr				 nodePtr,
									 u_int32_t				 transactionID,
									 u_int32_t				 flags );

<span class="enscript-comment">//// Node Buffer Operations
</span>
<span class="enscript-type">void</span>		ClearNode				(BTreeControlBlockPtr	 btreePtr,
									 NodeDescPtr			 node );

u_int16_t	GetNodeDataSize			(BTreeControlBlockPtr	 btreePtr,
									 NodeDescPtr			 node );

u_int16_t	GetNodeFreeSize			(BTreeControlBlockPtr	 btreePtr,
									 NodeDescPtr			 node );


<span class="enscript-comment">//// Record Operations
</span>
Boolean		InsertRecord			(BTreeControlBlockPtr	 btreePtr,
									 NodeDescPtr	 		 node,
									 u_int16_t	 			 index,
									 RecordPtr				 recPtr,
									 u_int16_t				 recSize );

Boolean		InsertKeyRecord			(BTreeControlBlockPtr	 btreePtr,
									 NodeDescPtr 			 node,
									 u_int16_t	 			 index,
									 KeyPtr					 keyPtr,
									 u_int16_t				 keyLength,
									 RecordPtr				 recPtr,
									 u_int16_t				 recSize );

<span class="enscript-type">void</span>		DeleteRecord			(BTreeControlBlockPtr	btree,
									 NodeDescPtr	 		node,
									 u_int16_t	 			index );


Boolean		SearchNode				(BTreeControlBlockPtr	 btree,
									 NodeDescPtr			 node,
									 KeyPtr					 searchKey,
									 u_int16_t				*index );

OSStatus	GetRecordByIndex		(BTreeControlBlockPtr	 btree,
									 NodeDescPtr			 node,
									 u_int16_t				 index,
									 KeyPtr					*keyPtr,
									 u_int8_t *				*dataPtr,
									 u_int16_t				*dataSize );

u_int8_t *	GetRecordAddress		(BTreeControlBlockPtr	 btree,
									 NodeDescPtr			 node,
									 u_int16_t				 index );

#<span class="enscript-reference">define</span> <span class="enscript-function-name">GetRecordAddress</span>(btreePtr,node,index)		((u_int8_t *)(node) + (*(short *) ((u_int8_t *)(node) + (btreePtr)-&gt;nodeSize - ((index) &lt;&lt; 1) - kOffsetSize)))


u_int16_t	GetRecordSize			(BTreeControlBlockPtr	 btree,
									 NodeDescPtr			 node,
									 u_int16_t				 index );

u_int32_t	GetChildNodeNum			(BTreeControlBlockPtr	 btreePtr,
									 NodeDescPtr			 nodePtr,
									 u_int16_t				 index );

<span class="enscript-type">void</span>		MoveRecordsLeft			(u_int8_t *				 src,
									 u_int8_t *				 dst,
									 u_int16_t				 bytesToMove );

#<span class="enscript-reference">define</span>		<span class="enscript-function-name">MoveRecordsLeft</span>(src,dst,bytes)			bcopy((src),(dst),(bytes))

<span class="enscript-type">void</span>		MoveRecordsRight		(u_int8_t *				 src,
									 u_int8_t *				 dst,
									 u_int16_t				 bytesToMove );

#<span class="enscript-reference">define</span>		<span class="enscript-function-name">MoveRecordsRight</span>(src,dst,bytes)			bcopy((src),(dst),(bytes))


<span class="enscript-comment">//////////////////////////////// Tree Operations ////////////////////////////////
</span>
OSStatus	SearchTree				(BTreeControlBlockPtr	 btreePtr,
									 BTreeKeyPtr			 keyPtr,
									 TreePathTable			 treePathTable,
									 u_int32_t				*nodeNum,
									 BlockDescriptor		*nodePtr,
									 u_int16_t				*index );

OSStatus	InsertTree				(BTreeControlBlockPtr	 btreePtr,
									 TreePathTable			 treePathTable,
									 KeyPtr					 keyPtr,
									 u_int8_t *				 recPtr,
									 u_int16_t				 recSize,
									 BlockDescriptor		*targetNode,
									 u_int16_t				 index,
									 u_int16_t				 level,
									 Boolean				 replacingKey,
									 u_int32_t				*insertNode );

OSStatus	DeleteTree				(BTreeControlBlockPtr	 btreePtr,
									 TreePathTable			 treePathTable,
									 BlockDescriptor		*targetNode,
									 u_int16_t				 index,
									 u_int16_t				 level );

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* __APPLE_API_PRIVATE */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL */</span>
#<span class="enscript-reference">endif</span> //<span class="enscript-variable-name">__BTREESPRIVATE__</span>
</pre>
<hr />
</body></html>