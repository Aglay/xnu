<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>socket.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">socket.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000-2015 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/* Copyright (c) 1998, 1999 Apple Computer, Inc. All Rights Reserved */</span>
<span class="enscript-comment">/* Copyright (c) 1995 NeXT Computer, Inc. All Rights Reserved */</span>
<span class="enscript-comment">/*
 * Copyright (c) 1982, 1985, 1986, 1988, 1993, 1994
 *	The Regents of the University of California.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *	@(#)socket.h	8.4 (Berkeley) 2/21/94
 * $FreeBSD: src/sys/sys/socket.h,v 1.39.2.7 2001/07/03 11:02:01 ume Exp $
 */</span>
<span class="enscript-comment">/*
 * NOTICE: This file was modified by SPARTA, Inc. in 2005 to introduce
 * support for mandatory and extensible security protections.  This notice
 * is included in support of clause 2.2 (b) of the Apple Public License,
 * Version 2.0.
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_SYS_SOCKET_H_</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_SYS_SOCKET_H_</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/types.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/cdefs.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;machine/_param.h&gt;</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/param.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;uuid/uuid.h&gt;</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">KERNEL</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;Availability.h&gt;</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*
 * Definitions related to sockets: types, address families, options.
 */</span>

<span class="enscript-comment">/*
 * Data types.
 */</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types/_gid_t.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types/_off_t.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types/_pid_t.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types/_sa_family_t.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types/_socklen_t.h&gt;</span>

<span class="enscript-comment">/* XXX Not explicitly defined by POSIX, but function return types are */</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types/_size_t.h&gt;</span>
 
<span class="enscript-comment">/* XXX Not explicitly defined by POSIX, but function return types are */</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types/_ssize_t.h&gt;</span>

<span class="enscript-comment">/*
 * [XSI] The iovec structure shall be defined as described in &lt;sys/uio.h&gt;.
 */</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types/_iovec_t.h&gt;</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_TCDBG_PID</span>		0x01	<span class="enscript-comment">/* Set/get traffic class for PID */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_TCDBG_PNAME</span>		0x02	<span class="enscript-comment">/* Set/get traffic class for processes of that name */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_TCDBG_PURGE</span>		0x04	<span class="enscript-comment">/* Purge entries for unused PIDs */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_TCDBG_FLUSH</span>		0x08	<span class="enscript-comment">/* Flush all entries */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_TCDBG_COUNT</span>		0x10	<span class="enscript-comment">/* Get count of entries */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_TCDBG_LIST</span>		0x20	<span class="enscript-comment">/* List entries */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_TCDBG_DELETE</span>		0x40	<span class="enscript-comment">/* Delete a process entry */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_TCDBG_TCFLUSH_PID</span>	0x80	<span class="enscript-comment">/* Flush traffic class for PID */</span>

<span class="enscript-type">struct</span> so_tcdbg {
	u_int32_t	so_tcdbg_cmd;
	int32_t		so_tcdbg_tclass;
	u_int32_t	so_tcdbg_count;
	pid_t		so_tcdbg_pid;
	<span class="enscript-type">char</span>		so_tcdbg_pname[MAXCOMLEN + 1];
	int32_t		so_tcdbg_opportunistic; <span class="enscript-comment">/* -1: unspecified, 0: off, 1: on, other: errors */</span>
};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>
 
<span class="enscript-comment">/*
 * Types
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOCK_STREAM</span>	1		<span class="enscript-comment">/* stream socket */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOCK_DGRAM</span>	2		<span class="enscript-comment">/* datagram socket */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOCK_RAW</span>	3		<span class="enscript-comment">/* raw-protocol interface */</span>
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOCK_RDM</span>	4		<span class="enscript-comment">/* reliably-delivered message */</span>
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOCK_SEQPACKET</span>	5		<span class="enscript-comment">/* sequenced packet stream */</span>

<span class="enscript-comment">/*
 * Option flags per-socket.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_DEBUG</span>	0x0001		<span class="enscript-comment">/* turn on debugging info recording */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_ACCEPTCONN</span>	0x0002		<span class="enscript-comment">/* socket has had listen() */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_REUSEADDR</span>	0x0004		<span class="enscript-comment">/* allow local address reuse */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_KEEPALIVE</span>	0x0008		<span class="enscript-comment">/* keep connections alive */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_DONTROUTE</span>	0x0010		<span class="enscript-comment">/* just use interface addresses */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_BROADCAST</span>	0x0020		<span class="enscript-comment">/* permit sending of broadcast msgs */</span>
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_USELOOPBACK</span>	0x0040		<span class="enscript-comment">/* bypass hardware when possible */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_LINGER</span>	0x0080          <span class="enscript-comment">/* linger on close if data present (in ticks) */</span>
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_LINGER</span>	0x1080          <span class="enscript-comment">/* linger on close if data present (in seconds) */</span>
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_OOBINLINE</span>	0x0100		<span class="enscript-comment">/* leave received OOB data in line */</span>
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_REUSEPORT</span>	0x0200		<span class="enscript-comment">/* allow local address &amp; port reuse */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_TIMESTAMP</span>	0x0400		<span class="enscript-comment">/* timestamp received dgram traffic */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_TIMESTAMP_MONOTONIC</span>	0x0800	<span class="enscript-comment">/* Monotonically increasing timestamp on rcvd dgram */</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">__APPLE__</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_ACCEPTFILTER</span>	0x1000		<span class="enscript-comment">/* there is an accept filter */</span>
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_DONTTRUNC</span>	0x2000		<span class="enscript-comment">/* APPLE: Retain unread data */</span>
					<span class="enscript-comment">/*  (ATOMIC proto) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_WANTMORE</span>	0x4000		<span class="enscript-comment">/* APPLE: Give hint when more data ready */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_WANTOOBFLAG</span>	0x8000		<span class="enscript-comment">/* APPLE: Want OOB in MSG_FLAG on receive */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_NOWAKEFROMSLEEP</span>	0x10000	<span class="enscript-comment">/* Don't wake for traffic to this socket */</span>
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">endif</span>  <span class="enscript-comment">/* (!__APPLE__) */</span>
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE) */</span>

<span class="enscript-comment">/*
 * Additional options, not kept in so_options.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_SNDBUF</span>	0x1001		<span class="enscript-comment">/* send buffer size */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_RCVBUF</span>	0x1002		<span class="enscript-comment">/* receive buffer size */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_SNDLOWAT</span>	0x1003		<span class="enscript-comment">/* send low-water mark */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_RCVLOWAT</span>	0x1004		<span class="enscript-comment">/* receive low-water mark */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_SNDTIMEO</span>	0x1005		<span class="enscript-comment">/* send timeout */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_RCVTIMEO</span>	0x1006		<span class="enscript-comment">/* receive timeout */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_ERROR</span>	0x1007		<span class="enscript-comment">/* get error status and clear */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_TYPE</span>		0x1008		<span class="enscript-comment">/* get socket type */</span>
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
<span class="enscript-comment">/*efine	SO_PRIVSTATE	0x1009		   get/deny privileged state */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_LABEL</span>        0x1010          <span class="enscript-comment">/* socket's MAC label */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_PEERLABEL</span>    0x1011          <span class="enscript-comment">/* socket's peer MAC label */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__APPLE__</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_NREAD</span>	0x1020		<span class="enscript-comment">/* APPLE: get 1st-packet byte count */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_NKE</span>		0x1021		<span class="enscript-comment">/* APPLE: Install socket-level NKE */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_NOSIGPIPE</span>	0x1022		<span class="enscript-comment">/* APPLE: No SIGPIPE on EPIPE */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_NOADDRERR</span>	0x1023		<span class="enscript-comment">/* APPLE: Returns EADDRNOTAVAIL when src is not available anymore */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_NWRITE</span>	0x1024		<span class="enscript-comment">/* APPLE: Get number of bytes currently in send socket buffer */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_REUSESHAREUID</span>	0x1025		<span class="enscript-comment">/* APPLE: Allow reuse of port/socket by different userids */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__APPLE_API_PRIVATE</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_NOTIFYCONFLICT</span>	0x1026	<span class="enscript-comment">/* APPLE: send notification if there is a bind on a port which is already in use */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_UPCALLCLOSEWAIT</span>	0x1027	<span class="enscript-comment">/* APPLE: block on close until an upcall returns */</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_LINGER_SEC</span>	0x1080          <span class="enscript-comment">/* linger on close if data present (in seconds) */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_RESTRICTIONS</span>	0x1081		<span class="enscript-comment">/* APPLE: deny flag set */</span>
#<span class="enscript-reference">define</span>	 <span class="enscript-variable-name">SO_RESTRICT_DENY_IN</span>	0x1	<span class="enscript-comment">/* deny inbound (trapdoor) */</span>
#<span class="enscript-reference">define</span>	 <span class="enscript-variable-name">SO_RESTRICT_DENY_OUT</span>	0x2	<span class="enscript-comment">/* deny outbound (trapdoor) */</span>
#<span class="enscript-reference">define</span>	 <span class="enscript-variable-name">SO_RESTRICT_DENY_CELLULAR</span> 0x4	<span class="enscript-comment">/* deny use of cellular (trapdoor) */</span>
#<span class="enscript-reference">define</span>	 <span class="enscript-variable-name">SO_RESTRICT_DENY_EXPENSIVE</span> 0x8	<span class="enscript-comment">/* deny use of expensive if (trapdoor)*/</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_RANDOMPORT</span>   0x1082  <span class="enscript-comment">/* APPLE: request local port randomization */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_NP_EXTENSIONS</span>	0x1083	<span class="enscript-comment">/* To turn off some POSIX behavior */</span>
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_EXECPATH</span>	0x1085 		<span class="enscript-comment">/* Application Firewall Socket option */</span>
<span class="enscript-comment">/*
 * Traffic service class definitions (lowest to highest):
 *
 * SO_TC_BK_SYS
 *	&quot;Background System-Initiated&quot;, high delay tolerant, high loss
 *	tolerant, elastic flow, variable size &amp; long-lived.  E.g: system-
 *	initiated iCloud synching or Time Capsule backup, for which there
 *	is no progress feedbacks.
 *
 * SO_TC_BK
 *	&quot;Background&quot;, user-initiated, high delay tolerant, high loss tolerant,
 *	elastic flow, variable size.  E.g. user-initiated iCloud synching or
 *	Time Capsule backup; or traffics of background applications, for which
 *	there is some progress feedbacks.
 *
 * SO_TC_BE
 *	&quot;Best Effort&quot;, unclassified/standard.  This is the default service
 *	class; pretty much a mix of everything.
 *
 * SO_TC_RD
 *	&quot;Responsive Data&quot;, a notch higher than &quot;Best Effort&quot;, medium delay
 *	tolerant, elastic &amp; inelastic flow, bursty, long-lived.  E.g. email,
 *	instant messaging, for which there is a sense of interactivity and
 *	urgency (user waiting for output).
 *
 * SO_TC_OAM
 *	&quot;Operations, Administration, and Management&quot;, medium delay tolerant,
 *	low-medium loss tolerant, elastic &amp; inelastic flows, variable size.
 *	E.g. VPN tunnels.
 *
 * SO_TC_AV
 *	&quot;Multimedia Audio/Video Streaming&quot;, medium delay tolerant, low-medium
 *	loss tolerant, elastic flow, constant packet interval, variable rate &amp;
 *	size.  E.g. AirPlay playback (both video and audio).
 *
 * SO_TC_RV
 *	&quot;Responsive Multimedia Audio/Video&quot;, low delay tolerant, low-medium
 *	loss tolerant, elastic flow, variable packet interval, rate and size.
 *	E.g. AirPlay mirroring, screen sharing.
 *
 * SO_TC_VI
 *	&quot;Interactive Video&quot;, low delay tolerant, low-medium loss tolerant,
 *	elastic flow, constant packet interval, variable rate &amp; size.  E.g.
 *	FaceTime video.
 *
 * SO_TC_VO
 *	&quot;Interactive Voice&quot;, low delay tolerant, low loss tolerant, inelastic
 *	flow, constant packet rate, somewhat fixed size.  E.g. VoIP including
 *	FaceTime audio.
 *
 * SO_TC_CTL
 *	&quot;Network Control&quot;, low delay tolerant, low loss tolerant, inelastic
 *	flow, rate is bursty but short, variable size.  E.g. DNS queries;
 *	certain types of locally-originated ICMP, ICMPv6; IGMP/MLD join/leave,
 *	ARP.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_TRAFFIC_CLASS</span>	0x1086	<span class="enscript-comment">/* Traffic service class (int) */</span>
#<span class="enscript-reference">define</span>	 <span class="enscript-variable-name">SO_TC_BK_SYS</span>	100		<span class="enscript-comment">/* lowest class */</span>
#<span class="enscript-reference">define</span>	 <span class="enscript-variable-name">SO_TC_BK</span>	200
#<span class="enscript-reference">define</span>  <span class="enscript-variable-name">SO_TC_BE</span>	0
#<span class="enscript-reference">define</span>	 <span class="enscript-variable-name">SO_TC_RD</span>	300
#<span class="enscript-reference">define</span>	 <span class="enscript-variable-name">SO_TC_OAM</span>	400
#<span class="enscript-reference">define</span>	 <span class="enscript-variable-name">SO_TC_AV</span>	500
#<span class="enscript-reference">define</span>	 <span class="enscript-variable-name">SO_TC_RV</span>	600
#<span class="enscript-reference">define</span>	 <span class="enscript-variable-name">SO_TC_VI</span>	700
#<span class="enscript-reference">define</span>	 <span class="enscript-variable-name">SO_TC_VO</span>	800
#<span class="enscript-reference">define</span>	 <span class="enscript-variable-name">SO_TC_CTL</span>	900		<span class="enscript-comment">/* highest class */</span>
#<span class="enscript-reference">define</span>  <span class="enscript-variable-name">SO_TC_MAX</span>	10		<span class="enscript-comment">/* Total # of traffic classes */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
#<span class="enscript-reference">define</span>  <span class="enscript-variable-name">_SO_TC_BK</span>	1		<span class="enscript-comment">/* deprecated */</span>
#<span class="enscript-reference">define</span>  <span class="enscript-variable-name">_SO_TC_VI</span>	2		<span class="enscript-comment">/* deprecated */</span>
#<span class="enscript-reference">define</span>  <span class="enscript-variable-name">_SO_TC_VO</span>	3		<span class="enscript-comment">/* deprecated */</span>
#<span class="enscript-reference">define</span>  <span class="enscript-variable-name">_SO_TC_MAX</span>	4		<span class="enscript-comment">/* deprecated */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">SO_VALID_TC</span>(c)							\
	(c == SO_TC_BK_SYS || c == SO_TC_BK || c == SO_TC_BE ||		\
	c == SO_TC_RD || c == SO_TC_OAM || c == SO_TC_AV ||		\
	c == SO_TC_RV || c == SO_TC_VI || c == SO_TC_VO || c == SO_TC_CTL)
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>

<span class="enscript-comment">/* Background socket configuration flags */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TRAFFIC_MGT_SO_BACKGROUND</span>       0x0001  <span class="enscript-comment">/* background socket */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TRAFFIC_MGT_TCP_RECVBG</span>          0x0002  <span class="enscript-comment">/* Only TCP sockets, receiver throttling */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_RECV_TRAFFIC_CLASS</span>	0x1087		<span class="enscript-comment">/* Receive traffic class (bool)*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_TRAFFIC_CLASS_DBG</span>	0x1088		<span class="enscript-comment">/* Debug traffic class (struct so_tcdbg) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_TRAFFIC_CLASS_STATS</span>	0x1089		<span class="enscript-comment">/* Traffic class statistics */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_PRIVILEGED_TRAFFIC_CLASS</span> 0x1090	<span class="enscript-comment">/* Privileged traffic class (bool) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_DEFUNCTOK</span>	0x1100		<span class="enscript-comment">/* can be defunct'd */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_ISDEFUNCT</span>	0x1101		<span class="enscript-comment">/* get defunct status */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_OPPORTUNISTIC</span>	0x1102	<span class="enscript-comment">/* deprecated; use SO_TRAFFIC_CLASS */</span>

<span class="enscript-comment">/*
 * SO_FLUSH flushes any unsent data generated by a given socket.  It takes
 * an integer parameter, which can be any of the SO_TC traffic class values,
 * or the special SO_TC_ALL value.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_FLUSH</span>	0x1103		<span class="enscript-comment">/* flush unsent data (int) */</span>
#<span class="enscript-reference">define</span>	 <span class="enscript-variable-name">SO_TC_ALL</span>	(-1)

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_RECV_ANYIF</span>	0x1104		<span class="enscript-comment">/* unrestricted inbound processing */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_TRAFFIC_MGT_BACKGROUND</span>	0x1105	<span class="enscript-comment">/* Background traffic management */</span>
 
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_FLOW_DIVERT_TOKEN</span>	0x1106	<span class="enscript-comment">/* flow divert token */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_DELEGATED</span>		0x1107	<span class="enscript-comment">/* set socket as delegate (pid_t) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_DELEGATED_UUID</span>	0x1108	<span class="enscript-comment">/* set socket as delegate (uuid_t) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_NECP_ATTRIBUTES</span>	0x1109	<span class="enscript-comment">/* NECP socket attributes (domain, account, etc.) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_CFIL_SOCK_ID</span>		0x1110	<span class="enscript-comment">/* get content filter socket ID (cfil_sock_id_t) */</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">MPTCP</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_MPTCP_FASTJOIN</span>	0x1111	<span class="enscript-comment">/* fast join MPTCP */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* MPTCP */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_NUMRCVPKT</span>		0x1112	<span class="enscript-comment">/* number of datagrams in receive socket buffer */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_AWDL_UNRESTRICTED</span> 	0x1113  <span class="enscript-comment">/* try to use AWDL in restricted mode */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_EXTENDED_BK_IDLE</span>	0x1114	<span class="enscript-comment">/* extended time to keep socket idle after app is suspended (int) */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

<span class="enscript-type">typedef</span> __uint32_t sae_associd_t;
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SAE_ASSOCID_ANY</span>	0
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SAE_ASSOCID_ALL</span>	((sae_associd_t)(-1ULL))

<span class="enscript-type">typedef</span> __uint32_t sae_connid_t;
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SAE_CONNID_ANY</span>	0
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SAE_CONNID_ALL</span>	((sae_connid_t)(-1ULL))

<span class="enscript-comment">/* connectx() flag parameters */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CONNECT_RESUME_ON_READ_WRITE</span>	0x1 <span class="enscript-comment">/* resume connect() on read/write */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CONNECT_DATA_IDEMPOTENT</span>		0x2 <span class="enscript-comment">/* data is idempotent */</span>

<span class="enscript-comment">/* sockaddr endpoints */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> sa_endpoints {
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	sae_srcif;      <span class="enscript-comment">/* optional source interface */</span>
	<span class="enscript-type">struct</span> sockaddr	*sae_srcaddr;   <span class="enscript-comment">/* optional source address */</span>
	socklen_t	sae_srcaddrlen; <span class="enscript-comment">/* size of source address */</span>
	<span class="enscript-type">struct</span> sockaddr	*sae_dstaddr;   <span class="enscript-comment">/* destination address */</span>
	socklen_t	sae_dstaddrlen; <span class="enscript-comment">/* size of destination address */</span>
} sa_endpoints_t;
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE) */</span>

<span class="enscript-comment">/*
 * Structure used for manipulating linger option.
 */</span>
<span class="enscript-type">struct</span>	linger {
	<span class="enscript-type">int</span>	l_onoff;		<span class="enscript-comment">/* option on/off */</span>
	<span class="enscript-type">int</span>	l_linger;		<span class="enscript-comment">/* linger time */</span>
};

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">__APPLE__</span>
<span class="enscript-type">struct</span>	accept_filter_arg {
	<span class="enscript-type">char</span>	af_name[16];
	<span class="enscript-type">char</span>	af_arg[256-16];
};
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__APPLE__</span>

<span class="enscript-comment">/*
 * Structure to control non-portable Sockets extension to POSIX  
 */</span>
<span class="enscript-type">struct</span> so_np_extensions {
	u_int32_t	npx_flags;
	u_int32_t	npx_mask;
};

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SONPX_SETOPTSHUT</span>	0x000000001     <span class="enscript-comment">/* flag for allowing setsockopt after shutdown */</span>


#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL_PRIVATE</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SONPX_MASK_VALID</span>		(SONPX_SETOPTSHUT)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">IS_SO_TC_BACKGROUND</span>(_tc_) ((_tc_) == SO_TC_BK || (_tc_) == SO_TC_BK_SYS)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">IS_SO_TC_BACKGROUNDSYSTEM</span>(_tc_) ((_tc_) == SO_TC_BK_SYS)
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL_PRIVATE */</span>

#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*
 * Level number for (get/set)sockopt() to apply to socket itself.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOL_SOCKET</span>	0xffff		<span class="enscript-comment">/* options for socket level */</span>


<span class="enscript-comment">/*
 * Address families.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_UNSPEC</span>	0		<span class="enscript-comment">/* unspecified */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_UNIX</span>		1		<span class="enscript-comment">/* local to host (pipes) */</span>
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_LOCAL</span>	AF_UNIX		<span class="enscript-comment">/* backward compatibility */</span>
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_INET</span>		2		<span class="enscript-comment">/* internetwork: UDP, TCP, etc. */</span>
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_IMPLINK</span>	3		<span class="enscript-comment">/* arpanet imp addresses */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_PUP</span>		4		<span class="enscript-comment">/* pup protocols: e.g. BSP */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_CHAOS</span>	5		<span class="enscript-comment">/* mit CHAOS protocols */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_NS</span>		6		<span class="enscript-comment">/* XEROX NS protocols */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_ISO</span>		7		<span class="enscript-comment">/* ISO protocols */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_OSI</span>		AF_ISO
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_ECMA</span>		8		<span class="enscript-comment">/* European computer manufacturers */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_DATAKIT</span>	9		<span class="enscript-comment">/* datakit protocols */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_CCITT</span>	10		<span class="enscript-comment">/* CCITT protocols, X.25 etc */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_SNA</span>		11		<span class="enscript-comment">/* IBM SNA */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">AF_DECnet</span>	12		<span class="enscript-comment">/* DECnet */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">AF_DLI</span>		13		<span class="enscript-comment">/* DEC Direct data link interface */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">AF_LAT</span>		14		<span class="enscript-comment">/* LAT */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_HYLINK</span>	15		<span class="enscript-comment">/* NSC Hyperchannel */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_APPLETALK</span>	16		<span class="enscript-comment">/* Apple Talk */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_ROUTE</span>	17		<span class="enscript-comment">/* Internal Routing Protocol */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_LINK</span>		18		<span class="enscript-comment">/* Link layer interface */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">pseudo_AF_XTP</span>	19		<span class="enscript-comment">/* eXpress Transfer Protocol (no AF) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_COIP</span>		20		<span class="enscript-comment">/* connection-oriented IP, aka ST II */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_CNT</span>		21		<span class="enscript-comment">/* Computer Network Technology */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">pseudo_AF_RTIP</span>	22		<span class="enscript-comment">/* Help Identify RTIP packets */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_IPX</span>		23		<span class="enscript-comment">/* Novell Internet Protocol */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_SIP</span>		24		<span class="enscript-comment">/* Simple Internet Protocol */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">pseudo_AF_PIP</span>	25		<span class="enscript-comment">/* Help Identify PIP packets */</span>
<span class="enscript-comment">/*define pseudo_AF_BLUE	26	   Identify packets for Blue Box - Not used */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">AF_NDRV</span>		27		<span class="enscript-comment">/* Network Driver 'raw' access */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_ISDN</span>		28		<span class="enscript-comment">/* Integrated Services Digital Network*/</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_E164</span>		AF_ISDN		<span class="enscript-comment">/* CCITT E.164 recommendation */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">pseudo_AF_KEY</span>	29		<span class="enscript-comment">/* Internal key-management function */</span>
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_INET6</span>	30		<span class="enscript-comment">/* IPv6 */</span>
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_NATM</span>		31		<span class="enscript-comment">/* native ATM access */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">AF_SYSTEM</span>	32		<span class="enscript-comment">/* Kernel event messages */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">AF_NETBIOS</span>	33		<span class="enscript-comment">/* NetBIOS */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">AF_PPP</span>		34		<span class="enscript-comment">/* PPP communication protocol */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">pseudo_AF_HDRCMPLT</span> 35		<span class="enscript-comment">/* Used by BPF to not rewrite headers
					 * in interface output routine */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">AF_AFP</span>	36			<span class="enscript-comment">/* Used by AFP */</span>
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">AF_RESERVED_36</span>	36		<span class="enscript-comment">/* Reserved for internal usage */</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">AF_IEEE80211</span>    37              <span class="enscript-comment">/* IEEE 802.11 protocol */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">AF_UTUN</span>		38
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_MULTIPATH</span>	39
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">AF_MAX</span>		40
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE) */</span>

<span class="enscript-comment">/*
 * [XSI] Structure used by kernel to store most addresses.
 */</span>
<span class="enscript-type">struct</span> sockaddr {
	__uint8_t	sa_len;		<span class="enscript-comment">/* total length */</span>
	sa_family_t	sa_family;	<span class="enscript-comment">/* [XSI] address family */</span>
	<span class="enscript-type">char</span>		sa_data[14];	<span class="enscript-comment">/* [XSI] addr value (actually larger) */</span>
};

#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOCK_MAXADDRLEN</span>	255		<span class="enscript-comment">/* longest possible addresses */</span>

<span class="enscript-comment">/*
 * Structure used by kernel to pass protocol
 * information in raw sockets.
 */</span>
<span class="enscript-type">struct</span> sockproto {
	__uint16_t	sp_family;		<span class="enscript-comment">/* address family */</span>
	__uint16_t	sp_protocol;		<span class="enscript-comment">/* protocol */</span>
};
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE)*/</span>

<span class="enscript-comment">/*
 * RFC 2553: protocol-independent placeholder for socket addresses
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_SS_MAXSIZE</span>	128
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_SS_ALIGNSIZE</span>	(sizeof(__int64_t))
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_SS_PAD1SIZE</span>	\
		(_SS_ALIGNSIZE - <span class="enscript-keyword">sizeof</span>(__uint8_t) - <span class="enscript-keyword">sizeof</span>(sa_family_t))
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_SS_PAD2SIZE</span>	\
		(_SS_MAXSIZE - <span class="enscript-keyword">sizeof</span>(__uint8_t) - <span class="enscript-keyword">sizeof</span>(sa_family_t) - \
				_SS_PAD1SIZE - _SS_ALIGNSIZE)

<span class="enscript-comment">/*
 * [XSI] sockaddr_storage
 */</span>
<span class="enscript-type">struct</span> sockaddr_storage {
	__uint8_t	ss_len;		<span class="enscript-comment">/* address length */</span>
	sa_family_t	ss_family;	<span class="enscript-comment">/* [XSI] address family */</span>
	<span class="enscript-type">char</span>			__ss_pad1[_SS_PAD1SIZE];
	__int64_t	__ss_align;	<span class="enscript-comment">/* force structure storage alignment */</span>
	<span class="enscript-type">char</span>			__ss_pad2[_SS_PAD2SIZE];
};

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/queue.h&gt;</span>

<span class="enscript-type">struct</span> sockaddr_entry {
	TAILQ_ENTRY(sockaddr_entry)	se_link;
	<span class="enscript-type">struct</span> sockaddr			*se_addr;
	uint32_t			se_flags;
};

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SEF_ATTACHED</span>		1	<span class="enscript-comment">/* attached to sockaddr_list */</span>

<span class="enscript-type">struct</span> sockaddr_list {
	TAILQ_HEAD(, sockaddr_entry)	sl_head;
	uint32_t			sl_cnt;

};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>

<span class="enscript-comment">/*
 * Protocol families, same as address families for now.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_UNSPEC</span>	AF_UNSPEC
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_LOCAL</span>	AF_LOCAL
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_UNIX</span>		PF_LOCAL	<span class="enscript-comment">/* backward compatibility */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_INET</span>		AF_INET
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_IMPLINK</span>	AF_IMPLINK
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_PUP</span>		AF_PUP
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_CHAOS</span>	AF_CHAOS
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_NS</span>		AF_NS
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_ISO</span>		AF_ISO
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_OSI</span>		AF_ISO
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_ECMA</span>		AF_ECMA
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_DATAKIT</span>	AF_DATAKIT
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_CCITT</span>	AF_CCITT
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_SNA</span>		AF_SNA
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PF_DECnet</span>	AF_DECnet
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PF_DLI</span>		AF_DLI
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PF_LAT</span>		AF_LAT
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_HYLINK</span>	AF_HYLINK
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_APPLETALK</span>	AF_APPLETALK
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_ROUTE</span>	AF_ROUTE
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_LINK</span>		AF_LINK
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_XTP</span>		pseudo_AF_XTP	<span class="enscript-comment">/* really just proto family, no AF */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_COIP</span>		AF_COIP
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_CNT</span>		AF_CNT
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_SIP</span>		AF_SIP
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_IPX</span>		AF_IPX		<span class="enscript-comment">/* same format as AF_NS */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PF_RTIP</span>		pseudo_AF_RTIP	<span class="enscript-comment">/* same format as AF_INET */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PF_PIP</span>		pseudo_AF_PIP
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PF_NDRV</span>		AF_NDRV
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_ISDN</span>		AF_ISDN
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_KEY</span>		pseudo_AF_KEY
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_INET6</span>	AF_INET6
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_NATM</span>		AF_NATM
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PF_SYSTEM</span>	AF_SYSTEM
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PF_NETBIOS</span>	AF_NETBIOS
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PF_PPP</span>		AF_PPP
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PF_AFP</span>		AF_AFP
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PF_RESERVED_36</span>  AF_RESERVED_36
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PF_UTUN</span>		AF_UTUN
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_MULTIPATH</span>	AF_MULTIPATH
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_MAX</span>		AF_MAX

<span class="enscript-comment">/*
 * These do not have socket-layer support:
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PF_VLAN</span>		((uint32_t)0x766c616e)	<span class="enscript-comment">/* 'vlan' */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PF_BOND</span>		((uint32_t)0x626f6e64)	<span class="enscript-comment">/* 'bond' */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL_PRIVATE</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PF_BRIDGE</span>	((uint32_t)0x62726467)	<span class="enscript-comment">/* 'brdg' */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL_PRIVATE */</span>

<span class="enscript-comment">/*
 * Definitions for network related sysctl, CTL_NET.
 *
 * Second level is protocol family.
 * Third level is protocol number.
 *
 * Further levels are defined by the individual families below.
 */</span>
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NET_MAXID</span>	AF_MAX
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* (_POSIX_C_SOURCE &amp;&amp; !_DARWIN_C_SOURCE) */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL_PRIVATE</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CTL_NET_NAMES</span> { \
	{ 0, 0 }, \
	{ <span class="enscript-string">&quot;local&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;inet&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;implink&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;pup&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;chaos&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;xerox_ns&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;iso&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;emca&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;datakit&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;ccitt&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;ibm_sna&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;decnet&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;dec_dli&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;lat&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;hylink&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;appletalk&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;route&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;link_layer&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;xtp&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;coip&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;cnt&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;rtip&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;ipx&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;sip&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;pip&quot;</span>, CTLTYPE_NODE }, \
	{ 0, 0 }, \
	{ <span class="enscript-string">&quot;ndrv&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;isdn&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;key&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;inet6&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;natm&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;sys&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;netbios&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;ppp&quot;</span>, CTLTYPE_NODE }, \
	{ <span class="enscript-string">&quot;hdrcomplete&quot;</span>, CTLTYPE_NODE }, \
}
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL_PRIVATE */</span>

#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
<span class="enscript-comment">/*
 * PF_ROUTE - Routing table
 *
 * Three additional levels are defined:
 *	Fourth: address family, 0 is wildcard
 *	Fifth: type of info, defined below
 *	Sixth: flag(s) to mask with for NET_RT_FLAGS
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NET_RT_DUMP</span>		1	<span class="enscript-comment">/* dump; may limit to a.f. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NET_RT_FLAGS</span>		2	<span class="enscript-comment">/* by flags, e.g. RESOLVING */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NET_RT_IFLIST</span>		3	<span class="enscript-comment">/* survey interface list */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NET_RT_STAT</span>		4	<span class="enscript-comment">/* routing statistics */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NET_RT_TRASH</span>		5	<span class="enscript-comment">/* routes not in table but not freed */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NET_RT_IFLIST2</span>		6	<span class="enscript-comment">/* interface list with addresses */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NET_RT_DUMP2</span>		7	<span class="enscript-comment">/* dump; may limit to a.f. */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NET_RT_DUMPX</span>		8	<span class="enscript-comment">/* private */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NET_RT_DUMPX_FLAGS</span>	9	<span class="enscript-comment">/* private */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NET_RT_MAXID</span>		10
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* (_POSIX_C_SOURCE &amp;&amp; !_DARWIN_C_SOURCE) */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL_PRIVATE</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CTL_NET_RT_NAMES</span> { \
	{ 0, 0 }, \
	{ <span class="enscript-string">&quot;dump&quot;</span>, CTLTYPE_STRUCT }, \
	{ <span class="enscript-string">&quot;flags&quot;</span>, CTLTYPE_STRUCT }, \
	{ <span class="enscript-string">&quot;iflist&quot;</span>, CTLTYPE_STRUCT }, \
	{ <span class="enscript-string">&quot;stat&quot;</span>, CTLTYPE_STRUCT }, \
	{ <span class="enscript-string">&quot;trash&quot;</span>, CTLTYPE_INT }, \
	{ <span class="enscript-string">&quot;iflist2&quot;</span>, CTLTYPE_STRUCT }, \
        { <span class="enscript-string">&quot;dump2&quot;</span>, CTLTYPE_STRUCT }, \
        { <span class="enscript-string">&quot;dumpx&quot;</span>, CTLTYPE_STRUCT }, \
        { <span class="enscript-string">&quot;dumpx_flags&quot;</span>, CTLTYPE_STRUCT }, \
}

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL_PRIVATE */</span>

<span class="enscript-comment">/*
 * Maximum queue length specifiable by listen.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOMAXCONN</span>	128

<span class="enscript-comment">/*
 * [XSI] Message header for recvmsg and sendmsg calls.
 * Used value-result for recvmsg, value only for sendmsg.
 */</span>
<span class="enscript-type">struct</span> msghdr {
	<span class="enscript-type">void</span>		*msg_name;	<span class="enscript-comment">/* [XSI] optional address */</span>
	socklen_t	msg_namelen;	<span class="enscript-comment">/* [XSI] size of address */</span>
	<span class="enscript-type">struct</span>		iovec *msg_iov;	<span class="enscript-comment">/* [XSI] scatter/gather array */</span>
	<span class="enscript-type">int</span>		msg_iovlen;	<span class="enscript-comment">/* [XSI] # elements in msg_iov */</span>
	<span class="enscript-type">void</span>		*msg_control;	<span class="enscript-comment">/* [XSI] ancillary data, see below */</span>
	socklen_t	msg_controllen;	<span class="enscript-comment">/* [XSI] ancillary data buffer len */</span>
	<span class="enscript-type">int</span>		msg_flags;	<span class="enscript-comment">/* [XSI] flags on received message */</span>
};

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
<span class="enscript-comment">/*
 * Extended version for sendmsg_x() and recvmsg_x() calls
 *
 * For recvmsg_x(), the size of the data received is given by the field
 * msg_datalen.
 *
 * For sendmsg_x(), the size of the data to send is given by the length of 
 * the iovec array -- like sendmsg(). The field msg_datalen is ignored.
 */</span>
<span class="enscript-type">struct</span> msghdr_x {
	<span class="enscript-type">void</span>		*msg_name;	<span class="enscript-comment">/* optional address */</span>
	socklen_t	msg_namelen;	<span class="enscript-comment">/* size of address */</span>
	<span class="enscript-type">struct</span> iovec 	*msg_iov;	<span class="enscript-comment">/* scatter/gather array */</span>
	<span class="enscript-type">int</span>		msg_iovlen;	<span class="enscript-comment">/* # elements in msg_iov */</span>
	<span class="enscript-type">void</span>		*msg_control;	<span class="enscript-comment">/* ancillary data, see below */</span>
	socklen_t	msg_controllen;	<span class="enscript-comment">/* ancillary data buffer len */</span>
	<span class="enscript-type">int</span>		msg_flags;	<span class="enscript-comment">/* flags on received message */</span>
	size_t		msg_datalen;	<span class="enscript-comment">/* byte length of buffer in msg_iov */</span>
};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
<span class="enscript-comment">/*
 * In-kernel representation of &quot;struct msghdr&quot; from
 * userspace. Has enough precision for 32-bit or
 * 64-bit clients, but does not need to be packed.
 */</span>

<span class="enscript-type">struct</span> user_msghdr {
	user_addr_t	msg_name;		<span class="enscript-comment">/* optional address */</span>
	socklen_t	msg_namelen;		<span class="enscript-comment">/* size of address */</span>
	user_addr_t	msg_iov;		<span class="enscript-comment">/* scatter/gather array */</span>
	<span class="enscript-type">int</span>		msg_iovlen;		<span class="enscript-comment">/* # elements in msg_iov */</span>
	user_addr_t	msg_control;		<span class="enscript-comment">/* ancillary data, see below */</span>
	socklen_t	msg_controllen;		<span class="enscript-comment">/* ancillary data buffer len */</span>
	<span class="enscript-type">int</span>		msg_flags;		<span class="enscript-comment">/* flags on received message */</span>
};

<span class="enscript-comment">/*
 * LP64 user version of struct msghdr.
 * WARNING - keep in sync with struct msghdr
 */</span>

<span class="enscript-type">struct</span> user64_msghdr {
	user64_addr_t	msg_name;		<span class="enscript-comment">/* optional address */</span>
	socklen_t	msg_namelen;		<span class="enscript-comment">/* size of address */</span>
	user64_addr_t	msg_iov;		<span class="enscript-comment">/* scatter/gather array */</span>
	<span class="enscript-type">int</span>		msg_iovlen;		<span class="enscript-comment">/* # elements in msg_iov */</span>
	user64_addr_t	msg_control;		<span class="enscript-comment">/* ancillary data, see below */</span>
	socklen_t	msg_controllen;		<span class="enscript-comment">/* ancillary data buffer len */</span>
	<span class="enscript-type">int</span>		msg_flags;		<span class="enscript-comment">/* flags on received message */</span>
};

<span class="enscript-comment">/*
 * ILP32 user version of struct msghdr.
 * WARNING - keep in sync with struct msghdr
 */</span>

<span class="enscript-type">struct</span> user32_msghdr {
	user32_addr_t	msg_name;	<span class="enscript-comment">/* optional address */</span>
	socklen_t	msg_namelen;	<span class="enscript-comment">/* size of address */</span>
	user32_addr_t	msg_iov;	<span class="enscript-comment">/* scatter/gather array */</span>
	<span class="enscript-type">int</span>		msg_iovlen;	<span class="enscript-comment">/* # elements in msg_iov */</span>
	user32_addr_t	msg_control;	<span class="enscript-comment">/* ancillary data, see below */</span>
	socklen_t	msg_controllen;	<span class="enscript-comment">/* ancillary data buffer len */</span>
	<span class="enscript-type">int</span>		msg_flags;	<span class="enscript-comment">/* flags on received message */</span>
};

<span class="enscript-comment">/*
 * In-kernel representation of &quot;struct msghdr_x&quot; from
 * userspace. Has enough precision for 32-bit or
 * 64-bit clients, but does not need to be packed.
 */</span>

<span class="enscript-type">struct</span> user_msghdr_x {
	user_addr_t	msg_name;	<span class="enscript-comment">/* optional address */</span>
	socklen_t	msg_namelen;	<span class="enscript-comment">/* size of address */</span>
	user_addr_t	msg_iov;	<span class="enscript-comment">/* scatter/gather array */</span>
	<span class="enscript-type">int</span>		msg_iovlen;	<span class="enscript-comment">/* # elements in msg_iov */</span>
	user_addr_t	msg_control;	<span class="enscript-comment">/* ancillary data, see below */</span>
	socklen_t	msg_controllen;	<span class="enscript-comment">/* ancillary data buffer len */</span>
	<span class="enscript-type">int</span>		msg_flags;	<span class="enscript-comment">/* flags on received message */</span>
	size_t		msg_datalen;	<span class="enscript-comment">/* byte length of buffer in msg_iov */</span>
};

<span class="enscript-comment">/*
 * LP64 user version of struct msghdr_x
 * WARNING - keep in sync with struct msghdr_x
 */</span>

<span class="enscript-type">struct</span> user64_msghdr_x {
	user64_addr_t	msg_name;	<span class="enscript-comment">/* optional address */</span>
	socklen_t	msg_namelen;	<span class="enscript-comment">/* size of address */</span>
	user64_addr_t	msg_iov;	<span class="enscript-comment">/* scatter/gather array */</span>
	<span class="enscript-type">int</span>		msg_iovlen;	<span class="enscript-comment">/* # elements in msg_iov */</span>
	user64_addr_t	msg_control;	<span class="enscript-comment">/* ancillary data, see below */</span>
	socklen_t	msg_controllen;	<span class="enscript-comment">/* ancillary data buffer len */</span>
	<span class="enscript-type">int</span>		msg_flags;	<span class="enscript-comment">/* flags on received message */</span>
	user64_size_t	msg_datalen;	<span class="enscript-comment">/* byte length of buffer in msg_iov */</span>
};

<span class="enscript-comment">/*
 * ILP32 user version of struct msghdr_x
 * WARNING - keep in sync with struct msghdr_x
 */</span>

<span class="enscript-type">struct</span> user32_msghdr_x {
	user32_addr_t	msg_name;	<span class="enscript-comment">/* optional address */</span>
	socklen_t	msg_namelen;	<span class="enscript-comment">/* size of address */</span>
	user32_addr_t	msg_iov;	<span class="enscript-comment">/* scatter/gather array */</span>
	<span class="enscript-type">int</span>		msg_iovlen;	<span class="enscript-comment">/* # elements in msg_iov */</span>
	user32_addr_t	msg_control;	<span class="enscript-comment">/* ancillary data, see below */</span>
	socklen_t	msg_controllen;	<span class="enscript-comment">/* ancillary data buffer len */</span>
	<span class="enscript-type">int</span>		msg_flags;	<span class="enscript-comment">/* flags on received message */</span>
	user32_size_t	msg_datalen;	<span class="enscript-comment">/* byte length of buffer in msg_iov */</span>
};

<span class="enscript-comment">/*
 * In-kernel representation of &quot;struct sa_endpoints&quot; from
 * userspace. Has enough precision for 32-bit or
 * 64-bit clients, but does not need to be packed.
 */</span>

<span class="enscript-type">struct</span> user_sa_endpoints {
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	sae_srcif;	<span class="enscript-comment">/* optional source interface */</span>
	user_addr_t	sae_srcaddr;	<span class="enscript-comment">/* optional source address */</span>
	socklen_t	sae_srcaddrlen;	<span class="enscript-comment">/* size of source address */</span>
	user_addr_t	sae_dstaddr;	<span class="enscript-comment">/* destination address */</span>
	socklen_t	sae_dstaddrlen;	<span class="enscript-comment">/* size of destination address */</span>
};

<span class="enscript-comment">/*
 * LP64 user version of struct sa_endpoints
 * WARNING - keep in sync with struct sa_endpoints
 */</span>

<span class="enscript-type">struct</span> user64_sa_endpoints {
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	sae_srcif;	<span class="enscript-comment">/* optional source interface */</span>
	user64_addr_t	sae_srcaddr;	<span class="enscript-comment">/* optional source address */</span>
	socklen_t	sae_srcaddrlen;	<span class="enscript-comment">/* size of source address */</span>
	user64_addr_t	sae_dstaddr;	<span class="enscript-comment">/* destination address */</span>
	socklen_t	sae_dstaddrlen;	<span class="enscript-comment">/* size of destination address */</span>
};

<span class="enscript-comment">/*
 * ILP32 user version of struct sa_endpoints
 * WARNING - keep in sync with struct sa_endpoints
 */</span>

<span class="enscript-type">struct</span> user32_sa_endpoints {
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	sae_srcif;	<span class="enscript-comment">/* optional source interface */</span>
	user32_addr_t	sae_srcaddr;	<span class="enscript-comment">/* optional source address */</span>
	socklen_t	sae_srcaddrlen;	<span class="enscript-comment">/* size of source address */</span>
	user32_addr_t	sae_dstaddr;	<span class="enscript-comment">/* destination address */</span>
	socklen_t	sae_dstaddrlen;	<span class="enscript-comment">/* size of destination address */</span>
};

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSG_OOB</span>		0x1		<span class="enscript-comment">/* process out-of-band data */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSG_PEEK</span>	0x2		<span class="enscript-comment">/* peek at incoming message */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSG_DONTROUTE</span>	0x4		<span class="enscript-comment">/* send without using routing tables */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSG_EOR</span>		0x8		<span class="enscript-comment">/* data completes record */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSG_TRUNC</span>	0x10		<span class="enscript-comment">/* data discarded before delivery */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSG_CTRUNC</span>	0x20		<span class="enscript-comment">/* control data lost before delivery */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSG_WAITALL</span>	0x40		<span class="enscript-comment">/* wait for full request or error */</span>
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSG_DONTWAIT</span>	0x80		<span class="enscript-comment">/* this message should be nonblocking */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSG_EOF</span>		0x100		<span class="enscript-comment">/* data completes connection */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__APPLE__</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__APPLE_API_OBSOLETE</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_WAITSTREAM</span>  0x200           <span class="enscript-comment">/* wait up to full request.. may return partial */</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_WAITSTREAM</span>  0x200           <span class="enscript-comment">/* wait up to full request.. may return partial */</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_FLUSH</span>	0x400		<span class="enscript-comment">/* Start of 'hold' seq; dump so_temp */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_HOLD</span>	0x800		<span class="enscript-comment">/* Hold frag in so_temp */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_SEND</span>	0x1000		<span class="enscript-comment">/* Send the packet in so_temp */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_HAVEMORE</span>	0x2000		<span class="enscript-comment">/* Data ready to be read */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_RCVMORE</span>	0x4000		<span class="enscript-comment">/* Data remains in current pkt */</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL_PRIVATE</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_COMPAT</span>      0x8000		<span class="enscript-comment">/* deprecated */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL_PRIVATE */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_NEEDSA</span>	0x10000		<span class="enscript-comment">/* Fail receive if socket address cannot be allocated */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL_PRIVATE</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_NBIO</span>	0x20000		<span class="enscript-comment">/* FIONBIO mode, used by fifofs */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_SKIPCFIL</span>	0x40000		<span class="enscript-comment">/* skip pass content filter */</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">KERNEL</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_USEUPCALL</span>	0x80000000 <span class="enscript-comment">/* Inherit upcall in sock_accept */</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE) */</span>

<span class="enscript-comment">/*
 * Header for ancillary data objects in msg_control buffer.
 * Used for additional information with/about a datagram
 * not expressible by flags.  The format is a sequence
 * of message elements headed by cmsghdr structures.
 */</span>
<span class="enscript-type">struct</span> cmsghdr {
	socklen_t	cmsg_len;	<span class="enscript-comment">/* [XSI] data byte count, including hdr */</span>
	<span class="enscript-type">int</span>		cmsg_level;	<span class="enscript-comment">/* [XSI] originating protocol */</span>
	<span class="enscript-type">int</span>		cmsg_type;	<span class="enscript-comment">/* [XSI] protocol-specific type */</span>
<span class="enscript-comment">/* followed by	unsigned char  cmsg_data[]; */</span>
};

#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">__APPLE__</span>
<span class="enscript-comment">/*
 * While we may have more groups than this, the cmsgcred struct must
 * be able to fit in an mbuf, and NGROUPS_MAX is too large to allow
 * this.
*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CMGROUP_MAX</span> 16

<span class="enscript-comment">/*
 * Credentials structure, used to verify the identity of a peer
 * process that has sent us a message. This is allocated by the
 * peer process but filled in by the kernel. This prevents the
 * peer from lying about its identity. (Note that cmcred_groups[0]
 * is the effective GID.)
 */</span>
<span class="enscript-type">struct</span> cmsgcred {
	pid_t	cmcred_pid;		<span class="enscript-comment">/* PID of sending process */</span>
	uid_t	cmcred_uid;		<span class="enscript-comment">/* real UID of sending process */</span>
	uid_t	cmcred_euid;		<span class="enscript-comment">/* effective UID of sending process */</span>
	gid_t	cmcred_gid;		<span class="enscript-comment">/* real GID of sending process */</span>
	<span class="enscript-type">short</span>	cmcred_ngroups;		<span class="enscript-comment">/* number or groups */</span>
	gid_t	cmcred_groups[CMGROUP_MAX];	<span class="enscript-comment">/* groups */</span>
};
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE) */</span>

<span class="enscript-comment">/* given pointer to struct cmsghdr, return pointer to data */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CMSG_DATA</span>(cmsg)		((unsigned char *)(cmsg) + \
				 __DARWIN_ALIGN32(<span class="enscript-keyword">sizeof</span>(<span class="enscript-type">struct</span> cmsghdr)))

<span class="enscript-comment">/*
 * RFC 2292 requires to check msg_controllen, in case that the kernel returns
 * an empty list for some reasons.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">CMSG_FIRSTHDR</span>(mhdr) \
        ((mhdr)-&gt;msg_controllen &gt;= <span class="enscript-keyword">sizeof</span>(<span class="enscript-type">struct</span> cmsghdr) ? \
         (<span class="enscript-type">struct</span> cmsghdr *)(mhdr)-&gt;msg_control : \
         (<span class="enscript-type">struct</span> cmsghdr *)0L)


<span class="enscript-comment">/* 
 * Given pointer to struct cmsghdr, return pointer to next cmsghdr
 * RFC 2292 says that CMSG_NXTHDR(mhdr, NULL) is equivalent to CMSG_FIRSTHDR(mhdr)
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CMSG_NXTHDR</span>(mhdr, cmsg)						\
	((<span class="enscript-type">char</span> *)(cmsg) == (<span class="enscript-type">char</span> *)0L ? CMSG_FIRSTHDR(mhdr) :		\
	 ((((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(cmsg) +					\
	    __DARWIN_ALIGN32((__uint32_t)(cmsg)-&gt;cmsg_len) +		\
	    __DARWIN_ALIGN32(<span class="enscript-keyword">sizeof</span>(<span class="enscript-type">struct</span> cmsghdr))) &gt;			\
	    ((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(mhdr)-&gt;msg_control +			\
	     (mhdr)-&gt;msg_controllen)) ?					\
	  (<span class="enscript-type">struct</span> cmsghdr *)0L <span class="enscript-comment">/* NULL */</span> :				\
	  (<span class="enscript-type">struct</span> cmsghdr *)(<span class="enscript-type">void</span> *)((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(cmsg) +		\
	 		    __DARWIN_ALIGN32((__uint32_t)(cmsg)-&gt;cmsg_len))))

#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
<span class="enscript-comment">/* RFC 2292 additions */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CMSG_SPACE</span>(l)		(__DARWIN_ALIGN32(sizeof(struct cmsghdr)) + __DARWIN_ALIGN32(l))
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CMSG_LEN</span>(l)		(__DARWIN_ALIGN32(sizeof(struct cmsghdr)) + (l))

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">CMSG_ALIGN</span>(n)	__DARWIN_ALIGN32(n)
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE) */</span>

<span class="enscript-comment">/* &quot;Socket&quot;-level control message types: */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SCM_RIGHTS</span>			0x01	<span class="enscript-comment">/* access rights (array of int) */</span>
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SCM_TIMESTAMP</span>			0x02	<span class="enscript-comment">/* timestamp (struct timeval) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SCM_CREDS</span>			0x03	<span class="enscript-comment">/* process creds (struct cmsgcred) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SCM_TIMESTAMP_MONOTONIC</span>		0x04	<span class="enscript-comment">/* timestamp (uint64_t) */</span> 

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SCM_SEQNUM</span>			0x05	<span class="enscript-comment">/* TCP unordered recv seq no */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SCM_MSG_PRIORITY</span>		0x06	<span class="enscript-comment">/* TCP unordered snd priority */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL_PRIVATE</span>
<span class="enscript-comment">/*
 * 4.3 compat sockaddr (deprecated)
 */</span>
<span class="enscript-type">struct</span> osockaddr {
	__uint16_t	sa_family;	<span class="enscript-comment">/* address family */</span>
	<span class="enscript-type">char</span>	sa_data[14];		<span class="enscript-comment">/* up to 14 bytes of direct address */</span>
};

<span class="enscript-comment">/*
 * 4.3-compat message header (deprecated)
 */</span>
<span class="enscript-type">struct</span> omsghdr {
	<span class="enscript-type">void</span>		*msg_name;		<span class="enscript-comment">/* optional address */</span>
	socklen_t	msg_namelen;		<span class="enscript-comment">/* size of address */</span>
	<span class="enscript-type">struct</span>	iovec	*msg_iov;		<span class="enscript-comment">/* scatter/gather array */</span>
	<span class="enscript-type">int</span>		msg_iovlen;		<span class="enscript-comment">/* # elements in msg_iov */</span>
	<span class="enscript-type">void</span>		*msg_accrights;		<span class="enscript-comment">/* access rights sent/rcvd */</span>
	<span class="enscript-type">int</span>		msg_accrightslen;
};

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">SA</span>(s)	((struct sockaddr *)(void *)(s))
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL_PRIVATE */</span>
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE) */</span>

<span class="enscript-comment">/*
 * howto arguments for shutdown(2), specified by Posix.1g.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SHUT_RD</span>		0		<span class="enscript-comment">/* shut down the reading side */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SHUT_WR</span>		1		<span class="enscript-comment">/* shut down the writing side */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SHUT_RDWR</span>	2		<span class="enscript-comment">/* shut down both sides */</span>

#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>)
<span class="enscript-comment">/*
 * sendfile(2) header/trailer struct
 */</span>
<span class="enscript-type">struct</span> sf_hdtr {
	<span class="enscript-type">struct</span> iovec *headers;	<span class="enscript-comment">/* pointer to an array of header struct iovec's */</span>
	<span class="enscript-type">int</span> hdr_cnt;		<span class="enscript-comment">/* number of header iovec's */</span>
	<span class="enscript-type">struct</span> iovec *trailers;	<span class="enscript-comment">/* pointer to an array of trailer struct iovec's */</span>
	<span class="enscript-type">int</span> trl_cnt;		<span class="enscript-comment">/* number of trailer iovec's */</span>
};

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>

<span class="enscript-comment">/* In-kernel representation */</span>
<span class="enscript-type">struct</span> user_sf_hdtr {
	user_addr_t headers;	<span class="enscript-comment">/* pointer to an array of header struct iovec's */</span>
	<span class="enscript-type">int</span> hdr_cnt;		<span class="enscript-comment">/* number of header iovec's */</span>
	user_addr_t trailers;	<span class="enscript-comment">/* pointer to an array of trailer struct iovec's */</span>
	<span class="enscript-type">int</span> trl_cnt;		<span class="enscript-comment">/* number of trailer iovec's */</span>
};

<span class="enscript-comment">/* LP64 user version of struct sf_hdtr */</span>
<span class="enscript-type">struct</span> user64_sf_hdtr {
	user64_addr_t headers;	<span class="enscript-comment">/* pointer to an array of header struct iovec's */</span>
	<span class="enscript-type">int</span> hdr_cnt;		<span class="enscript-comment">/* number of header iovec's */</span>
	user64_addr_t trailers;	<span class="enscript-comment">/* pointer to an array of trailer struct iovec's */</span>
	<span class="enscript-type">int</span> trl_cnt;		<span class="enscript-comment">/* number of trailer iovec's */</span>
};

<span class="enscript-comment">/* ILP32 user version of struct sf_hdtr */</span>
<span class="enscript-type">struct</span> user32_sf_hdtr {
	user32_addr_t headers;	<span class="enscript-comment">/* pointer to an array of header struct iovec's */</span>
	<span class="enscript-type">int</span> hdr_cnt;		<span class="enscript-comment">/* number of header iovec's */</span>
	user32_addr_t trailers;	<span class="enscript-comment">/* pointer to an array of trailer struct iovec's */</span>
	<span class="enscript-type">int</span> trl_cnt;		<span class="enscript-comment">/* number of trailer iovec's */</span>
};

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL */</span>

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* !_POSIX_C_SOURCE */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)

<span class="enscript-comment">/*
 * Structure for SIOCGASSOCIDS
 */</span>
<span class="enscript-type">struct</span> so_aidreq {
	__uint32_t	sar_cnt;	<span class="enscript-comment">/* number of associations */</span>
	sae_associd_t	*sar_aidp;	<span class="enscript-comment">/* array of association IDs */</span>
};

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>
<span class="enscript-type">struct</span> so_aidreq32 {
	__uint32_t	sar_cnt;
	user32_addr_t	sar_aidp;
};

<span class="enscript-type">struct</span> so_aidreq64 {
	__uint32_t	sar_cnt;
	user64_addr_t	sar_aidp __attribute__((aligned(8)));
};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>

<span class="enscript-comment">/*
 * Structure for SIOCGCONNIDS
 */</span>
<span class="enscript-type">struct</span> so_cidreq {
	sae_associd_t	scr_aid;	<span class="enscript-comment">/* association ID */</span>
	__uint32_t	scr_cnt;	<span class="enscript-comment">/* number of connections */</span>
	sae_connid_t	*scr_cidp;	<span class="enscript-comment">/* array of connection IDs */</span>
};

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>
<span class="enscript-type">struct</span> so_cidreq32 {
	sae_associd_t	scr_aid;
	__uint32_t	scr_cnt;
	user32_addr_t	scr_cidp;
};

<span class="enscript-type">struct</span> so_cidreq64 {
	sae_associd_t	scr_aid;
	__uint32_t	scr_cnt;
	user64_addr_t	scr_cidp __attribute__((aligned(8)));
};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>

<span class="enscript-comment">/*
 * Structure for SIOCGCONNINFO
 */</span>
<span class="enscript-type">struct</span> so_cinforeq {
	sae_connid_t	scir_cid;		<span class="enscript-comment">/* connection ID */</span>
	__uint32_t	scir_flags;		<span class="enscript-comment">/* see flags below */</span>
	__uint32_t	scir_ifindex;		<span class="enscript-comment">/* (last) outbound interface */</span>
	__int32_t	scir_error;		<span class="enscript-comment">/* most recent error */</span>
	<span class="enscript-type">struct</span> sockaddr	*scir_src;		<span class="enscript-comment">/* source address */</span>
	socklen_t	scir_src_len;		<span class="enscript-comment">/* source address len */</span>
	<span class="enscript-type">struct</span> sockaddr *scir_dst;		<span class="enscript-comment">/* destination address */</span>
	socklen_t	scir_dst_len;		<span class="enscript-comment">/* destination address len */</span>
	__uint32_t	scir_aux_type;		<span class="enscript-comment">/* aux data type (CIAUX) */</span>
	<span class="enscript-type">void</span>		*scir_aux_data;		<span class="enscript-comment">/* aux data */</span>
	__uint32_t	scir_aux_len;		<span class="enscript-comment">/* aux data len */</span>
};

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>
<span class="enscript-type">struct</span> so_cinforeq32 {
	sae_connid_t	scir_cid;
	__uint32_t	scir_flags;
	__uint32_t	scir_ifindex;
	__int32_t	scir_error;
	user32_addr_t	scir_src;
	socklen_t	scir_src_len;
	user32_addr_t	scir_dst;
	socklen_t	scir_dst_len;
	__uint32_t	scir_aux_type;
	user32_addr_t	scir_aux_data;
	__uint32_t	scir_aux_len;
};

<span class="enscript-type">struct</span> so_cinforeq64 {
	sae_connid_t	scir_cid;
	__uint32_t	scir_flags;
	__uint32_t	scir_ifindex;
	__int32_t	scir_error;
	user64_addr_t	scir_src	__attribute__((aligned(8)));
	socklen_t	scir_src_len;
	user64_addr_t	scir_dst	__attribute__((aligned(8)));
	socklen_t	scir_dst_len;
	__uint32_t	scir_aux_type;
	user64_addr_t	scir_aux_data	__attribute__((aligned(8)));
	__uint32_t	scir_aux_len;
};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>

<span class="enscript-comment">/* valid connection info flags */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CIF_CONNECTING</span>		0x1	<span class="enscript-comment">/* connection was attempted */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CIF_CONNECTED</span>		0x2	<span class="enscript-comment">/* connection is established */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CIF_DISCONNECTING</span>	0x4	<span class="enscript-comment">/* disconnection was attempted */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CIF_DISCONNECTED</span>	0x8	<span class="enscript-comment">/* has been disconnected */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CIF_BOUND_IF</span>		0x10	<span class="enscript-comment">/* bound to an interface */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CIF_BOUND_IP</span>		0x20	<span class="enscript-comment">/* bound to a src address */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CIF_BOUND_PORT</span>		0x40	<span class="enscript-comment">/* bound to a src port */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CIF_PREFERRED</span>		0x80	<span class="enscript-comment">/* connection is primary/preferred */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CIF_MP_CAPABLE</span>		0x100	<span class="enscript-comment">/* supports multipath protocol */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CIF_MP_READY</span>		0x200	<span class="enscript-comment">/* multipath protocol confirmed */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CIF_MP_DEGRADED</span>		0x400	<span class="enscript-comment">/* has lost its multipath capability */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CIF_MP_ACTIVE</span>		0x800	<span class="enscript-comment">/* this is the active subflow */</span>

<span class="enscript-comment">/* valid connection info auxiliary data types */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CIAUX_TCP</span>	0x1	<span class="enscript-comment">/* TCP auxiliary data (conninfo_tcp_t) */</span>

<span class="enscript-comment">/*
 * Structure for SIOC{S,G}CONNORDER
 */</span>
<span class="enscript-type">struct</span> so_cordreq {
	sae_connid_t	sco_cid;		<span class="enscript-comment">/* connection ID */</span>
	__uint32_t	sco_rank;		<span class="enscript-comment">/* rank (0 means unspecified) */</span>
};

<span class="enscript-comment">/*
 * Network policy subclass (of KEV_NETWORK_CLASS)
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KEV_NETPOLICY_SUBCLASS</span>	3

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KEV_NETPOLICY_IFDENIED</span>	1	<span class="enscript-comment">/* denied access to interface */</span>

<span class="enscript-comment">/*
 * Common structure for KEV_NETPOLICY_SUBCLASS
 */</span>
<span class="enscript-type">struct</span> netpolicy_event_data {
	__uint64_t	eupid;		<span class="enscript-comment">/* effective unique PID */</span>
	pid_t		epid;		<span class="enscript-comment">/* effective PID */</span>
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__LP64__</span>)
	__uint32_t	pad;
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* __LP64__ */</span>
	uuid_t		euuid;		<span class="enscript-comment">/* effective UUID */</span>
};

<span class="enscript-comment">/*
 * NETPOLICY_IFDENIED event structure
 */</span>
<span class="enscript-type">struct</span> kev_netpolicy_ifdenied {
	<span class="enscript-type">struct</span> netpolicy_event_data	ev_data;
};

<span class="enscript-comment">/*
 * Socket subclass (of KEV_NETWORK_CLASS)
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KEV_SOCKET_SUBCLASS</span>	4

<span class="enscript-comment">/*
 * Events for KEV_SOCKET_SUBCLASS of KEV_NETWORK_CLASS
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KEV_SOCKET_CLOSED</span>	1	<span class="enscript-comment">/* completely closed by protocol */</span>

<span class="enscript-comment">/*
 * Common structure for KEV_SOCKET_SUBCLASS
 */</span>
<span class="enscript-type">struct</span> kev_socket_event_data {
	<span class="enscript-type">struct</span> sockaddr_storage kev_sockname;
	<span class="enscript-type">struct</span> sockaddr_storage kev_peername;
};

<span class="enscript-type">struct</span> kev_socket_closed {
	<span class="enscript-type">struct</span> kev_socket_event_data ev_data;
};

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">KERNEL</span>
__BEGIN_DECLS

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">peeloff</span>(<span class="enscript-type">int</span> s, sae_associd_t);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">socket_delegate</span>(<span class="enscript-type">int</span>, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>, pid_t);

<span class="enscript-comment">/*
 * recvmsg_x() is a system call similar to recvmsg(2) to receive
 * several datagrams at once in the array of message headers &quot;msgp&quot;.
 *
 * recvmsg_x() can be used only with protocols handlers that have been specially
 * modified to support sending and receiving several datagrams at once.
 * 
 * The size of the array &quot;msgp&quot; is given by the argument &quot;cnt&quot;.
 *
 * The &quot;flags&quot; arguments supports only the value MSG_DONTWAIT.
 * 
 * Each member of &quot;msgp&quot; array is of type &quot;struct msghdr_x&quot;.
 *
 * The &quot;msg_iov&quot; and &quot;msg_iovlen&quot; are input parameters that describe where to
 * store a datagram in a scatter gather locations of buffers -- see recvmsg(2).
 * On output the field &quot;msg_datalen&quot; gives the length of the received datagram.
 *
 * The field &quot;msg_flags&quot; must be set to zero on input. On output, &quot;msg_flags&quot;
 * may have MSG_TRUNC set to indicate the trailing portion of the datagram was
 * discarded because the datagram was larger than the buffer supplied.
 * recvmsg_x() returns as soon as a datagram is truncated.
 *
 * recvmsg_x() may return with less than &quot;cnt&quot; datagrams received based on
 * the low water mark and the amount of data pending in the socket buffer.
 *
 * recvmsg_x() returns the number of datagrams that have been received,
 * or -1 if an error occurred. 
 *
 * NOTE: This a private system call, the API is subject to change.
 */</span>
ssize_t <span class="enscript-function-name">recvmsg_x</span>(<span class="enscript-type">int</span> s, <span class="enscript-type">const</span> <span class="enscript-type">struct</span> msghdr_x *msgp, u_int cnt, <span class="enscript-type">int</span> flags);

<span class="enscript-comment">/*
 * sendmsg_x() is a system call similar to send(2) to send
 * several datagrams at once in the array of message headers &quot;msgp&quot;.
 *
 * sendmsg_x() can be used only with protocols handlers that have been specially
 * modified to support sending and receiving several datagrams at once.
 * 
 * The size of the array &quot;msgp&quot; is given by the argument &quot;cnt&quot;.
 *
 * The &quot;flags&quot; arguments supports only the value MSG_DONTWAIT.
 * 
 * Each member of &quot;msgp&quot; array is of type &quot;struct msghdr_x&quot;.
 *
 * The &quot;msg_iov&quot; and &quot;msg_iovlen&quot; are input parameters that specify the
 * data to be sent in a scatter gather locations of buffers -- see sendmsg(2).
 *
 * sendmsg_x() fails with EMSGSIZE if the sum of the length of the datagrams
 * is greater than the high water mark.
 *
 * Address and ancillary data are not supported so the following fields
 * must be set to zero on input:
 *   &quot;msg_name&quot;, &quot;msg_namelen&quot;, &quot;msg_control&quot; and &quot;msg_controllen&quot;.
 *
 * The field &quot;msg_flags&quot; and &quot;msg_datalen&quot; must be set to zero on input. 
 *
 * sendmsg_x() returns the number of datagrams that have been sent,
 * or -1 if an error occurred. 
 *
 * NOTE: This a private system call, the API is subject to change.
 */</span>
ssize_t <span class="enscript-function-name">sendmsg_x</span>(<span class="enscript-type">int</span> s, <span class="enscript-type">const</span> <span class="enscript-type">struct</span> msghdr_x *msgp, u_int cnt, <span class="enscript-type">int</span> flags);
__END_DECLS
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !KERNEL */</span>
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE) */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">KERNEL</span>
__BEGIN_DECLS

<span class="enscript-type">int</span>	accept(<span class="enscript-type">int</span>, <span class="enscript-type">struct</span> sockaddr * __restrict, socklen_t * __restrict)
		__DARWIN_ALIAS_C(accept);
<span class="enscript-type">int</span>	bind(<span class="enscript-type">int</span>, <span class="enscript-type">const</span> <span class="enscript-type">struct</span> sockaddr *, socklen_t) __DARWIN_ALIAS(bind);
<span class="enscript-type">int</span>	connect(<span class="enscript-type">int</span>, <span class="enscript-type">const</span> <span class="enscript-type">struct</span> sockaddr *, socklen_t) __DARWIN_ALIAS_C( connect);
<span class="enscript-type">int</span>	getpeername(<span class="enscript-type">int</span>, <span class="enscript-type">struct</span> sockaddr * __restrict, socklen_t * __restrict)
		__DARWIN_ALIAS(getpeername);
<span class="enscript-type">int</span>	getsockname(<span class="enscript-type">int</span>, <span class="enscript-type">struct</span> sockaddr * __restrict, socklen_t * __restrict)
		__DARWIN_ALIAS(getsockname);
<span class="enscript-type">int</span>	getsockopt(<span class="enscript-type">int</span>, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>, <span class="enscript-type">void</span> * __restrict, socklen_t * __restrict);
<span class="enscript-type">int</span>	listen(<span class="enscript-type">int</span>, <span class="enscript-type">int</span>) __DARWIN_ALIAS(listen);
ssize_t	recv(<span class="enscript-type">int</span>, <span class="enscript-type">void</span> *, size_t, <span class="enscript-type">int</span>) __DARWIN_ALIAS_C(recv);
ssize_t	recvfrom(<span class="enscript-type">int</span>, <span class="enscript-type">void</span> *, size_t, <span class="enscript-type">int</span>, <span class="enscript-type">struct</span> sockaddr * __restrict,
		socklen_t * __restrict) __DARWIN_ALIAS_C(recvfrom);
ssize_t	recvmsg(<span class="enscript-type">int</span>, <span class="enscript-type">struct</span> msghdr *, <span class="enscript-type">int</span>) __DARWIN_ALIAS_C(recvmsg);
ssize_t	send(<span class="enscript-type">int</span>, <span class="enscript-type">const</span> <span class="enscript-type">void</span> *, size_t, <span class="enscript-type">int</span>) __DARWIN_ALIAS_C(send);
ssize_t	sendmsg(<span class="enscript-type">int</span>, <span class="enscript-type">const</span> <span class="enscript-type">struct</span> msghdr *, <span class="enscript-type">int</span>) __DARWIN_ALIAS_C(sendmsg);
ssize_t	sendto(<span class="enscript-type">int</span>, <span class="enscript-type">const</span> <span class="enscript-type">void</span> *, size_t,
		<span class="enscript-type">int</span>, <span class="enscript-type">const</span> <span class="enscript-type">struct</span> sockaddr *, socklen_t) __DARWIN_ALIAS_C(sendto);
<span class="enscript-type">int</span>	setsockopt(<span class="enscript-type">int</span>, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>, <span class="enscript-type">const</span> <span class="enscript-type">void</span> *, socklen_t);
<span class="enscript-type">int</span>	shutdown(<span class="enscript-type">int</span>, <span class="enscript-type">int</span>);
<span class="enscript-type">int</span>	sockatmark(<span class="enscript-type">int</span>) __OSX_AVAILABLE_STARTING(__MAC_10_5, __IPHONE_2_0);
<span class="enscript-type">int</span>	socket(<span class="enscript-type">int</span>, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>);
<span class="enscript-type">int</span>	socketpair(<span class="enscript-type">int</span>, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>, <span class="enscript-type">int</span> *) __DARWIN_ALIAS(socketpair);

#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>)
<span class="enscript-type">int</span>	sendfile(<span class="enscript-type">int</span>, <span class="enscript-type">int</span>, off_t, off_t *, <span class="enscript-type">struct</span> sf_hdtr *, <span class="enscript-type">int</span>);
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* !_POSIX_C_SOURCE */</span>

#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
<span class="enscript-type">void</span>	pfctlinput(<span class="enscript-type">int</span>, <span class="enscript-type">struct</span> sockaddr *);
<span class="enscript-type">int</span> <span class="enscript-function-name">connectx</span>(<span class="enscript-type">int</span> , <span class="enscript-type">const</span> sa_endpoints_t *, sae_associd_t, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>,
    <span class="enscript-type">const</span> <span class="enscript-type">struct</span> iovec *, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>, size_t *, sae_connid_t *);
<span class="enscript-type">int</span> <span class="enscript-function-name">disconnectx</span>(<span class="enscript-type">int</span> , sae_associd_t, sae_connid_t);
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE) */</span>
__END_DECLS
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !KERNEL */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/kpi_socket.h&gt;</span>
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !_SYS_SOCKET_H_ */</span>
</pre>
<hr />
</body></html>