<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>kauth.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">kauth.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2004-2010 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*
 * NOTICE: This file was modified by SPARTA, Inc. in 2005 to introduce
 * support for mandatory and extensible security protections.  This notice
 * is included in support of clause 2.2 (b) of the Apple Public License,
 * Version 2.0.
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_SYS_KAUTH_H</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_SYS_KAUTH_H</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/appleapiopts.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/cdefs.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/boolean.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types.h&gt;</span>		<span class="enscript-comment">/* __offsetof() */</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/syslimits.h&gt;</span>	<span class="enscript-comment">/* NGROUPS_MAX */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__APPLE_API_EVOLVING</span>

<span class="enscript-comment">/*
 * Identities.
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_UID_NONE</span>	(~(uid_t)0 - 100)	<span class="enscript-comment">/* not a valid UID */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_GID_NONE</span>	(~(gid_t)0 - 100)	<span class="enscript-comment">/* not a valid GID */</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types/_guid_t.h&gt;</span>

<span class="enscript-comment">/* NT Security Identifier, structure as defined by Microsoft */</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">pack</span>(1)    <span class="enscript-comment">/* push packing of 1 byte */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
	u_int8_t		sid_kind;
	u_int8_t		sid_authcount;
	u_int8_t		sid_authority[6];
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_NTSID_MAX_AUTHORITIES</span> 16
	u_int32_t	sid_authorities[KAUTH_NTSID_MAX_AUTHORITIES];
} ntsid_t;
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">pack</span>()    <span class="enscript-comment">/* pop packing to previous packing level */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_NTSID_T</span>

<span class="enscript-comment">/* valid byte count inside a SID structure */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_NTSID_HDRSIZE</span>	(8)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">KAUTH_NTSID_SIZE</span>(_s)	(KAUTH_NTSID_HDRSIZE + ((_s)-&gt;sid_authcount * sizeof(u_int32_t)))

<span class="enscript-comment">/*
 * External lookup message payload; this structure is shared between the
 * kernel group membership resolver, and the user space group membership
 * resolver daemon, and is use to communicate resolution requests from the
 * kernel to user space, and the result of that request from user space to
 * the kernel.
 */</span>
<span class="enscript-type">struct</span> kauth_identity_extlookup {
	u_int32_t	el_seqno;	<span class="enscript-comment">/* request sequence number */</span>
	u_int32_t	el_result;	<span class="enscript-comment">/* lookup result */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_SUCCESS</span>		0	<span class="enscript-comment">/* results here are good */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_BADRQ</span>		1	<span class="enscript-comment">/* request badly formatted */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_FAILURE</span>		2	<span class="enscript-comment">/* transient failure during lookup */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_FATAL</span>		3	<span class="enscript-comment">/* permanent failure during lookup */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_INPROG</span>		100	<span class="enscript-comment">/* request in progress */</span>
	u_int32_t	el_flags;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_VALID_UID</span>	(1&lt;&lt;0)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_VALID_UGUID</span>	(1&lt;&lt;1)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_VALID_USID</span>	(1&lt;&lt;2)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_VALID_GID</span>	(1&lt;&lt;3)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_VALID_GGUID</span>	(1&lt;&lt;4)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_VALID_GSID</span>	(1&lt;&lt;5)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_WANT_UID</span>	(1&lt;&lt;6)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_WANT_UGUID</span>	(1&lt;&lt;7)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_WANT_USID</span>	(1&lt;&lt;8)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_WANT_GID</span>	(1&lt;&lt;9)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_WANT_GGUID</span>	(1&lt;&lt;10)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_WANT_GSID</span>	(1&lt;&lt;11)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_WANT_MEMBERSHIP</span>	(1&lt;&lt;12)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_VALID_MEMBERSHIP</span> (1&lt;&lt;13)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_ISMEMBER</span>	(1&lt;&lt;14)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_VALID_PWNAM</span>	(1&lt;&lt;15)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KAUTH_EXTLOOKUP_WANT_PWNAM</span>	(1&lt;&lt;16)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_VALID_GRNAM</span>	(1&lt;&lt;17)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KAUTH_EXTLOOKUP_WANT_GRNAM</span>	(1&lt;&lt;18)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KAUTH_EXTLOOKUP_VALID_SUPGRPS</span>	(1&lt;&lt;19)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KAUTH_EXTLOOKUP_WANT_SUPGRPS</span>	(1&lt;&lt;20)

	__darwin_pid_t	el_info_pid;		<span class="enscript-comment">/* request on behalf of PID */</span>
	u_int64_t	el_extend;		<span class="enscript-comment">/* extension field */</span>
	u_int32_t	el_info_reserved_1;	<span class="enscript-comment">/* reserved (APPLE) */</span>

	uid_t		el_uid;		<span class="enscript-comment">/* user ID */</span>
	guid_t		el_uguid;	<span class="enscript-comment">/* user GUID */</span>
	u_int32_t	el_uguid_valid;	<span class="enscript-comment">/* TTL on translation result (seconds) */</span>
	ntsid_t		el_usid;	<span class="enscript-comment">/* user NT SID */</span>
	u_int32_t	el_usid_valid;	<span class="enscript-comment">/* TTL on translation result (seconds) */</span>
	gid_t		el_gid;		<span class="enscript-comment">/* group ID */</span>
	guid_t		el_gguid;	<span class="enscript-comment">/* group GUID */</span>
	u_int32_t	el_gguid_valid;	<span class="enscript-comment">/* TTL on translation result (seconds) */</span>
	ntsid_t		el_gsid;	<span class="enscript-comment">/* group SID */</span>
	u_int32_t	el_gsid_valid;	<span class="enscript-comment">/* TTL on translation result (seconds) */</span>
	u_int32_t	el_member_valid; <span class="enscript-comment">/* TTL on group lookup result */</span>
 	u_int32_t	el_sup_grp_cnt;  <span class="enscript-comment">/* count of supplemental groups up to NGROUPS */</span>
 	gid_t		el_sup_groups[NGROUPS_MAX];	<span class="enscript-comment">/* supplemental group list */</span>
};

<span class="enscript-type">struct</span> kauth_cache_sizes {
	u_int32_t kcs_group_size;
	u_int32_t kcs_id_size;
};

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_REGISTER</span>	(0)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_RESULT</span>		(1&lt;&lt;0)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_EXTLOOKUP_WORKER</span>		(1&lt;&lt;1)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KAUTH_EXTLOOKUP_DEREGISTER</span>	(1&lt;&lt;2)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KAUTH_GET_CACHE_SIZES</span>		(1&lt;&lt;3)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KAUTH_SET_CACHE_SIZES</span>		(1&lt;&lt;4)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KAUTH_CLEAR_CACHES</span>		(1&lt;&lt;5)


#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>
<span class="enscript-comment">/*
 * Credentials.
 */</span>

#<span class="enscript-reference">if</span> 0
<span class="enscript-comment">/*
 * Supplemental credential data.
 *
 * This interface allows us to associate arbitrary data with a credential.
 * As with the credential, the data is considered immutable.
 */</span>
<span class="enscript-type">struct</span> kauth_cred_supplement {
	TAILQ_ENTRY(kauth_cred_supplement) kcs_link;

	<span class="enscript-type">int</span>	kcs_ref;		<span class="enscript-comment">/* reference count */</span>
	<span class="enscript-type">int</span>	kcs_id;			<span class="enscript-comment">/* vended identifier */</span>
	size_t	kcs_size;		<span class="enscript-comment">/* size of data field */</span>
	<span class="enscript-type">char</span>	kcs_data[0];
};

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> kauth_cred_supplement *kauth_cred_supplement_t;

<span class="enscript-type">struct</span> kauth_cred {
	TAILQ_ENTRY(kauth_cred)	kc_link;
	
	<span class="enscript-type">int</span>	kc_ref;			<span class="enscript-comment">/* reference count */</span>
	uid_t	kc_uid;			<span class="enscript-comment">/* effective user id */</span>
	uid_t	kc_ruid;		<span class="enscript-comment">/* real user id */</span>
	uid_t	kc_svuid;		<span class="enscript-comment">/* saved user id */</span>
	gid_t	kc_gid;			<span class="enscript-comment">/* effective group id */</span>
	gid_t	kc_rgid;		<span class="enscript-comment">/* real group id */</span>
	gid_t	kc_svgid;		<span class="enscript-comment">/* saved group id */</span>

	<span class="enscript-type">int</span>	kc_flags;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_CRED_GRPOVERRIDE</span>		(1&lt;&lt;0)	<span class="enscript-comment">/* private group list is authoritative */</span>

	<span class="enscript-type">int</span>	kc_npvtgroups;		<span class="enscript-comment">/* private group list, advisory or authoritative */</span>
	gid_t	kc_pvtgroups[NGROUPS];	<span class="enscript-comment">/* based on KAUTH_CRED_GRPOVERRIDE flag */</span>

	<span class="enscript-type">int</span>	kc_nsuppgroups;		<span class="enscript-comment">/* supplementary group list */</span>
	gid_t	*kc_suppgroups;

	<span class="enscript-type">int</span>	kc_nwhtgroups;		<span class="enscript-comment">/* whiteout group list */</span>
	gid_t	*kc_whtgroups;
	
	<span class="enscript-type">struct</span> au_session cr_audit;	<span class="enscript-comment">/* user auditing data */</span>

	<span class="enscript-type">int</span>	kc_nsupplement;		<span class="enscript-comment">/* entry count in supplemental data pointer array */</span>
	kauth_cred_supplement_t *kc_supplement;
};
#<span class="enscript-reference">else</span>

<span class="enscript-comment">/* XXX just for now */</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/ucred.h&gt;</span>
<span class="enscript-comment">// typedef struct ucred *kauth_cred_t;
</span>#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/* Kernel SPI for now */</span>
__BEGIN_DECLS
<span class="enscript-comment">/*
 * Routines specific to credentials with POSIX credential labels attached
 *
 * XXX	Should be in policy_posix.h, with struct posix_cred
 */</span>
<span class="enscript-type">extern</span> kauth_cred_t <span class="enscript-function-name">posix_cred_create</span>(posix_cred_t pcred);
<span class="enscript-type">extern</span> posix_cred_t <span class="enscript-function-name">posix_cred_get</span>(kauth_cred_t cred);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">posix_cred_label</span>(kauth_cred_t cred, posix_cred_t pcred);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">posix_cred_access</span>(kauth_cred_t cred, id_t object_uid, id_t object_gid, mode_t object_mode, mode_t mode_req);

<span class="enscript-type">extern</span> uid_t	kauth_getuid(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> uid_t	kauth_getruid(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> gid_t	kauth_getgid(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> kauth_cred_t <span class="enscript-function-name">kauth_cred_get</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> kauth_cred_t <span class="enscript-function-name">kauth_cred_get_with_ref</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> kauth_cred_t <span class="enscript-function-name">kauth_cred_proc_ref</span>(proc_t procp);
<span class="enscript-type">extern</span> kauth_cred_t <span class="enscript-function-name">kauth_cred_create</span>(kauth_cred_t cred);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	kauth_cred_ref(kauth_cred_t _cred);
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">__LP64__</span>
<span class="enscript-comment">/* Use kauth_cred_unref(), not kauth_cred_rele() */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	kauth_cred_rele(kauth_cred_t _cred) __deprecated;
#<span class="enscript-reference">endif</span>
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	kauth_cred_unref(kauth_cred_t *_cred);

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">CONFIG_MACF</span>
<span class="enscript-type">struct</span> label;
<span class="enscript-type">extern</span> kauth_cred_t	kauth_cred_label_update(kauth_cred_t cred, <span class="enscript-type">struct</span> label *label);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">kauth_proc_label_update</span>(<span class="enscript-type">struct</span> proc *p, <span class="enscript-type">struct</span> label *label);
#<span class="enscript-reference">else</span>
<span class="enscript-comment">/* this is a temp hack to cover us when MAC is not built in a kernel configuration. 
 * Since we cannot build our export list based on the kernel configuration we need
 * to define a stub. 
 */</span>
<span class="enscript-type">extern</span> kauth_cred_t	kauth_cred_label_update(kauth_cred_t cred, <span class="enscript-type">void</span> *label);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">kauth_proc_label_update</span>(<span class="enscript-type">struct</span> proc *p, <span class="enscript-type">void</span> *label);
#<span class="enscript-reference">endif</span>

<span class="enscript-type">extern</span> kauth_cred_t <span class="enscript-function-name">kauth_cred_find</span>(kauth_cred_t cred);
<span class="enscript-type">extern</span> uid_t	kauth_cred_getuid(kauth_cred_t _cred);
<span class="enscript-type">extern</span> uid_t	kauth_cred_getruid(kauth_cred_t _cred);
<span class="enscript-type">extern</span> uid_t	kauth_cred_getsvuid(kauth_cred_t _cred);
<span class="enscript-type">extern</span> gid_t	kauth_cred_getgid(kauth_cred_t _cred);
<span class="enscript-type">extern</span> gid_t	kauth_cred_getrgid(kauth_cred_t _cred);
<span class="enscript-type">extern</span> gid_t	kauth_cred_getsvgid(kauth_cred_t _cred);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_cred_pwnam2guid(<span class="enscript-type">char</span> *pwnam, guid_t *guidp);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_cred_grnam2guid(<span class="enscript-type">char</span> *grnam, guid_t *guidp);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_cred_guid2pwnam(guid_t *guidp, <span class="enscript-type">char</span> *pwnam);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_cred_guid2grnam(guid_t *guidp, <span class="enscript-type">char</span> *grnam);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>      <span class="enscript-function-name">kauth_cred_guid2uid</span>(guid_t *_guid, uid_t *_uidp);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>      <span class="enscript-function-name">kauth_cred_guid2gid</span>(guid_t *_guid, gid_t *_gidp);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>      <span class="enscript-function-name">kauth_cred_ntsid2uid</span>(ntsid_t *_sid, uid_t *_uidp);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>      <span class="enscript-function-name">kauth_cred_ntsid2gid</span>(ntsid_t *_sid, gid_t *_gidp);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>      <span class="enscript-function-name">kauth_cred_ntsid2guid</span>(ntsid_t *_sid, guid_t *_guidp);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>      <span class="enscript-function-name">kauth_cred_uid2guid</span>(uid_t _uid, guid_t *_guidp);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_cred_getguid(kauth_cred_t _cred, guid_t *_guidp);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>      <span class="enscript-function-name">kauth_cred_gid2guid</span>(gid_t _gid, guid_t *_guidp);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>      <span class="enscript-function-name">kauth_cred_uid2ntsid</span>(uid_t _uid, ntsid_t *_sidp);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_cred_getntsid(kauth_cred_t _cred, ntsid_t *_sidp);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>      <span class="enscript-function-name">kauth_cred_gid2ntsid</span>(gid_t _gid, ntsid_t *_sidp);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>      <span class="enscript-function-name">kauth_cred_guid2ntsid</span>(guid_t *_guid, ntsid_t *_sidp);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_cred_ismember_gid(kauth_cred_t _cred, gid_t _gid, <span class="enscript-type">int</span> *_resultp);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_cred_ismember_guid(kauth_cred_t _cred, guid_t *_guidp, <span class="enscript-type">int</span> *_resultp);

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> 	groupmember(gid_t gid, kauth_cred_t cred);

<span class="enscript-comment">/* currently only exported in unsupported for use by seatbelt */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_cred_issuser(kauth_cred_t _cred);


<span class="enscript-comment">/* GUID, NTSID helpers */</span>
<span class="enscript-type">extern</span> guid_t	kauth_null_guid;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_guid_equal(guid_t *_guid1, guid_t *_guid2);
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_ntsid_equal(ntsid_t *_sid1, ntsid_t *_sid2);
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_wellknown_guid(guid_t *_guid);
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_WKG_NOT</span>		0	<span class="enscript-comment">/* not a well-known GUID */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_WKG_OWNER</span>		1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_WKG_GROUP</span>		2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_WKG_NOBODY</span>	3
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_WKG_EVERYBODY</span>	4

<span class="enscript-type">extern</span> kauth_cred_t <span class="enscript-function-name">kauth_cred_dup</span>(kauth_cred_t cred);
<span class="enscript-type">extern</span> gid_t	kauth_getrgid(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> kauth_cred_t <span class="enscript-function-name">kauth_cred_alloc</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	cantrace(proc_t cur_procp, kauth_cred_t creds, proc_t traced_procp, <span class="enscript-type">int</span> *errp);
<span class="enscript-type">extern</span> kauth_cred_t <span class="enscript-function-name">kauth_cred_copy_real</span>(kauth_cred_t cred);
<span class="enscript-type">extern</span> kauth_cred_t	kauth_cred_setresuid(kauth_cred_t cred, uid_t ruid, uid_t euid, uid_t svuid, uid_t gmuid);
<span class="enscript-type">extern</span> kauth_cred_t	kauth_cred_setresgid(kauth_cred_t cred, gid_t rgid, gid_t egid, gid_t svgid);
<span class="enscript-type">extern</span> kauth_cred_t <span class="enscript-function-name">kauth_cred_setuidgid</span>(kauth_cred_t cred, uid_t uid, gid_t gid);
<span class="enscript-type">extern</span> kauth_cred_t <span class="enscript-function-name">kauth_cred_setsvuidgid</span>(kauth_cred_t cred, uid_t uid, gid_t gid);
<span class="enscript-type">extern</span> kauth_cred_t	kauth_cred_setgroups(kauth_cred_t cred, gid_t *groups, <span class="enscript-type">int</span> groupcount, uid_t gmuid);
<span class="enscript-type">struct</span> uthread;
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	kauth_cred_uthread_update(<span class="enscript-type">struct</span> uthread *, proc_t);
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">CONFIG_MACF</span>
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">kauth_proc_label_update_execve</span>(<span class="enscript-type">struct</span> proc *p, <span class="enscript-type">struct</span> vfs_context *ctx, <span class="enscript-type">struct</span> vnode *vp, off_t offset, <span class="enscript-type">struct</span> vnode *scriptvp, <span class="enscript-type">struct</span> label *scriptlabel, <span class="enscript-type">struct</span> label *execlabel, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> *csflags, <span class="enscript-type">void</span> *psattr, <span class="enscript-type">int</span> *disjoint, <span class="enscript-type">int</span> *update_return);
#<span class="enscript-reference">endif</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_cred_getgroups(kauth_cred_t _cred, gid_t *_groups, <span class="enscript-type">int</span> *_groupcount);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_cred_assume(uid_t _uid);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_cred_gid_subset(kauth_cred_t _cred1, kauth_cred_t _cred2, <span class="enscript-type">int</span> *_resultp);
<span class="enscript-type">struct</span> auditinfo_addr;
<span class="enscript-type">extern</span> kauth_cred_t <span class="enscript-function-name">kauth_cred_setauditinfo</span>(kauth_cred_t, au_session_t *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_cred_supplementary_register(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *name, <span class="enscript-type">int</span> *ident);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_cred_supplementary_add(kauth_cred_t cred, <span class="enscript-type">int</span> ident, <span class="enscript-type">const</span> <span class="enscript-type">void</span> *data, size_t datasize);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_cred_supplementary_remove(kauth_cred_t cred, <span class="enscript-type">int</span> ident);

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>
__END_DECLS

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL */</span>

<span class="enscript-comment">/*
 * Generic Access Control Lists.
 */</span>
#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">KERNEL</span>) || <span class="enscript-variable-name">defined</span> (<span class="enscript-variable-name">_SYS_ACL_H</span>)

<span class="enscript-type">typedef</span> u_int32_t kauth_ace_rights_t;

<span class="enscript-comment">/* Access Control List Entry (ACE) */</span>
<span class="enscript-type">struct</span> kauth_ace {
	guid_t		ace_applicable;
	u_int32_t	ace_flags;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACE_KINDMASK</span>		0xf
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACE_PERMIT</span>		1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACE_DENY</span>			2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACE_AUDIT</span>			3	<span class="enscript-comment">/* not implemented */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACE_ALARM</span>			4	<span class="enscript-comment">/* not implemented */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KAUTH_ACE_INHERITED</span>		(1&lt;&lt;4)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACE_FILE_INHERIT</span>		(1&lt;&lt;5)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACE_DIRECTORY_INHERIT</span>	(1&lt;&lt;6)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACE_LIMIT_INHERIT</span>		(1&lt;&lt;7)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACE_ONLY_INHERIT</span>		(1&lt;&lt;8)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACE_SUCCESS</span>		(1&lt;&lt;9)	<span class="enscript-comment">/* not implemented (AUDIT/ALARM) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACE_FAILURE</span>		(1&lt;&lt;10)	<span class="enscript-comment">/* not implemented (AUDIT/ALARM) */</span>
<span class="enscript-comment">/* All flag bits controlling ACE inheritance */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACE_INHERIT_CONTROL_FLAGS</span>		\
		(KAUTH_ACE_FILE_INHERIT |	\
		 KAUTH_ACE_DIRECTORY_INHERIT |	\
		 KAUTH_ACE_LIMIT_INHERIT |	\
		 KAUTH_ACE_ONLY_INHERIT)
	kauth_ace_rights_t ace_rights;		<span class="enscript-comment">/* scope specific */</span>
	<span class="enscript-comment">/* These rights are never tested, but may be present in an ACL */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACE_GENERIC_ALL</span>		(1&lt;&lt;21) 
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACE_GENERIC_EXECUTE</span>	(1&lt;&lt;22)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACE_GENERIC_WRITE</span>		(1&lt;&lt;23)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACE_GENERIC_READ</span>		(1&lt;&lt;24)

};

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_KAUTH_ACE</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_KAUTH_ACE</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> kauth_ace *kauth_ace_t;
#<span class="enscript-reference">endif</span>


<span class="enscript-comment">/* Access Control List */</span>
<span class="enscript-type">struct</span> kauth_acl {
	u_int32_t	acl_entrycount;
	u_int32_t	acl_flags;
	
	<span class="enscript-type">struct</span> kauth_ace acl_ace[1];
};

<span class="enscript-comment">/*
 * XXX this value needs to be raised - 3893388
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACL_MAX_ENTRIES</span>		128

<span class="enscript-comment">/*
 * The low 16 bits of the flags field are reserved for filesystem
 * internal use and must be preserved by all APIs.  This includes
 * round-tripping flags through user-space interfaces.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACL_FLAGS_PRIVATE</span>	(0xffff)

<span class="enscript-comment">/*
 * The high 16 bits of the flags are used to store attributes and
 * to request specific handling of the ACL.
 */</span>

<span class="enscript-comment">/* inheritance will be deferred until the first rename operation */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACL_DEFER_INHERIT</span>	(1&lt;&lt;16)
<span class="enscript-comment">/* this ACL must not be overwritten as part of an inheritance operation */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_ACL_NO_INHERIT</span>	(1&lt;&lt;17)

<span class="enscript-comment">/* acl_entrycount that tells us the ACL is not valid */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_FILESEC_NOACL</span> ((u_int32_t)(-1))

<span class="enscript-comment">/*
 * If the acl_entrycount field is KAUTH_FILESEC_NOACL, then the size is the
 * same as a kauth_acl structure; the intent is to put an actual entrycount of
 * KAUTH_FILESEC_NOACL on disk to distinguish a kauth_filesec_t with an empty
 * entry (Windows treats this as &quot;deny all&quot;) from one that merely indicates a
 * file group and/or owner guid values.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">KAUTH_ACL_SIZE</span>(c)	(__offsetof(struct kauth_acl, acl_ace) + ((u_int32_t)(c) != KAUTH_FILESEC_NOACL ? ((c) * sizeof(struct kauth_ace)) : 0))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">KAUTH_ACL_COPYSIZE</span>(p)	KAUTH_ACL_SIZE((p)-&gt;acl_entrycount)


#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_KAUTH_ACL</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_KAUTH_ACL</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> kauth_acl *kauth_acl_t;
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>
__BEGIN_DECLS
kauth_acl_t	kauth_acl_alloc(<span class="enscript-type">int</span> size);
<span class="enscript-type">void</span>		kauth_acl_free(kauth_acl_t fsp);
__END_DECLS
#<span class="enscript-reference">endif</span>


<span class="enscript-comment">/*
 * Extended File Security.
 */</span>

<span class="enscript-comment">/* File Security information */</span>
<span class="enscript-type">struct</span> kauth_filesec {
	u_int32_t	fsec_magic;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_FILESEC_MAGIC</span>	0x012cc16d
	guid_t		fsec_owner;
	guid_t		fsec_group;

	<span class="enscript-type">struct</span> kauth_acl fsec_acl;
};

<span class="enscript-comment">/* backwards compatibility */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">fsec_entrycount</span> fsec_acl.acl_entrycount
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">fsec_flags</span> 	fsec_acl.acl_flags
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">fsec_ace</span>	fsec_acl.acl_ace
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_FILESEC_FLAGS_PRIVATE</span>	KAUTH_ACL_FLAGS_PRIVATE
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_FILESEC_DEFER_INHERIT</span>	KAUTH_ACL_DEFER_INHERIT
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_FILESEC_NO_INHERIT</span>	KAUTH_ACL_NO_INHERIT
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_FILESEC_NONE</span>	((kauth_filesec_t)0)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_FILESEC_WANTED</span>	((kauth_filesec_t)1)
	
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_KAUTH_FILESEC</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_KAUTH_FILESEC</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> kauth_filesec *kauth_filesec_t;
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">KAUTH_FILESEC_SIZE</span>(c)		(__offsetof(struct kauth_filesec, fsec_acl) + __offsetof(struct kauth_acl, acl_ace) + (c) * sizeof(struct kauth_ace))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">KAUTH_FILESEC_COPYSIZE</span>(p)	KAUTH_FILESEC_SIZE(((p)-&gt;fsec_entrycount == KAUTH_FILESEC_NOACL) ? 0 : (p)-&gt;fsec_entrycount)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">KAUTH_FILESEC_COUNT</span>(s)		(((s)  - KAUTH_FILESEC_SIZE(0)) / sizeof(struct kauth_ace))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">KAUTH_FILESEC_VALID</span>(s)		((s) &gt;= KAUTH_FILESEC_SIZE(0) &amp;&amp; (((s) - KAUTH_FILESEC_SIZE(0)) % sizeof(struct kauth_ace)) == 0)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_FILESEC_XATTR</span>	<span class="enscript-string">&quot;com.apple.system.Security&quot;</span>

<span class="enscript-comment">/* Allowable first arguments to kauth_filesec_acl_setendian() */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KAUTH_ENDIAN_HOST</span>	0x00000001	<span class="enscript-comment">/* set host endianness */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KAUTH_ENDIAN_DISK</span>	0x00000002	<span class="enscript-comment">/* set disk endianness */</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL || &lt;sys/acl.h&gt; */</span>


#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>


<span class="enscript-comment">/*
 * Scope management.
 */</span>
<span class="enscript-type">struct</span> kauth_scope;
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> kauth_scope *kauth_scope_t;
<span class="enscript-type">struct</span> kauth_listener;
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> kauth_listener *kauth_listener_t;
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_KAUTH_ACTION_T</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">int</span> kauth_action_t;
# <span class="enscript-reference">define</span> <span class="enscript-variable-name">_KAUTH_ACTION_T</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-type">typedef</span> <span class="enscript-function-name">int</span> (* kauth_scope_callback_t)(kauth_cred_t _credential,
				<span class="enscript-type">void</span> *_idata,
				kauth_action_t _action,
				uintptr_t _arg0,
				uintptr_t _arg1,
				uintptr_t _arg2,
				uintptr_t _arg3);

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_RESULT_ALLOW</span>	(1)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_RESULT_DENY</span>	(2)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_RESULT_DEFER</span>	(3)

<span class="enscript-type">struct</span> kauth_acl_eval {
	kauth_ace_t		ae_acl;
	<span class="enscript-type">int</span>			ae_count;
	kauth_ace_rights_t	ae_requested;
	kauth_ace_rights_t	ae_residual;
	<span class="enscript-type">int</span>			ae_result;
        boolean_t		ae_found_deny;
	<span class="enscript-type">int</span>			ae_options;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_AEVAL_IS_OWNER</span>	(1&lt;&lt;0)		<span class="enscript-comment">/* authorizing operation for owner */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_AEVAL_IN_GROUP</span>	(1&lt;&lt;1)		<span class="enscript-comment">/* authorizing operation for groupmember */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_AEVAL_IN_GROUP_UNKNOWN</span>	(1&lt;&lt;2)		<span class="enscript-comment">/* authorizing operation for unknown group membership */</span>
	<span class="enscript-comment">/* expansions for 'generic' rights bits */</span>
	kauth_ace_rights_t	ae_exp_gall;
	kauth_ace_rights_t	ae_exp_gread;
	kauth_ace_rights_t	ae_exp_gwrite;
	kauth_ace_rights_t	ae_exp_gexec;
};

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> kauth_acl_eval *kauth_acl_eval_t;
	
__BEGIN_DECLS
kauth_filesec_t	kauth_filesec_alloc(<span class="enscript-type">int</span> size);
<span class="enscript-type">void</span>		kauth_filesec_free(kauth_filesec_t fsp);
<span class="enscript-type">extern</span> kauth_scope_t <span class="enscript-function-name">kauth_register_scope</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *_identifier, kauth_scope_callback_t _callback, <span class="enscript-type">void</span> *_idata);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	kauth_deregister_scope(kauth_scope_t _scope);
<span class="enscript-type">extern</span> kauth_listener_t <span class="enscript-function-name">kauth_listen_scope</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *_identifier, kauth_scope_callback_t _callback, <span class="enscript-type">void</span> *_idata);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	kauth_unlisten_scope(kauth_listener_t _scope);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_authorize_action(kauth_scope_t _scope, kauth_cred_t _credential, kauth_action_t _action,
			uintptr_t _arg0, uintptr_t _arg1, uintptr_t _arg2, uintptr_t _arg3);

<span class="enscript-comment">/* default scope handlers */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_authorize_allow(kauth_cred_t _credential, <span class="enscript-type">void</span> *_idata, kauth_action_t _action,
    uintptr_t _arg0, uintptr_t _arg1, uintptr_t _arg2, uintptr_t _arg3);
	

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
<span class="enscript-type">void</span>		kauth_filesec_acl_setendian(<span class="enscript-type">int</span>, kauth_filesec_t, kauth_acl_t);
<span class="enscript-type">int</span>		kauth_copyinfilesec(user_addr_t xsecurity, kauth_filesec_t *xsecdestpp);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_acl_evaluate(kauth_cred_t _credential, kauth_acl_eval_t _eval);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_acl_inherit(vnode_t _dvp, kauth_acl_t _initial, kauth_acl_t *_product, <span class="enscript-type">int</span> _isdir, vfs_context_t _ctx);

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>


__END_DECLS

<span class="enscript-comment">/*
 * Generic scope.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_SCOPE_GENERIC</span>	<span class="enscript-string">&quot;com.apple.kauth.generic&quot;</span>

<span class="enscript-comment">/* Actions */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_GENERIC_ISSUSER</span>			1

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
__BEGIN_DECLS
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_authorize_generic(kauth_cred_t credential, kauth_action_t action);
__END_DECLS
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>

<span class="enscript-comment">/*
 * Process/task scope.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_SCOPE_PROCESS</span>	<span class="enscript-string">&quot;com.apple.kauth.process&quot;</span>

<span class="enscript-comment">/* Actions */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_PROCESS_CANSIGNAL</span>			1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_PROCESS_CANTRACE</span>			2

__BEGIN_DECLS
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_authorize_process(kauth_cred_t _credential, kauth_action_t _action,
    <span class="enscript-type">struct</span> proc *_process, uintptr_t _arg1, uintptr_t _arg2, uintptr_t _arg3);
__END_DECLS

<span class="enscript-comment">/*
 * Vnode operation scope.
 *
 * Prototype for vnode_authorize is in vnode.h
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_SCOPE_VNODE</span>	<span class="enscript-string">&quot;com.apple.kauth.vnode&quot;</span>

<span class="enscript-comment">/*
 * File system operation scope.
 *
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_SCOPE_FILEOP</span>	<span class="enscript-string">&quot;com.apple.kauth.fileop&quot;</span>

<span class="enscript-comment">/* Actions */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_FILEOP_OPEN</span>			1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_FILEOP_CLOSE</span>			2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_FILEOP_RENAME</span>			3
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_FILEOP_EXCHANGE</span>			4
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_FILEOP_LINK</span>			5
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_FILEOP_EXEC</span>			6
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_FILEOP_DELETE</span>			7

<span class="enscript-comment">/*
 * arguments passed to KAUTH_FILEOP_OPEN listeners
 *		arg0 is pointer to vnode (vnode *) for given user path.
 *		arg1 is pointer to path (char *) passed in to open.
 * arguments passed to KAUTH_FILEOP_CLOSE listeners
 *		arg0 is pointer to vnode (vnode *) for file to be closed.
 *		arg1 is pointer to path (char *) of file to be closed.
 *		arg2 is close flags.
 * arguments passed to KAUTH_FILEOP_RENAME listeners
 *		arg0 is pointer to &quot;from&quot; path (char *).
 *		arg1 is pointer to &quot;to&quot; path (char *).
 * arguments passed to KAUTH_FILEOP_EXCHANGE listeners
 *		arg0 is pointer to file 1 path (char *).
 *		arg1 is pointer to file 2 path (char *).
 * arguments passed to KAUTH_FILEOP_LINK listeners
 *		arg0 is pointer to path to file we are linking to (char *).
 *		arg1 is pointer to path to the new link file (char *).
 * arguments passed to KAUTH_FILEOP_EXEC listeners
 *		arg0 is pointer to vnode (vnode *) for executable.
 *		arg1 is pointer to path (char *) to executable.
 * arguments passed to KAUTH_FILEOP_DELETE listeners
 *		arg0 is pointer to vnode (vnode *) of file/dir that was deleted.
 *		arg1 is pointer to path (char *) of file/dir that was deleted.
 */</span>
 
<span class="enscript-comment">/* Flag values returned to close listeners. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_FILEOP_CLOSE_MODIFIED</span>			(1&lt;&lt;1)

__BEGIN_DECLS
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_authorize_fileop_has_listeners(<span class="enscript-type">void</span>);
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kauth_authorize_fileop(kauth_cred_t _credential, kauth_action_t _action,
    uintptr_t _arg0, uintptr_t _arg1);
__END_DECLS

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL */</span>

<span class="enscript-comment">/* Actions, also rights bits in an ACE */</span>

#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">KERNEL</span>) || <span class="enscript-variable-name">defined</span> (<span class="enscript-variable-name">_SYS_ACL_H</span>)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_READ_DATA</span>			(1&lt;&lt;1)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_LIST_DIRECTORY</span>		KAUTH_VNODE_READ_DATA
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_WRITE_DATA</span>			(1&lt;&lt;2)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_ADD_FILE</span>			KAUTH_VNODE_WRITE_DATA
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_EXECUTE</span>			(1&lt;&lt;3)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_SEARCH</span>			KAUTH_VNODE_EXECUTE
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_DELETE</span>			(1&lt;&lt;4)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_APPEND_DATA</span>			(1&lt;&lt;5)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_ADD_SUBDIRECTORY</span>		KAUTH_VNODE_APPEND_DATA
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_DELETE_CHILD</span>		(1&lt;&lt;6)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_READ_ATTRIBUTES</span>		(1&lt;&lt;7)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_WRITE_ATTRIBUTES</span>		(1&lt;&lt;8)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_READ_EXTATTRIBUTES</span>		(1&lt;&lt;9)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_WRITE_EXTATTRIBUTES</span>		(1&lt;&lt;10)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_READ_SECURITY</span>		(1&lt;&lt;11)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_WRITE_SECURITY</span>		(1&lt;&lt;12)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_TAKE_OWNERSHIP</span>		(1&lt;&lt;13)

<span class="enscript-comment">/* backwards compatibility only */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_CHANGE_OWNER</span>		KAUTH_VNODE_TAKE_OWNERSHIP

<span class="enscript-comment">/* For Windows interoperability only */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_SYNCHRONIZE</span>			(1&lt;&lt;20)

<span class="enscript-comment">/* (1&lt;&lt;21) - (1&lt;&lt;24) are reserved for generic rights bits */</span>

<span class="enscript-comment">/* Actions not expressed as rights bits */</span>
<span class="enscript-comment">/*
 * Authorizes the vnode as the target of a hard link.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_LINKTARGET</span>			(1&lt;&lt;25)

<span class="enscript-comment">/*
 * Indicates that other steps have been taken to authorise the action,
 * but authorisation should be denied for immutable objects.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_CHECKIMMUTABLE</span>		(1&lt;&lt;26)

<span class="enscript-comment">/* Action modifiers */</span>
<span class="enscript-comment">/*
 * The KAUTH_VNODE_ACCESS bit is passed to the callback if the authorisation
 * request in progress is advisory, rather than authoritative.  Listeners
 * performing consequential work (i.e. not strictly checking authorisation)
 * may test this flag to avoid performing unnecessary work.
 *
 * This bit will never be present in an ACE.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_ACCESS</span>			(1&lt;&lt;31)

<span class="enscript-comment">/*
 * The KAUTH_VNODE_NOIMMUTABLE bit is passed to the callback along with the
 * KAUTH_VNODE_WRITE_SECURITY bit (and no others) to indicate that the
 * caller wishes to change one or more of the immutable flags, and the
 * state of these flags should not be considered when authorizing the request.
 * The system immutable flags are only ignored when the system securelevel
 * is low enough to allow their removal.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_NOIMMUTABLE</span>			(1&lt;&lt;30)


<span class="enscript-comment">/*
 * fake right that is composed by the following...
 * vnode must have search for owner, group and world allowed
 * plus there must be no deny modes present for SEARCH... this fake
 * right is used by the fast lookup path to avoid checking
 * for an exact match on the last credential to lookup
 * the component being acted on
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_SEARCHBYANYONE</span>		(1&lt;&lt;29)


<span class="enscript-comment">/*
 * when passed as an 'action' to &quot;vnode_uncache_authorized_actions&quot;
 * it indicates that all of the cached authorizations for that
 * vnode should be invalidated 
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KAUTH_INVALIDATE_CACHED_RIGHTS</span>		((kauth_action_t)~0)



<span class="enscript-comment">/* The expansions of the GENERIC bits at evaluation time */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_GENERIC_READ_BITS</span>	(KAUTH_VNODE_READ_DATA |		\
					KAUTH_VNODE_READ_ATTRIBUTES |		\
					KAUTH_VNODE_READ_EXTATTRIBUTES |	\
					KAUTH_VNODE_READ_SECURITY)
 
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_GENERIC_WRITE_BITS</span>	(KAUTH_VNODE_WRITE_DATA |		\
					KAUTH_VNODE_APPEND_DATA |		\
					KAUTH_VNODE_DELETE |			\
					KAUTH_VNODE_DELETE_CHILD |		\
					KAUTH_VNODE_WRITE_ATTRIBUTES |		\
					KAUTH_VNODE_WRITE_EXTATTRIBUTES |	\
					KAUTH_VNODE_WRITE_SECURITY)
 
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_GENERIC_EXECUTE_BITS</span> (KAUTH_VNODE_EXECUTE)
 
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_GENERIC_ALL_BITS</span>	(KAUTH_VNODE_GENERIC_READ_BITS |	\
					KAUTH_VNODE_GENERIC_WRITE_BITS |	\
					KAUTH_VNODE_GENERIC_EXECUTE_BITS)
 
<span class="enscript-comment">/*
 * Some sets of bits, defined here for convenience.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_VNODE_WRITE_RIGHTS</span>	(KAUTH_VNODE_ADD_FILE |				\
					KAUTH_VNODE_ADD_SUBDIRECTORY |			\
					KAUTH_VNODE_DELETE_CHILD |			\
					KAUTH_VNODE_WRITE_DATA |			\
					KAUTH_VNODE_APPEND_DATA |			\
					KAUTH_VNODE_DELETE |				\
					KAUTH_VNODE_WRITE_ATTRIBUTES |			\
					KAUTH_VNODE_WRITE_EXTATTRIBUTES |		\
					KAUTH_VNODE_WRITE_SECURITY |			\
	    				KAUTH_VNODE_TAKE_OWNERSHIP |			\
					KAUTH_VNODE_LINKTARGET |			\
					KAUTH_VNODE_CHECKIMMUTABLE)


#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL || &lt;sys/acl.h&gt; */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/lock.h&gt;</span>	<span class="enscript-comment">/* lck_grp_t */</span>

<span class="enscript-comment">/*
 * Debugging
 *
 * XXX this wouldn't be necessary if we had a *real* debug-logging system.
 */</span>
#<span class="enscript-reference">if</span> 0
# <span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_FN_KPRINTF</span>
#  <span class="enscript-reference">define</span>	<span class="enscript-variable-name">_FN_KPRINTF</span>
<span class="enscript-type">void</span> <span class="enscript-function-name">kprintf</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *fmt, ...);
# <span class="enscript-reference">endif</span>	<span class="enscript-comment">/* !_FN_KPRINTF */</span>
# <span class="enscript-reference">define</span> <span class="enscript-variable-name">KAUTH_DEBUG_ENABLE</span>
# <span class="enscript-reference">define</span> <span class="enscript-variable-name">K_UUID_FMT</span> <span class="enscript-string">&quot;%08x:%08x:%08x:%08x&quot;</span>
# <span class="enscript-reference">define</span> <span class="enscript-function-name">K_UUID_ARG</span>(_u) *(int *)&amp;_u.g_guid[0],*(int *)&amp;_u.g_guid[4],*(int *)&amp;_u.g_guid[8],*(int *)&amp;_u.g_guid[12]
# <span class="enscript-reference">define</span> <span class="enscript-function-name">KAUTH_DEBUG</span>(fmt, args...)	do { kprintf(<span class="enscript-string">&quot;%s:%d: &quot;</span> fmt <span class="enscript-string">&quot;\n&quot;</span>, __PRETTY_FUNCTION__, __LINE__ , ##args); } while (0)
# <span class="enscript-reference">define</span> <span class="enscript-function-name">KAUTH_DEBUG_CTX</span>(_c)		KAUTH_DEBUG(<span class="enscript-string">&quot;p = %p c = %p&quot;</span>, _c-&gt;vc_proc, _c-&gt;vc_ucred)
# <span class="enscript-reference">define</span> <span class="enscript-function-name">VFS_DEBUG</span>(_ctx, _vp, fmt, args...)						\
	<span class="enscript-keyword">do</span> {										\
		kprintf(<span class="enscript-string">&quot;%p '%s' %s:%d &quot;</span> fmt <span class="enscript-string">&quot;\n&quot;</span>,					\
		    _ctx,								\
		    (_vp != NULL &amp;&amp; _vp-&gt;v_name != NULL) ? _vp-&gt;v_name : <span class="enscript-string">&quot;????&quot;</span>,	\
		    __PRETTY_FUNCTION__, __LINE__ ,					\
		    ##args);								\
	} <span class="enscript-keyword">while</span>(0)
#<span class="enscript-reference">else</span>	<span class="enscript-comment">/* !0 */</span>
# <span class="enscript-reference">define</span> <span class="enscript-function-name">KAUTH_DEBUG</span>(fmt, args...)		do { } while (0)
# <span class="enscript-reference">define</span> <span class="enscript-function-name">VFS_DEBUG</span>(ctx, vp, fmt, args...)	do { } while(0)
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* !0 */</span>

<span class="enscript-comment">/*
 * Initialisation.
 */</span>
<span class="enscript-type">extern</span> lck_grp_t *kauth_lck_grp;
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
__BEGIN_DECLS
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	kauth_init(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	kauth_cred_init(<span class="enscript-type">void</span>);
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">CONFIG_EXT_RESOLVER</span>
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	kauth_identity_init(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	kauth_groups_init(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	kauth_resolver_init(<span class="enscript-type">void</span>);
#<span class="enscript-reference">endif</span>
__END_DECLS
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* KERNEL */</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* __APPLE_API_EVOLVING */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* _SYS_KAUTH_H */</span>
</pre>
<hr />
</body></html>