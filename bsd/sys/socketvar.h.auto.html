<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>socketvar.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">socketvar.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000-2015 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/* Copyright (c) 1998, 1999 Apple Computer, Inc. All Rights Reserved */</span>
<span class="enscript-comment">/* Copyright (c) 1995 NeXT Computer, Inc. All Rights Reserved */</span>
<span class="enscript-comment">/*-
 * Copyright (c) 1982, 1986, 1990, 1993
 *	The Regents of the University of California.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *	@(#)socketvar.h	8.3 (Berkeley) 2/19/95
 * $FreeBSD: src/sys/sys/socketvar.h,v 1.46.2.6 2001/08/31 13:45:49 jlemon Exp $
 */</span>
<span class="enscript-comment">/*
 * NOTICE: This file was modified by SPARTA, Inc. in 2005 to introduce
 * support for mandatory and extensible security protections.  This notice
 * is included in support of clause 2.2 (b) of the Apple Public License,
 * Version 2.0.
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_SYS_SOCKETVAR_H_</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_SYS_SOCKETVAR_H_</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/appleapiopts.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/cdefs.h&gt;</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL_PRIVATE</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/queue.h&gt;</span>			<span class="enscript-comment">/* for TAILQ macros */</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/select.h&gt;</span>			<span class="enscript-comment">/* for struct selinfo */</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;net/kext_net.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/ev.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;uuid/uuid.h&gt;</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL_PRIVATE */</span>

<span class="enscript-type">typedef</span>	u_quad_t so_gen_t;

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL_PRIVATE</span>
<span class="enscript-type">struct</span> mbuf;
<span class="enscript-type">struct</span> socket_filter_entry;
<span class="enscript-type">struct</span> protosw;
<span class="enscript-type">struct</span> sockif;
<span class="enscript-type">struct</span> sockutil;

<span class="enscript-comment">/* strings for sleep message: */</span>
<span class="enscript-type">extern</span>	<span class="enscript-type">char</span> netio[], netcon[], netcls[];
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOCKET_CACHE_ON</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_CACHE_FLUSH_INTERVAL</span> 1	<span class="enscript-comment">/* Seconds */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_CACHE_TIME_LIMIT</span>	(120/SO_CACHE_FLUSH_INTERVAL) <span class="enscript-comment">/* Seconds */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_CACHE_MAX_FREE_BATCH</span>	50
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAX_CACHED_SOCKETS</span>	512
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">TEMPDEBUG</span>		0
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL_PRIVATE */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_TC_STATS_MAX</span> 4

<span class="enscript-type">struct</span> data_stats {
        u_int64_t       rxpackets;
        u_int64_t       rxbytes;
        u_int64_t       txpackets;
        u_int64_t       txbytes;
};

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_PRI_0</span> 0	<span class="enscript-comment">/* TCP message priority, lowest */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_PRI_1</span> 1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_PRI_2</span> 2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_PRI_3</span> 3	<span class="enscript-comment">/* TCP message priority, highest */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_PRI_MAX</span> MSG_PRI_3
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_PRI_MIN</span> MSG_PRI_0
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_PRI_COUNT</span> 4
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_PRI_DEFAULT</span> MSG_PRI_1
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL_PRIVATE</span>
<span class="enscript-comment">/* State for TCP message send or receive */</span>
<span class="enscript-type">struct</span> msg_priq {
	<span class="enscript-type">struct</span> mbuf *msgq_head; <span class="enscript-comment">/* first mbuf in the queue */</span>
	<span class="enscript-type">struct</span> mbuf *msgq_tail; <span class="enscript-comment">/* last mbuf in the queue */</span>
	<span class="enscript-type">struct</span> mbuf *msgq_lastmsg; <span class="enscript-comment">/* last message in the queue */</span>
	u_int32_t msgq_flags;	<span class="enscript-comment">/* flags per priority queue */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSGQ_MSG_NOTDONE</span> 0x1	<span class="enscript-comment">/* set when EOR of a msg is not seen */</span>
	u_int32_t msgq_bytes;	<span class="enscript-comment">/* data bytes in this queue */</span>
};

<span class="enscript-type">struct</span> msg_state {
	<span class="enscript-type">struct</span> msg_priq msg_priq[MSG_PRI_COUNT]; <span class="enscript-comment">/* priority queues */</span>
	u_int32_t msg_serial_bytes; <span class="enscript-comment">/* bytes moved to serial queue */</span>
	u_int32_t msg_uno_bytes; <span class="enscript-comment">/* out-of-order chars in rcv buffer */</span>
};

<span class="enscript-comment">/* mbuf flag used to indicate out of order data received */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">M_UNORDERED_DATA</span> M_PROTO1

<span class="enscript-comment">/*
 * Kernel structure per socket.
 * Contains send and receive buffer queues,
 * handle on protocol and pointer to protocol
 * private data and error information.
 */</span>
<span class="enscript-type">struct</span> socket {
	<span class="enscript-type">int</span>	so_zone;		<span class="enscript-comment">/* zone we were allocated from */</span>
	<span class="enscript-type">short</span>	so_type;		<span class="enscript-comment">/* generic type, see socket.h */</span>
	u_short	so_error;		<span class="enscript-comment">/* error affecting connection */</span>
	u_int32_t so_options;		<span class="enscript-comment">/* from socket call, see socket.h */</span>
	<span class="enscript-type">short</span>	so_linger;		<span class="enscript-comment">/* time to linger while closing */</span>
	<span class="enscript-type">short</span>	so_state;		<span class="enscript-comment">/* internal state flags SS_*, below */</span>
	<span class="enscript-type">void</span>	*so_pcb;		<span class="enscript-comment">/* protocol control block */</span>
	<span class="enscript-type">struct</span>	protosw *so_proto;	<span class="enscript-comment">/* protocol handle */</span>
	<span class="enscript-comment">/*
	 * Variables for connection queueing.
	 * Socket where accepts occur is so_head in all subsidiary sockets.
	 * If so_head is 0, socket is not related to an accept.
	 * For head socket so_incomp queues partially completed connections,
	 * while so_comp is a queue of connections ready to be accepted.
	 * If a connection is aborted and it has so_head set, then
	 * it has to be pulled out of either so_incomp or so_comp.
	 * We allow connections to queue up based on current queue lengths
	 * and limit on number of queued connections for this socket.
	 */</span>
	<span class="enscript-type">struct</span>	socket *so_head;	<span class="enscript-comment">/* back pointer to accept socket */</span>
	TAILQ_HEAD(, socket) so_incomp;	<span class="enscript-comment">/* q of partially unaccepted conns */</span>
	TAILQ_HEAD(, socket) so_comp;	<span class="enscript-comment">/* q of complete unaccepted conns */</span>
	TAILQ_ENTRY(socket) so_list;	<span class="enscript-comment">/* list of unaccepted connections */</span>
	<span class="enscript-type">short</span>	so_qlen;		<span class="enscript-comment">/* number of unaccepted connections */</span>
	<span class="enscript-type">short</span>	so_incqlen;		<span class="enscript-comment">/* number of unaccepted incomplete
					   connections */</span>
	<span class="enscript-type">short</span>	so_qlimit;		<span class="enscript-comment">/* max number queued connections */</span>
	<span class="enscript-type">short</span>	so_timeo;		<span class="enscript-comment">/* connection timeout */</span>
	pid_t	so_pgid;		<span class="enscript-comment">/* pgid for signals */</span>
	u_int32_t so_oobmark;		<span class="enscript-comment">/* chars to oob mark */</span>
	<span class="enscript-comment">/*
	 * Variables for socket buffering.
	 */</span>
	<span class="enscript-type">struct</span> sockbuf {
		u_int32_t	sb_cc;		<span class="enscript-comment">/* actual chars in buffer */</span>
		u_int32_t	sb_hiwat;	<span class="enscript-comment">/* max actual char count */</span>
		u_int32_t	sb_mbcnt;	<span class="enscript-comment">/* chars of mbufs used */</span>
		u_int32_t	sb_mbmax;	<span class="enscript-comment">/* max chars of mbufs to use */</span>
		u_int32_t	sb_ctl;		<span class="enscript-comment">/* non-data chars in buffer */</span>
		u_int32_t	sb_lowat;	<span class="enscript-comment">/* low water mark */</span>
		<span class="enscript-type">struct</span> mbuf	*sb_mb;		<span class="enscript-comment">/* the mbuf chain */</span>
		<span class="enscript-type">struct</span> mbuf	*sb_mbtail;	<span class="enscript-comment">/* the last mbuf in the chain */</span>
		<span class="enscript-type">struct</span> mbuf	*sb_lastrecord;	<span class="enscript-comment">/* first mbuf of last record */</span>
		<span class="enscript-type">struct</span> socket	*sb_so;		<span class="enscript-comment">/* socket back ptr for kexts */</span>
		<span class="enscript-type">struct</span> selinfo	sb_sel;		<span class="enscript-comment">/* process selecting rd/wr */</span>
		<span class="enscript-type">struct</span> timeval	sb_timeo;	<span class="enscript-comment">/* timeout for read/write */</span>
		u_int32_t	sb_flags;	<span class="enscript-comment">/* flags, see below */</span>
		u_int32_t	sb_idealsize;	<span class="enscript-comment">/* Ideal size for the sb based
						   on bandwidth and delay */</span>
		<span class="enscript-type">void</span>	(*sb_upcall)(<span class="enscript-type">struct</span> socket *, <span class="enscript-type">void</span> *arg, <span class="enscript-type">int</span> waitf);
		<span class="enscript-type">void</span>	*sb_upcallarg;		<span class="enscript-comment">/* Arg for above */</span>
		u_int32_t	sb_wantlock;	<span class="enscript-comment">/* # of SB_LOCK waiters */</span>
		u_int32_t	sb_waiters;	<span class="enscript-comment">/* # of data/space waiters */</span>
		thread_t	sb_cfil_thread;	<span class="enscript-comment">/* content filter thread */</span>
		u_int32_t	sb_cfil_refs;	<span class="enscript-comment">/* # of nested calls */</span>
		u_int32_t	sb_preconn_hiwat;<span class="enscript-comment">/* preconnect hiwat mark */</span>
	} so_rcv, so_snd;
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SB_MAX</span>		(8192*1024)	<span class="enscript-comment">/* default for max chars in sockbuf */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">LOW_SB_MAX</span>	(2*9*1024)	<span class="enscript-comment">/* lower limit on max socket buffer
					   size, 2 max datagrams */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SB_LOCK</span>		0x1		<span class="enscript-comment">/* lock on data queue */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SB_NOINTR</span>	0x2		<span class="enscript-comment">/* operations not interruptible */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SB_RECV</span>		0x4		<span class="enscript-comment">/* this is rcv sb */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SB_SEL</span>		0x8		<span class="enscript-comment">/* someone is selecting */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SB_ASYNC</span>	0x10		<span class="enscript-comment">/* ASYNC I/O, need signals */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SB_UPCALL</span>	0x20		<span class="enscript-comment">/* someone wants an upcall */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SB_KNOTE</span>	0x40		<span class="enscript-comment">/* kernel note attached */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SB_DROP</span>		0x80		<span class="enscript-comment">/* does not accept any more data */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SB_UNIX</span>		0x100		<span class="enscript-comment">/* UNIX domain socket buffer */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SB_USRSIZE</span>	0x200		<span class="enscript-comment">/* user specified sbreserve */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SB_AUTOSIZE</span>	0x400		<span class="enscript-comment">/* automatically size socket buffer */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SB_TRIM</span>		0x800		<span class="enscript-comment">/* Trim the socket buffer */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SB_NOCOMPRESS</span>	0x1000		<span class="enscript-comment">/* do not compress socket buffer */</span>
	caddr_t	so_tpcb;		<span class="enscript-comment">/* Misc. protocol control block, used
					   by some kexts */</span>

	<span class="enscript-type">void</span>		(*so_event)(<span class="enscript-type">struct</span> socket *, <span class="enscript-type">void</span> *, u_int32_t);
	<span class="enscript-type">void</span>		*so_eventarg;	<span class="enscript-comment">/* Arg for above */</span>
	kauth_cred_t	so_cred;	<span class="enscript-comment">/* cred of who opened the socket */</span>
	<span class="enscript-comment">/* NB: generation count must not be first; easiest to make it last. */</span>
	so_gen_t so_gencnt;		<span class="enscript-comment">/* generation count */</span>
	TAILQ_HEAD(, eventqelt) so_evlist;
	STAILQ_ENTRY(socket) so_cache_ent;	<span class="enscript-comment">/* socache entry */</span>
	caddr_t		so_saved_pcb;	<span class="enscript-comment">/* Saved pcb when cacheing */</span>
	u_int32_t	cache_timestamp;	<span class="enscript-comment">/* time socket was cached */</span>

	pid_t		last_pid;	<span class="enscript-comment">/* pid of most recent accessor */</span>
	u_int64_t	last_upid;	<span class="enscript-comment">/* upid of most recent accessor */</span>

	<span class="enscript-type">struct</span> mbuf	*so_temp;	<span class="enscript-comment">/* Holding area for outbound frags */</span>
	<span class="enscript-comment">/* Plug-in support - make the socket interface overridable */</span>
	<span class="enscript-type">struct</span> mbuf	*so_tail;
	<span class="enscript-type">struct</span> socket_filter_entry *so_filt;	<span class="enscript-comment">/* NKE hook */</span>
	u_int32_t	so_flags;	<span class="enscript-comment">/* Flags */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOF_NOSIGPIPE</span>		0x00000001
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOF_NOADDRAVAIL</span>		0x00000002 <span class="enscript-comment">/* EADDRNOTAVAIL if src addr is gone */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOF_PCBCLEARING</span>		0x00000004 <span class="enscript-comment">/* pru_disconnect done; don't
					      call pru_detach */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOF_DEFUNCT</span>		0x00000008 <span class="enscript-comment">/* socket marked as inactive */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOF_CLOSEWAIT</span>		0x00000010 <span class="enscript-comment">/* blocked in close awaiting some events */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF_REUSESHAREUID</span>	0x00000040 <span class="enscript-comment">/* Allows SO_REUSEADDR/SO_REUSEPORT
					      for multiple so_uid */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOF_MULTIPAGES</span>		0x00000080 <span class="enscript-comment">/* jumbo clusters may be used for sosend */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF_ABORTED</span>		0x00000100 <span class="enscript-comment">/* soabort was already called once */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF_OVERFLOW</span>		0x00000200 <span class="enscript-comment">/* socket was dropped as overflow of
					      listen q */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF_NOTIFYCONFLICT</span>	0x00000400 <span class="enscript-comment">/* notify that a bind was done on a
					      port already in use */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOF_UPCALLCLOSEWAIT</span>	0x00000800 <span class="enscript-comment">/* block close until upcall returns */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF_BINDRANDOMPORT</span>	0x00001000 <span class="enscript-comment">/* Randomized port number for bind */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF_NPX_SETOPTSHUT</span>	0x00002000 <span class="enscript-comment">/* Non POSIX extension to allow
					   setsockopt(2) after shut down */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF_RECV_TRAFFIC_CLASS</span>	0x00004000 <span class="enscript-comment">/* Receive TC as ancillary data */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOF_NODEFUNCT</span>		0x00008000 <span class="enscript-comment">/* socket cannot be defunct'd */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOF_PRIVILEGED_TRAFFIC_CLASS</span> 0x00010000 <span class="enscript-comment">/* traffic class is privileged */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF_SUSPENDED</span>		0x00020000 <span class="enscript-comment">/* i/f output queue is suspended */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF_INCOMP_INPROGRESS</span>	0x00040000 <span class="enscript-comment">/* incomp socket is being processed */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOF_NOTSENT_LOWAT</span>	0x00080000 <span class="enscript-comment">/* A different lowat on not sent
					      data has been set */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF_KNOTE</span>		0x00100000 <span class="enscript-comment">/* socket is on the EV_SOCK klist */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF_USELRO</span>		0x00200000 <span class="enscript-comment">/* TCP must use LRO on these sockets */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF_ENABLE_MSGS</span>		0x00400000 <span class="enscript-comment">/* TCP must enable message delivery */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF_FLOW_DIVERT</span>		0x00800000 <span class="enscript-comment">/* Flow Divert is enabled */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOF_MP_SUBFLOW</span>		0x01000000 <span class="enscript-comment">/* is a multipath subflow socket */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF_MPTCP_TRUE</span> 		0x02000000 <span class="enscript-comment">/* Established e2e MPTCP connection */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF_MPTCP_CLIENT</span>        0x04000000 <span class="enscript-comment">/* Only client starts addtnal flows */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF_MP_SEC_SUBFLOW</span>      0x08000000 <span class="enscript-comment">/* Set up secondary flow */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF_MP_TRYFAILOVER</span>	0x10000000 <span class="enscript-comment">/* Failing subflow */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOF_DELEGATED</span>		0x20000000 <span class="enscript-comment">/* on behalf of another process */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF_MPTCP_FASTJOIN</span>	0x40000000 <span class="enscript-comment">/* fast join support */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOF_CONTENT_FILTER</span>	0x80000000 <span class="enscript-comment">/* Content filter enabled */</span>

	uint32_t	so_upcallusecount; <span class="enscript-comment">/* number of upcalls in progress */</span>
	<span class="enscript-type">int</span>		so_usecount;	<span class="enscript-comment">/* refcounting of socket use */</span>;
	<span class="enscript-type">int</span>		so_retaincnt;
	u_int32_t	so_filteruse;	<span class="enscript-comment">/* usecount for the socket filters */</span>
	u_int16_t	so_traffic_class;
	u_int8_t	so_traffic_mgt_flags;	<span class="enscript-comment">/* traffic_mgt socket config */</span>
	u_int8_t	so_restrictions;
	thread_t	so_send_filt_thread;

	<span class="enscript-comment">/* for debug pruposes */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_LCKDBG_MAX</span> 4	<span class="enscript-comment">/* number of debug locking Link Registers recorded */</span>
	<span class="enscript-type">void</span>	*lock_lr[SO_LCKDBG_MAX];	<span class="enscript-comment">/* locking calling history */</span>
	<span class="enscript-type">void</span>	*unlock_lr[SO_LCKDBG_MAX];	<span class="enscript-comment">/* unlocking caller history */</span>
	u_int8_t	next_lock_lr;
	u_int8_t	next_unlock_lr;

	u_int16_t	so_pktheadroom;	<span class="enscript-comment">/* headroom before packet payload */</span>

	u_int32_t	so_ifdenied_notifies; <span class="enscript-comment">/* # of notifications generated */</span>

	<span class="enscript-type">struct</span> label	*so_label;	<span class="enscript-comment">/* MAC label for socket */</span>
	<span class="enscript-type">struct</span> label	*so_peerlabel;	<span class="enscript-comment">/* cached MAC label for socket peer */</span>
	thread_t	so_background_thread;	<span class="enscript-comment">/* thread that marked
						   this socket background */</span>
	<span class="enscript-type">struct</span> data_stats so_tc_stats[SO_TC_STATS_MAX];
	<span class="enscript-type">struct</span> klist	so_klist;		<span class="enscript-comment">/* klist for EV_SOCK events */</span>

	<span class="enscript-type">struct</span> msg_state *so_msg_state;		<span class="enscript-comment">/* unordered snd/rcv state */</span>
	<span class="enscript-type">struct</span> flow_divert_pcb	*so_fd_pcb;	<span class="enscript-comment">/* Flow Divert control block */</span>

	<span class="enscript-type">struct</span> cfil_info	*so_cfil;

	u_int32_t	so_eventmask;		<span class="enscript-comment">/* event mask */</span>

	pid_t		e_pid;		<span class="enscript-comment">/* pid of the effective owner */</span>
	u_int64_t	e_upid;		<span class="enscript-comment">/* upid of the effective owner */</span>

	uuid_t		last_uuid;	<span class="enscript-comment">/* uuid of most recent accessor */</span>
	uuid_t		e_uuid;		<span class="enscript-comment">/* uuid of effective owner */</span>
	uuid_t		so_vuuid;	<span class="enscript-comment">/* UUID of the Voucher originator */</span>

	int32_t		so_policy_gencnt; <span class="enscript-comment">/* UUID policy gencnt */</span>

	u_int32_t	so_flags1;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF1_POST_FALLBACK_SYNC</span>	0x00000001 <span class="enscript-comment">/* fallback to TCP */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOF1_AWDL_PRIVILEGED</span>	0x00000002
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOF1_IF_2KCL</span>		0x00000004 <span class="enscript-comment">/* interface prefers 2 KB clusters */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOF1_DEFUNCTINPROG</span>	0x00000008
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF1_DATA_IDEMPOTENT</span>	0x00000010 <span class="enscript-comment">/* idempotent data for TFO */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOF1_PRECONNECT_DATA</span>	0x00000020 <span class="enscript-comment">/* request for preconnect data */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOF1_EXTEND_BK_IDLE_WANTED</span>	0x00000040 <span class="enscript-comment">/* option set */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOF1_EXTEND_BK_IDLE_INPROG</span>	0x00000080 <span class="enscript-comment">/* socket */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOF1_CACHED_IN_SOCK_LAYER</span>	0x00000100 <span class="enscript-comment">/* bundled with inpcb and
						      tcpcb */</span>

	u_int64_t	so_extended_bk_start;
};

<span class="enscript-comment">/* Control message accessor in mbufs */</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">_MIN_NXT_CMSGHDR_PTR</span>(cmsg)					\
	((<span class="enscript-type">char</span> *)(cmsg) +						\
	    __DARWIN_ALIGN32((__uint32_t)(cmsg)-&gt;cmsg_len) +		\
	    __DARWIN_ALIGN32(<span class="enscript-keyword">sizeof</span>(<span class="enscript-type">struct</span> cmsghdr)))

#<span class="enscript-reference">define</span> <span class="enscript-function-name">M_FIRST_CMSGHDR</span>(m)						\
        ((<span class="enscript-type">char</span> *)(m) != (<span class="enscript-type">char</span> *)0L &amp;&amp;					\
	(size_t)(m)-&gt;m_len &gt;= <span class="enscript-keyword">sizeof</span> (<span class="enscript-type">struct</span> cmsghdr) &amp;&amp;		\
	(socklen_t)(m)-&gt;m_len &gt;=					\
	__DARWIN_ALIGN32(((<span class="enscript-type">struct</span> cmsghdr *)(<span class="enscript-type">void</span> *)(m)-&gt;m_data)-&gt;cmsg_len) ? \
	(<span class="enscript-type">struct</span> cmsghdr *)(<span class="enscript-type">void</span> *)(m)-&gt;m_data :	(<span class="enscript-type">struct</span> cmsghdr *)0L)

#<span class="enscript-reference">define</span> <span class="enscript-function-name">M_NXT_CMSGHDR</span>(m, cmsg)						\
        ((<span class="enscript-type">char</span> *)(cmsg) == (<span class="enscript-type">char</span> *)0L ? M_FIRST_CMSGHDR(m) :		\
	_MIN_NXT_CMSGHDR_PTR(cmsg) &gt; ((<span class="enscript-type">char</span> *)(m)-&gt;m_data) + (m)-&gt;m_len ||  \
	_MIN_NXT_CMSGHDR_PTR(cmsg) &lt; (<span class="enscript-type">char</span> *)(m)-&gt;m_data ?		\
	(<span class="enscript-type">struct</span> cmsghdr *)0L <span class="enscript-comment">/* NULL */</span> :				\
	(<span class="enscript-type">struct</span> cmsghdr *)(<span class="enscript-type">void</span> *)((<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)(cmsg) +		\
	__DARWIN_ALIGN32((__uint32_t)(cmsg)-&gt;cmsg_len)))

<span class="enscript-comment">/*
 * Socket state bits.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SS_NOFDREF</span>		0x0001	<span class="enscript-comment">/* no file table ref any more */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SS_ISCONNECTED</span>		0x0002	<span class="enscript-comment">/* socket connected to a peer */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SS_ISCONNECTING</span>		0x0004	<span class="enscript-comment">/* in process of connecting to peer */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SS_ISDISCONNECTING</span>	0x0008	<span class="enscript-comment">/* in process of disconnecting */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SS_CANTSENDMORE</span>		0x0010	<span class="enscript-comment">/* can't send more data to peer */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SS_CANTRCVMORE</span>		0x0020	<span class="enscript-comment">/* can't receive more data from peer */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SS_RCVATMARK</span>		0x0040	<span class="enscript-comment">/* at mark on input */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SS_PRIV</span>			0x0080	<span class="enscript-comment">/* privileged for broadcast, raw... */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SS_NBIO</span>			0x0100	<span class="enscript-comment">/* non-blocking ops */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SS_ASYNC</span>		0x0200	<span class="enscript-comment">/* async i/o notify */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SS_ISCONFIRMING</span>		0x0400	<span class="enscript-comment">/* deciding to accept connection req */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SS_INCOMP</span>		0x0800	<span class="enscript-comment">/* Unaccepted, incomplete connection */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SS_COMP</span>			0x1000	<span class="enscript-comment">/* unaccepted, complete connection */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SS_ISDISCONNECTED</span>	0x2000	<span class="enscript-comment">/* socket disconnected from peer */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SS_DRAINING</span>		0x4000	<span class="enscript-comment">/* close waiting for blocked system
					   calls to drain */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SS_DEFUNCT</span>		0x8000	<span class="enscript-comment">/* has been fully defunct'd */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL_PRIVATE */</span>

#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__LP64__</span>)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">_XSOCKET_PTR</span>(x)		u_int32_t
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">_XSOCKET_PTR</span>(x)		x
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
<span class="enscript-comment">/* Flags returned in data field for EVFILT_SOCK events. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOCKEV_CONNECTED</span>	0x00000001 <span class="enscript-comment">/* connected */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOCKEV_DISCONNECTED</span>	0x00000002 <span class="enscript-comment">/* disconnected */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">pack</span>(4)

<span class="enscript-type">struct</span> xsockbuf {
	u_int32_t	sb_cc;
	u_int32_t	sb_hiwat;
	u_int32_t	sb_mbcnt;
	u_int32_t	sb_mbmax;
	int32_t		sb_lowat;
	<span class="enscript-type">short</span>		sb_flags;
	<span class="enscript-type">short</span>		sb_timeo;
};

<span class="enscript-comment">/*
 * Externalized form of struct socket used by the sysctl(3) interface.
 */</span>
<span class="enscript-type">struct</span>	xsocket {
	u_int32_t		xso_len;	<span class="enscript-comment">/* length of this structure */</span>
	_XSOCKET_PTR(<span class="enscript-type">struct</span> socket *) xso_so;	<span class="enscript-comment">/* makes a convenient handle */</span>
	<span class="enscript-type">short</span>			so_type;
	<span class="enscript-type">short</span>			so_options;
	<span class="enscript-type">short</span>			so_linger;
	<span class="enscript-type">short</span>			so_state;
	_XSOCKET_PTR(caddr_t)	so_pcb;		<span class="enscript-comment">/* another convenient handle */</span>
	<span class="enscript-type">int</span>			xso_protocol;
	<span class="enscript-type">int</span>			xso_family;
	<span class="enscript-type">short</span>			so_qlen;
	<span class="enscript-type">short</span>			so_incqlen;
	<span class="enscript-type">short</span>			so_qlimit;
	<span class="enscript-type">short</span>			so_timeo;
	u_short			so_error;
	pid_t			so_pgid;
	u_int32_t		so_oobmark;
	<span class="enscript-type">struct</span> xsockbuf		so_rcv;
	<span class="enscript-type">struct</span> xsockbuf		so_snd;
	uid_t			so_uid;		<span class="enscript-comment">/* XXX */</span>
};

<span class="enscript-type">struct</span>	xsocket64 {
	u_int32_t		xso_len;	<span class="enscript-comment">/* length of this structure */</span>
	u_int64_t		xso_so;		<span class="enscript-comment">/* makes a convenient handle */</span>
	<span class="enscript-type">short</span>			so_type;
	<span class="enscript-type">short</span>			so_options;
	<span class="enscript-type">short</span>			so_linger;
	<span class="enscript-type">short</span>			so_state;
	u_int64_t		so_pcb;		<span class="enscript-comment">/* another convenient handle */</span>
	<span class="enscript-type">int</span>			xso_protocol;
	<span class="enscript-type">int</span>			xso_family;
	<span class="enscript-type">short</span>			so_qlen;
	<span class="enscript-type">short</span>			so_incqlen;
	<span class="enscript-type">short</span>			so_qlimit;
	<span class="enscript-type">short</span>			so_timeo;
	u_short			so_error;
	pid_t			so_pgid;
	u_int32_t		so_oobmark;
	<span class="enscript-type">struct</span> xsockbuf		so_rcv;
	<span class="enscript-type">struct</span> xsockbuf		so_snd;
	uid_t			so_uid;		<span class="enscript-comment">/* XXX */</span>
};

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">XSO_SOCKET</span>	0x001
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">XSO_RCVBUF</span>	0x002
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">XSO_SNDBUF</span>	0x004
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">XSO_STATS</span>	0x008
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">XSO_INPCB</span>	0x010
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">XSO_TCPCB</span>	0x020
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">XSO_KCREG</span>	0x040
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">XSO_KCB</span>		0x080
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">XSO_EVT</span>		0x100

<span class="enscript-type">struct</span>	xsocket_n {
	u_int32_t		xso_len;	<span class="enscript-comment">/* length of this structure */</span>
	u_int32_t		xso_kind;	<span class="enscript-comment">/* XSO_SOCKET */</span>
	u_int64_t		xso_so;		<span class="enscript-comment">/* makes a convenient handle */</span>
	<span class="enscript-type">short</span>			so_type;
	u_int32_t		so_options;
	<span class="enscript-type">short</span>			so_linger;
	<span class="enscript-type">short</span>			so_state;
	u_int64_t		so_pcb;		<span class="enscript-comment">/* another convenient handle */</span>
	<span class="enscript-type">int</span>			xso_protocol;
	<span class="enscript-type">int</span>			xso_family;
	<span class="enscript-type">short</span>			so_qlen;
	<span class="enscript-type">short</span>			so_incqlen;
	<span class="enscript-type">short</span>			so_qlimit;
	<span class="enscript-type">short</span>			so_timeo;
	u_short			so_error;
	pid_t			so_pgid;
	u_int32_t		so_oobmark;
	uid_t			so_uid;		<span class="enscript-comment">/* XXX */</span>
	pid_t			so_last_pid;
	pid_t			so_e_pid;
};

<span class="enscript-type">struct</span> xsockbuf_n {
	u_int32_t		xsb_len;	<span class="enscript-comment">/* length of this structure */</span>
	u_int32_t		xsb_kind;	<span class="enscript-comment">/* XSO_RCVBUF or XSO_SNDBUF */</span>
	u_int32_t		sb_cc;
	u_int32_t		sb_hiwat;
	u_int32_t		sb_mbcnt;
	u_int32_t		sb_mbmax;
	int32_t			sb_lowat;
	<span class="enscript-type">short</span>			sb_flags;
	<span class="enscript-type">short</span>			sb_timeo;
};

<span class="enscript-type">struct</span> xsockstat_n {
	u_int32_t		xst_len;	<span class="enscript-comment">/* length of this structure */</span>
	u_int32_t		xst_kind;	<span class="enscript-comment">/* XSO_STATS */</span>
	<span class="enscript-type">struct</span> data_stats	xst_tc_stats[SO_TC_STATS_MAX];
};

<span class="enscript-comment">/*
 * Global socket statistics
 */</span>
<span class="enscript-type">struct</span> soextbkidlestat {
	u_int32_t	so_xbkidle_maxperproc;
	u_int32_t	so_xbkidle_time;
	u_int32_t	so_xbkidle_rcvhiwat;
	int32_t		so_xbkidle_notsupp;
	int32_t		so_xbkidle_toomany;
	int32_t		so_xbkidle_wantok;
	int32_t		so_xbkidle_active;
	int32_t		so_xbkidle_nocell;
	int32_t		so_xbkidle_notime;
	int32_t		so_xbkidle_forced;
	int32_t		so_xbkidle_resumed;
	int32_t		so_xbkidle_expired;
	int32_t		so_xbkidle_resched;
	int32_t		so_xbkidle_nodlgtd;
	int32_t		so_xbkidle_drained;
};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">pack</span>()

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL_PRIVATE</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/kpi_mbuf.h&gt;</span>

<span class="enscript-comment">/*
 * Argument structure for sosetopt et seq.  This is in the KERNEL
 * section because it will never be visible to user code.
 */</span>
<span class="enscript-type">enum</span> sopt_dir { SOPT_GET, SOPT_SET };
<span class="enscript-type">struct</span> sockopt {
	<span class="enscript-type">enum</span>	sopt_dir sopt_dir; <span class="enscript-comment">/* is this a get or a set? */</span>
	<span class="enscript-type">int</span>	sopt_level;	<span class="enscript-comment">/* second arg of [gs]etsockopt */</span>
	<span class="enscript-type">int</span>	sopt_name;	<span class="enscript-comment">/* third arg of [gs]etsockopt */</span>
	user_addr_t sopt_val;	<span class="enscript-comment">/* fourth arg of [gs]etsockopt */</span>
	size_t	sopt_valsize;	<span class="enscript-comment">/* (almost) fifth arg of [gs]etsockopt */</span>
	<span class="enscript-type">struct</span>	proc *sopt_p;	<span class="enscript-comment">/* calling process or null if kernel */</span>
};

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">MALLOC_DECLARE</span>
<span class="enscript-function-name">MALLOC_DECLARE</span>(M_PCB);
<span class="enscript-function-name">MALLOC_DECLARE</span>(M_SONAME);
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* MALLOC_DECLARE */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>
<span class="enscript-comment">/*
 * Socket extension mechanism: control block hooks:
 * This is the &quot;head&quot; of any control block for an extenstion
 * Note: we separate intercept function dispatch vectors from
 *  the NFDescriptor to permit selective replacement during
 *  operation, e.g., to disable some functions.
 */</span>
<span class="enscript-type">struct</span> kextcb {
	<span class="enscript-type">struct</span> kextcb *e_next;		<span class="enscript-comment">/* Next kext control block */</span>
	<span class="enscript-type">void</span> *e_fcb;			<span class="enscript-comment">/* Real filter control block */</span>
	<span class="enscript-type">struct</span> NFDescriptor *e_nfd;	<span class="enscript-comment">/* NKE Descriptor */</span>
	<span class="enscript-comment">/* Plug-in support - intercept functions */</span>
	<span class="enscript-type">struct</span> sockif *e_soif;		<span class="enscript-comment">/* Socket functions */</span>
	<span class="enscript-type">struct</span> sockutil *e_sout;	<span class="enscript-comment">/* Sockbuf utility functions */</span>
};
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">EXT_NULL</span>	0x0		<span class="enscript-comment">/* STATE: Not in use */</span>

<span class="enscript-comment">/* Hints for socket event processing */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_FILT_HINT_LOCKED</span>      0x00000001	<span class="enscript-comment">/* socket is already locked */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_FILT_HINT_CONNRESET</span>   0x00000002	<span class="enscript-comment">/* Reset is received */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_FILT_HINT_CANTRCVMORE</span> 0x00000004	<span class="enscript-comment">/* No more data to read */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_FILT_HINT_CANTSENDMORE</span> 0x00000008	<span class="enscript-comment">/* Can't write more data */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_FILT_HINT_TIMEOUT</span>     0x00000010	<span class="enscript-comment">/* timeout */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_FILT_HINT_NOSRCADDR</span>   0x00000020	<span class="enscript-comment">/* No src address available */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_FILT_HINT_IFDENIED</span>    0x00000040	<span class="enscript-comment">/* interface denied access */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_FILT_HINT_SUSPEND</span>     0x00000080	<span class="enscript-comment">/* output queue suspended */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_FILT_HINT_RESUME</span>      0x00000100	<span class="enscript-comment">/* output queue resumed */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_FILT_HINT_KEEPALIVE</span>	 0x00000200	<span class="enscript-comment">/* TCP Keepalive received */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_FILT_HINT_ADAPTIVE_WTIMO</span> 0x00000400 <span class="enscript-comment">/* TCP adaptive write timeout */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_FILT_HINT_ADAPTIVE_RTIMO</span> 0x00000800 <span class="enscript-comment">/* TCP adaptive read timeout */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_FILT_HINT_CONNECTED</span>	  0x00001000	<span class="enscript-comment">/* socket is connected */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_FILT_HINT_DISCONNECTED</span> 0x00002000	<span class="enscript-comment">/* socket is disconnected */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_FILT_HINT_CONNINFO_UPDATED</span> 0x00004000 <span class="enscript-comment">/* updated conninfo avail. */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_FILT_HINT_MPFAILOVER</span>	0x00008000	<span class="enscript-comment">/* multipath failover */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_FILT_HINT_MPSTATUS</span>	0x00010000	<span class="enscript-comment">/* multipath status */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_FILT_HINT_MUSTRST</span>	0x00020000	<span class="enscript-comment">/* must send RST and close */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_FILT_HINT_MPFASTJ</span>	0x00040000	<span class="enscript-comment">/* can do MPTCP fast join */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_FILT_HINT_DELETEOK</span>	0x00100000	<span class="enscript-comment">/* Ok to delete socket */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_FILT_HINT_MPCANTRCVMORE</span>  0x00200000	<span class="enscript-comment">/* MPTCP DFIN Received */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SO_FILT_HINT_BITS</span> \
	<span class="enscript-string">&quot;\020\1LOCKED\2CONNRESET\3CANTRCVMORE\4CANTSENDMORE\5TIMEOUT&quot;</span>	\
	<span class="enscript-string">&quot;\6NOSRCADDR\7IFDENIED\10SUSPEND\11RESUME\12KEEPALIVE\13AWTIMO&quot;</span>	\
	<span class="enscript-string">&quot;\14ARTIMO\15CONNECTED\16DISCONNECTED\17CONNINFO_UPDATED&quot;</span> 	\
	<span class="enscript-string">&quot;\20MPFAILOVER\21MPSTATUS\22MUSTRST\23MPFASTJ\24DELETEOK&quot;</span> 	\
	<span class="enscript-string">&quot;\25MPCANTRCVMORE&quot;</span>

<span class="enscript-comment">/* Mask for hints that have corresponding kqueue events */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SO_FILT_HINT_EV</span>							\
	(SO_FILT_HINT_CONNRESET | SO_FILT_HINT_CANTRCVMORE |		\
	SO_FILT_HINT_CANTSENDMORE | SO_FILT_HINT_TIMEOUT |		\
	SO_FILT_HINT_NOSRCADDR | SO_FILT_HINT_IFDENIED |		\
	SO_FILT_HINT_SUSPEND | SO_FILT_HINT_RESUME |			\
	SO_FILT_HINT_KEEPALIVE | SO_FILT_HINT_ADAPTIVE_WTIMO |		\
	SO_FILT_HINT_ADAPTIVE_RTIMO | SO_FILT_HINT_CONNECTED |		\
	SO_FILT_HINT_DISCONNECTED | SO_FILT_HINT_CONNINFO_UPDATED)

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">SENDFILE</span>
<span class="enscript-type">struct</span> sf_buf {
	SLIST_ENTRY(sf_buf) free_list;	<span class="enscript-comment">/* list of free buffer slots */</span>
	<span class="enscript-type">int</span>		refcnt;		<span class="enscript-comment">/* reference count */</span>
	<span class="enscript-type">struct</span>		vm_page *m;	<span class="enscript-comment">/* currently mapped page */</span>
	vm_offset_t	kva;		<span class="enscript-comment">/* va of mapping */</span>
};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* SENDFILE */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">SBLASTRECORDCHK</span>(sb, s)						\
	<span class="enscript-keyword">if</span> (socket_debug) sblastrecordchk(sb, s);

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">SBLASTMBUFCHK</span>(sb, s)						\
	<span class="enscript-keyword">if</span> (socket_debug) sblastmbufchk(sb, s);

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">SB_EMPTY_FIXUP</span>(sb) {						\
	<span class="enscript-keyword">if</span> ((sb)-&gt;sb_mb == NULL) {					\
		(sb)-&gt;sb_mbtail = NULL;					\
		(sb)-&gt;sb_lastrecord = NULL;				\
	}								\
}

#<span class="enscript-reference">define</span> <span class="enscript-function-name">SB_MB_CHECK</span>(sb) do {						\
	<span class="enscript-keyword">if</span> (((sb)-&gt;sb_mb != NULL &amp;&amp;					\
	    (sb)-&gt;sb_cc == 0) ||					\
	    ((sb)-&gt;sb_mb == NULL &amp;&amp; (sb)-&gt;sb_cc &gt; 0))			\
		panic(<span class="enscript-string">&quot;corrupt so_rcv: sb_mb %p sb_cc %d\n&quot;</span>,		\
		    (sb)-&gt;sb_mb, (sb)-&gt;sb_cc);				\
} <span class="enscript-keyword">while</span>(0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">SODEFUNCTLOG</span>(x)		do { if (sodefunctlog) printf x; } while (0)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">SOTHROTTLELOG</span>(x)	do { if (sothrottlelog) printf x; } while (0)

<span class="enscript-comment">/*
 * For debugging traffic class behaviors
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOTCDB_NO_DSCP</span>		0x01	<span class="enscript-comment">/* Do not set DSCP code in IP header */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOTCDB_NO_MTC</span>		0x02	<span class="enscript-comment">/* Do not set the mbuf traffic class */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOTCDB_NO_SENDTCPBG</span>	0x04	<span class="enscript-comment">/* Do not use background TCP CC algorithm for sender */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOTCDB_NO_LCLTST</span>	0x08	<span class="enscript-comment">/* Do not test for local destination for setting DSCP */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOTCDB_NO_DSCPTST</span>	0x10	<span class="enscript-comment">/* Overwritte any existing DSCP code */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SOTCDB_NO_RECVTCPBG</span>	0x20	<span class="enscript-comment">/* Do not use throttling on receiver-side of TCP */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOTCDB_NO_PRIVILEGED</span>	0x40	<span class="enscript-comment">/* Do not set privileged traffic flag */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">SOCK_DOM</span>(so)			((so)-&gt;so_proto-&gt;pr_domain-&gt;dom_family)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">SOCK_TYPE</span>(so)			((so)-&gt;so_proto-&gt;pr_type)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">SOCK_PROTO</span>(so)			((so)-&gt;so_proto-&gt;pr_protocol)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">SOCK_CHECK_DOM</span>(so, dom)		(SOCK_DOM(so) == (dom))
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">SOCK_CHECK_TYPE</span>(so, type)	(SOCK_TYPE(so) == (type))
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">SOCK_CHECK_PROTO</span>(so, proto)	(SOCK_PROTO(so) == (proto))

<span class="enscript-comment">/*
 * Socket process information
 */</span>
<span class="enscript-type">struct</span> so_procinfo {
	pid_t		spi_pid;
	pid_t		spi_epid;
	uuid_t		spi_uuid;
	uuid_t		spi_euuid;
	<span class="enscript-type">int</span>		spi_delegated;
};

<span class="enscript-type">extern</span> u_int32_t sb_max;
<span class="enscript-type">extern</span> so_gen_t so_gencnt;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> socket_debug;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> sosendjcl;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> sosendjcl_ignore_capab;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> sodefunctlog;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> sothrottlelog;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> sorestrictrecv;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> sorestrictsend;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> somaxconn;
<span class="enscript-type">extern</span> uint32_t tcp_autosndbuf_max;
<span class="enscript-type">extern</span> u_int32_t sotcdb;
<span class="enscript-type">extern</span> u_int32_t net_io_policy_throttled;
<span class="enscript-type">extern</span> u_int32_t net_io_policy_log;
<span class="enscript-type">extern</span> u_int32_t net_io_policy_throttle_best_effort;
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">CONFIG_PROC_UUID_POLICY</span>
<span class="enscript-type">extern</span> u_int32_t net_io_policy_uuid;
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* CONFIG_PROC_UUID_POLICY */</span>

<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> soextbkidlestat soextbkidlestat;

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>

<span class="enscript-type">struct</span> mbuf;
<span class="enscript-type">struct</span> sockaddr;
<span class="enscript-type">struct</span> ucred;
<span class="enscript-type">struct</span> uio;

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOCK_MSG_SA</span> 0x01
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOCK_MSG_CONTROL</span> 0x02
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOCK_MSG_DATA</span> 0x04

<span class="enscript-type">struct</span> recv_msg_elem {
	<span class="enscript-type">struct</span> uio *uio;
	<span class="enscript-type">struct</span> sockaddr *psa;
	<span class="enscript-type">struct</span> mbuf *controlp;
	<span class="enscript-type">int</span> which;
	<span class="enscript-type">int</span> flags;
};

<span class="enscript-comment">/*
 * From uipc_socket and friends
 */</span>
__BEGIN_DECLS
<span class="enscript-comment">/* Exported */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sbappendaddr</span>(<span class="enscript-type">struct</span> sockbuf *sb, <span class="enscript-type">struct</span> sockaddr *asa,
    <span class="enscript-type">struct</span> mbuf *m0, <span class="enscript-type">struct</span> mbuf *control, <span class="enscript-type">int</span> *error_out);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sbappendrecord</span>(<span class="enscript-type">struct</span> sockbuf *sb, <span class="enscript-type">struct</span> mbuf *m0);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sbflush</span>(<span class="enscript-type">struct</span> sockbuf *sb);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sbspace</span>(<span class="enscript-type">struct</span> sockbuf *sb);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soabort</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">socantrcvmore</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">socantsendmore</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sodisconnect</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sofree</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sofreelastref</span>(<span class="enscript-type">struct</span> socket *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">soisconnected</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> boolean_t <span class="enscript-function-name">socanwrite</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">soisconnecting</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">soisdisconnected</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">soisdisconnecting</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> socket *<span class="enscript-function-name">sonewconn</span>(<span class="enscript-type">struct</span> socket *head, <span class="enscript-type">int</span> connstatus,
    <span class="enscript-type">const</span> <span class="enscript-type">struct</span> sockaddr *from);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sopoll</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">int</span> events, <span class="enscript-type">struct</span> ucred *cred, <span class="enscript-type">void</span> *wql);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sooptcopyin</span>(<span class="enscript-type">struct</span> sockopt *sopt, <span class="enscript-type">void</span> *data, size_t len,
    size_t minlen);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sooptcopyout</span>(<span class="enscript-type">struct</span> sockopt *sopt, <span class="enscript-type">void</span> *data, size_t len);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soreceive</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">struct</span> sockaddr **paddr,
    <span class="enscript-type">struct</span> uio *uio, <span class="enscript-type">struct</span> mbuf **mp0, <span class="enscript-type">struct</span> mbuf **controlp, <span class="enscript-type">int</span> *flagsp);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soreserve</span>(<span class="enscript-type">struct</span> socket *so, u_int32_t sndcc, u_int32_t rcvcc);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">soreserve_preconnect</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> pre_cc);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sorwakeup</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sosend</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">struct</span> sockaddr *addr, <span class="enscript-type">struct</span> uio *uio,
    <span class="enscript-type">struct</span> mbuf *top, <span class="enscript-type">struct</span> mbuf *control, <span class="enscript-type">int</span> flags);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sosend_list</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">struct</span> uio **uio, u_int uiocnt, <span class="enscript-type">int</span> flags);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soreceive_list</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">struct</span> recv_msg_elem *msgarray, u_int msgcnt,
    <span class="enscript-type">int</span> *flags);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sonullevent</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">void</span> *arg, uint32_t hint);
__END_DECLS

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>
<span class="enscript-type">struct</span> file;
<span class="enscript-type">struct</span> filedesc;
<span class="enscript-type">struct</span> so_tcdbg;

__BEGIN_DECLS
<span class="enscript-comment">/* Not exported */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">socketinit</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> sockaddr *<span class="enscript-function-name">dup_sockaddr</span>(<span class="enscript-type">struct</span> sockaddr *sa, <span class="enscript-type">int</span> canwait);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">getsock</span>(<span class="enscript-type">struct</span> filedesc *fdp, <span class="enscript-type">int</span> fd, <span class="enscript-type">struct</span> file **fpp);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sockargs</span>(<span class="enscript-type">struct</span> mbuf **mp, user_addr_t data, <span class="enscript-type">int</span> buflen, <span class="enscript-type">int</span> type);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">get_sockev_state</span>(<span class="enscript-type">struct</span> socket *, u_int32_t *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">so_update_last_owner_locked</span>(<span class="enscript-type">struct</span> socket *, <span class="enscript-type">struct</span> proc *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">so_update_policy</span>(<span class="enscript-type">struct</span> socket *);

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sbappend</span>(<span class="enscript-type">struct</span> sockbuf *sb, <span class="enscript-type">struct</span> mbuf *m);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sbappendstream</span>(<span class="enscript-type">struct</span> sockbuf *sb, <span class="enscript-type">struct</span> mbuf *m);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sbappendcontrol</span>(<span class="enscript-type">struct</span> sockbuf *sb, <span class="enscript-type">struct</span> mbuf *m0,
    <span class="enscript-type">struct</span> mbuf *control, <span class="enscript-type">int</span> *error_out);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sbappendmsgstream_rcv</span>(<span class="enscript-type">struct</span> sockbuf *sb, <span class="enscript-type">struct</span> mbuf *m,
    uint32_t seqnum, <span class="enscript-type">int</span> flags);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sbappendstream_rcvdemux</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">struct</span> mbuf *m,
    uint32_t seqnum, <span class="enscript-type">int</span> flags);
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">MPTCP</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sbappendmptcpstream_rcv</span>(<span class="enscript-type">struct</span> sockbuf *sb, <span class="enscript-type">struct</span> mbuf *m);
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* MPTCP */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sbappendmsg_snd</span>(<span class="enscript-type">struct</span> sockbuf *sb, <span class="enscript-type">struct</span> mbuf *m);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sbpull_unordered_data</span>(<span class="enscript-type">struct</span> socket *, int32_t, int32_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sbcheck</span>(<span class="enscript-type">struct</span> sockbuf *sb);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sblastmbufchk</span>(<span class="enscript-type">struct</span> sockbuf *, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sblastrecordchk</span>(<span class="enscript-type">struct</span> sockbuf *, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> mbuf *<span class="enscript-function-name">sbcreatecontrol</span>(caddr_t p, <span class="enscript-type">int</span> size, <span class="enscript-type">int</span> type, <span class="enscript-type">int</span> level);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> mbuf **<span class="enscript-function-name">sbcreatecontrol_mbuf</span>(caddr_t p, <span class="enscript-type">int</span> size, <span class="enscript-type">int</span> type,
    <span class="enscript-type">int</span> level, <span class="enscript-type">struct</span> mbuf** m);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sbdrop</span>(<span class="enscript-type">struct</span> sockbuf *sb, <span class="enscript-type">int</span> len);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sbdroprecord</span>(<span class="enscript-type">struct</span> sockbuf *sb);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sbinsertoob</span>(<span class="enscript-type">struct</span> sockbuf *sb, <span class="enscript-type">struct</span> mbuf *m0);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sbrelease</span>(<span class="enscript-type">struct</span> sockbuf *sb);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sbreserve</span>(<span class="enscript-type">struct</span> sockbuf *sb, u_int32_t cc);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sbtoxsockbuf</span>(<span class="enscript-type">struct</span> sockbuf *sb, <span class="enscript-type">struct</span> xsockbuf *xsb);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sbwait</span>(<span class="enscript-type">struct</span> sockbuf *sb);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sbwakeup</span>(<span class="enscript-type">struct</span> sockbuf *sb);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sb_empty_assert</span>(<span class="enscript-type">struct</span> sockbuf *, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sb_notify</span>(<span class="enscript-type">struct</span> sockbuf *sb);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sballoc</span>(<span class="enscript-type">struct</span> sockbuf *sb, <span class="enscript-type">struct</span> mbuf *m);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sbfree</span>(<span class="enscript-type">struct</span> sockbuf *sb, <span class="enscript-type">struct</span> mbuf *m);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sbfree_chunk</span>(<span class="enscript-type">struct</span> sockbuf *sb, <span class="enscript-type">struct</span> mbuf *m);

<span class="enscript-comment">/*
 * Flags to sblock().
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SBL_WAIT</span>	0x00000001	<span class="enscript-comment">/* Wait if not immediately available. */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SBL_NOINTR</span>	0x00000002	<span class="enscript-comment">/* Force non-interruptible sleep. */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SBL_IGNDEFUNCT</span>	0x00000004	<span class="enscript-comment">/* Ignore defunct'd state */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SBL_VALID</span>	(SBL_WAIT | SBL_NOINTR | SBL_IGNDEFUNCT)
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sblock</span>(<span class="enscript-type">struct</span> sockbuf *sb, uint32_t flags);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sbunlock</span>(<span class="enscript-type">struct</span> sockbuf *sb, boolean_t keeplocked);

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soaccept</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">struct</span> sockaddr **nam);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soacceptlock</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">struct</span> sockaddr **nam, <span class="enscript-type">int</span> dolock);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soacceptfilter</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> socket *<span class="enscript-function-name">soalloc</span>(<span class="enscript-type">int</span> waitok, <span class="enscript-type">int</span> dom, <span class="enscript-type">int</span> type);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sobindlock</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">struct</span> sockaddr *nam, <span class="enscript-type">int</span> dolock);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soclose</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soclose_locked</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">soclose_wait_locked</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soconnect</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">struct</span> sockaddr *nam);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soconnectlock</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">struct</span> sockaddr *nam, <span class="enscript-type">int</span> dolock);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soconnect2</span>(<span class="enscript-type">struct</span> socket *so1, <span class="enscript-type">struct</span> socket *so2);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soconnectxlocked</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">struct</span> sockaddr_list **src_sl,
    <span class="enscript-type">struct</span> sockaddr_list **dst_sl, <span class="enscript-type">struct</span> proc *, uint32_t, sae_associd_t,
    sae_connid_t *, uint32_t, <span class="enscript-type">void</span> *, u_int32_t, uio_t, user_ssize_t*);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sodisconnectx</span>(<span class="enscript-type">struct</span> socket *so, sae_associd_t, sae_connid_t);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sodisconnectxlocked</span>(<span class="enscript-type">struct</span> socket *so, sae_associd_t, sae_connid_t);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sopeelofflocked</span>(<span class="enscript-type">struct</span> socket *so, sae_associd_t, <span class="enscript-type">struct</span> socket **);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">soevupcall</span>(<span class="enscript-type">struct</span> socket *, u_int32_t);
<span class="enscript-comment">/* flags for socreate_internal */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOCF_ASYNC</span>	0x1	<span class="enscript-comment">/* non-blocking socket */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">SOCF_MP_SUBFLOW</span>	0x2	<span class="enscript-comment">/* multipath subflow socket */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">socreate_internal</span>(<span class="enscript-type">int</span> dom, <span class="enscript-type">struct</span> socket **aso, <span class="enscript-type">int</span> type, <span class="enscript-type">int</span> proto,
    <span class="enscript-type">struct</span> proc *, uint32_t, <span class="enscript-type">struct</span> proc *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">socreate</span>(<span class="enscript-type">int</span> dom, <span class="enscript-type">struct</span> socket **aso, <span class="enscript-type">int</span> type, <span class="enscript-type">int</span> proto);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">socreate_delegate</span>(<span class="enscript-type">int</span> dom, <span class="enscript-type">struct</span> socket **aso, <span class="enscript-type">int</span> type, <span class="enscript-type">int</span> proto, pid_t epid);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sodealloc</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sodisconnectlocked</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">soreference</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sodereference</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">somultipages</span>(<span class="enscript-type">struct</span> socket *, boolean_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">soif2kcl</span>(<span class="enscript-type">struct</span> socket *, boolean_t);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sosetdefunct</span>(<span class="enscript-type">struct</span> proc *, <span class="enscript-type">struct</span> socket *, <span class="enscript-type">int</span> level, boolean_t);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sodefunct</span>(<span class="enscript-type">struct</span> proc *, <span class="enscript-type">struct</span> socket *, <span class="enscript-type">int</span> level);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soresume</span>(<span class="enscript-type">struct</span> proc *, <span class="enscript-type">struct</span> socket *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">resume_proc_sockets</span>(proc_t);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">so_check_extended_bk_idle_time</span>(<span class="enscript-type">struct</span> socket *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">so_drain_extended_bk_idle</span>(<span class="enscript-type">struct</span> socket *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sohasoutofband</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sodisconnectwakeup</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soisthrottled</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soisprivilegedtraffic</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soissrcbackground</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soissrcrealtime</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soissrcbesteffort</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">solisten</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">int</span> backlog);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> socket *<span class="enscript-function-name">sodropablereq</span>(<span class="enscript-type">struct</span> socket *head);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">socket_lock</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">int</span> refcount);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">socket_unlock</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">int</span> refcount);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sogetaddr_locked</span>(<span class="enscript-type">struct</span> socket *, <span class="enscript-type">struct</span> sockaddr **, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">const</span> <span class="enscript-type">char</span> *<span class="enscript-function-name">solockhistory_nr</span>(<span class="enscript-type">struct</span> socket *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">soevent</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">long</span> hint);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sorflush</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sowflush</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sowakeup</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">struct</span> sockbuf *sb);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soioctl</span>(<span class="enscript-type">struct</span> socket *so, u_long cmd, caddr_t data, <span class="enscript-type">struct</span> proc *p);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sogetoptlock</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">struct</span> sockopt *sopt, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sosetoptlock</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">struct</span> sockopt *sopt, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soshutdown</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">int</span> how);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soshutdownlock</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">int</span> how);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soshutdownlock_final</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">int</span> how);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sotoxsocket</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">struct</span> xsocket *xso);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sotoxsocket64</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">struct</span> xsocket64 *xso);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sosendallatonce</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soreadable</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sowriteable</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sowwakeup</span>(<span class="enscript-type">struct</span> socket *so);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sosendcheck</span>(<span class="enscript-type">struct</span> socket *, <span class="enscript-type">struct</span> sockaddr *, user_ssize_t,
    int32_t, int32_t, <span class="enscript-type">int</span>, <span class="enscript-type">int</span> *, <span class="enscript-type">struct</span> mbuf *);

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soo_ioctl</span>(<span class="enscript-type">struct</span> fileproc *, u_long, caddr_t, vfs_context_t);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soo_stat</span>(<span class="enscript-type">struct</span> socket *, <span class="enscript-type">void</span> *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soo_select</span>(<span class="enscript-type">struct</span> fileproc *, <span class="enscript-type">int</span>, <span class="enscript-type">void</span> *, vfs_context_t);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soo_kqfilter</span>(<span class="enscript-type">struct</span> fileproc *, <span class="enscript-type">struct</span> knote *, vfs_context_t);

<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> sockaddr_entry *<span class="enscript-function-name">sockaddrentry_alloc</span>(<span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sockaddrentry_free</span>(<span class="enscript-type">struct</span> sockaddr_entry *);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> sockaddr_entry *<span class="enscript-function-name">sockaddrentry_dup</span>(<span class="enscript-type">const</span> <span class="enscript-type">struct</span> sockaddr_entry *,
    <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> sockaddr_list *<span class="enscript-function-name">sockaddrlist_alloc</span>(<span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sockaddrlist_free</span>(<span class="enscript-type">struct</span> sockaddr_list *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sockaddrlist_insert</span>(<span class="enscript-type">struct</span> sockaddr_list *,
    <span class="enscript-type">struct</span> sockaddr_entry *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sockaddrlist_remove</span>(<span class="enscript-type">struct</span> sockaddr_list *,
    <span class="enscript-type">struct</span> sockaddr_entry *);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> sockaddr_list *<span class="enscript-function-name">sockaddrlist_dup</span>(<span class="enscript-type">const</span> <span class="enscript-type">struct</span> sockaddr_list *,
    <span class="enscript-type">int</span>);

<span class="enscript-comment">/* Service class flags used for setting service class on a packet */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PKT_SCF_IPV6</span>		0x00000001	<span class="enscript-comment">/* IPv6 packet */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PKT_SCF_TCP_ACK</span>		0x00000002	<span class="enscript-comment">/* Pure TCP ACK */</span>

<span class="enscript-comment">/*
 * Flags for connectx(2) user-protocol request routine.
 */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CONNREQF_MPTCP</span>	0x1	<span class="enscript-comment">/* called internally by MPTCP */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CONNREQF_UIO</span>	0x2	<span class="enscript-comment">/* there's data */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CONNREQF_IDEM</span>	0x4	<span class="enscript-comment">/* data is idempotent */</span>

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">set_packet_service_class</span>(<span class="enscript-type">struct</span> mbuf *, <span class="enscript-type">struct</span> socket *,
    mbuf_svc_class_t, u_int32_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">so_tc_update_stats</span>(<span class="enscript-type">struct</span> mbuf *, <span class="enscript-type">struct</span> socket *,
    mbuf_svc_class_t);
<span class="enscript-type">extern</span> mbuf_svc_class_t <span class="enscript-function-name">mbuf_service_class_from_control</span>(<span class="enscript-type">struct</span> mbuf *);
<span class="enscript-type">extern</span> mbuf_svc_class_t <span class="enscript-function-name">so_tc2msc</span>(<span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">so_svc2tc</span>(mbuf_svc_class_t);

<span class="enscript-type">extern</span> u_int8_t <span class="enscript-function-name">tcp_cansbgrow</span>(<span class="enscript-type">struct</span> sockbuf *sb);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">tcp_get_msg_priority</span>(<span class="enscript-type">struct</span> mbuf *, uint32_t *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">set_tcp_stream_priority</span>(<span class="enscript-type">struct</span> socket *so);

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">so_set_traffic_class</span>(<span class="enscript-type">struct</span> socket *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">so_set_default_traffic_class</span>(<span class="enscript-type">struct</span> socket *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">so_set_opportunistic</span>(<span class="enscript-type">struct</span> socket *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">so_get_opportunistic</span>(<span class="enscript-type">struct</span> socket *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">so_set_recv_anyif</span>(<span class="enscript-type">struct</span> socket *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">so_get_recv_anyif</span>(<span class="enscript-type">struct</span> socket *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">so_set_effective_pid</span>(<span class="enscript-type">struct</span> socket *, <span class="enscript-type">int</span>, <span class="enscript-type">struct</span> proc *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">so_set_effective_uuid</span>(<span class="enscript-type">struct</span> socket *, uuid_t, <span class="enscript-type">struct</span> proc *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">so_set_restrictions</span>(<span class="enscript-type">struct</span> socket *, uint32_t);
<span class="enscript-type">extern</span> uint32_t <span class="enscript-function-name">so_get_restrictions</span>(<span class="enscript-type">struct</span> socket *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">socket_tclass_init</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">so_set_tcdbg</span>(<span class="enscript-type">struct</span> socket *, <span class="enscript-type">struct</span> so_tcdbg *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sogetopt_tcdbg</span>(<span class="enscript-type">struct</span> socket *, <span class="enscript-type">struct</span> sockopt *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">so_set_lro</span>(<span class="enscript-type">struct</span> socket*, <span class="enscript-type">int</span>);

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">so_isdstlocal</span>(<span class="enscript-type">struct</span> socket *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">so_recv_data_stat</span>(<span class="enscript-type">struct</span> socket *, <span class="enscript-type">struct</span> mbuf *, size_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">so_inc_recv_data_stat</span>(<span class="enscript-type">struct</span> socket *, size_t, size_t, uint32_t);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">so_wait_for_if_feedback</span>(<span class="enscript-type">struct</span> socket *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">msgq_sbspace</span>(<span class="enscript-type">struct</span> socket *so, <span class="enscript-type">struct</span> mbuf *control);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soopt_getm</span>(<span class="enscript-type">struct</span> sockopt *sopt, <span class="enscript-type">struct</span> mbuf **mp);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soopt_mcopyin</span>(<span class="enscript-type">struct</span> sockopt *sopt, <span class="enscript-type">struct</span> mbuf *m);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">soopt_mcopyout</span>(<span class="enscript-type">struct</span> sockopt *sopt, <span class="enscript-type">struct</span> mbuf *m);
<span class="enscript-type">extern</span> boolean_t <span class="enscript-function-name">so_cache_timer</span>(<span class="enscript-type">void</span>);

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">mptcp_preproc_sbdrop</span>(<span class="enscript-type">struct</span> mbuf *, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">mptcp_postproc_sbdrop</span>(<span class="enscript-type">struct</span> mbuf *, u_int64_t, u_int32_t,
    u_int32_t);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">mptcp_adj_rmap</span>(<span class="enscript-type">struct</span> socket *, <span class="enscript-type">struct</span> mbuf *);

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">netpolicy_post_msg</span>(uint32_t, <span class="enscript-type">struct</span> netpolicy_event_data *,
    uint32_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">socket_post_kev_msg</span>(uint32_t, <span class="enscript-type">struct</span> kev_socket_event_data *,
    uint32_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">socket_post_kev_msg_closed</span>(<span class="enscript-type">struct</span> socket *);
<span class="enscript-comment">/* 
 * Socket operation routines.
 * These routines are called by the routines in
 * sys_socket.c or from a system process, and
 * implement the semantics of socket operations by
 * switching out to the protocol specific routines.
 */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">postevent</span>(<span class="enscript-type">struct</span> socket *, <span class="enscript-type">struct</span> sockbuf *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">evsofree</span>(<span class="enscript-type">struct</span> socket *);

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">tcp_notsent_lowat_check</span>(<span class="enscript-type">struct</span> socket *so);

<span class="enscript-type">extern</span> user_ssize_t <span class="enscript-function-name">uio_array_resid</span>(<span class="enscript-type">struct</span> uio **, u_int);
<span class="enscript-type">extern</span> user_ssize_t <span class="enscript-function-name">recv_msg_array_resid</span>(<span class="enscript-type">struct</span> recv_msg_elem *, u_int);

<span class="enscript-type">void</span> <span class="enscript-function-name">sotoxsocket_n</span>(<span class="enscript-type">struct</span> socket *, <span class="enscript-type">struct</span> xsocket_n *);
<span class="enscript-type">void</span> <span class="enscript-function-name">sbtoxsockbuf_n</span>(<span class="enscript-type">struct</span> sockbuf *, <span class="enscript-type">struct</span> xsockbuf_n *);
<span class="enscript-type">void</span> <span class="enscript-function-name">sbtoxsockstat_n</span>(<span class="enscript-type">struct</span> socket *, <span class="enscript-type">struct</span> xsockstat_n *);

__END_DECLS
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL_PRIVATE */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !_SYS_SOCKETVAR_H_ */</span>
</pre>
<hr />
</body></html>