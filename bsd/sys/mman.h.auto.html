<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>mman.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">mman.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000-2002 Apple Computer, Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/* Copyright (c) 1995 NeXT Computer, Inc. All Rights Reserved */</span>
<span class="enscript-comment">/*-
 * Copyright (c) 1982, 1986, 1993
 *	The Regents of the University of California.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *	@(#)mman.h	8.1 (Berkeley) 6/2/93
 */</span>

<span class="enscript-comment">/*
 * Currently unsupported:
 *
 * [TYM]	POSIX_TYPED_MEM_ALLOCATE
 * [TYM]	POSIX_TYPED_MEM_ALLOCATE_CONTIG
 * [TYM]	POSIX_TYPED_MEM_MAP_ALLOCATABLE
 * [TYM]	struct posix_typed_mem_info
 * [TYM]	posix_mem_offset()
 * [TYM]	posix_typed_mem_get_info()
 * [TYM]	posix_typed_mem_open()
 */</span>

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">_SYS_MMAN_H_</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_SYS_MMAN_H_</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/appleapiopts.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/cdefs.h&gt;</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types.h&gt;</span>

<span class="enscript-comment">/*
 * [various] The mode_t, off_t, and size_t types shall be defined as
 * described in &lt;sys/types.h&gt;
 */</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types/_mode_t.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types/_off_t.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types/_size_t.h&gt;</span>

<span class="enscript-comment">/*
 * Protections are chosen from these bits, or-ed together
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PROT_NONE</span>	0x00	<span class="enscript-comment">/* [MC2] no permissions */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PROT_READ</span>	0x01	<span class="enscript-comment">/* [MC2] pages can be read */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PROT_WRITE</span>	0x02	<span class="enscript-comment">/* [MC2] pages can be written */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PROT_EXEC</span>	0x04	<span class="enscript-comment">/* [MC2] pages can be executed */</span>

<span class="enscript-comment">/*
 * Flags contain sharing type and options.
 * Sharing types; choose one.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAP_SHARED</span>	0x0001		<span class="enscript-comment">/* [MF|SHM] share changes */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAP_PRIVATE</span>	0x0002		<span class="enscript-comment">/* [MF|SHM] changes are private */</span>
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAP_COPY</span>	MAP_PRIVATE	<span class="enscript-comment">/* Obsolete */</span>
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE) */</span>

<span class="enscript-comment">/*
 * Other flags
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAP_FIXED</span>	 0x0010	<span class="enscript-comment">/* [MF|SHM] interpret addr exactly */</span>
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAP_RENAME</span>	 0x0020	<span class="enscript-comment">/* Sun: rename private pages to file */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAP_NORESERVE</span>	 0x0040	<span class="enscript-comment">/* Sun: don't reserve needed swap area */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAP_RESERVED0080</span> 0x0080	<span class="enscript-comment">/* previously unimplemented MAP_INHERIT */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAP_NOEXTEND</span>	 0x0100	<span class="enscript-comment">/* for MAP_FILE, don't change file size */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAP_HASSEMAPHORE</span> 0x0200	<span class="enscript-comment">/* region may contain semaphores */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAP_NOCACHE</span>	 0x0400 <span class="enscript-comment">/* don't cache pages for this mapping */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAP_JIT</span>		 0x0800 <span class="enscript-comment">/* Allocate a region that will be used for JIT purposes */</span>

<span class="enscript-comment">/*
 * Mapping type
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAP_FILE</span>	0x0000	<span class="enscript-comment">/* map from file (default) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAP_ANON</span>	0x1000	<span class="enscript-comment">/* allocated from memory, swap space */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAP_ANONYMOUS</span>	MAP_ANON

<span class="enscript-comment">/*
 * The MAP_RESILIENT_* flags can be used when the caller wants to map some
 * possibly unreliable memory and be able to access it safely, possibly
 * getting the wrong contents rather than raising any exception.
 * For safety reasons, such mappings have to be read-only (PROT_READ access
 * only).
 *
 * MAP_RESILIENT_CODESIGN:
 * 	accessing this mapping will not generate code-signing violations,
 *	even if the contents are tainted.
 * MAP_RESILIENT_MEDIA:
 *	accessing this mapping will not generate an exception if the contents
 *	are not available (unreachable removable or remote media, access beyond
 *	end-of-file, ...).  Missing contents will be replaced with zeroes.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAP_RESILIENT_CODESIGN</span>	0x2000 <span class="enscript-comment">/* no code-signing failures */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAP_RESILIENT_MEDIA</span>	0x4000 <span class="enscript-comment">/* no backing-store failures */</span>

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE) */</span>

<span class="enscript-comment">/*
 * Process memory locking
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MCL_CURRENT</span>	0x0001	<span class="enscript-comment">/* [ML] Lock only current memory */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MCL_FUTURE</span>	0x0002	<span class="enscript-comment">/* [ML] Lock all future memory as well */</span>

<span class="enscript-comment">/*
 * Error return from mmap()
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAP_FAILED</span>	((void *)-1)	<span class="enscript-comment">/* [MF|SHM] mmap failed */</span>

<span class="enscript-comment">/*
 * msync() flags
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MS_ASYNC</span>	0x0001	<span class="enscript-comment">/* [MF|SIO] return immediately */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MS_INVALIDATE</span>	0x0002	<span class="enscript-comment">/* [MF|SIO] invalidate all cached data */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MS_SYNC</span>		0x0010	<span class="enscript-comment">/* [MF|SIO] msync synchronously */</span>

#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MS_KILLPAGES</span>    0x0004  <span class="enscript-comment">/* invalidate pages, leave mapped */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MS_DEACTIVATE</span>   0x0008  <span class="enscript-comment">/* deactivate pages, leave mapped */</span>

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE) */</span>


<span class="enscript-comment">/*
 * Advice to madvise
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">POSIX_MADV_NORMAL</span>	0	<span class="enscript-comment">/* [MC1] no further special treatment */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">POSIX_MADV_RANDOM</span>	1	<span class="enscript-comment">/* [MC1] expect random page refs */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">POSIX_MADV_SEQUENTIAL</span>	2	<span class="enscript-comment">/* [MC1] expect sequential page refs */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">POSIX_MADV_WILLNEED</span>	3	<span class="enscript-comment">/* [MC1] will need these pages */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">POSIX_MADV_DONTNEED</span>	4	<span class="enscript-comment">/* [MC1] dont need these pages */</span>

#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MADV_NORMAL</span>		POSIX_MADV_NORMAL
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MADV_RANDOM</span>		POSIX_MADV_RANDOM
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MADV_SEQUENTIAL</span>		POSIX_MADV_SEQUENTIAL
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MADV_WILLNEED</span>		POSIX_MADV_WILLNEED
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MADV_DONTNEED</span>		POSIX_MADV_DONTNEED
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MADV_FREE</span>		5	<span class="enscript-comment">/* pages unneeded, discard contents */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MADV_ZERO_WIRED_PAGES</span>	6	<span class="enscript-comment">/* zero the wired pages that have not been unwired before the entry is deleted */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MADV_FREE_REUSABLE</span>	7	<span class="enscript-comment">/* pages can be reused (by anyone) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MADV_FREE_REUSE</span>		8	<span class="enscript-comment">/* caller wants to reuse those pages */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MADV_CAN_REUSE</span>		9
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MADV_PAGEOUT</span>		10	<span class="enscript-comment">/* page out now (internal only) */</span>

<span class="enscript-comment">/*
 * Return bits from mincore
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MINCORE_INCORE</span>	 	 0x1	 <span class="enscript-comment">/* Page is incore */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MINCORE_REFERENCED</span>	 0x2	 <span class="enscript-comment">/* Page has been referenced by us */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MINCORE_MODIFIED</span>	 0x4	 <span class="enscript-comment">/* Page has been modified by us */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MINCORE_REFERENCED_OTHER</span> 0x8	 <span class="enscript-comment">/* Page has been referenced */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MINCORE_MODIFIED_OTHER</span>	0x10	 <span class="enscript-comment">/* Page has been modified */</span>
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE) */</span>


#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">KERNEL</span>

__BEGIN_DECLS
<span class="enscript-comment">/* [ML] */</span>
<span class="enscript-type">int</span>	mlockall(<span class="enscript-type">int</span>);
<span class="enscript-type">int</span>	munlockall(<span class="enscript-type">void</span>);
<span class="enscript-comment">/* [MR] */</span>
<span class="enscript-type">int</span>	mlock(<span class="enscript-type">const</span> <span class="enscript-type">void</span> *, size_t);
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_MMAP</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_MMAP</span>
<span class="enscript-comment">/* [MC3]*/</span>
<span class="enscript-type">void</span> *	mmap(<span class="enscript-type">void</span> *, size_t, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>, off_t) __DARWIN_ALIAS(mmap);
#<span class="enscript-reference">endif</span>
<span class="enscript-comment">/* [MPR] */</span>
<span class="enscript-type">int</span>	mprotect(<span class="enscript-type">void</span> *, size_t, <span class="enscript-type">int</span>) __DARWIN_ALIAS(mprotect);
<span class="enscript-comment">/* [MF|SIO] */</span>
<span class="enscript-type">int</span>	msync(<span class="enscript-type">void</span> *, size_t, <span class="enscript-type">int</span>) __DARWIN_ALIAS_C(msync);
<span class="enscript-comment">/* [MR] */</span>
<span class="enscript-type">int</span>	munlock(<span class="enscript-type">const</span> <span class="enscript-type">void</span> *, size_t);
<span class="enscript-comment">/* [MC3]*/</span>
<span class="enscript-type">int</span>	munmap(<span class="enscript-type">void</span> *, size_t) __DARWIN_ALIAS(munmap);
<span class="enscript-comment">/* [SHM] */</span>
<span class="enscript-type">int</span>	shm_open(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *, <span class="enscript-type">int</span>, ...);
<span class="enscript-type">int</span>	shm_unlink(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *);
<span class="enscript-comment">/* [ADV] */</span>
<span class="enscript-type">int</span>	posix_madvise(<span class="enscript-type">void</span> *, size_t, <span class="enscript-type">int</span>);

#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
<span class="enscript-type">int</span>	madvise(<span class="enscript-type">void</span> *, size_t, <span class="enscript-type">int</span>);
<span class="enscript-type">int</span>	mincore(<span class="enscript-type">const</span> <span class="enscript-type">void</span> *, size_t, <span class="enscript-type">char</span> *);
<span class="enscript-type">int</span>	minherit(<span class="enscript-type">void</span> *, size_t, <span class="enscript-type">int</span>);
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
<span class="enscript-type">int</span> <span class="enscript-function-name">mremap_encrypted</span>(<span class="enscript-type">void</span> *, size_t, __uint32_t, __uint32_t, __uint32_t);
#<span class="enscript-reference">endif</span>

__END_DECLS

#<span class="enscript-reference">else</span>	<span class="enscript-comment">/* KERNEL */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
<span class="enscript-type">void</span> <span class="enscript-function-name">pshm_cache_init</span>(<span class="enscript-type">void</span>);	<span class="enscript-comment">/* for bsd_init() */</span>
<span class="enscript-type">void</span> <span class="enscript-function-name">pshm_lock_init</span>(<span class="enscript-type">void</span>);

<span class="enscript-comment">/*
 * XXX routine exported by posix_shm.c, but never used there, only used in
 * XXX kern_mman.c in the implementation of mmap().
 */</span>
<span class="enscript-type">struct</span> mmap_args;
<span class="enscript-type">struct</span> fileproc;
<span class="enscript-type">int</span> <span class="enscript-function-name">pshm_mmap</span>(<span class="enscript-type">struct</span> proc *p, <span class="enscript-type">struct</span> mmap_args *uap, user_addr_t *retval,
		<span class="enscript-type">struct</span> fileproc *fp, off_t pageoff);
<span class="enscript-comment">/* Really need to overhaul struct fileops to avoid this... */</span>
<span class="enscript-type">struct</span> pshmnode;
<span class="enscript-type">struct</span> stat;
<span class="enscript-type">int</span> <span class="enscript-function-name">pshm_stat</span>(<span class="enscript-type">struct</span> pshmnode *pnode, <span class="enscript-type">void</span> *ub, <span class="enscript-type">int</span> isstat64);
<span class="enscript-type">struct</span> fileproc;
<span class="enscript-type">int</span> <span class="enscript-function-name">pshm_truncate</span>(<span class="enscript-type">struct</span> proc *p, <span class="enscript-type">struct</span> fileproc *fp, <span class="enscript-type">int</span> fd, off_t length, int32_t *retval);

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !_SYS_MMAN_H_ */</span>
</pre>
<hr />
</body></html>