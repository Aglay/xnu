<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>kern_memorystatus.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">kern_memorystatus.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2006 Apple Computer, Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">SYS_MEMORYSTATUS_H</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">SYS_MEMORYSTATUS_H</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;stdint.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/time.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/proc.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/param.h&gt;</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_REVISION</span>                  2

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_IDLE_HEAD</span>                -2
<span class="enscript-comment">/* The value -1 is an alias to JETSAM_PRIORITY_DEFAULT */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_IDLE</span>                      0
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_IDLE_DEFERRED</span>             1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_BACKGROUND_OPPORTUNISTIC</span>  2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_BACKGROUND</span>                3
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_MAIL</span>                      4
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_PHONE</span>                     5
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_UI_SUPPORT</span>                8
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_FOREGROUND_SUPPORT</span>        9
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_FOREGROUND</span>               10
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_AUDIO_AND_ACCESSORY</span>      12
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_CONDUCTOR</span>                13
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_HOME</span>                     16
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_EXECUTIVE</span>                17
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_IMPORTANT</span>                18
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_CRITICAL</span>                 19

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_MAX</span>                      21

<span class="enscript-comment">/* TODO - tune. This should probably be lower priority */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_DEFAULT</span>                  18
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_PRIORITY_TELEPHONY</span>                19

<span class="enscript-comment">/* Compatibility */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DEFAULT_JETSAM_PRIORITY</span>                  18

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DEFERRED_IDLE_EXIT_TIME_SECS</span>             10

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KEV_MEMORYSTATUS_SUBCLASS</span>                 3

<span class="enscript-type">enum</span> {
	kMemorystatusLevelNote = 1,
	kMemorystatusSnapshotNote = 2,
	kMemorystatusFreezeNote = 3,
	kMemorystatusPressureNote = 4
};

<span class="enscript-type">enum</span> {
	kMemorystatusLevelAny = -1,
	kMemorystatusLevelNormal = 0,
	kMemorystatusLevelWarning = 1,
	kMemorystatusLevelUrgent = 2,
	kMemorystatusLevelCritical = 3
};

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> memorystatus_priority_entry {
	pid_t pid;
	int32_t priority;
	uint64_t user_data;
	int32_t limit;
	uint32_t state;
} memorystatus_priority_entry_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> memorystatus_kernel_stats {
	uint32_t free_pages;
	uint32_t active_pages;
	uint32_t inactive_pages;
	uint32_t throttled_pages;
	uint32_t purgeable_pages;
	uint32_t wired_pages;
	uint32_t speculative_pages;
	uint32_t filebacked_pages;
	uint32_t anonymous_pages;
	uint32_t compressor_pages;
	uint64_t compressions;
	uint64_t decompressions;
	uint64_t total_uncompressed_pages_in_compressor;
} memorystatus_kernel_stats_t;

<span class="enscript-comment">/*
** This is a variable-length struct.
** Allocate a buffer of the size returned by the sysctl, cast to a memorystatus_snapshot_t *
*/</span>

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> jetsam_snapshot_entry {
	pid_t    pid;
	<span class="enscript-type">char</span>     name[MAXCOMLEN+1];
	int32_t  priority;
	uint32_t pages;
	uint32_t max_pages;
	uint32_t state;
	uint32_t killed;
	uint64_t user_data;
	uint8_t  uuid[16];
	uint32_t fds;
	uint32_t max_pages_lifetime;
	uint32_t purgeable_pages;
	<span class="enscript-type">struct</span> timeval cpu_time;
} memorystatus_jetsam_snapshot_entry_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> jetsam_snapshot {
	uint64_t snapshot_time;
	uint64_t notification_time;
	memorystatus_kernel_stats_t stats;
	size_t entry_count;
	memorystatus_jetsam_snapshot_entry_t entries[];
} memorystatus_jetsam_snapshot_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> memorystatus_freeze_entry {
 	int32_t pid;
 	uint32_t flags;
 	uint32_t pages;
} memorystatus_freeze_entry_t;

<span class="enscript-comment">/* TODO - deprecate; see &lt;rdar://problem/12969599&gt; */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kMaxSnapshotEntries</span> 192

<span class="enscript-comment">/* State */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kMemorystatusSuspended</span>        0x01
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kMemorystatusFrozen</span>           0x02
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kMemorystatusWasThawed</span>        0x04
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kMemorystatusTracked</span>          0x08
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kMemorystatusSupportsIdleExit</span> 0x10
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kMemorystatusDirty</span>            0x20

<span class="enscript-comment">/* Cause */</span>
<span class="enscript-type">enum</span> {
	kMemorystatusKilled = 1,
	kMemorystatusKilledHiwat,
 	kMemorystatusKilledVnodes,
  	kMemorystatusKilledVMPageShortage,
  	kMemorystatusKilledVMThrashing,
  	kMemorystatusKilledFCThrashing,
  	kMemorystatusKilledPerProcessLimit,
	kMemorystatusKilledDiagnostic,
	kMemorystatusKilledIdleExit
};

<span class="enscript-comment">/* Temporary, to prevent the need for a linked submission of ReportCrash */</span>
<span class="enscript-comment">/* Remove when &lt;rdar://problem/13210532&gt; has been integrated */</span>
<span class="enscript-type">enum</span> {
	kMemorystatusKilledVM = kMemorystatusKilledVMPageShortage
};

<span class="enscript-comment">/* Memorystatus control */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORYSTATUS_BUFFERSIZE_MAX</span> 65536

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">KERNEL</span>
<span class="enscript-type">int</span> <span class="enscript-function-name">memorystatus_get_level</span>(user_addr_t level);
<span class="enscript-type">int</span> <span class="enscript-function-name">memorystatus_control</span>(uint32_t command, int32_t pid, uint32_t flags, <span class="enscript-type">void</span> *buffer, size_t buffersize);
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/* Commands */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORYSTATUS_CMD_GET_PRIORITY_LIST</span>            1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORYSTATUS_CMD_SET_PRIORITY_PROPERTIES</span>      2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORYSTATUS_CMD_GET_JETSAM_SNAPSHOT</span>          3
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORYSTATUS_CMD_GET_PRESSURE_STATUS</span>          4
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORYSTATUS_CMD_SET_JETSAM_HIGH_WATER_MARK</span>   5    <span class="enscript-comment">/* Set active memory limit = inactive memory limit, both non-fatal	*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORYSTATUS_CMD_SET_JETSAM_TASK_LIMIT</span>	      6    <span class="enscript-comment">/* Set active memory limit = inactive memory limit, both fatal	*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORYSTATUS_CMD_SET_MEMLIMIT_PROPERTIES</span>      7    <span class="enscript-comment">/* Set memory limits plus attributes independently			*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORYSTATUS_CMD_GET_MEMLIMIT_PROPERTIES</span>      8    <span class="enscript-comment">/* Get memory limits plus attributes					*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORYSTATUS_CMD_PRIVILEGED_LISTENER_ENABLE</span>   9    <span class="enscript-comment">/* Set the task's status as a privileged listener w.r.t memory notifications  */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORYSTATUS_CMD_PRIVILEGED_LISTENER_DISABLE</span>  10   <span class="enscript-comment">/* Reset the task's status as a privileged listener w.r.t memory notifications  */</span>
<span class="enscript-comment">/* Commands that act on a group of processes */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORYSTATUS_CMD_GRP_SET_PROPERTIES</span>           100

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">PRIVATE</span>
<span class="enscript-comment">/* Test commands */</span>

<span class="enscript-comment">/* Trigger forced jetsam */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORYSTATUS_CMD_TEST_JETSAM</span>		1000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORYSTATUS_CMD_TEST_JETSAM_SORT</span>	1001

<span class="enscript-comment">/* Panic on jetsam options */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> memorystatus_jetsam_panic_options {
	uint32_t data;
	uint32_t mask;
} memorystatus_jetsam_panic_options_t;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORYSTATUS_CMD_SET_JETSAM_PANIC_BITS</span>        1002

<span class="enscript-comment">/* Select priority band sort order */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_SORT_NOSORT</span>	0
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">JETSAM_SORT_DEFAULT</span>	1

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

<span class="enscript-comment">/*
 * For use with memorystatus_control:
 * MEMORYSTATUS_CMD_GET_JETSAM_SNAPSHOT
 *
 * A jetsam snapshot is initialized when a non-idle
 * jetsam event occurs.  The data is held in the
 * buffer until it is reaped. This is the default
 * behavior.
 *
 * Flags change the default behavior:
 *	Demand mode - this is an on_demand snapshot,
 *	meaning data is populated upon request.
 *
 *	Boot mode - this is a snapshot of
 *	memstats collected before loading the
 *	init program.  Once collected, these
 *	stats do not change.  In this mode,
 *	the snapshot entry_count is always 0.
 *
 * Snapshots are inherently racey between request
 * for buffer size and actual data compilation.
*/</span>

<span class="enscript-comment">/* Flags */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORYSTATUS_SNAPSHOT_ON_DEMAND</span>		0x1	<span class="enscript-comment">/* A populated snapshot buffer is returned on demand */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORYSTATUS_SNAPSHOT_AT_BOOT</span>		0x2	<span class="enscript-comment">/* Returns a snapshot with memstats collected at boot */</span>


<span class="enscript-comment">/*
 * For use with memorystatus_control:
 * MEMORYSTATUS_CMD_SET_PRIORITY_PROPERTIES
 */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> memorystatus_priority_properties {
	int32_t  priority;
	uint64_t user_data;
} memorystatus_priority_properties_t;

<span class="enscript-comment">/*
 * For use with memorystatus_control:
 * MEMORYSTATUS_CMD_SET_MEMLIMIT_PROPERTIES
 * MEMORYSTATUS_CMD_GET_MEMLIMIT_PROPERTIES
 */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> memorystatus_memlimit_properties {
	int32_t memlimit_active;		<span class="enscript-comment">/* jetsam memory limit (in MB) when process is active */</span>
	uint32_t memlimit_active_attr;
	int32_t memlimit_inactive;		<span class="enscript-comment">/* jetsam memory limit (in MB) when process is inactive */</span>
	uint32_t memlimit_inactive_attr;
} memorystatus_memlimit_properties_t;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORYSTATUS_MEMLIMIT_ATTR_FATAL</span>	0x1	<span class="enscript-comment">/* if set, exceeding the memlimit is fatal */</span>


#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>

<span class="enscript-comment">/*
 * A process will be killed immediately if it crosses a memory limit marked as fatal.
 * Fatal limit types are the
 *	- default system-wide task limit
 *	- per-task custom memory limit
 *
 * A process with a non-fatal memory limit can exceed that limit, but becomes an early
 * candidate for jetsam when the device is under memory pressure.
 * Non-fatal limit types are the
 *	- high-water-mark limit
 *
 * P_MEMSTAT_MEMLIMIT_BACKGROUND is translated in posix_spawn as
 *	the fatal system_wide task limit when active
 * 	non-fatal inactive limit based on limit provided.
 *	This is necessary for backward compatibility until the
 * 	the flag can be considered obsolete.
 *
 * Processes that opt into dirty tracking are evaluated
 * based on clean vs dirty state.
 *      dirty ==&gt; active
 *      clean ==&gt; inactive
 *
 * Processes that do not opt into dirty tracking are
 * evalulated based on priority level.
 *      Foreground or above ==&gt; active
 *      Below Foreground    ==&gt; inactive
 */</span>

<span class="enscript-comment">/*
 * p_memstat_state flag holds
 *	- in kernel process state and memlimit state
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">P_MEMSTAT_SUSPENDED</span>            0x00000001
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">P_MEMSTAT_FROZEN</span>               0x00000002
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">P_MEMSTAT_NORECLAIM</span>            0x00000004
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">P_MEMSTAT_ERROR</span>                0x00000008
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">P_MEMSTAT_LOCKED</span>               0x00000010
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">P_MEMSTAT_TERMINATED</span>           0x00000020
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">P_MEMSTAT_NOTFIED</span>              0x00000040
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">P_MEMSTAT_PRIORITYUPDATED</span>      0x00000080
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">P_MEMSTAT_FOREGROUND</span>           0x00000100
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">P_MEMSTAT_DIAG_SUSPENDED</span>       0x00000200
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">P_MEMSTAT_PRIOR_THAW</span>           0x00000400
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">P_MEMSTAT_MEMLIMIT_BACKGROUND</span>  0x00000800 <span class="enscript-comment">/* Task has a memory limit for when it's in the background. Used for a process' &quot;high water mark&quot;.*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">P_MEMSTAT_INTERNAL</span>             0x00001000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">P_MEMSTAT_FATAL_MEMLIMIT</span>                  0x00002000   <span class="enscript-comment">/* current fatal state of the process's memlimit */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">P_MEMSTAT_MEMLIMIT_ACTIVE_FATAL</span>           0x00004000   <span class="enscript-comment">/* if set, exceeding limit is fatal when the process is active   */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">P_MEMSTAT_MEMLIMIT_ACTIVE_EXC_TRIGGERED</span>   0x00008000   <span class="enscript-comment">/* if set, supresses high-water-mark EXC_RESOURCE, allows one hit per active limit */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">P_MEMSTAT_MEMLIMIT_INACTIVE_FATAL</span>         0x00010000   <span class="enscript-comment">/* if set, exceeding limit is fatal when the process is inactive */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">P_MEMSTAT_MEMLIMIT_INACTIVE_EXC_TRIGGERED</span> 0x00020000   <span class="enscript-comment">/* if set, supresses high-water-mark EXC_RESOURCE, allows one hit per inactive limit */</span>

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">memorystatus_init</span>(<span class="enscript-type">void</span>) __attribute__((section(<span class="enscript-string">&quot;__TEXT, initcode&quot;</span>)));

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">memorystatus_init_at_boot_snapshot</span>(<span class="enscript-type">void</span>);

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">memorystatus_add</span>(proc_t p, boolean_t locked);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">memorystatus_update</span>(proc_t p, <span class="enscript-type">int</span> priority, uint64_t user_data, boolean_t effective,
			       boolean_t update_memlimit, int32_t memlimit_active, boolean_t memlimit_active_is_fatal,
			       int32_t memlimit_inactive, boolean_t memlimit_inactive_is_fatal, boolean_t memlimit_background);

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">memorystatus_remove</span>(proc_t p, boolean_t locked);

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">memorystatus_dirty_track</span>(proc_t p, uint32_t pcontrol);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">memorystatus_dirty_set</span>(proc_t p, boolean_t self, uint32_t pcontrol);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">memorystatus_dirty_get</span>(proc_t p);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">memorystatus_dirty_clear</span>(proc_t p, uint32_t pcontrol);

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">memorystatus_on_terminate</span>(proc_t p);

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">memorystatus_on_suspend</span>(proc_t p);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">memorystatus_on_resume</span>(proc_t p);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">memorystatus_on_inactivity</span>(proc_t p);

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">memorystatus_on_pageout_scan_end</span>(<span class="enscript-type">void</span>);

<span class="enscript-comment">/* Memorystatus kevent */</span>

<span class="enscript-type">void</span> <span class="enscript-function-name">memorystatus_kevent_init</span>(lck_grp_t *grp, lck_attr_t *attr);

<span class="enscript-type">int</span> <span class="enscript-function-name">memorystatus_knote_register</span>(<span class="enscript-type">struct</span> knote *kn);
<span class="enscript-type">void</span> <span class="enscript-function-name">memorystatus_knote_unregister</span>(<span class="enscript-type">struct</span> knote *kn);

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">CONFIG_JETSAM</span>

<span class="enscript-type">int</span> <span class="enscript-function-name">memorystatus_get_pressure_status_kdp</span>(<span class="enscript-type">void</span>);

<span class="enscript-type">typedef</span> <span class="enscript-type">enum</span> memorystatus_policy {
	kPolicyDefault        = 0x0, 
	kPolicyMoreFree       = 0x1,
	kPolicyDiagnoseAll    = 0x2,
	kPolicyDiagnoseFirst  = 0x4,
	kPolicyDiagnoseActive = (kPolicyDiagnoseAll | kPolicyDiagnoseFirst),
} memorystatus_policy_t;

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> memorystatus_jetsam_wakeup;
<span class="enscript-type">extern</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> memorystatus_jetsam_running;

boolean_t <span class="enscript-function-name">memorystatus_kill_on_VM_page_shortage</span>(boolean_t async);
boolean_t <span class="enscript-function-name">memorystatus_kill_on_VM_thrashing</span>(boolean_t async);
boolean_t <span class="enscript-function-name">memorystatus_kill_on_FC_thrashing</span>(boolean_t async);
boolean_t <span class="enscript-function-name">memorystatus_kill_on_vnode_limit</span>(<span class="enscript-type">void</span>);

<span class="enscript-type">void</span> <span class="enscript-function-name">memorystatus_on_ledger_footprint_exceeded</span>(<span class="enscript-type">int</span> warning, <span class="enscript-type">const</span> <span class="enscript-type">int</span> max_footprint_mb);
<span class="enscript-type">void</span> <span class="enscript-function-name">proc_memstat_terminated</span>(proc_t p, boolean_t set);
<span class="enscript-type">void</span> <span class="enscript-function-name">jetsam_on_ledger_cpulimit_exceeded</span>(<span class="enscript-type">void</span>);

<span class="enscript-type">void</span> <span class="enscript-function-name">memorystatus_pages_update</span>(<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> pages_avail);

#<span class="enscript-reference">else</span> <span class="enscript-comment">/* CONFIG_JETSAM */</span>

boolean_t <span class="enscript-function-name">memorystatus_idle_exit_from_VM</span>(<span class="enscript-type">void</span>);

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !CONFIG_JETSAM */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">CONFIG_FREEZE</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">FREEZE_PAGES_MIN</span>   ( 1 * 1024 * 1024 / PAGE_SIZE)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">FREEZE_PAGES_MAX</span>   (16 * 1024 * 1024 / PAGE_SIZE)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">FREEZE_SUSPENDED_THRESHOLD_LOW</span>     2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">FREEZE_SUSPENDED_THRESHOLD_DEFAULT</span> 4

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">FREEZE_DAILY_MB_MAX_DEFAULT</span> 	  1024

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> throttle_interval_t {
	uint32_t mins;
	uint32_t burst_multiple;
	uint32_t pageouts;
	uint32_t max_pageouts;
	mach_timespec_t ts;
	boolean_t throttle;
} throttle_interval_t;

<span class="enscript-type">extern</span> boolean_t memorystatus_freeze_enabled;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> memorystatus_freeze_wakeup;

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">memorystatus_freeze_init</span>(<span class="enscript-type">void</span>) __attribute__((section(<span class="enscript-string">&quot;__TEXT, initcode&quot;</span>)));
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>  <span class="enscript-function-name">memorystatus_freeze_process_sync</span>(proc_t p);
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* CONFIG_FREEZE */</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">VM_PRESSURE_EVENTS</span>

<span class="enscript-type">extern</span> kern_return_t <span class="enscript-function-name">memorystatus_update_vm_pressure</span>(boolean_t);

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">CONFIG_MEMORYSTATUS</span>
<span class="enscript-comment">/* Flags */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">memorystatus_low_mem_privileged_listener</span>(uint32_t op_flags);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">memorystatus_send_pressure_note</span>(<span class="enscript-type">int</span> pid);
<span class="enscript-type">extern</span> boolean_t <span class="enscript-function-name">memorystatus_is_foreground_locked</span>(proc_t p);
<span class="enscript-type">extern</span> boolean_t <span class="enscript-function-name">memorystatus_bg_pressure_eligible</span>(proc_t p);
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* CONFIG_MEMORYSTATUS */</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* VM_PRESSURE_EVENTS */</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* SYS_MEMORYSTATUS_H */</span>
</pre>
<hr />
</body></html>