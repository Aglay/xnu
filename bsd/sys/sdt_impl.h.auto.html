<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>sdt_impl.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">sdt_impl.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * CDDL HEADER START
 *
 * The contents of this file are subject to the terms of the
 * Common Development and Distribution License, Version 1.0 only
 * (the &quot;License&quot;).  You may not use this file except in compliance
 * with the License.
 *
 * You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
 * or <a href="http://www.opensolaris.org/os/licensing.">http://www.opensolaris.org/os/licensing.</a>
 * See the License for the specific language governing permissions
 * and limitations under the License.
 *
 * When distributing Covered Code, include this CDDL HEADER in each
 * file and include the License file at usr/src/OPENSOLARIS.LICENSE.
 * If applicable, add the following below this CDDL HEADER, with the
 * fields enclosed by brackets &quot;[]&quot; replaced with your own identifying
 * information: Portions Copyright [yyyy] [name of copyright owner]
 *
 * CDDL HEADER END
 */</span>
<span class="enscript-comment">/*
 * Copyright 2004 Sun Microsystems, Inc.  All rights reserved.
 * Use is subject to license terms.
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_SDT_IMPL_H</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_SDT_IMPL_H</span>

<span class="enscript-comment">/*
 * This file has been created by splitting up the original DTrace sdt.h
 * header. Keep the pragma notice here to allow version tracking.
 */</span>

<span class="enscript-comment">/* #pragma ident	&quot;@(#)sdt.h	1.7	05/06/08 SMI&quot; */</span>

#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">__cplusplus</span>
<span class="enscript-type">extern</span> <span class="enscript-string">&quot;C&quot;</span> {
#<span class="enscript-reference">endif</span>

<span class="enscript-type">extern</span> <span class="enscript-type">const</span> <span class="enscript-type">char</span> *sdt_prefix;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> sdt_probedesc {
	<span class="enscript-type">char</span>			*sdpd_name;	<span class="enscript-comment">/* name of this probe */</span>
	<span class="enscript-type">char</span>			*sdpd_func;	<span class="enscript-comment">/* APPLE NOTE: function name */</span>
	<span class="enscript-type">unsigned</span> <span class="enscript-type">long</span>		sdpd_offset;	<span class="enscript-comment">/* offset of call in text */</span>
	<span class="enscript-type">struct</span> sdt_probedesc	*sdpd_next;	<span class="enscript-comment">/* next static probe */</span>
} sdt_probedesc_t;

#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">__cplusplus</span>
}
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/* #pragma ident	&quot;@(#)sdt_impl.h	1.3	05/06/08 SMI&quot; */</span>

#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">__cplusplus</span>
<span class="enscript-type">extern</span> <span class="enscript-string">&quot;C&quot;</span> {
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/dtrace.h&gt;</span>

<span class="enscript-type">struct</span> module {
	<span class="enscript-type">int</span> sdt_nprobes;
	sdt_probedesc_t *sdt_probes;
};

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sdt_invop</span>(uintptr_t, uintptr_t *, uintptr_t);
<span class="enscript-type">extern</span> uint64_t <span class="enscript-function-name">sdt_getarg</span>(<span class="enscript-type">void</span> *, dtrace_id_t, <span class="enscript-type">void</span> *, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>);

<span class="enscript-type">void</span> <span class="enscript-function-name">sdt_provide_module</span>(<span class="enscript-type">void</span> *, <span class="enscript-type">struct</span> modctl *);
<span class="enscript-type">void</span> <span class="enscript-function-name">sdt_init</span>(<span class="enscript-type">void</span>);

<span class="enscript-type">extern</span> <span class="enscript-type">int</span>          sdt_probetab_size;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>          sdt_probetab_mask;
#<span class="enscript-reference">define</span> <span class="enscript-function-name">SDT_ADDR2NDX</span>(addr)  ((((uintptr_t)(addr)) &gt;&gt; 4) &amp; sdt_probetab_mask)


#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__x86_64__</span>)
<span class="enscript-type">typedef</span> uint8_t sdt_instr_t;
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">error</span> <span class="enscript-variable-name">Unknown</span> <span class="enscript-variable-name">implementation</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> sdt_provider {
	<span class="enscript-type">const</span> <span class="enscript-type">char</span>			*sdtp_name;	<span class="enscript-comment">/* name of provider */</span>
	<span class="enscript-type">const</span> <span class="enscript-type">char</span>			*sdtp_prefix;	<span class="enscript-comment">/* prefix for probe names */</span>
	dtrace_pattr_t		*sdtp_attr;	<span class="enscript-comment">/* stability attributes */</span>
	dtrace_provider_id_t	sdtp_id;	<span class="enscript-comment">/* provider ID */</span>
} sdt_provider_t;

<span class="enscript-type">extern</span> sdt_provider_t sdt_providers[];		<span class="enscript-comment">/* array of providers */</span>

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> sdt_probe {
	sdt_provider_t	*sdp_provider;		<span class="enscript-comment">/* provider */</span>
	<span class="enscript-type">char</span>		*sdp_name;		<span class="enscript-comment">/* name of probe */</span>
	<span class="enscript-type">int</span>		sdp_namelen;		<span class="enscript-comment">/* length of allocated name */</span>
	dtrace_id_t	sdp_id;			<span class="enscript-comment">/* probe ID */</span>
	<span class="enscript-type">struct</span> modctl	*sdp_ctl;		<span class="enscript-comment">/* modctl for module */</span>
	<span class="enscript-type">int</span>		sdp_loadcnt;		<span class="enscript-comment">/* load count for module */</span>
	<span class="enscript-type">int</span>		sdp_primary;		<span class="enscript-comment">/* non-zero if primary mod */</span>
	sdt_instr_t	*sdp_patchpoint;	<span class="enscript-comment">/* patch point */</span>
	sdt_instr_t	sdp_patchval;		<span class="enscript-comment">/* instruction to patch */</span>
	sdt_instr_t	sdp_savedval;		<span class="enscript-comment">/* saved instruction value */</span>
	<span class="enscript-type">struct</span> sdt_probe *sdp_next;		<span class="enscript-comment">/* next probe */</span>
	<span class="enscript-type">struct</span> sdt_probe *sdp_hashnext;		<span class="enscript-comment">/* next on hash */</span>
} sdt_probe_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> sdt_argdesc {
	<span class="enscript-type">const</span> <span class="enscript-type">char</span> *sda_provider;		<span class="enscript-comment">/* provider for arg */</span>
	<span class="enscript-type">const</span> <span class="enscript-type">char</span> *sda_name;			<span class="enscript-comment">/* name of probe */</span>
	<span class="enscript-type">const</span> <span class="enscript-type">int</span> sda_ndx;			<span class="enscript-comment">/* argument index */</span>
	<span class="enscript-type">const</span> <span class="enscript-type">int</span> sda_mapping;			<span class="enscript-comment">/* mapping of argument */</span>
	<span class="enscript-type">const</span> <span class="enscript-type">char</span> *sda_native;			<span class="enscript-comment">/* native type of argument */</span>
	<span class="enscript-type">const</span> <span class="enscript-type">char</span> *sda_xlate;			<span class="enscript-comment">/* translated type of arg */</span>
} sdt_argdesc_t;

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sdt_getargdesc</span>(<span class="enscript-type">void</span> *, dtrace_id_t, <span class="enscript-type">void</span> *, dtrace_argdesc_t *);

#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">__cplusplus</span>
}
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* _SDT_IMPL_H */</span>
</pre>
<hr />
</body></html>