<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>msg.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">msg.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000-2007 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*	$NetBSD: msg.h,v 1.4 1994/06/29 06:44:43 cgd Exp $	*/</span>

<span class="enscript-comment">/*
 * SVID compatible msg.h file
 *
 * Author:  Daniel Boulet
 *
 * Copyright 1993 Daniel Boulet and RTMX Inc.
 *
 * This system call was implemented by Daniel Boulet under contract from RTMX.
 *
 * Redistribution and use in source forms, with and without modification,
 * are permitted provided that this entire comment appears intact.
 *
 * Redistribution in binary form may occur without any restrictions.
 * Obviously, it would be nice if you gave credit where credit is due
 * but requiring it would be too onerous.
 *
 * This software is provided ``AS IS'' without any warranties of any kind.
 */</span>
<span class="enscript-comment">/*
 * NOTICE: This file was modified by SPARTA, Inc. in 2005 to introduce
 * support for mandatory and extensible security protections.  This notice
 * is included in support of clause 2.2 (b) of the Apple Public License,
 * Version 2.0.
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_SYS_MSG_H_</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_SYS_MSG_H_</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/appleapiopts.h&gt;</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/cdefs.h&gt;</span>

<span class="enscript-comment">/*
 * [XSI] All of the symbols from &lt;sys/ipc.h&gt; SHALL be defined when this
 * header is included
 */</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/ipc.h&gt;</span>


<span class="enscript-comment">/*
 * [XSI] The pid_t, time_t, key_t, size_t, and ssize_t types shall be
 * defined as described in &lt;sys/types.h&gt;.
 *
 * NOTE:	The definition of the key_t type is implicit from the
 *		inclusion of &lt;sys/ipc.h&gt;
 */</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types/_pid_t.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types/_time_t.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types/_size_t.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types/_ssize_t.h&gt;</span>

<span class="enscript-comment">/* [XSI] Used for the number of messages in the message queue */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span>		msgqnum_t;

<span class="enscript-comment">/* [XSI] Used for the number of bytes allowed in a message queue */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span>		msglen_t;

<span class="enscript-comment">/*
 * Possible values for the fifth parameter to msgrcv(), in addition to the
 * IPC_NOWAIT flag, which is permitted.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_NOERROR</span>	010000		<span class="enscript-comment">/* [XSI] No error if big message */</span>


<span class="enscript-comment">/*
 * Technically, we should force all code references to the new structure
 * definition, not in just the standards conformance case, and leave the
 * legacy interface there for binary compatibility only.  Currently, we
 * are only forcing this for programs requesting standards conformance.
 */</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">__DARWIN_UNIX03</span> || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">KERNEL</span>)
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">pack</span>(4)
<span class="enscript-comment">/*
 * Structure used internally.
 * 
 * Structure whose address is passed as the third parameter to msgctl()
 * when the second parameter is IPC_SET or IPC_STAT.  In the case of the
 * IPC_SET command, only the msg_perm.{uid|gid|perm} and msg_qbytes are
 * honored.  In the case of IPC_STAT, only the fields indicated as [XSI]
 * mandated fields are guaranteed to meaningful: DO NOT depend on the
 * contents of the other fields.
 *
 * NOTES:	Reserved fields are not preserved across IPC_SET/IPC_STAT.
 */</span>
#<span class="enscript-reference">if</span> (<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) &amp;&amp; !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>))
<span class="enscript-type">struct</span> msqid_ds
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">msqid_ds</span>	__msqid_ds_new
<span class="enscript-type">struct</span> __msqid_ds_new
#<span class="enscript-reference">endif</span>
{
	<span class="enscript-type">struct</span> __ipc_perm_new	msg_perm; <span class="enscript-comment">/* [XSI] msg queue permissions */</span>
	__int32_t	msg_first;	<span class="enscript-comment">/* RESERVED: kernel use only */</span>
	__int32_t	msg_last;	<span class="enscript-comment">/* RESERVED: kernel use only */</span>
	msglen_t	msg_cbytes;	<span class="enscript-comment">/* # of bytes on the queue */</span>
	msgqnum_t	msg_qnum;	<span class="enscript-comment">/* [XSI] number of msgs on the queue */</span>
	msglen_t	msg_qbytes;	<span class="enscript-comment">/* [XSI] max bytes on the queue */</span>
	pid_t		msg_lspid;	<span class="enscript-comment">/* [XSI] pid of last msgsnd() */</span>
	pid_t		msg_lrpid;	<span class="enscript-comment">/* [XSI] pid of last msgrcv() */</span>
	time_t		msg_stime;	<span class="enscript-comment">/* [XSI] time of last msgsnd() */</span>
	__int32_t	msg_pad1;	<span class="enscript-comment">/* RESERVED: DO NOT USE */</span>
	time_t		msg_rtime;	<span class="enscript-comment">/* [XSI] time of last msgrcv() */</span>
	__int32_t	msg_pad2;	<span class="enscript-comment">/* RESERVED: DO NOT USE */</span>
	time_t		msg_ctime;	<span class="enscript-comment">/* [XSI] time of last msgctl() */</span>
	__int32_t	msg_pad3;	<span class="enscript-comment">/* RESERVED: DO NOT USE */</span>
	__int32_t	msg_pad4[4];	<span class="enscript-comment">/* RESERVED: DO NOT USE */</span>
};
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">pack</span>()
#<span class="enscript-reference">else</span>	<span class="enscript-comment">/* !__DARWIN_UNIX03 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">msqid_ds</span>	__msqid_ds_old
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* !__DARWIN_UNIX03 */</span>

#<span class="enscript-reference">if</span> !<span class="enscript-variable-name">__DARWIN_UNIX03</span>
<span class="enscript-type">struct</span> __msqid_ds_old {
	<span class="enscript-type">struct</span> __ipc_perm_old	msg_perm; <span class="enscript-comment">/* [XSI] msg queue permissions */</span>
	__int32_t	msg_first;	<span class="enscript-comment">/* RESERVED: kernel use only */</span>
	__int32_t	msg_last;	<span class="enscript-comment">/* RESERVED: kernel use only */</span>
	msglen_t	msg_cbytes;	<span class="enscript-comment">/* # of bytes on the queue */</span>
	msgqnum_t	msg_qnum;	<span class="enscript-comment">/* [XSI] number of msgs on the queue */</span>
	msglen_t	msg_qbytes;	<span class="enscript-comment">/* [XSI] max bytes on the queue */</span>
	pid_t		msg_lspid;	<span class="enscript-comment">/* [XSI] pid of last msgsnd() */</span>
	pid_t		msg_lrpid;	<span class="enscript-comment">/* [XSI] pid of last msgrcv() */</span>
	time_t		msg_stime;	<span class="enscript-comment">/* [XSI] time of last msgsnd() */</span>
	__int32_t	msg_pad1;	<span class="enscript-comment">/* RESERVED: DO NOT USE */</span>
	time_t		msg_rtime;	<span class="enscript-comment">/* [XSI] time of last msgrcv() */</span>
	__int32_t	msg_pad2;	<span class="enscript-comment">/* RESERVED: DO NOT USE */</span>
	time_t		msg_ctime;	<span class="enscript-comment">/* [XSI] time of last msgctl() */</span>
	__int32_t	msg_pad3;	<span class="enscript-comment">/* RESERVED: DO NOT USE */</span>
	__int32_t	msg_pad4[4];	<span class="enscript-comment">/* RESERVED: DO NOT USE */</span>
};
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* !__DARWIN_UNIX03 */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__APPLE_API_PRIVATE</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;machine/types.h&gt;</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">__DARWIN_ALIGN_NATURAL</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">options</span> <span class="enscript-variable-name">align</span>=<span class="enscript-variable-name">natural</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-type">typedef</span> user_ulong_t	user_msgqnum_t;
<span class="enscript-type">typedef</span> user64_ulong_t	user64_msgqnum_t;
<span class="enscript-type">typedef</span> user32_ulong_t	user32_msgqnum_t;

<span class="enscript-type">typedef</span> user_ulong_t	user_msglen_t;
<span class="enscript-type">typedef</span> user64_ulong_t	user64_msglen_t;
<span class="enscript-type">typedef</span> user32_ulong_t	user32_msglen_t;

<span class="enscript-comment">/* kernel version */</span>
<span class="enscript-type">struct</span> user_msqid_ds {
	<span class="enscript-type">struct</span> ipc_perm	msg_perm;	<span class="enscript-comment">/* [XSI] msg queue permissions */</span>
	<span class="enscript-type">struct</span> msg	*msg_first;	<span class="enscript-comment">/* first message in the queue */</span>
	<span class="enscript-type">struct</span> msg	*msg_last;	<span class="enscript-comment">/* last message in the queue */</span>
	user_msglen_t	msg_cbytes;	<span class="enscript-comment">/* # of bytes on the queue */</span>
	user_msgqnum_t	msg_qnum;	<span class="enscript-comment">/* [XSI] number of msgs on the queue */</span>
	user_msglen_t	msg_qbytes;	<span class="enscript-comment">/* [XSI] max bytes on the queue */</span>
	pid_t		msg_lspid;	<span class="enscript-comment">/* [XSI] pid of last msgsnd() */</span>
	pid_t		msg_lrpid;	<span class="enscript-comment">/* [XSI] pid of last msgrcv() */</span>
	user_time_t	msg_stime;	<span class="enscript-comment">/* [XSI] time of last msgsnd() */</span>
	__int32_t	msg_pad1;	<span class="enscript-comment">/* RESERVED: DO NOT USE */</span>
	user_time_t	msg_rtime;	<span class="enscript-comment">/* [XSI] time of last msgrcv() */</span>
	__int32_t	msg_pad2;	<span class="enscript-comment">/* RESERVED: DO NOT USE */</span>
	user_time_t	msg_ctime;	<span class="enscript-comment">/* [XSI] time of last msgctl() */</span>
	__int32_t	msg_pad3;	<span class="enscript-comment">/* RESERVED: DO NOT USE */</span>
	__int32_t	msg_pad4[4];
};

<span class="enscript-comment">/*
 * user64 version - this structure only has to be correct if
 * compiled LP64, because the 32 bit kernel doesn't need it
 */</span>
<span class="enscript-type">struct</span> user64_msqid_ds {
	<span class="enscript-type">struct</span> ipc_perm	msg_perm;	<span class="enscript-comment">/* [XSI] msg queue permissions */</span>
	__int32_t	msg_first;	<span class="enscript-comment">/* RESERVED: kernel use only */</span>
	__int32_t	msg_last;	<span class="enscript-comment">/* RESERVED: kernel use only */</span>
	user64_msglen_t	msg_cbytes;	<span class="enscript-comment">/* # of bytes on the queue */</span>
	user64_msgqnum_t	msg_qnum;	<span class="enscript-comment">/* [XSI] number of msgs on the queue */</span>
	user64_msglen_t	msg_qbytes;	<span class="enscript-comment">/* [XSI] max bytes on the queue */</span>
	pid_t		msg_lspid;	<span class="enscript-comment">/* [XSI] pid of last msgsnd() */</span>
	pid_t		msg_lrpid;	<span class="enscript-comment">/* [XSI] pid of last msgrcv() */</span>
	user64_time_t	msg_stime;	<span class="enscript-comment">/* [XSI] time of last msgsnd() */</span>
	__int32_t	msg_pad1;	<span class="enscript-comment">/* RESERVED: DO NOT USE */</span>
	user64_time_t	msg_rtime;	<span class="enscript-comment">/* [XSI] time of last msgrcv() */</span>
	__int32_t	msg_pad2;	<span class="enscript-comment">/* RESERVED: DO NOT USE */</span>
	user64_time_t	msg_ctime;	<span class="enscript-comment">/* [XSI] time of last msgctl() */</span>
	__int32_t	msg_pad3;	<span class="enscript-comment">/* RESERVED: DO NOT USE */</span>
	__int32_t	msg_pad4[4];
} __attribute__((__packed__));

<span class="enscript-type">struct</span> user32_msqid_ds
{
	<span class="enscript-type">struct</span> __ipc_perm_new	msg_perm; <span class="enscript-comment">/* [XSI] msg queue permissions */</span>
	__int32_t	msg_first;	<span class="enscript-comment">/* RESERVED: kernel use only */</span>
	__int32_t	msg_last;	<span class="enscript-comment">/* RESERVED: kernel use only */</span>
	user32_msglen_t	msg_cbytes;	<span class="enscript-comment">/* # of bytes on the queue */</span>
	user32_msgqnum_t	msg_qnum;	<span class="enscript-comment">/* [XSI] number of msgs on the queue */</span>
	user32_msglen_t	msg_qbytes;	<span class="enscript-comment">/* [XSI] max bytes on the queue */</span>
	pid_t		msg_lspid;	<span class="enscript-comment">/* [XSI] pid of last msgsnd() */</span>
	pid_t		msg_lrpid;	<span class="enscript-comment">/* [XSI] pid of last msgrcv() */</span>
	user32_time_t		msg_stime;	<span class="enscript-comment">/* [XSI] time of last msgsnd() */</span>
	__int32_t	msg_pad1;	<span class="enscript-comment">/* RESERVED: DO NOT USE */</span>
	user32_time_t		msg_rtime;	<span class="enscript-comment">/* [XSI] time of last msgrcv() */</span>
	__int32_t	msg_pad2;	<span class="enscript-comment">/* RESERVED: DO NOT USE */</span>
	user32_time_t		msg_ctime;	<span class="enscript-comment">/* [XSI] time of last msgctl() */</span>
	__int32_t	msg_pad3;	<span class="enscript-comment">/* RESERVED: DO NOT USE */</span>
	__int32_t	msg_pad4[4];	<span class="enscript-comment">/* RESERVED: DO NOT USE */</span>
};

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">__DARWIN_ALIGN_NATURAL</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">options</span> <span class="enscript-variable-name">align</span>=<span class="enscript-variable-name">reset</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-type">struct</span> label;

<span class="enscript-comment">/*
 * Kernel wrapper for the user-level structure
 */</span>
<span class="enscript-type">struct</span> msqid_kernel {
	<span class="enscript-type">struct</span>	user_msqid_ds u;
	<span class="enscript-type">struct</span>	label *label;	<span class="enscript-comment">/* MAC framework label */</span>
};

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* __APPLE_API_PRIVATE */</span>
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* KERNEL */</span>


#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__APPLE_API_UNSTABLE</span>
<span class="enscript-comment">/* XXX kernel only; protect with macro later */</span>

<span class="enscript-type">struct</span> msg {
	<span class="enscript-type">struct</span> msg	*msg_next;	<span class="enscript-comment">/* next msg in the chain */</span>
	<span class="enscript-type">long</span>		msg_type;	<span class="enscript-comment">/* type of this message */</span>
    					<span class="enscript-comment">/* &gt;0 -&gt; type of this message */</span>
    					<span class="enscript-comment">/* 0 -&gt; free header */</span>
	<span class="enscript-type">unsigned</span> <span class="enscript-type">short</span>	msg_ts;		<span class="enscript-comment">/* size of this message */</span>
	<span class="enscript-type">short</span>		msg_spot;	<span class="enscript-comment">/* location of msg start in buffer */</span>
	<span class="enscript-type">struct</span> label	*label;		<span class="enscript-comment">/* MAC label */</span>
};

<span class="enscript-comment">/*
 * Example structure describing a message whose address is to be passed as
 * the second argument to the functions msgrcv() and msgsnd().  The only
 * actual hard requirement is that the first field be of type long, and
 * contain the message type.  The user is encouraged to define their own
 * application specific structure; this definition is included solely for
 * backward compatability with existing source code.
 */</span>
<span class="enscript-type">struct</span> mymsg {
	<span class="enscript-type">long</span>	mtype;		<span class="enscript-comment">/* message type (+ve integer) */</span>
	<span class="enscript-type">char</span>	mtext[1];	<span class="enscript-comment">/* message body */</span>
};

<span class="enscript-comment">/*
 * Based on the configuration parameters described in an SVR2 (yes, two)
 * config(1m) man page.
 *
 * Each message is broken up and stored in segments that are msgssz bytes
 * long.  For efficiency reasons, this should be a power of two.  Also,
 * it doesn't make sense if it is less than 8 or greater than about 256.
 * Consequently, msginit in kern/sysv_msg.c checks that msgssz is a power of
 * two between 8 and 1024 inclusive (and panic's if it isn't).
 */</span>
<span class="enscript-type">struct</span> msginfo {
	<span class="enscript-type">int</span>	msgmax,		<span class="enscript-comment">/* max chars in a message */</span>
		msgmni,		<span class="enscript-comment">/* max message queue identifiers */</span>
		msgmnb,		<span class="enscript-comment">/* max chars in a queue */</span>
		msgtql,		<span class="enscript-comment">/* max messages in system */</span>
		msgssz,		<span class="enscript-comment">/* size of a message segment (see notes above) */</span>
		msgseg;		<span class="enscript-comment">/* number of message segments */</span>
};
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> msginfo	msginfo;

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">MSGSSZ</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSGSSZ</span>	8		<span class="enscript-comment">/* Each segment must be 2^N long */</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">MSGSEG</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSGSEG</span>	2048		<span class="enscript-comment">/* must be less than 32767 */</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSGMAX</span>	(MSGSSZ*MSGSEG)
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">MSGMNB</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSGMNB</span>	2048		<span class="enscript-comment">/* max # of bytes in a queue */</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">MSGMNI</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSGMNI</span>	40
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">MSGTQL</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSGTQL</span>	40
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*
 * macros to convert between msqid_ds's and msqid's.
 * (specific to this implementation)
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">MSQID</span>(ix,ds)	((ix) &amp; 0xffff | (((ds).msg_perm.seq &lt;&lt; 16) &amp; 0xffff0000))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">MSQID_IX</span>(id)	((id) &amp; 0xffff)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">MSQID_SEQ</span>(id)	(((id) &gt;&gt; 16) &amp; 0xffff)

<span class="enscript-comment">/*
 * The rest of this file is specific to this particular implementation.
 */</span>


<span class="enscript-comment">/*
 * Stuff allocated in machdep.h
 */</span>
<span class="enscript-type">struct</span> msgmap {
	<span class="enscript-type">short</span>	next;		<span class="enscript-comment">/* next segment in buffer */</span>
    				<span class="enscript-comment">/* -1 -&gt; available */</span>
    				<span class="enscript-comment">/* 0..(MSGSEG-1) -&gt; index of next segment */</span>
};

<span class="enscript-comment">/* The following four externs really, really need to die; should be static */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">char</span> *msgpool;		<span class="enscript-comment">/* MSGMAX byte long msg buffer pool */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> msgmap *msgmaps;	<span class="enscript-comment">/* MSGSEG msgmap structures */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> msg *msghdrs;	<span class="enscript-comment">/* MSGTQL msg headers */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> msqid_kernel *msqids;	<span class="enscript-comment">/* MSGMNI user_msqid_ds struct's */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSG_LOCKED</span>	01000	<span class="enscript-comment">/* Is this msqid_ds locked? */</span>

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* KERNEL */</span>
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* __APPLE_API_UNSTABLE */</span>
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE) */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">KERNEL</span>

__BEGIN_DECLS
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_POSIX_C_SOURCE</span>) || <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_DARWIN_C_SOURCE</span>)
<span class="enscript-type">int</span> <span class="enscript-function-name">msgsys</span>(<span class="enscript-type">int</span>, ...);
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* (!_POSIX_C_SOURCE || _DARWIN_C_SOURCE) */</span>
<span class="enscript-type">int</span> <span class="enscript-function-name">msgctl</span>(<span class="enscript-type">int</span>, <span class="enscript-type">int</span>, <span class="enscript-type">struct</span> msqid_ds *) __DARWIN_ALIAS(msgctl);
<span class="enscript-type">int</span> <span class="enscript-function-name">msgget</span>(key_t, <span class="enscript-type">int</span>);
ssize_t <span class="enscript-function-name">msgrcv</span>(<span class="enscript-type">int</span>, <span class="enscript-type">void</span> *, size_t, <span class="enscript-type">long</span>, <span class="enscript-type">int</span>) __DARWIN_ALIAS_C(msgrcv);
<span class="enscript-type">int</span> <span class="enscript-function-name">msgsnd</span>(<span class="enscript-type">int</span>, <span class="enscript-type">const</span> <span class="enscript-type">void</span> *, size_t, <span class="enscript-type">int</span>) __DARWIN_ALIAS_C(msgsnd);
__END_DECLS

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !KERNEL */</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !_SYS_MSG_H_ */</span>


</pre>
<hr />
</body></html>