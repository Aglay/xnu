<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>event.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">event.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2003-2015 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*-
 * Copyright (c) 1999,2000,2001 Jonathan Lemon &lt;<a href="mailto:jlemon@FreeBSD.org">jlemon@FreeBSD.org</a>&gt;
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *	$FreeBSD: src/sys/sys/event.h,v 1.5.2.5 2001/12/14 19:21:22 jlemon Exp $
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_SYS_EVENT_H_</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_SYS_EVENT_H_</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;machine/types.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/cdefs.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;stdint.h&gt;</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EVFILT_READ</span>		(-1)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EVFILT_WRITE</span>		(-2)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EVFILT_AIO</span>		(-3)	<span class="enscript-comment">/* attached to aio requests */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EVFILT_VNODE</span>		(-4)	<span class="enscript-comment">/* attached to vnodes */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EVFILT_PROC</span>		(-5)	<span class="enscript-comment">/* attached to struct proc */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EVFILT_SIGNAL</span>		(-6)	<span class="enscript-comment">/* attached to struct proc */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EVFILT_TIMER</span>		(-7)	<span class="enscript-comment">/* timers */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EVFILT_MACHPORT</span>         (-8)	<span class="enscript-comment">/* Mach portsets */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EVFILT_FS</span>		(-9)	<span class="enscript-comment">/* Filesystem events */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EVFILT_USER</span>             (-10)   <span class="enscript-comment">/* User events */</span>
					<span class="enscript-comment">/* (-11) unused */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EVFILT_VM</span>		(-12)	<span class="enscript-comment">/* Virtual memory events */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EVFILT_SOCK</span>		(-13)	<span class="enscript-comment">/* Socket events */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EVFILT_MEMORYSTATUS</span>	(-14)	<span class="enscript-comment">/* Memorystatus events */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EVFILT_SYSCOUNT</span>		14
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EVFILT_THREADMARKER</span>	EVFILT_SYSCOUNT <span class="enscript-comment">/* Internal use only */</span>

#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">pack</span>(4)

<span class="enscript-type">struct</span> kevent {
	uintptr_t	ident;		<span class="enscript-comment">/* identifier for this event */</span>
	int16_t		filter;		<span class="enscript-comment">/* filter for event */</span>
	uint16_t	flags;		<span class="enscript-comment">/* general flags */</span>
	uint32_t	fflags;		<span class="enscript-comment">/* filter-specific flags */</span>
	intptr_t	data;		<span class="enscript-comment">/* filter-specific data */</span>
	<span class="enscript-type">void</span>		*udata;		<span class="enscript-comment">/* opaque user data identifier */</span>
};

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL_PRIVATE</span>

<span class="enscript-type">struct</span> user64_kevent {
	uint64_t	ident;		<span class="enscript-comment">/* identifier for this event */</span>
	int16_t		filter;		<span class="enscript-comment">/* filter for event */</span>
	uint16_t	flags;		<span class="enscript-comment">/* general flags */</span>
	uint32_t	fflags;		<span class="enscript-comment">/* filter-specific flags */</span>
	int64_t		data;		<span class="enscript-comment">/* filter-specific data */</span>
	user_addr_t	udata;		<span class="enscript-comment">/* opaque user data identifier */</span>
};

<span class="enscript-type">struct</span> user32_kevent {
	uint32_t	ident;		<span class="enscript-comment">/* identifier for this event */</span>
	int16_t		filter;		<span class="enscript-comment">/* filter for event */</span>
	uint16_t	flags;		<span class="enscript-comment">/* general flags */</span>
	uint32_t	fflags;		<span class="enscript-comment">/* filter-specific flags */</span>
	int32_t		data;		<span class="enscript-comment">/* filter-specific data */</span>
	user32_addr_t	udata;		<span class="enscript-comment">/* opaque user data identifier */</span>
};

<span class="enscript-type">struct</span> kevent_internal_s {
	uint64_t        ident;          <span class="enscript-comment">/* identifier for this event */</span>
	int16_t         filter;         <span class="enscript-comment">/* filter for event */</span>
	uint16_t        flags;          <span class="enscript-comment">/* general flags */</span>
	uint32_t        fflags;         <span class="enscript-comment">/* filter-specific flags */</span>
	int64_t         data;           <span class="enscript-comment">/* filter-specific data */</span>
	uint64_t        udata;          <span class="enscript-comment">/* opaque user data identifier */</span>
	uint64_t        ext[2];         <span class="enscript-comment">/* filter-specific extensions */</span>
};

#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">pack</span>()

<span class="enscript-type">struct</span> kevent64_s {
	uint64_t	ident;		<span class="enscript-comment">/* identifier for this event */</span>
	int16_t		filter;		<span class="enscript-comment">/* filter for event */</span>
	uint16_t	flags;		<span class="enscript-comment">/* general flags */</span>
	uint32_t	fflags;		<span class="enscript-comment">/* filter-specific flags */</span>
	int64_t		data;		<span class="enscript-comment">/* filter-specific data */</span>
	uint64_t	udata;		<span class="enscript-comment">/* opaque user data identifier */</span>
	uint64_t	ext[2];		<span class="enscript-comment">/* filter-specific extensions */</span>
};

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
<span class="enscript-type">struct</span> kevent_qos_s {
	uint64_t	ident;		<span class="enscript-comment">/* identifier for this event */</span>
	int16_t		filter;		<span class="enscript-comment">/* filter for event */</span>
	uint16_t	flags;		<span class="enscript-comment">/* general flags */</span>
	int32_t		qos;		<span class="enscript-comment">/* quality of service */</span>
	uint64_t	udata;		<span class="enscript-comment">/* opaque user data identifier */</span>
	uint32_t	fflags;		<span class="enscript-comment">/* filter-specific flags */</span>
	uint32_t	xflags;		<span class="enscript-comment">/* extra filter-specific flags */</span>
	int64_t		data;		<span class="enscript-comment">/* filter-specific data */</span>
	uint64_t	ext[4];		<span class="enscript-comment">/* filter-specific extensions */</span>
};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">EV_SET</span>(kevp, a, b, c, d, e, f) do {	\
	<span class="enscript-type">struct</span> kevent *__kevp__ = (kevp);	\
	__kevp__-&gt;ident = (a);			\
	__kevp__-&gt;filter = (b);			\
	__kevp__-&gt;flags = (c);			\
	__kevp__-&gt;fflags = (d);			\
	__kevp__-&gt;data = (e);			\
	__kevp__-&gt;udata = (f);			\
} <span class="enscript-keyword">while</span>(0)

#<span class="enscript-reference">define</span> <span class="enscript-function-name">EV_SET64</span>(kevp, a, b, c, d, e, f, g, h) do {	\
	<span class="enscript-type">struct</span> kevent64_s *__kevp__ = (kevp);		\
	__kevp__-&gt;ident = (a);				\
	__kevp__-&gt;filter = (b);				\
	__kevp__-&gt;flags = (c);				\
	__kevp__-&gt;fflags = (d);				\
	__kevp__-&gt;data = (e);				\
	__kevp__-&gt;udata = (f);				\
	__kevp__-&gt;ext[0] = (g);				\
	__kevp__-&gt;ext[1] = (h);				\
} <span class="enscript-keyword">while</span>(0)


<span class="enscript-comment">/* kevent system call flags */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KEVENT_FLAG_NONE</span>		0x00	<span class="enscript-comment">/* no flag value */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KEVENT_FLAG_IMMEDIATE</span>		0x01	<span class="enscript-comment">/* immediate timeout */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KEVENT_FLAG_ERROR_EVENTS</span>	0x02	<span class="enscript-comment">/* output events only include change errors */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EV_SET_QOS</span> 0
<span class="enscript-comment">/*
 * Rather than provide an EV_SET_QOS macro for kevent_qos_t structure
 * initialization, we encourage use of named field initialization support
 * instead.
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KEVENT_FLAG_STACK_EVENTS</span>	0x04	<span class="enscript-comment">/* output events treated as stack (grows down) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KEVENT_FLAG_STACK_DATA</span>		0x08	<span class="enscript-comment">/* output data allocated as stack (grows down) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KEVENT_FLAG_WORKQ</span>               0x20	<span class="enscript-comment">/* interact with the default workq kq */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KEVENT_FLAG_LEGACY32</span>            0x40	<span class="enscript-comment">/* event data in legacy 32-bit format */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KEVENT_FLAG_LEGACY64</span>            0x80	<span class="enscript-comment">/* event data in legacy 64-bit format */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KEVENT_FLAG_USER</span>	(KEVENT_FLAG_IMMEDIATE | KEVENT_FLAG_ERROR_EVENTS | \
				 KEVENT_FLAG_STACK_EVENTS | KEVENT_FLAG_STACK_DATA | \
				 KEVENT_FLAG_WORKQ)
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

<span class="enscript-comment">/* actions */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EV_ADD</span>			0x0001		<span class="enscript-comment">/* add event to kq (implies enable) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EV_DELETE</span>		0x0002		<span class="enscript-comment">/* delete event from kq */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EV_ENABLE</span>		0x0004		<span class="enscript-comment">/* enable event */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EV_DISABLE</span>		0x0008		<span class="enscript-comment">/* disable event (not reported) */</span>

<span class="enscript-comment">/* flags */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EV_ONESHOT</span>		0x0010		<span class="enscript-comment">/* only report one occurrence */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EV_CLEAR</span>		0x0020		<span class="enscript-comment">/* clear event state after reporting */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EV_RECEIPT</span>		0x0040		<span class="enscript-comment">/* force EV_ERROR on success, data == 0 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EV_DISPATCH</span>     0x0080      <span class="enscript-comment">/* disable event after reporting */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EV_UDATA_SPECIFIC</span>	0x0100          <span class="enscript-comment">/* unique kevent per udata value */</span>
                                            <span class="enscript-comment">/* ... in combination with EV_DELETE */</span>
                                            <span class="enscript-comment">/* will defer delete until udata-specific */</span>
                                            <span class="enscript-comment">/* event enabled. EINPROGRESS will be */</span>
                                            <span class="enscript-comment">/* returned to indicate the deferral */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EV_DISPATCH2</span>		(EV_DISPATCH | EV_UDATA_SPECIFIC)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EV_SYSFLAGS</span>		0xF000		<span class="enscript-comment">/* reserved by system */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EV_FLAG0</span>		0x1000		<span class="enscript-comment">/* filter-specific flag */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EV_FLAG1</span>		0x2000		<span class="enscript-comment">/* filter-specific flag */</span>

<span class="enscript-comment">/* returned values */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EV_EOF</span>			0x8000		<span class="enscript-comment">/* EOF detected */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EV_ERROR</span>		0x4000		<span class="enscript-comment">/* error, data contains errno */</span>

<span class="enscript-comment">/*
 * Filter specific flags for EVFILT_READ
 *
 * The default behavior for EVFILT_READ is to make the &quot;read&quot; determination
 * relative to the current file descriptor read pointer. 
 *
 * The EV_POLL flag indicates the determination should be made via poll(2)
 * semantics. These semantics dictate always returning true for regular files,
 * regardless of the amount of unread data in the file.  
 *
 * On input, EV_OOBAND specifies that filter should actively return in the
 * presence of OOB on the descriptor. It implies that filter will return
 * if there is OOB data available to read OR when any other condition
 * for the read are met (for example number of bytes regular data becomes &gt;=
 * low-watermark).
 * If EV_OOBAND is not set on input, it implies that the filter should not actively
 * return for out of band data on the descriptor. The filter will then only return
 * when some other condition for read is met (ex: when number of regular data bytes
 * &gt;=low-watermark OR when socket can't receive more data (SS_CANTRCVMORE)).
 *
 * On output, EV_OOBAND indicates the presence of OOB data on the descriptor.
 * If it was not specified as an input parameter, then the data count is the
 * number of bytes before the current OOB marker, else data count is the number
 * of bytes beyond OOB marker.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EV_POLL</span>		EV_FLAG0
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EV_OOBAND</span>	EV_FLAG1

<span class="enscript-comment">/*
 * data/hint fflags for EVFILT_USER, shared with userspace
 */</span>

<span class="enscript-comment">/*
 * On input, NOTE_TRIGGER causes the event to be triggered for output.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_TRIGGER</span>	0x01000000

<span class="enscript-comment">/*
 * On input, the top two bits of fflags specifies how the lower twenty four 
 * bits should be applied to the stored value of fflags.
 *
 * On output, the top two bits will always be set to NOTE_FFNOP and the
 * remaining twenty four bits will contain the stored fflags value.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_FFNOP</span>      0x00000000              <span class="enscript-comment">/* ignore input fflags */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_FFAND</span>      0x40000000              <span class="enscript-comment">/* and fflags */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_FFOR</span>       0x80000000              <span class="enscript-comment">/* or fflags */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_FFCOPY</span>     0xc0000000              <span class="enscript-comment">/* copy fflags */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_FFCTRLMASK</span> 0xc0000000              <span class="enscript-comment">/* mask for operations */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_FFLAGSMASK</span>	0x00ffffff 

<span class="enscript-comment">/*
 * data/hint fflags for EVFILT_{READ|WRITE}, shared with userspace
 *
 * The default behavior for EVFILT_READ is to make the determination
 * realtive to the current file descriptor read pointer.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_LOWAT</span>	0x00000001		<span class="enscript-comment">/* low water mark */</span>

<span class="enscript-comment">/*
 * data/hint fflags for EVFILT_VNODE, shared with userspace
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_DELETE</span>	0x00000001		<span class="enscript-comment">/* vnode was removed */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_WRITE</span>	0x00000002		<span class="enscript-comment">/* data contents changed */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_EXTEND</span>	0x00000004		<span class="enscript-comment">/* size increased */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_ATTRIB</span>	0x00000008		<span class="enscript-comment">/* attributes changed */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_LINK</span>	0x00000010		<span class="enscript-comment">/* link count changed */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_RENAME</span>	0x00000020		<span class="enscript-comment">/* vnode was renamed */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_REVOKE</span>	0x00000040		<span class="enscript-comment">/* vnode access was revoked */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_NONE</span>	0x00000080		<span class="enscript-comment">/* No specific vnode event: to test for EVFILT_READ activation*/</span>

<span class="enscript-comment">/*
 * data/hint fflags for EVFILT_PROC, shared with userspace
 *
 * Please note that EVFILT_PROC and EVFILT_SIGNAL share the same knote list
 * that hangs off the proc structure. They also both play games with the hint
 * passed to KNOTE(). If NOTE_SIGNAL is passed as a hint, then the lower bits
 * of the hint contain the signal. IF NOTE_FORK is passed, then the lower bits
 * contain the PID of the child (but the pid does not get passed through in
 * the actual kevent).
 */</span>
<span class="enscript-type">enum</span> {
	eNoteReapDeprecated __deprecated_enum_msg(<span class="enscript-string">&quot;This kqueue(2) EVFILT_PROC flag is deprecated&quot;</span>) = 0x10000000
};

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_EXIT</span>		0x80000000	<span class="enscript-comment">/* process exited */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_FORK</span>		0x40000000	<span class="enscript-comment">/* process forked */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_EXEC</span>		0x20000000	<span class="enscript-comment">/* process exec'd */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_REAP</span>		((unsigned int)eNoteReapDeprecated <span class="enscript-comment">/* 0x10000000 */</span>)	<span class="enscript-comment">/* process reaped */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_SIGNAL</span>		0x08000000	<span class="enscript-comment">/* shared with EVFILT_SIGNAL */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_EXITSTATUS</span>		0x04000000	<span class="enscript-comment">/* exit status to be returned, valid for child process only */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_EXIT_DETAIL</span>	0x02000000	<span class="enscript-comment">/* provide details on reasons for exit */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_PDATAMASK</span>	0x000fffff		<span class="enscript-comment">/* mask for signal &amp; exit status */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_PCTRLMASK</span>	(~NOTE_PDATAMASK)

<span class="enscript-comment">/*
 * If NOTE_EXITSTATUS is present, provide additional info about exiting process.
 */</span>
<span class="enscript-type">enum</span> {
	eNoteExitReparentedDeprecated __deprecated_enum_msg(<span class="enscript-string">&quot;This kqueue(2) EVFILT_PROC flag is no longer sent&quot;</span>) = 0x00080000 
};
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_EXIT_REPARENTED</span>	((unsigned int)eNoteExitReparentedDeprecated)	<span class="enscript-comment">/* exited while reparented */</span>

<span class="enscript-comment">/*
 * If NOTE_EXIT_DETAIL is present, these bits indicate specific reasons for exiting.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_EXIT_DETAIL_MASK</span>		0x00070000
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_EXIT_DECRYPTFAIL</span>		0x00010000 
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_EXIT_MEMORY</span>		0x00020000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_EXIT_CSERROR</span>		0x00040000

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>

<span class="enscript-comment">/*
 * If NOTE_EXIT_MEMORY is present, these bits indicate specific jetsam condition.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_EXIT_MEMORY_DETAIL_MASK</span>	0xfe000000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_EXIT_MEMORY_VMPAGESHORTAGE</span>	0x80000000	<span class="enscript-comment">/* jetsam condition: lowest jetsam priority proc killed due to vm page shortage */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_EXIT_MEMORY_VMTHRASHING</span>	0x40000000	<span class="enscript-comment">/* jetsam condition: lowest jetsam priority proc killed due to vm thrashing */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_EXIT_MEMORY_HIWAT</span>		0x20000000	<span class="enscript-comment">/* jetsam condition: process reached its high water mark */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_EXIT_MEMORY_PID</span>		0x10000000	<span class="enscript-comment">/* jetsam condition: special pid kill requested */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_EXIT_MEMORY_IDLE</span>		0x08000000	<span class="enscript-comment">/* jetsam condition: idle process cleaned up */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_EXIT_MEMORY_VNODE</span>		0X04000000	<span class="enscript-comment">/* jetsam condition: virtual node kill */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_EXIT_MEMORY_FCTHRASHING</span>	0x02000000	<span class="enscript-comment">/* jetsam condition: lowest jetsam priority proc killed due to filecache thrashing */</span>

#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*
 * data/hint fflags for EVFILT_VM, shared with userspace.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_VM_PRESSURE</span>			0x80000000              <span class="enscript-comment">/* will react on memory pressure */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_VM_PRESSURE_TERMINATE</span>		0x40000000              <span class="enscript-comment">/* will quit on memory pressure, possibly after cleaning up dirty state */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_VM_PRESSURE_SUDDEN_TERMINATE</span>	0x20000000		<span class="enscript-comment">/* will quit immediately on memory pressure */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_VM_ERROR</span>				0x10000000              <span class="enscript-comment">/* there was an error */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>

<span class="enscript-comment">/*
 * data/hint fflags for EVFILT_MEMORYSTATUS, shared with userspace.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_MEMORYSTATUS_PRESSURE_NORMAL</span>	0x00000001	<span class="enscript-comment">/* system memory pressure has returned to normal */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_MEMORYSTATUS_PRESSURE_WARN</span>		0x00000002	<span class="enscript-comment">/* system memory pressure has changed to the warning state */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_MEMORYSTATUS_PRESSURE_CRITICAL</span>	0x00000004	<span class="enscript-comment">/* system memory pressure has changed to the critical state */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_MEMORYSTATUS_LOW_SWAP</span>		0x00000008	<span class="enscript-comment">/* system is in a low-swap state */</span>

<span class="enscript-type">typedef</span> <span class="enscript-type">enum</span> vm_pressure_level {
        kVMPressureNormal   = 0,
        kVMPressureWarning  = 1,
        kVMPressureUrgent   = 2,
        kVMPressureCritical = 3,
} vm_pressure_level_t;

#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*
 * data/hint fflags for EVFILT_TIMER, shared with userspace.
 * The default is a (repeating) interval timer with the data
 * specifying the timeout interval in milliseconds.
 *
 * All timeouts are implicitly EV_CLEAR events.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_SECONDS</span>	0x00000001		<span class="enscript-comment">/* data is seconds         */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_USECONDS</span>	0x00000002		<span class="enscript-comment">/* data is microseconds    */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_NSECONDS</span>	0x00000004		<span class="enscript-comment">/* data is nanoseconds     */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_ABSOLUTE</span>	0x00000008		<span class="enscript-comment">/* absolute timeout        */</span>
						<span class="enscript-comment">/* ... implicit EV_ONESHOT */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_LEEWAY</span>	0x00000010		<span class="enscript-comment">/* ext[1] holds leeway for power aware timers */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_CRITICAL</span>	0x00000020		<span class="enscript-comment">/* system does minimal timer coalescing */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_BACKGROUND</span>	0x00000040		<span class="enscript-comment">/* system does maximum timer coalescing */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
<span class="enscript-comment">/*
 * data/hint fflags for EVFILT_SOCK, shared with userspace.
 *
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_CONNRESET</span>		0x00000001 <span class="enscript-comment">/* Received RST */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_READCLOSED</span>		0x00000002 <span class="enscript-comment">/* Read side is shutdown */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_WRITECLOSED</span>	0x00000004 <span class="enscript-comment">/* Write side is shutdown */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_TIMEOUT</span>		0x00000008 <span class="enscript-comment">/* timeout: rexmt, keep-alive or persist */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_NOSRCADDR</span>		0x00000010 <span class="enscript-comment">/* source address not available */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_IFDENIED</span>		0x00000020 <span class="enscript-comment">/* interface denied connection */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_SUSPEND</span>		0x00000040 <span class="enscript-comment">/* output queue suspended */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_RESUME</span>		0x00000080 <span class="enscript-comment">/* output queue resumed */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_KEEPALIVE</span>		0x00000100 <span class="enscript-comment">/* TCP Keepalive received */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_ADAPTIVE_WTIMO</span>	0x00000200 <span class="enscript-comment">/* TCP adaptive write timeout */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NOTE_ADAPTIVE_RTIMO</span>	0x00000400 <span class="enscript-comment">/* TCP adaptive read timeout */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_CONNECTED</span>		0x00000800 <span class="enscript-comment">/* socket is connected */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_DISCONNECTED</span>	0x00001000 <span class="enscript-comment">/* socket is disconnected */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_CONNINFO_UPDATED</span>	0x00002000 <span class="enscript-comment">/* connection info was updated */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">EVFILT_SOCK_LEVEL_TRIGGER_MASK</span> \
    (NOTE_READCLOSED | NOTE_WRITECLOSED | NOTE_SUSPEND | NOTE_RESUME | NOTE_CONNECTED | NOTE_DISCONNECTED)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EVFILT_SOCK_ALL_MASK</span> \
    (NOTE_CONNRESET | NOTE_READCLOSED | NOTE_WRITECLOSED | NOTE_TIMEOUT | NOTE_NOSRCADDR | NOTE_IFDENIED | NOTE_SUSPEND | NOTE_RESUME | NOTE_KEEPALIVE | NOTE_ADAPTIVE_WTIMO | NOTE_ADAPTIVE_RTIMO | NOTE_CONNECTED | NOTE_DISCONNECTED | NOTE_CONNINFO_UPDATED)

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

<span class="enscript-comment">/*
 * data/hint fflags for EVFILT_MACHPORT, shared with userspace.
 *
 * Only portsets are supported at this time.
 *
 * The fflags field can optionally contain the MACH_RCV_MSG, MACH_RCV_LARGE,
 * and related trailer receive options as defined in &lt;mach/message.h&gt;.
 * The presence of these flags directs the kevent64() call to attempt to receive
 * the message during kevent delivery, rather than just indicate that a message exists.
 * On setup, The ext[0] field contains the receive buffer pointer and ext[1] contains
 * the receive buffer length.  Upon event delivery, the actual received message size
 * is returned in ext[1].  As with mach_msg(), the buffer must be large enough to
 * receive the message and the requested (or default) message trailers.  In addition,
 * the fflags field contains the return code normally returned by mach_msg().
 *
 * If MACH_RCV_MSG is specified, and the ext[1] field specifies a zero length, the
 * system call argument specifying an ouput area (kevent_qos) will be consulted. If
 * the system call specified an output data area, the user-space address
 * of the received message is carved from that provided output data area (if enough
 * space remains there). The address and length of each received message is 
 * returned in the ext[0] and ext[1] fields (respectively) of the corresponding kevent.
 *
 * IF_MACH_RCV_VOUCHER_CONTENT is specified, the contents of the message voucher is
 * extracted (as specified in the xflags field) and stored in ext[2] up to ext[3]
 * length.  If the input length is zero, and the system call provided a data area,
 * the space for the voucher content is carved from the provided space and its
 * address and length is returned in ext[2] and ext[3] respectively.
 *
 * If no message receipt options were provided in the fflags field on setup, no
 * message is received by this call. Instead, on output, the data field simply
 * contains the name of the actual port detected with a message waiting.
 */</span>

<span class="enscript-comment">/*
 * DEPRECATED!!!!!!!!!
 * NOTE_TRACK, NOTE_TRACKERR, and NOTE_CHILD are no longer supported as of 10.5
 */</span>
<span class="enscript-comment">/* additional flags for EVFILT_PROC */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_TRACK</span>	0x00000001		<span class="enscript-comment">/* follow across forks */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_TRACKERR</span>	0x00000002		<span class="enscript-comment">/* could not track child */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">NOTE_CHILD</span>	0x00000004		<span class="enscript-comment">/* am a child process */</span>



#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">KERNEL</span>
<span class="enscript-comment">/* Temporay solution for BootX to use inode.h till kqueue moves to vfs layer */</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/queue.h&gt;</span> 
<span class="enscript-type">struct</span> knote;
<span class="enscript-function-name">SLIST_HEAD</span>(klist, knote);
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL_PRIVATE</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/queue.h&gt;</span> 
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;kern/kern_types.h&gt;</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">MALLOC_DECLARE</span>
<span class="enscript-function-name">MALLOC_DECLARE</span>(M_KQUEUE);
#<span class="enscript-reference">endif</span>

<span class="enscript-function-name">TAILQ_HEAD</span>(kqtailq, knote);	<span class="enscript-comment">/* a list of &quot;queued&quot; events */</span>

<span class="enscript-type">struct</span> knote {
	<span class="enscript-type">int</span>		kn_inuse;	<span class="enscript-comment">/* inuse count */</span>
	<span class="enscript-type">int</span>		kn_hookid;
	TAILQ_ENTRY(knote)	kn_tqe;		<span class="enscript-comment">/* linkage for tail queue */</span>
	<span class="enscript-type">struct</span> kqtailq		*kn_tq;		<span class="enscript-comment">/* pointer to tail queue */</span>
	<span class="enscript-type">struct</span> kqueue		*kn_kq;		<span class="enscript-comment">/* which kqueue we are on */</span>
	SLIST_ENTRY(knote)	kn_link;	<span class="enscript-comment">/* linkage for search list */</span>
	SLIST_ENTRY(knote)	kn_selnext;	<span class="enscript-comment">/* klist element chain */</span>
	<span class="enscript-type">union</span> {
		<span class="enscript-type">struct</span>		fileproc *p_fp;	<span class="enscript-comment">/* file data pointer */</span>
		<span class="enscript-type">struct</span>		proc *p_proc;	<span class="enscript-comment">/* proc pointer */</span>
		<span class="enscript-type">struct</span>          ipc_pset *p_pset;       <span class="enscript-comment">/* pset pointer */</span>
	} kn_ptr;
	<span class="enscript-type">struct</span>			filterops *kn_fop;
	<span class="enscript-type">int</span>			kn_status;	<span class="enscript-comment">/* status bits */</span>
	<span class="enscript-type">int</span>			kn_sfflags;	<span class="enscript-comment">/* saved filter flags */</span>
	<span class="enscript-type">union</span> {
		<span class="enscript-type">void</span>		*kn_hook;
		uint64_t	kn_hook_data;
	};
	int64_t			kn_sdata;	<span class="enscript-comment">/* saved data field */</span>
	<span class="enscript-type">struct</span> 			kevent_internal_s kn_kevent;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KN_ACTIVE</span>	0x01			<span class="enscript-comment">/* event has been triggered */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KN_QUEUED</span>	0x02			<span class="enscript-comment">/* event is on queue */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KN_DISABLED</span>	0x04			<span class="enscript-comment">/* event is disabled */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KN_DROPPING</span>	0x08			<span class="enscript-comment">/* knote is being dropped */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KN_USEWAIT</span>	0x10			<span class="enscript-comment">/* wait for knote use */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KN_ATTACHING</span>	0x20			<span class="enscript-comment">/* event is pending attach */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KN_STAYQUEUED</span>	0x40			<span class="enscript-comment">/* force event to stay on queue */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KN_DEFERDROP</span>	0x80			<span class="enscript-comment">/* defer drop until re-enabled */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KN_TOUCH</span>	0x100			<span class="enscript-comment">/* Always call f_touch callback */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kn_id</span>		kn_kevent.ident
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kn_filter</span>	kn_kevent.filter
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kn_flags</span>	kn_kevent.flags
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kn_qos</span>		kn_kevent.qos
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kn_udata</span>	kn_kevent.udata
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kn_fflags</span>	kn_kevent.fflags
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kn_xflags</span>	kn_kevent.xflags
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kn_data</span>		kn_kevent.data
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kn_ext</span>		kn_kevent.ext
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kn_fp</span>		kn_ptr.p_fp
};

<span class="enscript-comment">/* Hint values for f_touch filter operation */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EVENT_REGISTER</span>  1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">EVENT_PROCESS</span>   2

<span class="enscript-type">struct</span> filterops {
	<span class="enscript-type">int</span>	f_isfd;		<span class="enscript-comment">/* true if ident == filedescriptor */</span>
	<span class="enscript-type">int</span>	(*f_attach)(<span class="enscript-type">struct</span> knote *kn);
	<span class="enscript-type">void</span>	(*f_detach)(<span class="enscript-type">struct</span> knote *kn);
	<span class="enscript-type">int</span>	(*f_event)(<span class="enscript-type">struct</span> knote *kn, <span class="enscript-type">long</span> hint);
	<span class="enscript-comment">/* Optional f_touch operation, called only if !f_isfd &amp;&amp; non-NULL */</span>
	<span class="enscript-type">void</span>    (*f_touch)(<span class="enscript-type">struct</span> knote *kn, <span class="enscript-type">struct</span> kevent_internal_s *kev, <span class="enscript-type">long</span> type);
	<span class="enscript-comment">/* Optional f_peek operation, called only if KN_STAYQUEUED is set */</span>
	<span class="enscript-type">unsigned</span> (*f_peek)(<span class="enscript-type">struct</span> knote *kn);
};

<span class="enscript-type">struct</span> proc;
<span class="enscript-type">struct</span> waitq;

<span class="enscript-function-name">SLIST_HEAD</span>(klist, knote);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	knote_init(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	klist_init(<span class="enscript-type">struct</span> klist *list);

#<span class="enscript-reference">define</span> <span class="enscript-function-name">KNOTE</span>(list, hint)	knote(list, hint)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">KNOTE_ATTACH</span>(list, kn)	knote_attach(list, kn)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">KNOTE_DETACH</span>(list, kn)	knote_detach(list, kn)


<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	knote(<span class="enscript-type">struct</span> klist *list, <span class="enscript-type">long</span> hint);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	knote_attach(<span class="enscript-type">struct</span> klist *list, <span class="enscript-type">struct</span> knote *kn);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	knote_detach(<span class="enscript-type">struct</span> klist *list, <span class="enscript-type">struct</span> knote *kn);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	knote_link_waitq(<span class="enscript-type">struct</span> knote *kn, <span class="enscript-type">struct</span> waitq *wq, uint64_t *reserved_link);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	knote_unlink_waitq(<span class="enscript-type">struct</span> knote *kn, <span class="enscript-type">struct</span> waitq *wq);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	knote_fdclose(<span class="enscript-type">struct</span> proc *p, <span class="enscript-type">int</span> fd);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	knote_markstayqueued(<span class="enscript-type">struct</span> knote *kn);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	knote_clearstayqueued(<span class="enscript-type">struct</span> knote *kn);

<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	kevent_qos_internal(<span class="enscript-type">struct</span> proc *p, <span class="enscript-type">int</span> fd, 
			    user_addr_t changelist, <span class="enscript-type">int</span> nchanges,
			    user_addr_t eventlist, <span class="enscript-type">int</span> nevents,
			    user_addr_t data_out, user_size_t *data_available,
			    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> flags, int32_t *retval);
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !KERNEL_PRIVATE */</span>

#<span class="enscript-reference">else</span> 	<span class="enscript-comment">/* KERNEL */</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/types.h&gt;</span>

<span class="enscript-type">struct</span> timespec;

__BEGIN_DECLS
<span class="enscript-type">int</span>     <span class="enscript-function-name">kqueue</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">int</span>     <span class="enscript-function-name">kevent</span>(<span class="enscript-type">int</span> kq, 
	       <span class="enscript-type">const</span> <span class="enscript-type">struct</span> kevent *changelist, <span class="enscript-type">int</span> nchanges,
	       <span class="enscript-type">struct</span> kevent *eventlist, <span class="enscript-type">int</span> nevents,
	       <span class="enscript-type">const</span> <span class="enscript-type">struct</span> timespec *timeout);
<span class="enscript-type">int</span>     <span class="enscript-function-name">kevent64</span>(<span class="enscript-type">int</span> kq, 
		 <span class="enscript-type">const</span> <span class="enscript-type">struct</span> kevent64_s *changelist, <span class="enscript-type">int</span> nchanges,
		 <span class="enscript-type">struct</span> kevent64_s *eventlist, <span class="enscript-type">int</span> nevents,
		 <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> flags, 
		 <span class="enscript-type">const</span> <span class="enscript-type">struct</span> timespec *timeout);

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
<span class="enscript-type">int</span>     <span class="enscript-function-name">kevent_qos</span>(<span class="enscript-type">int</span> kq, 
		   <span class="enscript-type">const</span> <span class="enscript-type">struct</span> kevent_qos_s *changelist, <span class="enscript-type">int</span> nchanges,
		   <span class="enscript-type">struct</span> kevent_qos_s *eventlist, <span class="enscript-type">int</span> nevents,
		   <span class="enscript-type">void</span> *data_out, size_t *data_available,
		   <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> flags);
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

__END_DECLS


#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL */</span>


#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !_SYS_EVENT_H_ */</span>
</pre>
<hr />
</body></html>