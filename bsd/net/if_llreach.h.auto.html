<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>if_llreach.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">if_llreach.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2011-2014 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 *
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 *
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 *
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">_NET_IF_LLREACH_H_</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_NET_IF_LLREACH_H_</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">ifdef</span>  <span class="enscript-variable-name">__cplusplus</span>
<span class="enscript-type">extern</span> <span class="enscript-string">&quot;C&quot;</span> {
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/types.h&gt;</span>

<span class="enscript-comment">/*
 * Per-interface link-layer reachability information (private).
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IF_LLREACHINFO_ADDRLEN</span>		64	<span class="enscript-comment">/* max ll addr len */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IF_LLREACHINFO_RESERVED2</span>	16	<span class="enscript-comment">/* more reserved bits */</span>

<span class="enscript-type">struct</span> if_llreach_info {
	u_int32_t		lri_refcnt;	<span class="enscript-comment">/* reference count */</span>
	u_int32_t		lri_ifindex;	<span class="enscript-comment">/* interface index */</span>
	u_int64_t		lri_expire;	<span class="enscript-comment">/* expiration (calendar) time */</span>
	u_int32_t		lri_probes;	<span class="enscript-comment">/* total # of probes */</span>
	u_int16_t		lri_reserved;	<span class="enscript-comment">/* for future use */</span>
	u_int16_t		lri_proto;	<span class="enscript-comment">/* ll proto */</span>
	u_int8_t		lri_addr[IF_LLREACHINFO_ADDRLEN]; <span class="enscript-comment">/* ll addr */</span>
	int32_t			lri_rssi;	<span class="enscript-comment">/* received signal strength */</span>
	int32_t			lri_lqm;	<span class="enscript-comment">/* link quality metric */</span>
	int32_t			lri_npm;	<span class="enscript-comment">/* node proximity metric */</span>
	u_int8_t		lri_reserved2[IF_LLREACHINFO_RESERVED2];
};

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/tree.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;kern/locks.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;net/ethernet.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;netinet/in.h&gt;</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">INET6</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;netinet6/in6_var.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;netinet6/nd6.h&gt;</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* INET6 */</span>

<span class="enscript-comment">/*
 * Link-layer reachability is based off node constants in RFC4861.
 */</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">INET6</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">LL_BASE_REACHABLE</span>	REACHABLE_TIME
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">LL_BASE_REACHABLE</span>	30000	<span class="enscript-comment">/* msec */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !INET6 */</span>

<span class="enscript-comment">/*
 * Per-interface link-layer reachability.  (Currently only for ARP/NDP/Ethernet.)
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IF_LLREACH_MAXLEN</span>	ETHER_ADDR_LEN

<span class="enscript-type">struct</span> if_llreach {
	decl_lck_mtx_data(, lr_lock);
	RB_ENTRY(if_llreach)	lr_link;	<span class="enscript-comment">/* RB tree links */</span>
	<span class="enscript-type">struct</span> ifnet		*lr_ifp;	<span class="enscript-comment">/* back pointer to ifnet */</span>
	u_int32_t		lr_refcnt;	<span class="enscript-comment">/* reference count */</span>
	u_int32_t		lr_reqcnt;	<span class="enscript-comment">/* RB tree request count */</span>
	u_int32_t		lr_debug;	<span class="enscript-comment">/* see ifa_debug flags */</span>
	u_int32_t		lr_probes;	<span class="enscript-comment">/* number of probes so far */</span>
	u_int64_t		lr_basecal;	<span class="enscript-comment">/* base calendar time */</span>
	u_int64_t		lr_baseup;	<span class="enscript-comment">/* base uptime */</span>
	u_int64_t		lr_lastrcvd;	<span class="enscript-comment">/* last-heard-of timestamp */</span>
	u_int32_t		lr_basereachable; <span class="enscript-comment">/* baseline time */</span>
	u_int32_t		lr_reachable;	<span class="enscript-comment">/* reachable time */</span>
	<span class="enscript-type">struct</span> lr_key_s {
		u_int16_t	proto;		<span class="enscript-comment">/* ll proto */</span>
		u_int8_t	addr[IF_LLREACH_MAXLEN]; <span class="enscript-comment">/* ll addr */</span>
	} lr_key;
	int32_t			lr_rssi;	<span class="enscript-comment">/* received signal strength */</span>
	int32_t			lr_lqm;		<span class="enscript-comment">/* link quality metric */</span>
	int32_t			lr_npm;		<span class="enscript-comment">/* node proximity metric */</span>
};

<span class="enscript-function-name">RB_PROTOTYPE_SC_PREV</span>(__private_extern__, ll_reach_tree, if_llreach,
    ls_link, ifllr_cmp);

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">IFLR_LOCK_ASSERT_HELD</span>(_iflr)					\
	lck_mtx_assert(&amp;(_iflr)-&gt;lr_lock, LCK_MTX_ASSERT_OWNED)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">IFLR_LOCK_ASSERT_NOTHELD</span>(_iflr)				\
	lck_mtx_assert(&amp;(_iflr)-&gt;lr_lock, LCK_MTX_ASSERT_NOTOWNED)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">IFLR_LOCK</span>(_iflr)						\
	lck_mtx_lock(&amp;(_iflr)-&gt;lr_lock)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">IFLR_LOCK_SPIN</span>(_iflr)						\
	lck_mtx_lock_spin(&amp;(_iflr)-&gt;lr_lock)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">IFLR_CONVERT_LOCK</span>(_iflr) do {					\
	IFLR_LOCK_ASSERT_HELD(_iflr);					\
	lck_mtx_convert_spin(&amp;(_iflr)-&gt;lr_lock);			\
} <span class="enscript-keyword">while</span> (0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">IFLR_UNLOCK</span>(_iflr)						\
	lck_mtx_unlock(&amp;(_iflr)-&gt;lr_lock)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">IFLR_ADDREF</span>(_iflr)						\
	iflr_addref(_iflr, 0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">IFLR_ADDREF_LOCKED</span>(_iflr)					\
	iflr_addref(_iflr, 1)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">IFLR_REMREF</span>(_iflr)						\
	iflr_remref(_iflr)

<span class="enscript-type">struct</span> ifnet_llreach_info;	<span class="enscript-comment">/* forward declaration */</span>

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">ifnet_llreach_init</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">ifnet_llreach_ifattach</span>(<span class="enscript-type">struct</span> ifnet *, boolean_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">ifnet_llreach_ifdetach</span>(<span class="enscript-type">struct</span> ifnet *);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> if_llreach *<span class="enscript-function-name">ifnet_llreach_alloc</span>(<span class="enscript-type">struct</span> ifnet *, u_int16_t, <span class="enscript-type">void</span> *,
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>, u_int64_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">ifnet_llreach_free</span>(<span class="enscript-type">struct</span> if_llreach *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">ifnet_llreach_reachable</span>(<span class="enscript-type">struct</span> if_llreach *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">ifnet_llreach_reachable_delta</span>(<span class="enscript-type">struct</span> if_llreach *, u_int64_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">ifnet_llreach_set_reachable</span>(<span class="enscript-type">struct</span> ifnet *, u_int16_t, <span class="enscript-type">void</span> *,
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> u_int64_t <span class="enscript-function-name">ifnet_llreach_up2calexp</span>(<span class="enscript-type">struct</span> if_llreach *, u_int64_t);
<span class="enscript-type">extern</span> u_int64_t <span class="enscript-function-name">ifnet_llreach_up2upexp</span>(<span class="enscript-type">struct</span> if_llreach *, u_int64_t);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">ifnet_llreach_get_defrouter</span>(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">int</span>,
    <span class="enscript-type">struct</span> ifnet_llreach_info *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">ifnet_lr2ri</span>(<span class="enscript-type">struct</span> if_llreach *, <span class="enscript-type">struct</span> rt_reach_info *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">ifnet_lr2iflri</span>(<span class="enscript-type">struct</span> if_llreach *, <span class="enscript-type">struct</span> ifnet_llreach_info *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">ifnet_lr2lri</span>(<span class="enscript-type">struct</span> if_llreach *, <span class="enscript-type">struct</span> if_llreach_info *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">iflr_addref</span>(<span class="enscript-type">struct</span> if_llreach *, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">iflr_remref</span>(<span class="enscript-type">struct</span> if_llreach *);
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">ifdef</span>  <span class="enscript-variable-name">__cplusplus</span>
}
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !_NET_IF_LLREACH_H_ */</span>
</pre>
<hr />
</body></html>