<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>route.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">route.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000-2015 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 *
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 *
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 *
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*
 * Copyright (c) 1980, 1986, 1993
 *	The Regents of the University of California.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *	@(#)route.h	8.3 (Berkeley) 4/19/94
 * $FreeBSD: src/sys/net/route.h,v 1.36.2.1 2000/08/16 06:14:23 jayanth Exp $
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_NET_ROUTE_H_</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_NET_ROUTE_H_</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/appleapiopts.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;stdint.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/types.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/socket.h&gt;</span>

<span class="enscript-comment">/*
 * These numbers are used by reliable protocols for determining
 * retransmission behavior and are included in the routing structure.
 */</span>
<span class="enscript-type">struct</span> rt_metrics {
	u_int32_t	rmx_locks;	<span class="enscript-comment">/* Kernel leaves these values alone */</span>
	u_int32_t	rmx_mtu;	<span class="enscript-comment">/* MTU for this path */</span>
	u_int32_t	rmx_hopcount;	<span class="enscript-comment">/* max hops expected */</span>
	int32_t		rmx_expire;	<span class="enscript-comment">/* lifetime for route, e.g. redirect */</span>
	u_int32_t	rmx_recvpipe;	<span class="enscript-comment">/* inbound delay-bandwidth product */</span>
	u_int32_t	rmx_sendpipe;	<span class="enscript-comment">/* outbound delay-bandwidth product */</span>
	u_int32_t	rmx_ssthresh;	<span class="enscript-comment">/* outbound gateway buffer limit */</span>
	u_int32_t	rmx_rtt;	<span class="enscript-comment">/* estimated round trip time */</span>
	u_int32_t	rmx_rttvar;	<span class="enscript-comment">/* estimated rtt variance */</span>
	u_int32_t	rmx_pksent;	<span class="enscript-comment">/* packets sent using this route */</span>
	u_int32_t	rmx_filler[4];	<span class="enscript-comment">/* will be used for T/TCP later */</span>
};

<span class="enscript-comment">/*
 * rmx_rtt and rmx_rttvar are stored as microseconds;
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_RTTUNIT</span>	1000000	<span class="enscript-comment">/* units for rtt, rttvar, as units per sec */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
<span class="enscript-type">struct</span> route_old {
	<span class="enscript-type">void</span>		*ro_rt;
	uint32_t	ro_flags;
	<span class="enscript-type">struct</span> sockaddr	ro_dst;
};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;kern/locks.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;net/radix.h&gt;</span>

<span class="enscript-comment">/*
 * Kernel resident routing tables.
 *
 * The routing tables are initialized when interface addresses
 * are set by making entries for all directly connected interfaces.
 */</span>

<span class="enscript-comment">/* forward declarations */</span>
<span class="enscript-type">struct</span> ifnet_llreach_info;
<span class="enscript-type">struct</span> rt_reach_info;

<span class="enscript-comment">/*
 * IP route structure
 *
 * A route consists of a destination address and a reference
 * to a routing entry.  These are often held by protocols
 * in their control blocks, e.g. inpcb.
 */</span>
<span class="enscript-type">struct</span> route {
	<span class="enscript-comment">/*
	 * N.B: struct route must begin with ro_{rt,srcia,flags}
	 * because the code does some casts of a 'struct route_in6 *'
	 * to a 'struct route *'.
	 */</span>
	<span class="enscript-type">struct</span> rtentry	*ro_rt;
	<span class="enscript-type">struct</span> ifaddr	*ro_srcia;
	uint32_t	ro_flags;	<span class="enscript-comment">/* route flags (see below) */</span>
	<span class="enscript-type">struct</span> sockaddr	ro_dst;
};

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ROF_SRCIF_SELECTED</span>	0x1	<span class="enscript-comment">/* source interface was selected */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">ROUTE_UNUSABLE</span>(_ro)						\
	((_ro)-&gt;ro_rt == NULL ||					\
	((_ro)-&gt;ro_rt-&gt;rt_flags &amp; (RTF_UP|RTF_CONDEMNED)) != RTF_UP ||	\
	RT_GENID_OUTOFSYNC((_ro)-&gt;ro_rt))

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">_ROUTE_RELEASE_COMMON</span>(_ro, _rnh_locked) do {			\
	<span class="enscript-keyword">if</span> ((_ro)-&gt;ro_rt != NULL) {					\
		RT_LOCK_ASSERT_NOTHELD((_ro)-&gt;ro_rt);			\
		<span class="enscript-keyword">if</span> (_rnh_locked)					\
			rtfree_locked((_ro)-&gt;ro_rt);			\
		<span class="enscript-keyword">else</span>							\
			rtfree((_ro)-&gt;ro_rt);				\
		(_ro)-&gt;ro_rt = NULL;					\
	}								\
	<span class="enscript-keyword">if</span> ((_ro)-&gt;ro_srcia != NULL) {					\
		IFA_REMREF((_ro)-&gt;ro_srcia);				\
		(_ro)-&gt;ro_srcia = NULL;					\
		(_ro)-&gt;ro_flags &amp;= ~ROF_SRCIF_SELECTED;			\
	}								\
} <span class="enscript-keyword">while</span> (0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">ROUTE_RELEASE_LOCKED</span>(_ro)	_ROUTE_RELEASE_COMMON(_ro, TRUE)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">ROUTE_RELEASE</span>(_ro)		_ROUTE_RELEASE_COMMON(_ro, FALSE)

<span class="enscript-comment">/*
 * We distinguish between routes to hosts and routes to networks,
 * preferring the former if available.  For each route we infer
 * the interface to use from the gateway address supplied when
 * the route was entered.  Routes that forward packets through
 * gateways are marked so that the output routines know to address the
 * gateway rather than the ultimate destination.
 */</span>

<span class="enscript-comment">/*
 * Kernel routing entry structure.
 */</span>
<span class="enscript-type">struct</span> rtentry {
	<span class="enscript-type">struct</span>	radix_node rt_nodes[2];	<span class="enscript-comment">/* tree glue, and other values */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">rt_key</span>(r)	(SA((r)-&gt;rt_nodes-&gt;rn_key))
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">rt_mask</span>(r)	(SA((r)-&gt;rt_nodes-&gt;rn_mask))
	<span class="enscript-comment">/*
	 * See bsd/net/route.c for synchronization notes.
	 */</span>
	decl_lck_mtx_data(, rt_lock);	<span class="enscript-comment">/* lock for routing entry */</span>
	uint32_t rt_refcnt;		<span class="enscript-comment">/* # held references */</span>
	uint32_t rt_flags;		<span class="enscript-comment">/* up/down?, host/net */</span>
	uint32_t rt_genid;		<span class="enscript-comment">/* route generation id */</span>
	<span class="enscript-type">struct</span> sockaddr *rt_gateway;	<span class="enscript-comment">/* value */</span>
	<span class="enscript-type">struct</span> ifnet *rt_ifp;		<span class="enscript-comment">/* the answer: interface to use */</span>
	<span class="enscript-type">struct</span> ifaddr *rt_ifa;		<span class="enscript-comment">/* the answer: interface addr to use */</span>
	<span class="enscript-type">struct</span> sockaddr *rt_genmask;	<span class="enscript-comment">/* for generation of cloned routes */</span>
	<span class="enscript-type">void</span> *rt_llinfo;		<span class="enscript-comment">/* pointer to link level info cache */</span>
	<span class="enscript-type">void</span> (*rt_llinfo_get_ri)	<span class="enscript-comment">/* llinfo get reachability info fn */</span>
	    (<span class="enscript-type">struct</span> rtentry *, <span class="enscript-type">struct</span> rt_reach_info *);
	<span class="enscript-type">void</span> (*rt_llinfo_get_iflri)	<span class="enscript-comment">/* ifnet llinfo get reach. info fn */</span>
	    (<span class="enscript-type">struct</span> rtentry *, <span class="enscript-type">struct</span> ifnet_llreach_info *);
	<span class="enscript-type">void</span> (*rt_llinfo_purge)(<span class="enscript-type">struct</span> rtentry *); <span class="enscript-comment">/* llinfo purge fn */</span>
	<span class="enscript-type">void</span> (*rt_llinfo_free)(<span class="enscript-type">void</span> *); <span class="enscript-comment">/* link level info free function */</span>
	<span class="enscript-type">void</span> (*rt_llinfo_refresh) (<span class="enscript-type">struct</span> rtentry *); <span class="enscript-comment">/* expedite llinfo refresh */</span>
	<span class="enscript-type">struct</span> rt_metrics rt_rmx;	<span class="enscript-comment">/* metrics used by rx'ing protocols */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">rt_use</span> rt_rmx.rmx_pksent
	<span class="enscript-type">struct</span> rtentry *rt_gwroute;	<span class="enscript-comment">/* implied entry for gatewayed routes */</span>
	<span class="enscript-type">struct</span> rtentry *rt_parent;	<span class="enscript-comment">/* cloning parent of this route */</span>
	<span class="enscript-type">struct</span> nstat_counts *rt_stats;	<span class="enscript-comment">/* route stats */</span>
	<span class="enscript-type">void</span> (*rt_if_ref_fn)(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">int</span>); <span class="enscript-comment">/* interface ref func */</span>

	uint32_t *rt_tree_genid;	<span class="enscript-comment">/* ptr to per-tree route_genid */</span>
	uint64_t rt_expire;		<span class="enscript-comment">/* expiration time in uptime seconds */</span>
	uint64_t base_calendartime;	<span class="enscript-comment">/* calendar time upon entry creation */</span>
	uint64_t base_uptime;		<span class="enscript-comment">/* uptime upon entry creation */</span>
};

<span class="enscript-comment">/*
 * Synchronize route entry's generation ID with the tree's.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">RT_GENID_SYNC</span>(_rt) do {						\
	<span class="enscript-keyword">if</span> ((_rt)-&gt;rt_tree_genid != NULL)				\
		(_rt)-&gt;rt_genid = *(_rt)-&gt;rt_tree_genid;		\
} <span class="enscript-keyword">while</span> (0)

<span class="enscript-comment">/*
 * Indicates whether or not the route entry's generation ID is stale.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">RT_GENID_OUTOFSYNC</span>(_rt)						\
	((_rt)-&gt;rt_tree_genid != NULL &amp;&amp;				\
	*(_rt)-&gt;rt_tree_genid != (_rt)-&gt;rt_genid)

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_UP</span>		0x1		<span class="enscript-comment">/* route usable */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_GATEWAY</span>	0x2		<span class="enscript-comment">/* destination is a gateway */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_HOST</span>	0x4		<span class="enscript-comment">/* host entry (net otherwise) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_REJECT</span>	0x8		<span class="enscript-comment">/* host or net unreachable */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_DYNAMIC</span>	0x10		<span class="enscript-comment">/* created dynamically (by redirect) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_MODIFIED</span>	0x20		<span class="enscript-comment">/* modified dynamically (by redirect) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_DONE</span>	0x40		<span class="enscript-comment">/* message confirmed */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_DELCLONE</span>	0x80		<span class="enscript-comment">/* delete cloned route */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_CLONING</span>	0x100		<span class="enscript-comment">/* generate new routes on use */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_XRESOLVE</span>	0x200		<span class="enscript-comment">/* external daemon resolves name */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_LLINFO</span>	0x400		<span class="enscript-comment">/* generated by link layer (e.g. ARP) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_STATIC</span>	0x800		<span class="enscript-comment">/* manually added */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_BLACKHOLE</span>	0x1000		<span class="enscript-comment">/* just discard pkts (during updates) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_NOIFREF</span>	0x2000		<span class="enscript-comment">/* not eligible for RTF_IFREF */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_PROTO2</span>	0x4000		<span class="enscript-comment">/* protocol specific routing flag */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_PROTO1</span>	0x8000		<span class="enscript-comment">/* protocol specific routing flag */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_PRCLONING</span>	0x10000		<span class="enscript-comment">/* protocol requires cloning */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_WASCLONED</span>	0x20000		<span class="enscript-comment">/* route generated through cloning */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_PROTO3</span>	0x40000		<span class="enscript-comment">/* protocol specific routing flag */</span>
					<span class="enscript-comment">/* 0x80000 unused */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_PINNED</span>	0x100000	<span class="enscript-comment">/* future use */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_LOCAL</span>	0x200000	<span class="enscript-comment">/* route represents a local address */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_BROADCAST</span>	0x400000	<span class="enscript-comment">/* route represents a bcast address */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_MULTICAST</span>	0x800000	<span class="enscript-comment">/* route represents a mcast address */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_IFSCOPE</span>	0x1000000	<span class="enscript-comment">/* has valid interface scope */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_CONDEMNED</span>	0x2000000	<span class="enscript-comment">/* defunct; no longer modifiable */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_IFREF</span>	0x4000000	<span class="enscript-comment">/* route holds a ref to interface */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_PROXY</span>	0x8000000	<span class="enscript-comment">/* proxying, no interface scope */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_ROUTER</span>	0x10000000	<span class="enscript-comment">/* host is a router */</span>
					<span class="enscript-comment">/* 0x20000000 and up unassigned */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTF_BITS</span> \
	<span class="enscript-string">&quot;\020\1UP\2GATEWAY\3HOST\4REJECT\5DYNAMIC\6MODIFIED\7DONE&quot;</span> \
	<span class="enscript-string">&quot;\10DELCLONE\11CLONING\12XRESOLVE\13LLINFO\14STATIC\15BLACKHOLE&quot;</span> \
	<span class="enscript-string">&quot;\16NOIFREF\17PROTO2\20PROTO1\21PRCLONING\22WASCLONED\23PROTO3&quot;</span> \
	<span class="enscript-string">&quot;\25PINNED\26LOCAL\27BROADCAST\30MULTICAST\31IFSCOPE\32CONDEMNED&quot;</span> \
	<span class="enscript-string">&quot;\33IFREF\34PROXY\35ROUTER&quot;</span>

<span class="enscript-comment">/*
 * Routing statistics.
 */</span>
<span class="enscript-type">struct</span>	rtstat {
	<span class="enscript-type">short</span>	rts_badredirect;	<span class="enscript-comment">/* bogus redirect calls */</span>
	<span class="enscript-type">short</span>	rts_dynamic;		<span class="enscript-comment">/* routes created by redirects */</span>
	<span class="enscript-type">short</span>	rts_newgateway;		<span class="enscript-comment">/* routes modified by redirects */</span>
	<span class="enscript-type">short</span>	rts_unreach;		<span class="enscript-comment">/* lookups which failed */</span>
	<span class="enscript-type">short</span>	rts_wildcard;		<span class="enscript-comment">/* lookups satisfied by a wildcard */</span>
};

<span class="enscript-comment">/*
 * Structures for routing messages.
 */</span>
<span class="enscript-type">struct</span> rt_msghdr {
	u_short	rtm_msglen;	<span class="enscript-comment">/* to skip over non-understood messages */</span>
	u_char	rtm_version;	<span class="enscript-comment">/* future binary compatibility */</span>
	u_char	rtm_type;	<span class="enscript-comment">/* message type */</span>
	u_short	rtm_index;	<span class="enscript-comment">/* index for associated ifp */</span>
	<span class="enscript-type">int</span>	rtm_flags;	<span class="enscript-comment">/* flags, incl. kern &amp; message, e.g. DONE */</span>
	<span class="enscript-type">int</span>	rtm_addrs;	<span class="enscript-comment">/* bitmask identifying sockaddrs in msg */</span>
	pid_t	rtm_pid;	<span class="enscript-comment">/* identify sender */</span>
	<span class="enscript-type">int</span>	rtm_seq;	<span class="enscript-comment">/* for sender to identify action */</span>
	<span class="enscript-type">int</span>	rtm_errno;	<span class="enscript-comment">/* why failed */</span>
	<span class="enscript-type">int</span>	rtm_use;	<span class="enscript-comment">/* from rtentry */</span>
	u_int32_t rtm_inits;	<span class="enscript-comment">/* which metrics we are initializing */</span>
	<span class="enscript-type">struct</span> rt_metrics rtm_rmx; <span class="enscript-comment">/* metrics themselves */</span>
};

<span class="enscript-type">struct</span> rt_msghdr2 {
	u_short	rtm_msglen;	<span class="enscript-comment">/* to skip over non-understood messages */</span>
	u_char	rtm_version;	<span class="enscript-comment">/* future binary compatibility */</span>
	u_char	rtm_type;	<span class="enscript-comment">/* message type */</span>
	u_short	rtm_index;	<span class="enscript-comment">/* index for associated ifp */</span>
	<span class="enscript-type">int</span>	rtm_flags;	<span class="enscript-comment">/* flags, incl. kern &amp; message, e.g. DONE */</span>
	<span class="enscript-type">int</span>	rtm_addrs;	<span class="enscript-comment">/* bitmask identifying sockaddrs in msg */</span>
	int32_t	rtm_refcnt;	<span class="enscript-comment">/* reference count */</span>
	<span class="enscript-type">int</span>	rtm_parentflags; <span class="enscript-comment">/* flags of the parent route */</span>
	<span class="enscript-type">int</span>	rtm_reserved;	<span class="enscript-comment">/* reserved field set to 0 */</span>
	<span class="enscript-type">int</span>	rtm_use;	<span class="enscript-comment">/* from rtentry */</span>
	u_int32_t rtm_inits;	<span class="enscript-comment">/* which metrics we are initializing */</span>
	<span class="enscript-type">struct</span> rt_metrics rtm_rmx; <span class="enscript-comment">/* metrics themselves */</span>
};

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
<span class="enscript-comment">/*
 * Route reachability info.
 */</span>
<span class="enscript-type">struct</span> rt_reach_info {
	u_int32_t	ri_refcnt;	<span class="enscript-comment">/* reference count */</span>
	u_int32_t	ri_probes;	<span class="enscript-comment">/* total # of probes */</span>
	u_int64_t	ri_snd_expire;	<span class="enscript-comment">/* tx expiration (calendar) time */</span>
	u_int64_t	ri_rcv_expire;	<span class="enscript-comment">/* rx expiration (calendar) time */</span>
	int32_t		ri_rssi;	<span class="enscript-comment">/* received signal strength */</span>
	int32_t		ri_lqm;		<span class="enscript-comment">/* link quality metric */</span>
	int32_t		ri_npm;		<span class="enscript-comment">/* node proximity metric */</span>
};

<span class="enscript-comment">/*
 * Extended routing message header (private).
 */</span>
<span class="enscript-type">struct</span> rt_msghdr_ext {
	u_short	rtm_msglen;	<span class="enscript-comment">/* to skip over non-understood messages */</span>
	u_char	rtm_version;	<span class="enscript-comment">/* future binary compatibility */</span>
	u_char	rtm_type;	<span class="enscript-comment">/* message type */</span>
	u_int32_t rtm_index;	<span class="enscript-comment">/* index for associated ifp */</span>
	u_int32_t rtm_flags;	<span class="enscript-comment">/* flags, incl. kern &amp; message, e.g. DONE */</span>
	u_int32_t rtm_reserved;	<span class="enscript-comment">/* for future use */</span>
	u_int32_t rtm_addrs;	<span class="enscript-comment">/* bitmask identifying sockaddrs in msg */</span>
	pid_t	rtm_pid;	<span class="enscript-comment">/* identify sender */</span>
	<span class="enscript-type">int</span>	rtm_seq;	<span class="enscript-comment">/* for sender to identify action */</span>
	<span class="enscript-type">int</span>	rtm_errno;	<span class="enscript-comment">/* why failed */</span>
	u_int32_t rtm_use;	<span class="enscript-comment">/* from rtentry */</span>
	u_int32_t rtm_inits;	<span class="enscript-comment">/* which metrics we are initializing */</span>
	<span class="enscript-type">struct</span> rt_metrics rtm_rmx;	<span class="enscript-comment">/* metrics themselves */</span>
	<span class="enscript-type">struct</span> rt_reach_info rtm_ri;	<span class="enscript-comment">/* route reachability info */</span>
};
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_VERSION</span>	5	<span class="enscript-comment">/* Up the ante and ignore older versions */</span>

<span class="enscript-comment">/*
 * Message types.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_ADD</span>		0x1	<span class="enscript-comment">/* Add Route */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_DELETE</span>	0x2	<span class="enscript-comment">/* Delete Route */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_CHANGE</span>	0x3	<span class="enscript-comment">/* Change Metrics or flags */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_GET</span>		0x4	<span class="enscript-comment">/* Report Metrics */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_LOSING</span>	0x5	<span class="enscript-comment">/* RTM_LOSING is no longer generated by xnu
				   and is deprecated */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_REDIRECT</span>	0x6	<span class="enscript-comment">/* Told to use different route */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_MISS</span>	0x7	<span class="enscript-comment">/* Lookup failed on this address */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_LOCK</span>	0x8	<span class="enscript-comment">/* fix specified metrics */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_OLDADD</span>	0x9	<span class="enscript-comment">/* caused by SIOCADDRT */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_OLDDEL</span>	0xa	<span class="enscript-comment">/* caused by SIOCDELRT */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_RESOLVE</span>	0xb	<span class="enscript-comment">/* req to resolve dst to LL addr */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_NEWADDR</span>	0xc	<span class="enscript-comment">/* address being added to iface */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_DELADDR</span>	0xd	<span class="enscript-comment">/* address being removed from iface */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_IFINFO</span>	0xe	<span class="enscript-comment">/* iface going up/down etc. */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_NEWMADDR</span>	0xf	<span class="enscript-comment">/* mcast group membership being added to if */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_DELMADDR</span>	0x10	<span class="enscript-comment">/* mcast group membership being deleted */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_GET_SILENT</span>	0x11
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_IFINFO2</span>	0x12	<span class="enscript-comment">/* */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_NEWMADDR2</span>	0x13	<span class="enscript-comment">/* */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_GET2</span>	0x14	<span class="enscript-comment">/* */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTM_GET_EXT</span>	0x15
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

<span class="enscript-comment">/*
 * Bitmask values for rtm_inits and rmx_locks.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTV_MTU</span>		0x1	<span class="enscript-comment">/* init or lock _mtu */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTV_HOPCOUNT</span>	0x2	<span class="enscript-comment">/* init or lock _hopcount */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTV_EXPIRE</span>	0x4	<span class="enscript-comment">/* init or lock _expire */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTV_RPIPE</span>	0x8	<span class="enscript-comment">/* init or lock _recvpipe */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTV_SPIPE</span>	0x10	<span class="enscript-comment">/* init or lock _sendpipe */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTV_SSTHRESH</span>	0x20	<span class="enscript-comment">/* init or lock _ssthresh */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTV_RTT</span>		0x40	<span class="enscript-comment">/* init or lock _rtt */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTV_RTTVAR</span>	0x80	<span class="enscript-comment">/* init or lock _rttvar */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTV_REFRESH_HOST</span>	0x100	<span class="enscript-comment">/* init host route to expedite refresh */</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*
 * Bitmask values for rtm_addrs.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTA_DST</span>		0x1	<span class="enscript-comment">/* destination sockaddr present */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTA_GATEWAY</span>	0x2	<span class="enscript-comment">/* gateway sockaddr present */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTA_NETMASK</span>	0x4	<span class="enscript-comment">/* netmask sockaddr present */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTA_GENMASK</span>	0x8	<span class="enscript-comment">/* cloning mask sockaddr present */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTA_IFP</span>		0x10	<span class="enscript-comment">/* interface name sockaddr present */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTA_IFA</span>		0x20	<span class="enscript-comment">/* interface addr sockaddr present */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTA_AUTHOR</span>	0x40	<span class="enscript-comment">/* sockaddr for author of redirect */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTA_BRD</span>		0x80	<span class="enscript-comment">/* for NEWADDR, broadcast or p-p dest addr */</span>

<span class="enscript-comment">/*
 * Index offsets for sockaddr array for alternate internal encoding.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTAX_DST</span>	0	<span class="enscript-comment">/* destination sockaddr present */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTAX_GATEWAY</span>	1	<span class="enscript-comment">/* gateway sockaddr present */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTAX_NETMASK</span>	2	<span class="enscript-comment">/* netmask sockaddr present */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTAX_GENMASK</span>	3	<span class="enscript-comment">/* cloning mask sockaddr present */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTAX_IFP</span>	4	<span class="enscript-comment">/* interface name sockaddr present */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTAX_IFA</span>	5	<span class="enscript-comment">/* interface addr sockaddr present */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTAX_AUTHOR</span>	6	<span class="enscript-comment">/* sockaddr for author of redirect */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTAX_BRD</span>	7	<span class="enscript-comment">/* for NEWADDR, broadcast or p-p dest addr */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RTAX_MAX</span>	8	<span class="enscript-comment">/* size of array to allocate */</span>

<span class="enscript-type">struct</span> rt_addrinfo {
	<span class="enscript-type">int</span>	rti_addrs;
	<span class="enscript-type">struct</span>	sockaddr *rti_info[RTAX_MAX];
};

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
<span class="enscript-comment">/*
 * For scoped routing; a zero interface scope value means nil/no scope.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">IFSCOPE_NONE</span>	0
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">BSD_KERNEL_PRIVATE</span>
<span class="enscript-comment">/*
 * Generic call trace used by some subsystems (e.g. route, ifaddr)
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CTRACE_STACK_SIZE</span>	8		<span class="enscript-comment">/* depth of stack trace */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CTRACE_HIST_SIZE</span>	4		<span class="enscript-comment">/* refcnt history size */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> ctrace {
	<span class="enscript-type">void</span>	*th;				<span class="enscript-comment">/* thread ptr */</span>
	<span class="enscript-type">void</span>	*pc[CTRACE_STACK_SIZE];		<span class="enscript-comment">/* PC stack trace */</span>
} ctrace_t;

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">ctrace_record</span>(ctrace_t *);

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">RT_LOCK_ASSERT_HELD</span>(_rt)					\
	lck_mtx_assert(&amp;(_rt)-&gt;rt_lock, LCK_MTX_ASSERT_OWNED)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">RT_LOCK_ASSERT_NOTHELD</span>(_rt)					\
	lck_mtx_assert(&amp;(_rt)-&gt;rt_lock, LCK_MTX_ASSERT_NOTOWNED)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">RT_LOCK</span>(_rt) do {						\
	rt_lock(_rt, FALSE);						\
} <span class="enscript-keyword">while</span> (0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">RT_LOCK_SPIN</span>(_rt) do {						\
	rt_lock(_rt, TRUE);						\
} <span class="enscript-keyword">while</span> (0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">RT_CONVERT_LOCK</span>(_rt) do {					\
	RT_LOCK_ASSERT_HELD(_rt);					\
	lck_mtx_convert_spin(&amp;(_rt)-&gt;rt_lock);				\
} <span class="enscript-keyword">while</span> (0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">RT_UNLOCK</span>(_rt) do {						\
	rt_unlock(_rt);							\
} <span class="enscript-keyword">while</span> (0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">RT_ADDREF_LOCKED</span>(_rt) do {					\
	rtref(_rt);							\
} <span class="enscript-keyword">while</span> (0)

<span class="enscript-comment">/*
 * Spin variant mutex is used here; caller is responsible for
 * converting any previously-held similar lock to full mutex.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">RT_ADDREF</span>(_rt) do {						\
	RT_LOCK_SPIN(_rt);						\
	RT_ADDREF_LOCKED(_rt);						\
	RT_UNLOCK(_rt);							\
} <span class="enscript-keyword">while</span> (0)

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">RT_REMREF_LOCKED</span>(_rt) do {					\
	(<span class="enscript-type">void</span>) rtunref(_rt);						\
} <span class="enscript-keyword">while</span> (0)

<span class="enscript-comment">/*
 * Spin variant mutex is used here; caller is responsible for
 * converting any previously-held similar lock to full mutex.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">RT_REMREF</span>(_rt) do {						\
	RT_LOCK_SPIN(_rt);						\
	RT_REMREF_LOCKED(_rt);						\
	RT_UNLOCK(_rt);							\
} <span class="enscript-keyword">while</span> (0)

<span class="enscript-comment">/*
 * This macro calculates skew in wall clock, just in case the user changes the
 * system time. This skew adjustment is required because we now keep the
 * expiration times in uptime terms in the kernel, but the userland still
 * expects expiration times in terms of calendar times.  This is used when
 * reporting rt_expire, ln_expire, etc. values to user space.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">NET_CALCULATE_CLOCKSKEW</span>(cc, ic, cu, iu)				\
	((cc.tv_sec - ic) - (cu - iu))

<span class="enscript-type">extern</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> rt_verbose;
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> radix_node_head *rt_tables[AF_MAX+1];
<span class="enscript-type">extern</span> lck_mtx_t *rnh_lock;
<span class="enscript-type">extern</span> uint32_t route_genid_inet;	<span class="enscript-comment">/* INET route generation count */</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">INET6</span>
<span class="enscript-type">extern</span> uint32_t route_genid_inet6;	<span class="enscript-comment">/* INET6 route generation count */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* INET6 */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> rttrash;
<span class="enscript-type">extern</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> rte_debug;

<span class="enscript-type">struct</span> ifmultiaddr;
<span class="enscript-type">struct</span> proc;

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">route_init</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">routegenid_update</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">routegenid_inet_update</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">routegenid_inet6_update</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rt_ifmsg</span>(<span class="enscript-type">struct</span> ifnet *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rt_missmsg</span>(<span class="enscript-type">int</span>, <span class="enscript-type">struct</span> rt_addrinfo *, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rt_newaddrmsg</span>(<span class="enscript-type">int</span>, <span class="enscript-type">struct</span> ifaddr *, <span class="enscript-type">int</span>, <span class="enscript-type">struct</span> rtentry *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rt_newmaddrmsg</span>(<span class="enscript-type">int</span>, <span class="enscript-type">struct</span> ifmultiaddr *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">rt_setgate</span>(<span class="enscript-type">struct</span> rtentry *, <span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">struct</span> sockaddr *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">set_primary_ifscope</span>(<span class="enscript-type">int</span>, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> <span class="enscript-function-name">get_primary_ifscope</span>(<span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> boolean_t <span class="enscript-function-name">rt_primary_default</span>(<span class="enscript-type">struct</span> rtentry *, <span class="enscript-type">struct</span> sockaddr *);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> rtentry *<span class="enscript-function-name">rt_lookup</span>(boolean_t, <span class="enscript-type">struct</span> sockaddr *,
    <span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">struct</span> radix_node_head *, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> rtentry *<span class="enscript-function-name">rt_lookup_coarse</span>(boolean_t, <span class="enscript-type">struct</span> sockaddr *,
    <span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">struct</span> radix_node_head *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rtalloc</span>(<span class="enscript-type">struct</span> route *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rtalloc_scoped</span>(<span class="enscript-type">struct</span> route *, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rtalloc_ign</span>(<span class="enscript-type">struct</span> route *, uint32_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rtalloc_scoped_ign</span>(<span class="enscript-type">struct</span> route *, uint32_t, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> rtentry *<span class="enscript-function-name">rtalloc1</span>(<span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">int</span>, uint32_t);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> rtentry *<span class="enscript-function-name">rtalloc1_scoped</span>(<span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">int</span>, uint32_t,
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> rtentry *<span class="enscript-function-name">rtalloc1_scoped_locked</span>(<span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">int</span>,
    uint32_t, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rtfree_locked</span>(<span class="enscript-type">struct</span> rtentry *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rtfree</span>(<span class="enscript-type">struct</span> rtentry *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rtref</span>(<span class="enscript-type">struct</span> rtentry *);
<span class="enscript-comment">/*
 * rtunref will decrement the refcount, rtfree will decrement and free if
 * the refcount has reached zero and the route is not up.
 * Unless you have good reason to do otherwise, use rtfree.
 */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">rtunref</span>(<span class="enscript-type">struct</span> rtentry *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rtsetifa</span>(<span class="enscript-type">struct</span> rtentry *, <span class="enscript-type">struct</span> ifaddr *);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">rtinit</span>(<span class="enscript-type">struct</span> ifaddr *, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">rtinit_locked</span>(<span class="enscript-type">struct</span> ifaddr *, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">rtioctl</span>(<span class="enscript-type">unsigned</span> <span class="enscript-type">long</span>, caddr_t, <span class="enscript-type">struct</span> proc *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rtredirect</span>(<span class="enscript-type">struct</span> ifnet *, <span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">struct</span> sockaddr *,
    <span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">int</span>, <span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">struct</span> rtentry **);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">rtrequest</span>(<span class="enscript-type">int</span>, <span class="enscript-type">struct</span> sockaddr *,
    <span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">int</span>, <span class="enscript-type">struct</span> rtentry **);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">rtrequest_scoped</span>(<span class="enscript-type">int</span>, <span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">struct</span> sockaddr *,
    <span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">int</span>, <span class="enscript-type">struct</span> rtentry **, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">rtrequest_locked</span>(<span class="enscript-type">int</span>, <span class="enscript-type">struct</span> sockaddr *,
    <span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">int</span>, <span class="enscript-type">struct</span> rtentry **);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">rtrequest_scoped_locked</span>(<span class="enscript-type">int</span>, <span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">struct</span> sockaddr *,
    <span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">int</span>, <span class="enscript-type">struct</span> rtentry **, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">sin_set_ifscope</span>(<span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sin_get_ifscope</span>(<span class="enscript-type">struct</span> sockaddr *);
<span class="enscript-type">extern</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> <span class="enscript-function-name">sin6_get_ifscope</span>(<span class="enscript-type">struct</span> sockaddr *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rt_lock</span>(<span class="enscript-type">struct</span> rtentry *, boolean_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rt_unlock</span>(<span class="enscript-type">struct</span> rtentry *);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> sockaddr *<span class="enscript-function-name">rtm_scrub</span>(<span class="enscript-type">int</span>, <span class="enscript-type">int</span>, <span class="enscript-type">struct</span> sockaddr *,
    <span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">void</span> *, uint32_t, kauth_cred_t *);
<span class="enscript-type">extern</span> boolean_t <span class="enscript-function-name">rt_validate</span>(<span class="enscript-type">struct</span> rtentry *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rt_set_proxy</span>(<span class="enscript-type">struct</span> rtentry *, boolean_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rt_set_gwroute</span>(<span class="enscript-type">struct</span> rtentry *, <span class="enscript-type">struct</span> sockaddr *,
    <span class="enscript-type">struct</span> rtentry *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rt_revalidate_gwroute</span>(<span class="enscript-type">struct</span> rtentry *, <span class="enscript-type">struct</span> rtentry *);
<span class="enscript-type">extern</span> errno_t <span class="enscript-function-name">route_to_gwroute</span>(<span class="enscript-type">const</span> <span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">struct</span> rtentry *,
    <span class="enscript-type">struct</span> rtentry **);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rt_setexpire</span>(<span class="enscript-type">struct</span> rtentry *, uint64_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">rt_str</span>(<span class="enscript-type">struct</span> rtentry *, <span class="enscript-type">char</span> *, uint32_t, <span class="enscript-type">char</span> *, uint32_t);
<span class="enscript-type">extern</span> <span class="enscript-type">const</span> <span class="enscript-type">char</span> *<span class="enscript-function-name">rtm2str</span>(<span class="enscript-type">int</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">route_copyin</span>(<span class="enscript-type">struct</span> route *, <span class="enscript-type">struct</span> route *, size_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">route_copyout</span>(<span class="enscript-type">struct</span> route *, <span class="enscript-type">const</span> <span class="enscript-type">struct</span> route *, size_t);
<span class="enscript-type">extern</span> boolean_t <span class="enscript-function-name">rt_ifa_is_dst</span>(<span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">struct</span> ifaddr *);
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> sockaddr *<span class="enscript-function-name">sa_copy</span>(<span class="enscript-type">struct</span> sockaddr *, <span class="enscript-type">struct</span> sockaddr_storage *,
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> *);
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* BSD_KERNEL_PRIVATE */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* _NET_ROUTE_H_ */</span>
</pre>
<hr />
</body></html>