<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>conf.c</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">conf.c&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 1997-2012 Apple Computer, Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*
 * Copyright (c) 1993 NeXT Computer, Inc.
 *
 * UNIX Device switch tables.
 *
 * HISTORY
 *
 * 30 July 1997 Umesh Vaishampayan (<a href="mailto:umeshv@apple.com">umeshv@apple.com</a>)
 * 	enabled file descriptor pseudo-device.
 * 18 June 1993 ? at NeXT
 *	Cleaned up a lot of stuff in this file.
 */</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/param.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/systm.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/ioctl.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/tty.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/conf.h&gt;</span>

<span class="enscript-comment">/* Prototypes that should be elsewhere: */</span>
<span class="enscript-type">extern</span> dev_t	chrtoblk(dev_t dev);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	chrtoblk_set(<span class="enscript-type">int</span> cdev, <span class="enscript-type">int</span> bdev);

<span class="enscript-type">struct</span> bdevsw	bdevsw[] =
{
	<span class="enscript-comment">/*
	 *	For block devices, every other block of 8 slots is 
	 *	reserved for Apple.  The other slots are available for
	 *	the user.  This way we can both add new entries without
	 *	running into each other.  Be sure to fill in Apple's
	 *	8 reserved slots when you jump over us -- we'll do the
	 *	same for you.
	 */</span>

	<span class="enscript-comment">/* 0 - 7 are reserved for Apple */</span>

	NO_BDEVICE,							<span class="enscript-comment">/* 0*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/* 1*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/* 2*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/* 3*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/* 4*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/* 5*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/* 6*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/* 7*/</span>

	<span class="enscript-comment">/* 8 - 15 are reserved to the user */</span>
	NO_BDEVICE,							<span class="enscript-comment">/* 8*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/* 9*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/*10*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/*11*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/*12*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/*13*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/*14*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/*15*/</span>

	<span class="enscript-comment">/* 16 - 23 are reserved for Apple */</span>
	NO_BDEVICE,							<span class="enscript-comment">/*16*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/*17*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/*18*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/*18*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/*20*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/*21*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/*22*/</span>
	NO_BDEVICE,							<span class="enscript-comment">/*23*/</span>
};

<span class="enscript-type">int</span>	nblkdev = <span class="enscript-keyword">sizeof</span> (bdevsw) / <span class="enscript-keyword">sizeof</span> (bdevsw[0]);

<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> tty *km_tty[];
<span class="enscript-type">extern</span> d_open_t		cnopen;
<span class="enscript-type">extern</span> d_close_t	cnclose;
<span class="enscript-type">extern</span> d_read_t		cnread;
<span class="enscript-type">extern</span> d_write_t	cnwrite;
<span class="enscript-type">extern</span> d_ioctl_t	cnioctl;
<span class="enscript-type">extern</span> d_select_t	cnselect;
<span class="enscript-type">extern</span> d_open_t		kmopen;
<span class="enscript-type">extern</span> d_close_t	kmclose;
<span class="enscript-type">extern</span> d_read_t		kmread;
<span class="enscript-type">extern</span> d_write_t	kmwrite;
<span class="enscript-type">extern</span> d_ioctl_t	kmioctl;
<span class="enscript-type">extern</span> d_open_t		sgopen;
<span class="enscript-type">extern</span> d_close_t	sgclose;
<span class="enscript-type">extern</span> d_ioctl_t	sgioctl;

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">NVOL</span> &gt; 0
<span class="enscript-type">extern</span> d_open_t		volopen;
<span class="enscript-type">extern</span> d_close_t	volclose;
<span class="enscript-type">extern</span> d_ioctl_t	volioctl;
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">volopen</span>		eno_opcl
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">volclose</span>	eno_opcl
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">volioctl</span>	eno_ioctl
#<span class="enscript-reference">endif</span>

<span class="enscript-type">extern</span> d_open_t		cttyopen;
<span class="enscript-type">extern</span> d_read_t		cttyread;
<span class="enscript-type">extern</span> d_write_t	cttywrite;
<span class="enscript-type">extern</span> d_ioctl_t	cttyioctl;
<span class="enscript-type">extern</span> d_select_t	cttyselect;

<span class="enscript-type">extern</span> d_read_t		mmread;
<span class="enscript-type">extern</span> d_write_t	mmwrite;
<span class="enscript-type">extern</span> d_ioctl_t	mmioctl;
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">mmselect</span>	(select_fcn_t *)seltrue
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">mmmmap</span>		eno_mmap

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;pty.h&gt;</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">NPTY</span> &gt; 0
<span class="enscript-type">extern</span> d_open_t		ptsopen;
<span class="enscript-type">extern</span> d_close_t	ptsclose;
<span class="enscript-type">extern</span> d_read_t		ptsread;
<span class="enscript-type">extern</span> d_write_t	ptswrite;
<span class="enscript-type">extern</span> d_stop_t		ptsstop;
<span class="enscript-type">extern</span> d_select_t	ptsselect;
<span class="enscript-type">extern</span> d_open_t		ptcopen;
<span class="enscript-type">extern</span> d_close_t	ptcclose;
<span class="enscript-type">extern</span> d_read_t		ptcread;
<span class="enscript-type">extern</span> d_write_t	ptcwrite;
<span class="enscript-type">extern</span> d_select_t	ptcselect;
<span class="enscript-type">extern</span> d_ioctl_t	ptyioctl;
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">ptsopen</span>		eno_opcl
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">ptsclose</span>	eno_opcl
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">ptsread</span>		eno_rdwrt
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">ptswrite</span>	eno_rdwrt
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ptsstop</span>		nulldev

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">ptcopen</span>		eno_opcl
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">ptcclose</span>	eno_opcl
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">ptcread</span>		eno_rdwrt
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">ptcwrite</span>	eno_rdwrt
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ptcselect</span>	eno_select
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">ptyioctl</span>	eno_ioctl
#<span class="enscript-reference">endif</span>

<span class="enscript-type">extern</span> d_open_t		logopen;
<span class="enscript-type">extern</span> d_close_t	logclose;
<span class="enscript-type">extern</span> d_read_t		logread;
<span class="enscript-type">extern</span> d_ioctl_t	logioctl;
<span class="enscript-type">extern</span> d_select_t	logselect;
<span class="enscript-type">extern</span> d_open_t		fdesc_open;
<span class="enscript-type">extern</span> d_read_t		fdesc_read;
<span class="enscript-type">extern</span> d_write_t	fdesc_write;
<span class="enscript-type">extern</span> d_ioctl_t	fdesc_ioctl;
<span class="enscript-type">extern</span> d_select_t	fdesc_select;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">nullopen</span>	(d_open_t *)&amp;nulldev
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">nullclose</span>	(d_close_t *)&amp;nulldev
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">nullread</span>	(d_read_t *)&amp;nulldev
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">nullwrite</span>	(d_write_t *)&amp;nulldev
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">nullioctl</span>	(d_ioctl_t *)&amp;nulldev
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">nullselect</span>	(d_select_t *)&amp;nulldev
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">nullstop</span>	(d_stop_t *)&amp;nulldev
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">nullreset</span>	(d_reset_t *)&amp;nulldev

<span class="enscript-type">struct</span> cdevsw	cdevsw[] =
{
	<span class="enscript-comment">/*
	 *	For character devices, every other block of 16 slots is
	 *	reserved for Apple.  The other slots are available for
	 *	the user.  This way we can both add new entries without
	 *	running into each other.  Be sure to fill in Apple's
	 *	16 reserved slots when you jump over us -- we'll do the
	 *	same for you.
	 */</span>

	<span class="enscript-comment">/* 0 - 15 are reserved for Apple */</span>

    {
	cnopen,		cnclose,	cnread,		cnwrite,	<span class="enscript-comment">/* 0*/</span>
	cnioctl,	nullstop,	nullreset,	0,		cnselect,
	eno_mmap,	eno_strat,	eno_getc,	eno_putc, 	D_TTY
    },
    NO_CDEVICE,								<span class="enscript-comment">/* 1*/</span>
    {
	cttyopen,	nullclose,	cttyread,	cttywrite,	<span class="enscript-comment">/* 2*/</span>
	cttyioctl,	nullstop,	nullreset,	0,		cttyselect,
	eno_mmap,	eno_strat,	eno_getc,	eno_putc,	D_TTY
    },
    {
	nullopen,	nullclose,	mmread,		mmwrite,	<span class="enscript-comment">/* 3*/</span>
	mmioctl,	nullstop,	nullreset,	0,		mmselect,
	mmmmap,		eno_strat,	eno_getc,	eno_putc,	D_DISK
    },
    {
	ptsopen,	ptsclose,	ptsread,	ptswrite,	<span class="enscript-comment">/* 4*/</span>
	ptyioctl,	ptsstop,	nullreset,	0,		ptsselect,
	eno_mmap,	eno_strat,	eno_getc,	eno_putc,	D_TTY
    },
    {
	ptcopen,	ptcclose,	ptcread,	ptcwrite,	<span class="enscript-comment">/* 5*/</span>
	ptyioctl,	nullstop,	nullreset,	0,		ptcselect,
	eno_mmap,	eno_strat,	eno_getc,	eno_putc,	D_TTY
    },
    {
	logopen,	logclose,	logread,	eno_rdwrt,	<span class="enscript-comment">/* 6*/</span>
	logioctl,	eno_stop,	nullreset,	0,		logselect,
	eno_mmap,	eno_strat,	eno_getc,	eno_putc,	0
    },
    NO_CDEVICE,								<span class="enscript-comment">/* 7*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/* 8*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/* 9*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*10*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*11*/</span>
    {
	kmopen,		kmclose,	kmread,		kmwrite,	<span class="enscript-comment">/*12*/</span>
	kmioctl,	nullstop,	nullreset,	km_tty,		ttselect,
	eno_mmap,	eno_strat,	eno_getc,	eno_putc,	0
    },
    NO_CDEVICE,								<span class="enscript-comment">/*13*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*14*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*15*/</span>

	<span class="enscript-comment">/* 16 - 31 are reserved to the user */</span>
    NO_CDEVICE,								<span class="enscript-comment">/*16*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*17*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*18*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*19*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*20*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*21*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*22*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*23*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*24*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*25*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*26*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*27*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*28*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*29*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*30*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*31*/</span>

	<span class="enscript-comment">/* 32 - 47 are reserved to NeXT */</span>
    {
	fdesc_open,	eno_opcl,	fdesc_read,	fdesc_write,	<span class="enscript-comment">/*32*/</span>
	fdesc_ioctl,	eno_stop,	eno_reset,	0,		fdesc_select,
	eno_mmap,	eno_strat,	eno_getc,	eno_putc,	0
    },
#<span class="enscript-reference">if</span> 1
   NO_CDEVICE,
#<span class="enscript-reference">else</span>
    {
	sgopen,		sgclose,	eno_rdwrt,	eno_rdwrt,	<span class="enscript-comment">/*33*/</span>
	sgioctl,	eno_stop,	eno_reset,	0,		eno_select,
	eno_mmap,	eno_strat,	eno_getc,	eno_putc,	D_TAPE
    },
#<span class="enscript-reference">endif</span>
    NO_CDEVICE,								<span class="enscript-comment">/*34*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*35*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*36*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*37*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*38*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*39*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*40*/</span>
    NO_CDEVICE,								<span class="enscript-comment">/*41*/</span>
    {
	volopen,	volclose,	eno_rdwrt,	eno_rdwrt,	<span class="enscript-comment">/*42*/</span>
	volioctl,	eno_stop,	eno_reset,	0,		(select_fcn_t *)seltrue,
	eno_mmap,	eno_strat,	eno_getc,	eno_putc,	0
    },
};
<span class="enscript-type">int</span>	nchrdev = <span class="enscript-keyword">sizeof</span> (cdevsw) / <span class="enscript-keyword">sizeof</span> (cdevsw[0]);

uint64_t cdevsw_flags[<span class="enscript-keyword">sizeof</span> (cdevsw) / <span class="enscript-keyword">sizeof</span> (cdevsw[0])];

#<span class="enscript-reference">include</span>	<span class="enscript-string">&lt;sys/vnode.h&gt;</span> <span class="enscript-comment">/* for VCHR and VBLK */</span>
<span class="enscript-comment">/*
 * return true if a disk
 */</span>
<span class="enscript-type">int</span>
<span class="enscript-function-name">isdisk</span>(dev_t dev, <span class="enscript-type">int</span> type)
{
	dev_t	maj = major(dev);

	<span class="enscript-keyword">switch</span> (type) {
	<span class="enscript-keyword">case</span> <span class="enscript-reference">VCHR</span>:
		maj = chrtoblk(maj);
		<span class="enscript-keyword">if</span> (maj == NODEV) {
			<span class="enscript-keyword">break</span>;
		}
		<span class="enscript-comment">/* FALL THROUGH */</span>
	<span class="enscript-keyword">case</span> <span class="enscript-reference">VBLK</span>:
		<span class="enscript-keyword">if</span> (bdevsw[maj].d_type == D_DISK) {
			<span class="enscript-keyword">return</span> (1);
		}
		<span class="enscript-keyword">break</span>;
	}
	<span class="enscript-keyword">return</span>(0);
}

<span class="enscript-type">static</span> <span class="enscript-type">int</span> chrtoblktab[] = {
	<span class="enscript-comment">/* CHR*/</span>	<span class="enscript-comment">/* BLK*/</span>	<span class="enscript-comment">/* CHR*/</span>	<span class="enscript-comment">/* BLK*/</span>
	<span class="enscript-comment">/*  0 */</span>	NODEV,		<span class="enscript-comment">/*  1 */</span>	NODEV,
	<span class="enscript-comment">/*  2 */</span>	NODEV,		<span class="enscript-comment">/*  3 */</span>	NODEV,
	<span class="enscript-comment">/*  4 */</span>	NODEV,		<span class="enscript-comment">/*  5 */</span>	NODEV,
	<span class="enscript-comment">/*  6 */</span>	NODEV,		<span class="enscript-comment">/*  7 */</span>	NODEV,
	<span class="enscript-comment">/*  8 */</span>	NODEV,		<span class="enscript-comment">/*  9 */</span>	NODEV,
	<span class="enscript-comment">/* 10 */</span>	NODEV,		<span class="enscript-comment">/* 11 */</span>	NODEV,
	<span class="enscript-comment">/* 12 */</span>	NODEV,		<span class="enscript-comment">/* 13 */</span>	NODEV,
	<span class="enscript-comment">/* 14 */</span>	NODEV,		<span class="enscript-comment">/* 15 */</span>	NODEV,
	<span class="enscript-comment">/* 16 */</span>	NODEV,		<span class="enscript-comment">/* 17 */</span>	NODEV,
	<span class="enscript-comment">/* 18 */</span>	NODEV,		<span class="enscript-comment">/* 19 */</span>	NODEV,
	<span class="enscript-comment">/* 20 */</span>	NODEV,		<span class="enscript-comment">/* 21 */</span>	NODEV,
	<span class="enscript-comment">/* 22 */</span>	NODEV,		<span class="enscript-comment">/* 23 */</span>	NODEV,
	<span class="enscript-comment">/* 24 */</span>	NODEV,		<span class="enscript-comment">/* 25 */</span>	NODEV,
	<span class="enscript-comment">/* 26 */</span>	NODEV,		<span class="enscript-comment">/* 27 */</span>	NODEV,
	<span class="enscript-comment">/* 28 */</span>	NODEV,		<span class="enscript-comment">/* 29 */</span>	NODEV,
	<span class="enscript-comment">/* 30 */</span>	NODEV,		<span class="enscript-comment">/* 31 */</span>	NODEV,
	<span class="enscript-comment">/* 32 */</span>	NODEV,		<span class="enscript-comment">/* 33 */</span>	NODEV,
	<span class="enscript-comment">/* 34 */</span>	NODEV,		<span class="enscript-comment">/* 35 */</span>	NODEV,
	<span class="enscript-comment">/* 36 */</span>	NODEV,		<span class="enscript-comment">/* 37 */</span>	NODEV,
	<span class="enscript-comment">/* 38 */</span>	NODEV,		<span class="enscript-comment">/* 39 */</span>	NODEV,
	<span class="enscript-comment">/* 40 */</span>	NODEV,		<span class="enscript-comment">/* 41 */</span>	NODEV,
	<span class="enscript-comment">/* 42 */</span>	NODEV,		<span class="enscript-comment">/* 43 */</span>	NODEV,
	<span class="enscript-comment">/* 44 */</span>	NODEV,
};

<span class="enscript-comment">/*
 * convert chr dev to blk dev
 */</span>
dev_t
<span class="enscript-function-name">chrtoblk</span>(dev_t dev)
{
	<span class="enscript-type">int</span> blkmaj;

	<span class="enscript-keyword">if</span> (major(dev) &gt;= nchrdev)
		<span class="enscript-keyword">return</span>(NODEV);
	blkmaj = chrtoblktab[major(dev)];
	<span class="enscript-keyword">if</span> (blkmaj == NODEV)
		<span class="enscript-keyword">return</span>(NODEV);
	<span class="enscript-keyword">return</span>(makedev(blkmaj, minor(dev)));
}

<span class="enscript-type">int</span>
<span class="enscript-function-name">chrtoblk_set</span>(<span class="enscript-type">int</span> cdev, <span class="enscript-type">int</span> bdev)
{
	<span class="enscript-keyword">if</span> (cdev &gt;= nchrdev)
		<span class="enscript-keyword">return</span> (-1);
	<span class="enscript-keyword">if</span> (bdev != NODEV &amp;&amp; bdev &gt;= nblkdev)
		<span class="enscript-keyword">return</span> (-1);
	chrtoblktab[cdev] = bdev;
	<span class="enscript-keyword">return</span> 0;
}

</pre>
<hr />
</body></html>