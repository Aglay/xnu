<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>sysctl.c</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">sysctl.c&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2003-2011 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;string.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/param.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/kernel.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/sysctl.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;i386/cpuid.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;i386/tsc.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;i386/machine_routines.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;i386/pal_routines.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;i386/ucode.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;kern/clock.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;libkern/libkern.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;i386/lapic.h&gt;</span>


<span class="enscript-type">static</span> <span class="enscript-type">int</span>
_i386_cpu_info SYSCTL_HANDLER_ARGS
{
    __unused <span class="enscript-type">struct</span> sysctl_oid *unused_oidp = oidp;
    <span class="enscript-type">void</span> *ptr = arg1;
    <span class="enscript-type">int</span> value;

    <span class="enscript-keyword">if</span> (arg2 == -1) {
        ptr = *(<span class="enscript-type">void</span> **)ptr;
        arg2 = 0;
    }

    <span class="enscript-keyword">if</span> (arg2 == 0 &amp;&amp; ((<span class="enscript-type">char</span> *)ptr)[0] == <span class="enscript-string">'\0'</span>) {
        <span class="enscript-keyword">return</span> ENOENT;
    }

    <span class="enscript-keyword">if</span> (arg2 == <span class="enscript-keyword">sizeof</span>(uint8_t)) {
	value = (uint32_t) *(uint8_t *)ptr;
	ptr = &amp;value;
	arg2 = <span class="enscript-keyword">sizeof</span>(uint32_t);
    }
    <span class="enscript-keyword">return</span> SYSCTL_OUT(req, ptr, arg2 ? (size_t) arg2 : strlen((<span class="enscript-type">char</span> *)ptr)+1);
}

<span class="enscript-type">static</span> <span class="enscript-type">int</span>
i386_cpu_info SYSCTL_HANDLER_ARGS
{
    <span class="enscript-type">void</span> *ptr = (uint8_t *)cpuid_info() + (uintptr_t)arg1;
    <span class="enscript-keyword">return</span> _i386_cpu_info(oidp, ptr, arg2, req);
}

<span class="enscript-type">static</span> <span class="enscript-type">int</span>
i386_cpu_info_nonzero SYSCTL_HANDLER_ARGS
{
    <span class="enscript-type">void</span> *ptr = (uint8_t *)cpuid_info() + (uintptr_t)arg1;
    <span class="enscript-type">int</span> value = *(uint32_t *)ptr;

    <span class="enscript-keyword">if</span> (value == 0)
        <span class="enscript-keyword">return</span> ENOENT;

    <span class="enscript-keyword">return</span> _i386_cpu_info(oidp, ptr, arg2, req);
}
<span class="enscript-type">static</span> <span class="enscript-type">int</span>
cpu_mwait SYSCTL_HANDLER_ARGS
{
    i386_cpu_info_t *cpu_info = cpuid_info();
    <span class="enscript-type">void</span> *ptr = (uint8_t *)cpu_info-&gt;cpuid_mwait_leafp + (uintptr_t)arg1;
    <span class="enscript-keyword">if</span> (cpu_info-&gt;cpuid_mwait_leafp == NULL)
        <span class="enscript-keyword">return</span> ENOENT;
    <span class="enscript-keyword">return</span> _i386_cpu_info(oidp, ptr, arg2, req);
}

<span class="enscript-type">static</span> <span class="enscript-type">int</span>
cpu_thermal SYSCTL_HANDLER_ARGS
{
    i386_cpu_info_t *cpu_info = cpuid_info();
    <span class="enscript-type">void</span> *ptr = (uint8_t *)cpu_info-&gt;cpuid_thermal_leafp + (uintptr_t)arg1;
    <span class="enscript-keyword">if</span> (cpu_info-&gt;cpuid_thermal_leafp == NULL)
        <span class="enscript-keyword">return</span> ENOENT;
    <span class="enscript-keyword">return</span> _i386_cpu_info(oidp, ptr, arg2, req);
}

<span class="enscript-type">static</span> <span class="enscript-type">int</span>
cpu_arch_perf SYSCTL_HANDLER_ARGS
{
    i386_cpu_info_t *cpu_info = cpuid_info();
    <span class="enscript-type">void</span> *ptr = (uint8_t *)cpu_info-&gt;cpuid_arch_perf_leafp + (uintptr_t)arg1;
    <span class="enscript-keyword">if</span> (cpu_info-&gt;cpuid_arch_perf_leafp == NULL)
        <span class="enscript-keyword">return</span> ENOENT;
    <span class="enscript-keyword">return</span> _i386_cpu_info(oidp, ptr, arg2, req);
}

<span class="enscript-type">static</span> <span class="enscript-type">int</span>
cpu_xsave SYSCTL_HANDLER_ARGS
{
    i386_cpu_info_t *cpu_info = cpuid_info();
    <span class="enscript-type">void</span> *ptr = (uint8_t *)cpu_info-&gt;cpuid_xsave_leafp + (uintptr_t)arg1;
    <span class="enscript-keyword">if</span> (cpu_info-&gt;cpuid_xsave_leafp == NULL)
        <span class="enscript-keyword">return</span> ENOENT;
    <span class="enscript-keyword">return</span> _i386_cpu_info(oidp, ptr, arg2, req);
}


<span class="enscript-type">static</span> <span class="enscript-type">int</span>
cpu_features SYSCTL_HANDLER_ARGS
{
    __unused <span class="enscript-type">struct</span> sysctl_oid *unused_oidp = oidp;
    __unused <span class="enscript-type">void</span> *unused_arg1 = arg1;
    __unused <span class="enscript-type">int</span> unused_arg2 = arg2; 
    <span class="enscript-type">char</span> buf[512];

    buf[0] = <span class="enscript-string">'\0'</span>;
    cpuid_get_feature_names(cpuid_features(), buf, <span class="enscript-keyword">sizeof</span>(buf));

    <span class="enscript-keyword">return</span> SYSCTL_OUT(req, buf, strlen(buf) + 1);
}

<span class="enscript-type">static</span> <span class="enscript-type">int</span>
cpu_extfeatures SYSCTL_HANDLER_ARGS
{
    __unused <span class="enscript-type">struct</span> sysctl_oid *unused_oidp = oidp;
    __unused <span class="enscript-type">void</span> *unused_arg1 = arg1;
    __unused <span class="enscript-type">int</span> unused_arg2 = arg2; 
    <span class="enscript-type">char</span> buf[512];

    buf[0] = <span class="enscript-string">'\0'</span>;
    cpuid_get_extfeature_names(cpuid_extfeatures(), buf, <span class="enscript-keyword">sizeof</span>(buf));

    <span class="enscript-keyword">return</span> SYSCTL_OUT(req, buf, strlen(buf) + 1);
}

<span class="enscript-type">static</span> <span class="enscript-type">int</span>
cpu_leaf7_features SYSCTL_HANDLER_ARGS
{
    __unused <span class="enscript-type">struct</span> sysctl_oid *unused_oidp = oidp;
    __unused <span class="enscript-type">void</span> *unused_arg1 = arg1;
    __unused <span class="enscript-type">int</span> unused_arg2 = arg2; 
    <span class="enscript-type">char</span> buf[512];

    uint32_t	leaf7_features = cpuid_info()-&gt;cpuid_leaf7_features;
    <span class="enscript-keyword">if</span> (leaf7_features == 0)
        <span class="enscript-keyword">return</span> ENOENT;

    buf[0] = <span class="enscript-string">'\0'</span>;
    cpuid_get_leaf7_feature_names(leaf7_features, buf, <span class="enscript-keyword">sizeof</span>(buf));

    <span class="enscript-keyword">return</span> SYSCTL_OUT(req, buf, strlen(buf) + 1);
}

<span class="enscript-type">static</span> <span class="enscript-type">int</span>
cpu_logical_per_package SYSCTL_HANDLER_ARGS
{
	__unused <span class="enscript-type">struct</span> sysctl_oid *unused_oidp = oidp;
	__unused <span class="enscript-type">void</span> *unused_arg1 = arg1;
	__unused <span class="enscript-type">int</span> unused_arg2 = arg2;
	i386_cpu_info_t *cpu_info = cpuid_info();

	<span class="enscript-keyword">if</span> (!(cpuid_features() &amp; CPUID_FEATURE_HTT))
		<span class="enscript-keyword">return</span> ENOENT;

	<span class="enscript-keyword">return</span> SYSCTL_OUT(req, &amp;cpu_info-&gt;cpuid_logical_per_package,
			  <span class="enscript-keyword">sizeof</span>(cpu_info-&gt;cpuid_logical_per_package));
}

<span class="enscript-type">static</span> <span class="enscript-type">int</span>
cpu_flex_ratio_desired SYSCTL_HANDLER_ARGS
{
	__unused <span class="enscript-type">struct</span> sysctl_oid *unused_oidp = oidp;
	__unused <span class="enscript-type">void</span> *unused_arg1 = arg1;
	__unused <span class="enscript-type">int</span> unused_arg2 = arg2;
	i386_cpu_info_t *cpu_info = cpuid_info();

	<span class="enscript-keyword">if</span> (cpu_info-&gt;cpuid_model != 26)
		<span class="enscript-keyword">return</span> ENOENT;

	<span class="enscript-keyword">return</span> SYSCTL_OUT(req, &amp;flex_ratio, <span class="enscript-keyword">sizeof</span>(flex_ratio));
}

<span class="enscript-type">static</span> <span class="enscript-type">int</span>
cpu_flex_ratio_min SYSCTL_HANDLER_ARGS
{
	__unused <span class="enscript-type">struct</span> sysctl_oid *unused_oidp = oidp;
	__unused <span class="enscript-type">void</span> *unused_arg1 = arg1;
	__unused <span class="enscript-type">int</span> unused_arg2 = arg2;
	i386_cpu_info_t *cpu_info = cpuid_info();

	<span class="enscript-keyword">if</span> (cpu_info-&gt;cpuid_model != 26)
		<span class="enscript-keyword">return</span> ENOENT;

	<span class="enscript-keyword">return</span> SYSCTL_OUT(req, &amp;flex_ratio_min, <span class="enscript-keyword">sizeof</span>(flex_ratio_min));
}

<span class="enscript-type">static</span> <span class="enscript-type">int</span>
cpu_flex_ratio_max SYSCTL_HANDLER_ARGS
{
	__unused <span class="enscript-type">struct</span> sysctl_oid *unused_oidp = oidp;
	__unused <span class="enscript-type">void</span> *unused_arg1 = arg1;
	__unused <span class="enscript-type">int</span> unused_arg2 = arg2;
	i386_cpu_info_t *cpu_info = cpuid_info();

	<span class="enscript-keyword">if</span> (cpu_info-&gt;cpuid_model != 26)
		<span class="enscript-keyword">return</span> ENOENT;

	<span class="enscript-keyword">return</span> SYSCTL_OUT(req, &amp;flex_ratio_max, <span class="enscript-keyword">sizeof</span>(flex_ratio_max));
}

<span class="enscript-type">static</span> <span class="enscript-type">int</span>
cpu_ucode_update SYSCTL_HANDLER_ARGS
{
	__unused <span class="enscript-type">struct</span> sysctl_oid *unused_oidp = oidp;
	__unused <span class="enscript-type">void</span> *unused_arg1 = arg1;
	__unused <span class="enscript-type">int</span> unused_arg2 = arg2;
	uint64_t addr;
	<span class="enscript-type">int</span> error;
	
	error = SYSCTL_IN(req, &amp;addr, <span class="enscript-keyword">sizeof</span>(addr));
	<span class="enscript-keyword">if</span> (error)
		<span class="enscript-keyword">return</span> error;

	<span class="enscript-type">int</span> ret = ucode_interface(addr);
	<span class="enscript-keyword">return</span> ret;
}

<span class="enscript-type">extern</span> uint64_t panic_restart_timeout;
<span class="enscript-type">static</span> <span class="enscript-type">int</span>
<span class="enscript-function-name">panic_set_restart_timeout</span>(__unused <span class="enscript-type">struct</span> sysctl_oid *oidp, __unused <span class="enscript-type">void</span> *arg1, __unused <span class="enscript-type">int</span> arg2, <span class="enscript-type">struct</span> sysctl_req *req)
{
	<span class="enscript-type">int</span> new_value = 0, old_value = 0, changed = 0, error;
	uint64_t nstime;

	<span class="enscript-keyword">if</span> (panic_restart_timeout) {
		absolutetime_to_nanoseconds(panic_restart_timeout, &amp;nstime);
		old_value = nstime / NSEC_PER_SEC;
	}

	error = sysctl_io_number(req, old_value, <span class="enscript-keyword">sizeof</span>(<span class="enscript-type">int</span>), &amp;new_value, &amp;changed);
	<span class="enscript-keyword">if</span> (error == 0 &amp;&amp; changed) {
		nanoseconds_to_absolutetime(((uint64_t)new_value) * NSEC_PER_SEC, &amp;panic_restart_timeout);
	}
	<span class="enscript-keyword">return</span> error;
}

<span class="enscript-comment">/*
 * Populates the {CPU, vector, latency} triple for the maximum observed primary
 * interrupt latency
 */</span>
<span class="enscript-type">static</span> <span class="enscript-type">int</span>
<span class="enscript-function-name">misc_interrupt_latency_max</span>(__unused <span class="enscript-type">struct</span> sysctl_oid *oidp, __unused <span class="enscript-type">void</span> *arg1, __unused <span class="enscript-type">int</span> arg2, <span class="enscript-type">struct</span> sysctl_req *req)
{
	<span class="enscript-type">int</span> changed = 0, error;
	<span class="enscript-type">char</span> buf[128];
	buf[0] = <span class="enscript-string">'\0'</span>;

	interrupt_populate_latency_stats(buf, <span class="enscript-keyword">sizeof</span>(buf));

	error = sysctl_io_string(req, buf, <span class="enscript-keyword">sizeof</span>(buf), 0, &amp;changed);

	<span class="enscript-keyword">if</span> (error == 0 &amp;&amp; changed) {
		interrupt_reset_latency_stats();
	}

	<span class="enscript-keyword">return</span> error;
}

<span class="enscript-comment">/*
 * Triggers a machine-check exception - for a suitably configured kernel only.
 */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">mca_exception_panic</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">static</span> <span class="enscript-type">int</span>
<span class="enscript-function-name">misc_machine_check_panic</span>(__unused <span class="enscript-type">struct</span> sysctl_oid *oidp, __unused <span class="enscript-type">void</span> *arg1, __unused <span class="enscript-type">int</span> arg2, <span class="enscript-type">struct</span> sysctl_req *req)
{
	<span class="enscript-type">int</span> changed = 0, error;
	<span class="enscript-type">char</span> buf[128];
	buf[0] = <span class="enscript-string">'\0'</span>;

	error = sysctl_io_string(req, buf, <span class="enscript-keyword">sizeof</span>(buf), 0, &amp;changed);

	<span class="enscript-keyword">if</span> (error == 0 &amp;&amp; changed) {
		mca_exception_panic();
	}
	<span class="enscript-keyword">return</span> error;
}


<span class="enscript-function-name">SYSCTL_NODE</span>(_machdep, OID_AUTO, cpu, CTLFLAG_RW|CTLFLAG_LOCKED, 0,
	<span class="enscript-string">&quot;CPU info&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, max_basic, CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_max_basic),<span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info, <span class="enscript-string">&quot;IU&quot;</span>, <span class="enscript-string">&quot;Max Basic Information value&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, max_ext, CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_max_ext), <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info, <span class="enscript-string">&quot;IU&quot;</span>, <span class="enscript-string">&quot;Max Extended Function Information value&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, vendor, CTLTYPE_STRING | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_vendor), 0,
	    i386_cpu_info, <span class="enscript-string">&quot;A&quot;</span>, <span class="enscript-string">&quot;CPU vendor&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, brand_string, CTLTYPE_STRING | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_brand_string), 0,
	    i386_cpu_info, <span class="enscript-string">&quot;A&quot;</span>, <span class="enscript-string">&quot;CPU brand string&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, family, CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_family), <span class="enscript-keyword">sizeof</span>(uint8_t),
	    i386_cpu_info, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;CPU family&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, model, CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_model), <span class="enscript-keyword">sizeof</span>(uint8_t),
	    i386_cpu_info, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;CPU model&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, extmodel, CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_extmodel), <span class="enscript-keyword">sizeof</span>(uint8_t),
	    i386_cpu_info, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;CPU extended model&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, extfamily, CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_extfamily), <span class="enscript-keyword">sizeof</span>(uint8_t),
	    i386_cpu_info, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;CPU extended family&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, stepping, CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_stepping), <span class="enscript-keyword">sizeof</span>(uint8_t),
	    i386_cpu_info, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;CPU stepping&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, feature_bits, CTLTYPE_QUAD | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_features), <span class="enscript-keyword">sizeof</span>(uint64_t),
	    i386_cpu_info, <span class="enscript-string">&quot;IU&quot;</span>, <span class="enscript-string">&quot;CPU features&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, leaf7_feature_bits,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_leaf7_features),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info_nonzero, <span class="enscript-string">&quot;IU&quot;</span>, <span class="enscript-string">&quot;CPU Leaf7 features&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, extfeature_bits, CTLTYPE_QUAD | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_extfeatures), <span class="enscript-keyword">sizeof</span>(uint64_t),
	    i386_cpu_info, <span class="enscript-string">&quot;IU&quot;</span>, <span class="enscript-string">&quot;CPU extended features&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, signature, CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_signature), <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;CPU signature&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, brand, CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_brand), <span class="enscript-keyword">sizeof</span>(uint8_t),
	    i386_cpu_info, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;CPU brand&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, features, CTLTYPE_STRING | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    0, 0,
	    cpu_features, <span class="enscript-string">&quot;A&quot;</span>, <span class="enscript-string">&quot;CPU feature names&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, leaf7_features,
	    CTLTYPE_STRING | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    0, 0,
	    cpu_leaf7_features, <span class="enscript-string">&quot;A&quot;</span>, <span class="enscript-string">&quot;CPU Leaf7 feature names&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, extfeatures, CTLTYPE_STRING | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    0, 0,
	    cpu_extfeatures, <span class="enscript-string">&quot;A&quot;</span>, <span class="enscript-string">&quot;CPU extended feature names&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, logical_per_package,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    0, 0,
	    cpu_logical_per_package, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;CPU logical cpus per package&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, cores_per_package,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_cores_per_package),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;CPU cores per package&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, microcode_version,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_microcode_version),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Microcode version number&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, processor_flag,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_processor_flag),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;CPU processor flag&quot;</span>);


<span class="enscript-function-name">SYSCTL_NODE</span>(_machdep_cpu, OID_AUTO, mwait, CTLFLAG_RW|CTLFLAG_LOCKED, 0,
	<span class="enscript-string">&quot;mwait&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_mwait, OID_AUTO, linesize_min,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_mwait_leaf_t, linesize_min),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    cpu_mwait, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Monitor/mwait minimum line size&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_mwait, OID_AUTO, linesize_max,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_mwait_leaf_t, linesize_max),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    cpu_mwait, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Monitor/mwait maximum line size&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_mwait, OID_AUTO, extensions,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_mwait_leaf_t, extensions),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    cpu_mwait, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Monitor/mwait extensions&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_mwait, OID_AUTO, sub_Cstates,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_mwait_leaf_t, sub_Cstates),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    cpu_mwait, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Monitor/mwait sub C-states&quot;</span>);


<span class="enscript-function-name">SYSCTL_NODE</span>(_machdep_cpu, OID_AUTO, thermal, CTLFLAG_RW|CTLFLAG_LOCKED, 0,
	<span class="enscript-string">&quot;thermal&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_thermal, OID_AUTO, sensor,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_thermal_leaf_t, sensor),
	    <span class="enscript-keyword">sizeof</span>(boolean_t),
	    cpu_thermal, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Thermal sensor present&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_thermal, OID_AUTO, dynamic_acceleration,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_thermal_leaf_t, dynamic_acceleration),
	    <span class="enscript-keyword">sizeof</span>(boolean_t),
	    cpu_thermal, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Dynamic Acceleration Technology (Turbo Mode)&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_thermal, OID_AUTO, invariant_APIC_timer,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_thermal_leaf_t, invariant_APIC_timer),
	    <span class="enscript-keyword">sizeof</span>(boolean_t),
	    cpu_thermal, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Invariant APIC Timer&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_thermal, OID_AUTO, thresholds,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_thermal_leaf_t, thresholds),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    cpu_thermal, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Number of interrupt thresholds&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_thermal, OID_AUTO, ACNT_MCNT,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_thermal_leaf_t, ACNT_MCNT),
	    <span class="enscript-keyword">sizeof</span>(boolean_t),
	    cpu_thermal, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;ACNT_MCNT capability&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_thermal, OID_AUTO, core_power_limits,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_thermal_leaf_t, core_power_limits),
	    <span class="enscript-keyword">sizeof</span>(boolean_t),
	    cpu_thermal, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Power Limit Notifications at a Core Level&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_thermal, OID_AUTO, fine_grain_clock_mod,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_thermal_leaf_t, fine_grain_clock_mod),
	    <span class="enscript-keyword">sizeof</span>(boolean_t),
	    cpu_thermal, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Fine Grain Clock Modulation&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_thermal, OID_AUTO, package_thermal_intr,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_thermal_leaf_t, package_thermal_intr),
	    <span class="enscript-keyword">sizeof</span>(boolean_t),
	    cpu_thermal, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Package Thermal interrupt and Status&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_thermal, OID_AUTO, hardware_feedback,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_thermal_leaf_t, hardware_feedback),
	    <span class="enscript-keyword">sizeof</span>(boolean_t),
	    cpu_thermal, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Hardware Coordination Feedback&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_thermal, OID_AUTO, energy_policy,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_thermal_leaf_t, energy_policy),
	    <span class="enscript-keyword">sizeof</span>(boolean_t),
	    cpu_thermal, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Energy Efficient Policy Support&quot;</span>);

<span class="enscript-function-name">SYSCTL_NODE</span>(_machdep_cpu, OID_AUTO, xsave, CTLFLAG_RW|CTLFLAG_LOCKED, 0,
	<span class="enscript-string">&quot;xsave&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_xsave, OID_AUTO, extended_state,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *) 0,
	    <span class="enscript-keyword">sizeof</span>(cpuid_xsave_leaf_t),
	    cpu_xsave, <span class="enscript-string">&quot;IU&quot;</span>, <span class="enscript-string">&quot;XSAVE Extended State Main Leaf&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_xsave, OID_AUTO, extended_state1,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *) <span class="enscript-keyword">sizeof</span>(cpuid_xsave_leaf_t),
	    <span class="enscript-keyword">sizeof</span>(cpuid_xsave_leaf_t),
	    cpu_xsave, <span class="enscript-string">&quot;IU&quot;</span>, <span class="enscript-string">&quot;XSAVE Extended State Sub-leaf 1&quot;</span>);


<span class="enscript-function-name">SYSCTL_NODE</span>(_machdep_cpu, OID_AUTO, arch_perf, CTLFLAG_RW|CTLFLAG_LOCKED, 0,
	<span class="enscript-string">&quot;arch_perf&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_arch_perf, OID_AUTO, version,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_arch_perf_leaf_t, version),
	    <span class="enscript-keyword">sizeof</span>(uint8_t),
	    cpu_arch_perf, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Architectural Performance Version Number&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_arch_perf, OID_AUTO, number,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_arch_perf_leaf_t, number),
	    <span class="enscript-keyword">sizeof</span>(uint8_t),
	    cpu_arch_perf, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Number of counters per logical cpu&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_arch_perf, OID_AUTO, width,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_arch_perf_leaf_t, width),
	    <span class="enscript-keyword">sizeof</span>(uint8_t),
	    cpu_arch_perf, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Bit width of counters&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_arch_perf, OID_AUTO, events_number,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_arch_perf_leaf_t, events_number),
	    <span class="enscript-keyword">sizeof</span>(uint8_t),
	    cpu_arch_perf, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Number of monitoring events&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_arch_perf, OID_AUTO, events,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_arch_perf_leaf_t, events),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    cpu_arch_perf, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Bit vector of events&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_arch_perf, OID_AUTO, fixed_number,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_arch_perf_leaf_t, fixed_number),
	    <span class="enscript-keyword">sizeof</span>(uint8_t),
	    cpu_arch_perf, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Number of fixed-function counters&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_arch_perf, OID_AUTO, fixed_width,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(cpuid_arch_perf_leaf_t, fixed_width),
	    <span class="enscript-keyword">sizeof</span>(uint8_t),
	    cpu_arch_perf, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Bit-width of fixed-function counters&quot;</span>);


<span class="enscript-function-name">SYSCTL_NODE</span>(_machdep_cpu, OID_AUTO, cache, CTLFLAG_RW|CTLFLAG_LOCKED, 0,
	<span class="enscript-string">&quot;cache&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_cache, OID_AUTO, linesize,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_cache_linesize),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Cacheline size&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_cache, OID_AUTO, L2_associativity,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_cache_L2_associativity),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;L2 cache associativity&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_cache, OID_AUTO, size,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_cache_size),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Cache size (in Kbytes)&quot;</span>);


<span class="enscript-function-name">SYSCTL_NODE</span>(_machdep_cpu, OID_AUTO, tlb, CTLFLAG_RW|CTLFLAG_LOCKED, 0,
	<span class="enscript-string">&quot;tlb&quot;</span>);
<span class="enscript-function-name">SYSCTL_NODE</span>(_machdep_cpu_tlb, OID_AUTO, inst, CTLFLAG_RW|CTLFLAG_LOCKED, 0,
	<span class="enscript-string">&quot;inst&quot;</span>);
<span class="enscript-function-name">SYSCTL_NODE</span>(_machdep_cpu_tlb, OID_AUTO, data, CTLFLAG_RW|CTLFLAG_LOCKED, 0,
	<span class="enscript-string">&quot;data&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_tlb_inst, OID_AUTO, small,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t,
			     cpuid_tlb[TLB_INST][TLB_SMALL][0]),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info_nonzero, <span class="enscript-string">&quot;I&quot;</span>,
	    <span class="enscript-string">&quot;Number of small page instruction TLBs&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_tlb_data, OID_AUTO, small,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t,
			     cpuid_tlb[TLB_DATA][TLB_SMALL][0]),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info_nonzero, <span class="enscript-string">&quot;I&quot;</span>,
	    <span class="enscript-string">&quot;Number of small page data TLBs (1st level)&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_tlb_data, OID_AUTO, small_level1,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t,
			     cpuid_tlb[TLB_DATA][TLB_SMALL][1]),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info_nonzero, <span class="enscript-string">&quot;I&quot;</span>,
	    <span class="enscript-string">&quot;Number of small page data TLBs (2nd level)&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_tlb_inst, OID_AUTO, large,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t,
			     cpuid_tlb[TLB_INST][TLB_LARGE][0]),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info_nonzero, <span class="enscript-string">&quot;I&quot;</span>,
	    <span class="enscript-string">&quot;Number of large page instruction TLBs&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_tlb_data, OID_AUTO, large,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t,
			     cpuid_tlb[TLB_DATA][TLB_LARGE][0]),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info_nonzero, <span class="enscript-string">&quot;I&quot;</span>,
	    <span class="enscript-string">&quot;Number of large page data TLBs (1st level)&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_tlb_data, OID_AUTO, large_level1,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t,
			     cpuid_tlb[TLB_DATA][TLB_LARGE][1]),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info_nonzero, <span class="enscript-string">&quot;I&quot;</span>,
	    <span class="enscript-string">&quot;Number of large page data TLBs (2nd level)&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_tlb, OID_AUTO, shared,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_stlb),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info_nonzero, <span class="enscript-string">&quot;I&quot;</span>,
	    <span class="enscript-string">&quot;Number of shared TLBs&quot;</span>);


<span class="enscript-function-name">SYSCTL_NODE</span>(_machdep_cpu, OID_AUTO, address_bits, CTLFLAG_RW|CTLFLAG_LOCKED, 0,
	<span class="enscript-string">&quot;address_bits&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_address_bits, OID_AUTO, physical,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_address_bits_physical),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Number of physical address bits&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_address_bits, OID_AUTO, virtual,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, cpuid_address_bits_virtual),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Number of virtual address bits&quot;</span>);


<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, core_count,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, core_count),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Number of enabled cores per package&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, thread_count,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    (<span class="enscript-type">void</span> *)offsetof(i386_cpu_info_t, thread_count),
	    <span class="enscript-keyword">sizeof</span>(uint32_t),
	    i386_cpu_info, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Number of enabled threads per package&quot;</span>);

<span class="enscript-function-name">SYSCTL_NODE</span>(_machdep_cpu, OID_AUTO, flex_ratio, CTLFLAG_RW|CTLFLAG_LOCKED, 0,
	<span class="enscript-string">&quot;Flex ratio&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_flex_ratio, OID_AUTO, desired,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    0, 0,
	    cpu_flex_ratio_desired, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Flex ratio desired (0 disabled)&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_flex_ratio, OID_AUTO, min,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    0, 0,
	    cpu_flex_ratio_min, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Flex ratio min (efficiency)&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu_flex_ratio, OID_AUTO, max,
	    CTLTYPE_INT | CTLFLAG_RD | CTLFLAG_LOCKED, 
	    0, 0,
	    cpu_flex_ratio_max, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Flex ratio max (non-turbo)&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_cpu, OID_AUTO, ucupdate, 
	    CTLTYPE_INT | CTLFLAG_WR | CTLFLAG_LOCKED, 0, 0,
            cpu_ucode_update, <span class="enscript-string">&quot;S&quot;</span>, <span class="enscript-string">&quot;Microcode update interface&quot;</span>);

<span class="enscript-type">static</span> <span class="enscript-type">const</span> uint32_t apic_timer_vector = (LAPIC_DEFAULT_INTERRUPT_BASE + LAPIC_TIMER_INTERRUPT);
<span class="enscript-type">static</span> <span class="enscript-type">const</span> uint32_t apic_IPI_vector = (LAPIC_DEFAULT_INTERRUPT_BASE + LAPIC_INTERPROCESSOR_INTERRUPT);

<span class="enscript-function-name">SYSCTL_NODE</span>(_machdep, OID_AUTO, vectors, CTLFLAG_RD | CTLFLAG_LOCKED, 0,
	<span class="enscript-string">&quot;Interrupt vector assignments&quot;</span>);

<span class="enscript-function-name">SYSCTL_UINT</span>     (_machdep_vectors, OID_AUTO, timer, CTLFLAG_RD | CTLFLAG_KERN | CTLFLAG_LOCKED, __DECONST(uint32_t *,&amp;apic_timer_vector), 0, <span class="enscript-string">&quot;&quot;</span>);
<span class="enscript-function-name">SYSCTL_UINT</span>     (_machdep_vectors, OID_AUTO, IPI, CTLFLAG_RD | CTLFLAG_KERN | CTLFLAG_LOCKED, __DECONST(uint32_t *,&amp;apic_IPI_vector), 0, <span class="enscript-string">&quot;&quot;</span>);

uint64_t pmap_pv_hashlist_walks;
uint64_t pmap_pv_hashlist_cnts;
uint32_t pmap_pv_hashlist_max;
uint32_t pmap_kernel_text_ps = PAGE_SIZE;
<span class="enscript-type">extern</span> uint32_t pv_hashed_kern_low_water_mark;

<span class="enscript-comment">/*extern struct sysctl_oid_list sysctl__machdep_pmap_children;*/</span>

<span class="enscript-function-name">SYSCTL_NODE</span>(_machdep, OID_AUTO, pmap, CTLFLAG_RW|CTLFLAG_LOCKED, 0,
	<span class="enscript-string">&quot;PMAP info&quot;</span>);

<span class="enscript-function-name">SYSCTL_QUAD</span>    (_machdep_pmap, OID_AUTO, hashwalks, CTLFLAG_RD | CTLFLAG_KERN | CTLFLAG_LOCKED, &amp;pmap_pv_hashlist_walks, <span class="enscript-string">&quot;&quot;</span>);
<span class="enscript-function-name">SYSCTL_QUAD</span>    (_machdep_pmap, OID_AUTO, hashcnts, CTLFLAG_RD | CTLFLAG_KERN | CTLFLAG_LOCKED, &amp;pmap_pv_hashlist_cnts, <span class="enscript-string">&quot;&quot;</span>);
<span class="enscript-function-name">SYSCTL_INT</span>     (_machdep_pmap, OID_AUTO, hashmax, CTLFLAG_RD | CTLFLAG_KERN | CTLFLAG_LOCKED, &amp;pmap_pv_hashlist_max, 0, <span class="enscript-string">&quot;&quot;</span>);
<span class="enscript-function-name">SYSCTL_INT</span>     (_machdep_pmap, OID_AUTO, kernel_text_ps, CTLFLAG_RD | CTLFLAG_KERN | CTLFLAG_LOCKED, &amp;pmap_kernel_text_ps, 0, <span class="enscript-string">&quot;&quot;</span>);
<span class="enscript-function-name">SYSCTL_INT</span>     (_machdep_pmap, OID_AUTO, kern_pv_reserve, CTLFLAG_RW | CTLFLAG_KERN | CTLFLAG_LOCKED, &amp;pv_hashed_kern_low_water_mark, 0, <span class="enscript-string">&quot;&quot;</span>);

<span class="enscript-function-name">SYSCTL_NODE</span>(_machdep, OID_AUTO, memmap, CTLFLAG_RD|CTLFLAG_LOCKED, NULL, <span class="enscript-string">&quot;physical memory map&quot;</span>);

uint64_t firmware_Conventional_bytes = 0;
uint64_t firmware_RuntimeServices_bytes = 0;
uint64_t firmware_ACPIReclaim_bytes = 0;
uint64_t firmware_ACPINVS_bytes = 0;
uint64_t firmware_PalCode_bytes = 0;
uint64_t firmware_Reserved_bytes = 0;
uint64_t firmware_Unusable_bytes = 0;
uint64_t firmware_other_bytes = 0;

<span class="enscript-function-name">SYSCTL_QUAD</span>(_machdep_memmap, OID_AUTO, Conventional, CTLFLAG_RD|CTLFLAG_LOCKED, &amp;firmware_Conventional_bytes, <span class="enscript-string">&quot;&quot;</span>);
<span class="enscript-function-name">SYSCTL_QUAD</span>(_machdep_memmap, OID_AUTO, RuntimeServices, CTLFLAG_RD|CTLFLAG_LOCKED, &amp;firmware_RuntimeServices_bytes, <span class="enscript-string">&quot;&quot;</span>);
<span class="enscript-function-name">SYSCTL_QUAD</span>(_machdep_memmap, OID_AUTO, ACPIReclaim, CTLFLAG_RD|CTLFLAG_LOCKED, &amp;firmware_ACPIReclaim_bytes, <span class="enscript-string">&quot;&quot;</span>);
<span class="enscript-function-name">SYSCTL_QUAD</span>(_machdep_memmap, OID_AUTO, ACPINVS, CTLFLAG_RD|CTLFLAG_LOCKED, &amp;firmware_ACPINVS_bytes, <span class="enscript-string">&quot;&quot;</span>);
<span class="enscript-function-name">SYSCTL_QUAD</span>(_machdep_memmap, OID_AUTO, PalCode, CTLFLAG_RD|CTLFLAG_LOCKED, &amp;firmware_PalCode_bytes, <span class="enscript-string">&quot;&quot;</span>);
<span class="enscript-function-name">SYSCTL_QUAD</span>(_machdep_memmap, OID_AUTO, Reserved, CTLFLAG_RD|CTLFLAG_LOCKED, &amp;firmware_Reserved_bytes, <span class="enscript-string">&quot;&quot;</span>);
<span class="enscript-function-name">SYSCTL_QUAD</span>(_machdep_memmap, OID_AUTO, Unusable, CTLFLAG_RD|CTLFLAG_LOCKED, &amp;firmware_Unusable_bytes, <span class="enscript-string">&quot;&quot;</span>);
<span class="enscript-function-name">SYSCTL_QUAD</span>(_machdep_memmap, OID_AUTO, Other, CTLFLAG_RD|CTLFLAG_LOCKED, &amp;firmware_other_bytes, <span class="enscript-string">&quot;&quot;</span>);

<span class="enscript-function-name">SYSCTL_NODE</span>(_machdep, OID_AUTO, tsc, CTLFLAG_RD|CTLFLAG_LOCKED, NULL, <span class="enscript-string">&quot;Timestamp counter parameters&quot;</span>);

<span class="enscript-function-name">SYSCTL_QUAD</span>(_machdep_tsc, OID_AUTO, frequency,
	CTLFLAG_RD|CTLFLAG_LOCKED, &amp;tscFreq, <span class="enscript-string">&quot;&quot;</span>);

<span class="enscript-type">extern</span> uint32_t deep_idle_rebase;
<span class="enscript-function-name">SYSCTL_UINT</span>(_machdep_tsc, OID_AUTO, deep_idle_rebase,
	CTLFLAG_RW|CTLFLAG_KERN|CTLFLAG_LOCKED, &amp;deep_idle_rebase, 0, <span class="enscript-string">&quot;&quot;</span>);

<span class="enscript-function-name">SYSCTL_NODE</span>(_machdep_tsc, OID_AUTO, nanotime,
	CTLFLAG_RD|CTLFLAG_LOCKED, NULL, <span class="enscript-string">&quot;TSC to ns conversion&quot;</span>);
<span class="enscript-function-name">SYSCTL_QUAD</span>(_machdep_tsc_nanotime, OID_AUTO, tsc_base,
	CTLFLAG_RD | CTLFLAG_LOCKED,
	__DECONST(uint64_t *, &amp;pal_rtc_nanotime_info.tsc_base), <span class="enscript-string">&quot;&quot;</span>);
<span class="enscript-function-name">SYSCTL_QUAD</span>(_machdep_tsc_nanotime, OID_AUTO, ns_base,
	CTLFLAG_RD | CTLFLAG_LOCKED,
	__DECONST(uint64_t *, &amp;pal_rtc_nanotime_info.ns_base), <span class="enscript-string">&quot;&quot;</span>);
<span class="enscript-function-name">SYSCTL_UINT</span>(_machdep_tsc_nanotime, OID_AUTO, scale,
	CTLFLAG_RD | CTLFLAG_LOCKED,
	__DECONST(uint32_t *, &amp;pal_rtc_nanotime_info.scale), 0, <span class="enscript-string">&quot;&quot;</span>);
<span class="enscript-function-name">SYSCTL_UINT</span>(_machdep_tsc_nanotime, OID_AUTO, shift,
	CTLFLAG_RD | CTLFLAG_LOCKED,
	__DECONST(uint32_t *, &amp;pal_rtc_nanotime_info.shift), 0, <span class="enscript-string">&quot;&quot;</span>);
<span class="enscript-function-name">SYSCTL_UINT</span>(_machdep_tsc_nanotime, OID_AUTO, generation,
	CTLFLAG_RD | CTLFLAG_LOCKED,
	__DECONST(uint32_t *, &amp;pal_rtc_nanotime_info.generation), 0, <span class="enscript-string">&quot;&quot;</span>);

<span class="enscript-function-name">SYSCTL_NODE</span>(_machdep, OID_AUTO, misc, CTLFLAG_RW|CTLFLAG_LOCKED, 0,
	<span class="enscript-string">&quot;Miscellaneous x86 kernel parameters&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_misc, OID_AUTO, panic_restart_timeout,
	    CTLTYPE_INT | CTLFLAG_RW | CTLFLAG_LOCKED, 
	    0, 0,
	    panic_set_restart_timeout, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Panic restart timeout in seconds&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_misc, OID_AUTO, interrupt_latency_max,
	    CTLTYPE_STRING | CTLFLAG_RW | CTLFLAG_LOCKED, 
	    0, 0,
	    misc_interrupt_latency_max, <span class="enscript-string">&quot;A&quot;</span>, <span class="enscript-string">&quot;Maximum Interrupt latency&quot;</span>);

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_misc, OID_AUTO, machine_check_panic,
	    CTLTYPE_STRING | CTLFLAG_RW | CTLFLAG_LOCKED, 
	    0, 0,
	    misc_machine_check_panic, <span class="enscript-string">&quot;A&quot;</span>, <span class="enscript-string">&quot;Machine-check exception test&quot;</span>);

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">DEVELOPMENT</span> || <span class="enscript-variable-name">DEBUG</span>
<span class="enscript-function-name">SYSCTL_QUAD</span>(_machdep, OID_AUTO, reportphyreadabs,
		CTLFLAG_KERN | CTLFLAG_RW | CTLFLAG_LOCKED,
		&amp;reportphyreaddelayabs, <span class="enscript-string">&quot;&quot;</span>);
<span class="enscript-function-name">SYSCTL_INT</span>(_machdep, OID_AUTO, reportphyreadosbt,
		CTLFLAG_KERN | CTLFLAG_RW | CTLFLAG_LOCKED,
		&amp;reportphyreadosbt, 0, <span class="enscript-string">&quot;&quot;</span>);
#<span class="enscript-reference">endif</span>

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">timer_queue_trace_cpu</span>(<span class="enscript-type">int</span>);
<span class="enscript-type">static</span> <span class="enscript-type">int</span>
<span class="enscript-function-name">misc_timer_queue_trace</span>(__unused <span class="enscript-type">struct</span> sysctl_oid *oidp, __unused <span class="enscript-type">void</span> *arg1, __unused <span class="enscript-type">int</span> arg2, <span class="enscript-type">struct</span> sysctl_req *req)
{
	<span class="enscript-type">int</span> changed = 0, error;
	<span class="enscript-type">char</span> buf[128];
	buf[0] = <span class="enscript-string">'\0'</span>;

	error = sysctl_io_string(req, buf, <span class="enscript-keyword">sizeof</span>(buf), 0, &amp;changed);

	<span class="enscript-keyword">if</span> (error == 0 &amp;&amp; changed) {
		timer_queue_trace_cpu(0);
	}
	<span class="enscript-keyword">return</span> error;
}

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_misc, OID_AUTO, timer_queue_trace,
	    CTLTYPE_STRING | CTLFLAG_RW | CTLFLAG_LOCKED, 
	    0, 0,
	    misc_timer_queue_trace, <span class="enscript-string">&quot;A&quot;</span>, <span class="enscript-string">&quot;Cut timer queue tracepoint&quot;</span>);

<span class="enscript-type">extern</span> <span class="enscript-type">long</span> NMI_count;
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">NMI_cpus</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">static</span> <span class="enscript-type">int</span>
<span class="enscript-function-name">misc_nmis</span>(__unused <span class="enscript-type">struct</span> sysctl_oid *oidp, __unused <span class="enscript-type">void</span> *arg1, __unused <span class="enscript-type">int</span> arg2, <span class="enscript-type">struct</span> sysctl_req *req)
{
	<span class="enscript-type">int</span> new = 0, old = 0, changed = 0, error;

	old = NMI_count;

	error = sysctl_io_number(req, old, <span class="enscript-keyword">sizeof</span>(<span class="enscript-type">int</span>), &amp;new, &amp;changed);
	<span class="enscript-keyword">if</span> (error == 0 &amp;&amp; changed) {
		NMI_cpus();
	}

	<span class="enscript-keyword">return</span> error;
}

<span class="enscript-function-name">SYSCTL_PROC</span>(_machdep_misc, OID_AUTO, nmis,
	    CTLTYPE_INT | CTLFLAG_RW | CTLFLAG_LOCKED, 
	    0, 0,
	    misc_nmis, <span class="enscript-string">&quot;I&quot;</span>, <span class="enscript-string">&quot;Report/increment NMI count&quot;</span>);

<span class="enscript-comment">/* Parameters related to timer coalescing tuning, to be replaced
 * with a dedicated systemcall in the future.
 */</span>
<span class="enscript-comment">/* Enable processing pending timers in the context of any other interrupt */</span>
<span class="enscript-function-name">SYSCTL_INT</span>(_kern, OID_AUTO, interrupt_timer_coalescing_enabled,
		CTLFLAG_KERN | CTLFLAG_RW | CTLFLAG_LOCKED,
		&amp;interrupt_timer_coalescing_enabled, 0, <span class="enscript-string">&quot;&quot;</span>);
<span class="enscript-comment">/* Upon entering idle, process pending timers with HW deadlines
 * this far in the future.
 */</span>
<span class="enscript-function-name">SYSCTL_INT</span>(_kern, OID_AUTO, timer_coalesce_idle_entry_hard_deadline_max,
		CTLFLAG_KERN | CTLFLAG_RW | CTLFLAG_LOCKED,
		&amp;idle_entry_timer_processing_hdeadline_threshold, 0, <span class="enscript-string">&quot;&quot;</span>);

<span class="enscript-comment">/* Track potentially expensive eager timer evaluations on QoS tier
 * switches.
 */</span>
<span class="enscript-type">extern</span> uint32_t ml_timer_eager_evaluations;

<span class="enscript-function-name">SYSCTL_INT</span>(_machdep, OID_AUTO, eager_timer_evaluations,
		CTLFLAG_KERN | CTLFLAG_RW | CTLFLAG_LOCKED,
		&amp;ml_timer_eager_evaluations, 0, <span class="enscript-string">&quot;&quot;</span>);

<span class="enscript-type">extern</span> uint64_t ml_timer_eager_evaluation_max;

<span class="enscript-function-name">SYSCTL_QUAD</span>(_machdep, OID_AUTO, eager_timer_evaluation_max,
		CTLFLAG_KERN | CTLFLAG_RW | CTLFLAG_LOCKED,
		&amp;ml_timer_eager_evaluation_max, <span class="enscript-string">&quot;&quot;</span>);
<span class="enscript-type">extern</span> uint64_t x86_isr_fp_simd_use;
<span class="enscript-function-name">SYSCTL_QUAD</span>(_machdep, OID_AUTO, x86_fp_simd_isr_uses,
		CTLFLAG_KERN | CTLFLAG_RW | CTLFLAG_LOCKED,
		&amp;x86_isr_fp_simd_use, <span class="enscript-string">&quot;&quot;</span>);
</pre>
<hr />
</body></html>