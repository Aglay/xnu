<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>searchp.c</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">searchp.c&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 1999 Apple Computer, Inc. All rights reserved.
 *
 * @APPLE_LICENSE_HEADER_START@
 * 
 * &quot;Portions Copyright (c) 1999 Apple Computer, Inc.  All Rights
 * Reserved.  This file contains Original Code and/or Modifications of
 * Original Code as defined in and that are subject to the Apple Public
 * Source License Version 1.0 (the 'License').  You may not use this file
 * except in compliance with the License.  Please obtain a copy of the
 * License at <a href="http://www.apple.com/publicsource">http://www.apple.com/publicsource</a> and read it before using
 * this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE OR NON-INFRINGEMENT.  Please see the
 * License for the specific language governing rights and limitations
 * under the License.&quot;
 * 
 * @APPLE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*  searchp  --  search through pathlist for file
 *
 *  Usage:  p = searchp (path,file,fullname,func);
 *	char *p, *path, *file, *fullname;
 *	int (*func)();
 *
 *  Searchp will parse &quot;path&quot;, a list of pathnames separated
 *  by colons, prepending each pathname to &quot;file&quot;.  The resulting
 *  filename will be passed to &quot;func&quot;, a function provided by the
 *  user.  This function must return zero if the search is
 *  successful (i.e. ended), and non-zero if the search must
 *  continue.  If the function returns zero (success), then
 *  searching stops, the full filename is placed into &quot;fullname&quot;,
 *  and searchp returns 0.  If the pathnames are all unsuccessfully
 *  examined, then searchp returns -1.
 *  If &quot;file&quot; begins with a slash, it is assumed to be an
 *  absolute pathname and the &quot;path&quot; list is not used.  Note
 *  that this rule is used by Bell's cc also; whereas Bell's
 *  sh uses the rule that any filename which CONTAINS a slash
 *  is assumed to be absolute.  The execlp and execvp procedures
 *  also use this latter rule.  In my opinion, this is bogosity.
 *
 *  HISTORY
 * 01-Apr-86  Rudy Nedved (ern) at Carnegie-Mellon University
 *	4.1BSD system ignores trailing slashes. 4.2BSD does not. 
 *	Therefore don't add a seperating slash if there is a null
 *	filename.
 *
 * 23-Oct-82  Steven Shafer (sas) at Carnegie-Mellon University
 *	Fixed two bugs: (1) calling function as &quot;func&quot; instead of
 *	&quot;(*func)&quot;, (2) omitting trailing null name implied by trailing
 *	colon in path.  Latter bug fixed by introducing &quot;lastchar&quot; and
 *	changing final loop test to look for &quot;*lastchar&quot; instead of
 *	&quot;*nextpath&quot;.
 *
 * 20-Nov-79  Steven Shafer (sas) at Carnegie-Mellon University
 *	Created for VAX.  If you're thinking of using this, you probably
 *	should look at openp() and fopenp() (or the &quot;want...&quot; routines)
 *	instead.
 *
 */</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;config.h&quot;</span>

<span class="enscript-type">int</span>
<span class="enscript-function-name">searchp</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *spath, <span class="enscript-type">char</span> *file, <span class="enscript-type">char</span> *fullname, <span class="enscript-type">int</span> (*func)(<span class="enscript-type">char</span> *))
{
	<span class="enscript-type">const</span> <span class="enscript-type">char</span> *nextpath, *nextchar, *lastchar;
	<span class="enscript-type">char</span> *fname;
	<span class="enscript-type">int</span> failure;

	nextpath = ((*file == <span class="enscript-string">'/'</span>) ? <span class="enscript-string">&quot;&quot;</span> : spath);
	<span class="enscript-keyword">do</span> {
		fname = fullname;
		nextchar = nextpath;
		<span class="enscript-keyword">while</span> (*nextchar &amp;&amp; (*nextchar != <span class="enscript-string">':'</span>))
			*fname++ = *nextchar++;
		<span class="enscript-keyword">if</span> (nextchar != nextpath &amp;&amp; *file) *fname++ = <span class="enscript-string">'/'</span>;
		lastchar = nextchar;
		nextpath = ((*nextchar) ? nextchar + 1 : nextchar);
		nextchar = file;	<span class="enscript-comment">/* append file */</span>
		<span class="enscript-keyword">while</span> (*nextchar)  *fname++ = *nextchar++;
		*fname = <span class="enscript-string">'\0'</span>;
		failure = (*func) (fullname);
	} 
	<span class="enscript-keyword">while</span> (failure &amp;&amp; (*lastchar));
	<span class="enscript-keyword">return</span> (failure ? -1 : 0);
}
</pre>
<hr />
</body></html>