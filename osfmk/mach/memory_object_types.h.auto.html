<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>memory_object_types.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">memory_object_types.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000-2006 Apple Computer, Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*
 * @OSF_COPYRIGHT@
 */</span>
<span class="enscript-comment">/* 
 * Mach Operating System
 * Copyright (c) 1991,1990,1989,1988 Carnegie Mellon University
 * All Rights Reserved.
 * 
 * Permission to use, copy, modify and distribute this software and its
 * documentation is hereby granted, provided that both the copyright
 * notice and this permission notice appear in all copies of the
 * software, derivative works or modified versions, and any portions
 * thereof, and that both notices appear in supporting documentation.
 * 
 * CARNEGIE MELLON ALLOWS FREE USE OF THIS SOFTWARE IN ITS &quot;AS IS&quot;
 * CONDITION.  CARNEGIE MELLON DISCLAIMS ANY LIABILITY OF ANY KIND FOR
 * ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.
 * 
 * Carnegie Mellon requests users of this software to return to
 * 
 *  Software Distribution Coordinator  or  <a href="mailto:Software.Distribution@CS.CMU.EDU">Software.Distribution@CS.CMU.EDU</a>
 *  School of Computer Science
 *  Carnegie Mellon University
 *  Pittsburgh PA 15213-3890
 * 
 * any improvements or extensions that they make and grant Carnegie Mellon
 * the rights to redistribute these changes.
 */</span>
<span class="enscript-comment">/*
 */</span>
<span class="enscript-comment">/*
 *	File:	memory_object.h
 *	Author:	Michael Wayne Young
 *
 *	External memory management interface definition.
 */</span>

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">_MACH_MEMORY_OBJECT_TYPES_H_</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_MACH_MEMORY_OBJECT_TYPES_H_</span>

<span class="enscript-comment">/*
 *	User-visible types used in the external memory
 *	management interface:
 */</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/port.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/message.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/vm_prot.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/vm_sync.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/vm_types.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/machine/vm_types.h&gt;</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/cdefs.h&gt;</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_64_BIT_DATA_OBJECTS</span>

<span class="enscript-type">typedef</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> <span class="enscript-type">long</span>	memory_object_offset_t;
<span class="enscript-type">typedef</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> <span class="enscript-type">long</span>	memory_object_size_t;
<span class="enscript-type">typedef</span> natural_t		memory_object_cluster_size_t;
<span class="enscript-type">typedef</span> natural_t *		memory_object_fault_info_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> <span class="enscript-type">long</span> 	vm_object_id_t;


<span class="enscript-comment">/*
 * Temporary until real EMMI version gets re-implemented
 */</span>

#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">KERNEL_PRIVATE</span>

<span class="enscript-type">struct</span> memory_object_pager_ops;	<span class="enscript-comment">/* forward declaration */</span>

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> 		memory_object {
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	_pad1; <span class="enscript-comment">/* struct ipc_object_header */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__LP64__</span>
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	_pad2; <span class="enscript-comment">/* pad to natural boundary */</span>
#<span class="enscript-reference">endif</span>
	<span class="enscript-type">const</span> <span class="enscript-type">struct</span> memory_object_pager_ops	*mo_pager_ops;
} *memory_object_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span>		memory_object_control {
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	moc_ikot; <span class="enscript-comment">/* struct ipc_object_header */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__LP64__</span>
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	_pad; <span class="enscript-comment">/* pad to natural boundary */</span>
#<span class="enscript-reference">endif</span>
	<span class="enscript-type">struct</span> vm_object *moc_object;
} *memory_object_control_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">const</span> <span class="enscript-type">struct</span> memory_object_pager_ops {
	<span class="enscript-type">void</span> (*memory_object_reference)(
		memory_object_t mem_obj);
	<span class="enscript-type">void</span> (*memory_object_deallocate)(
		memory_object_t mem_obj);
	kern_return_t (*memory_object_init)(
		memory_object_t mem_obj,
		memory_object_control_t mem_control,
		memory_object_cluster_size_t size);
	kern_return_t (*memory_object_terminate)(
		memory_object_t mem_obj);
	kern_return_t (*memory_object_data_request)(
		memory_object_t mem_obj,
		memory_object_offset_t offset,
		memory_object_cluster_size_t length,
		vm_prot_t desired_access,
		memory_object_fault_info_t fault_info);
	kern_return_t (*memory_object_data_return)(
		memory_object_t mem_obj,
		memory_object_offset_t offset,
		memory_object_cluster_size_t size,
		memory_object_offset_t *resid_offset,
		<span class="enscript-type">int</span> *io_error,
		boolean_t dirty,
		boolean_t kernel_copy,
		<span class="enscript-type">int</span> upl_flags);
	kern_return_t (*memory_object_data_initialize)(
		memory_object_t mem_obj,
		memory_object_offset_t offset,
		memory_object_cluster_size_t size);
	kern_return_t (*memory_object_data_unlock)(
		memory_object_t mem_obj,
		memory_object_offset_t offset,
		memory_object_size_t size,
		vm_prot_t desired_access);
	kern_return_t (*memory_object_synchronize)(
		memory_object_t mem_obj,
		memory_object_offset_t offset,
		memory_object_size_t size,
		vm_sync_t sync_flags);
	kern_return_t (*memory_object_map)(
		memory_object_t mem_obj,
		vm_prot_t prot);
	kern_return_t (*memory_object_last_unmap)(
		memory_object_t mem_obj);
	kern_return_t (*memory_object_data_reclaim)(
		memory_object_t mem_obj,
		boolean_t reclaim_backing_store);
	<span class="enscript-type">const</span> <span class="enscript-type">char</span> *memory_object_pager_name;
} * memory_object_pager_ops_t;

#<span class="enscript-reference">else</span>	<span class="enscript-comment">/* KERNEL_PRIVATE */</span>

<span class="enscript-type">typedef</span> mach_port_t	memory_object_t;
<span class="enscript-type">typedef</span> mach_port_t	memory_object_control_t;

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* KERNEL_PRIVATE */</span>

<span class="enscript-type">typedef</span> memory_object_t *memory_object_array_t;
					<span class="enscript-comment">/* A memory object ... */</span>
					<span class="enscript-comment">/*  Used by the kernel to retrieve */</span>
					<span class="enscript-comment">/*  or store data */</span>

<span class="enscript-type">typedef</span>	mach_port_t	memory_object_name_t;
					<span class="enscript-comment">/* Used to describe the memory ... */</span>
					<span class="enscript-comment">/*  object in vm_regions() calls */</span>

<span class="enscript-type">typedef</span> mach_port_t	memory_object_default_t;
					<span class="enscript-comment">/* Registered with the host ... */</span>
					<span class="enscript-comment">/*  for creating new internal objects */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORY_OBJECT_NULL</span>		((memory_object_t) 0)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORY_OBJECT_CONTROL_NULL</span>	((memory_object_control_t) 0)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORY_OBJECT_NAME_NULL</span>		((memory_object_name_t) 0)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORY_OBJECT_DEFAULT_NULL</span>	((memory_object_default_t) 0)


<span class="enscript-type">typedef</span>	<span class="enscript-type">int</span>		memory_object_copy_strategy_t;
					<span class="enscript-comment">/* How memory manager handles copy: */</span>
#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">MEMORY_OBJECT_COPY_NONE</span>		0
					<span class="enscript-comment">/* ... No special support */</span>
#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">MEMORY_OBJECT_COPY_CALL</span>		1
					<span class="enscript-comment">/* ... Make call on memory manager */</span>
#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">MEMORY_OBJECT_COPY_DELAY</span> 	2
					<span class="enscript-comment">/* ... Memory manager doesn't
					 *     change data externally.
					 */</span>
#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">MEMORY_OBJECT_COPY_TEMPORARY</span> 	3
					<span class="enscript-comment">/* ... Memory manager doesn't
					 *     change data externally, and
					 *     doesn't need to see changes.
					 */</span>
#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">MEMORY_OBJECT_COPY_SYMMETRIC</span> 	4
					<span class="enscript-comment">/* ... Memory manager doesn't
					 *     change data externally,
					 *     doesn't need to see changes,
					 *     and object will not be
					 *     multiply mapped.
					 *
					 *     XXX
					 *     Not yet safe for non-kernel use.
					 */</span>

#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">MEMORY_OBJECT_COPY_INVALID</span>	5
					<span class="enscript-comment">/* ...	An invalid copy strategy,
					 *	for external objects which
					 *	have not been initialized.
					 *	Allows copy_strategy to be
					 *	examined without also
					 *	examining pager_ready and
					 *	internal.
					 */</span>

<span class="enscript-type">typedef</span>	<span class="enscript-type">int</span>		memory_object_return_t;
					<span class="enscript-comment">/* Which pages to return to manager
					   this time (lock_request) */</span>
#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">MEMORY_OBJECT_RETURN_NONE</span>	0
					<span class="enscript-comment">/* ... don't return any. */</span>
#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">MEMORY_OBJECT_RETURN_DIRTY</span>	1
					<span class="enscript-comment">/* ... only dirty pages. */</span>
#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">MEMORY_OBJECT_RETURN_ALL</span>	2
					<span class="enscript-comment">/* ... dirty and precious pages. */</span>
#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">MEMORY_OBJECT_RETURN_ANYTHING</span>	3
					<span class="enscript-comment">/* ... any resident page. */</span>

<span class="enscript-comment">/* 
 *	Data lock request flags
 */</span>

#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">MEMORY_OBJECT_DATA_FLUSH</span> 	0x1
#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">MEMORY_OBJECT_DATA_NO_CHANGE</span>	0x2
#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">MEMORY_OBJECT_DATA_PURGE</span>	0x4
#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">MEMORY_OBJECT_COPY_SYNC</span>		0x8
#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">MEMORY_OBJECT_DATA_SYNC</span>		0x10
#<span class="enscript-reference">define</span>         <span class="enscript-variable-name">MEMORY_OBJECT_IO_SYNC</span>           0x20
#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">MEMORY_OBJECT_DATA_FLUSH_ALL</span>	0x40

<span class="enscript-comment">/*
 *	Types for the memory object flavor interfaces
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORY_OBJECT_INFO_MAX</span>      (1024) 
<span class="enscript-type">typedef</span> <span class="enscript-type">int</span>     *memory_object_info_t;      
<span class="enscript-type">typedef</span> <span class="enscript-type">int</span>	 memory_object_flavor_t;
<span class="enscript-type">typedef</span> <span class="enscript-type">int</span>      memory_object_info_data_t[MEMORY_OBJECT_INFO_MAX];


#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORY_OBJECT_PERFORMANCE_INFO</span>	11
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORY_OBJECT_ATTRIBUTE_INFO</span>	14
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORY_OBJECT_BEHAVIOR_INFO</span> 	15	

#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">PRIVATE</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">OLD_MEMORY_OBJECT_BEHAVIOR_INFO</span> 	10	
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">OLD_MEMORY_OBJECT_ATTRIBUTE_INFO</span>	12

<span class="enscript-type">struct</span> old_memory_object_behave_info {
	memory_object_copy_strategy_t	copy_strategy;	
	boolean_t			temporary;
	boolean_t			invalidate;
};

<span class="enscript-type">struct</span> old_memory_object_attr_info {			<span class="enscript-comment">/* old attr list */</span>
        boolean_t       		object_ready;
        boolean_t       		may_cache;
        memory_object_copy_strategy_t 	copy_strategy;
};

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> old_memory_object_behave_info *old_memory_object_behave_info_t;
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> old_memory_object_behave_info old_memory_object_behave_info_data_t;
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> old_memory_object_attr_info *old_memory_object_attr_info_t;
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> old_memory_object_attr_info old_memory_object_attr_info_data_t;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">OLD_MEMORY_OBJECT_BEHAVE_INFO_COUNT</span>   	((mach_msg_type_number_t) \
                (<span class="enscript-keyword">sizeof</span>(old_memory_object_behave_info_data_t)/<span class="enscript-keyword">sizeof</span>(<span class="enscript-type">int</span>)))
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">OLD_MEMORY_OBJECT_ATTR_INFO_COUNT</span>	((mach_msg_type_number_t) \
		(<span class="enscript-keyword">sizeof</span>(old_memory_object_attr_info_data_t)/<span class="enscript-keyword">sizeof</span>(<span class="enscript-type">int</span>)))

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>

__BEGIN_DECLS
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">memory_object_reference</span>(memory_object_t object);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">memory_object_deallocate</span>(memory_object_t object);

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">memory_object_default_reference</span>(memory_object_default_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">memory_object_default_deallocate</span>(memory_object_default_t);

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">memory_object_control_reference</span>(memory_object_control_t control);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">memory_object_control_deallocate</span>(memory_object_control_t control);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>  <span class="enscript-function-name">memory_object_control_uiomove</span>(memory_object_control_t, memory_object_offset_t, <span class="enscript-type">void</span> *, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>, <span class="enscript-type">int</span>);
__END_DECLS

#<span class="enscript-reference">endif</span>  <span class="enscript-comment">/* KERNEL */</span>

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* PRIVATE */</span>

<span class="enscript-type">struct</span> memory_object_perf_info {
	memory_object_cluster_size_t	cluster_size;
	boolean_t			may_cache;
};

<span class="enscript-type">struct</span> memory_object_attr_info {
	memory_object_copy_strategy_t	copy_strategy;
	memory_object_cluster_size_t	cluster_size;
	boolean_t			may_cache_object;
	boolean_t			temporary;
};

<span class="enscript-type">struct</span> memory_object_behave_info {
	memory_object_copy_strategy_t	copy_strategy;	
	boolean_t			temporary;
	boolean_t			invalidate;
	boolean_t			silent_overwrite;
	boolean_t			advisory_pageout;
};


<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> memory_object_behave_info *memory_object_behave_info_t;
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> memory_object_behave_info memory_object_behave_info_data_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> memory_object_perf_info 	*memory_object_perf_info_t;
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> memory_object_perf_info	memory_object_perf_info_data_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> memory_object_attr_info	*memory_object_attr_info_t;
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> memory_object_attr_info	memory_object_attr_info_data_t;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORY_OBJECT_BEHAVE_INFO_COUNT</span> ((mach_msg_type_number_t)	\
                (<span class="enscript-keyword">sizeof</span>(memory_object_behave_info_data_t)/<span class="enscript-keyword">sizeof</span>(<span class="enscript-type">int</span>)))
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORY_OBJECT_PERF_INFO_COUNT</span>	((mach_msg_type_number_t)	\
		(<span class="enscript-keyword">sizeof</span>(memory_object_perf_info_data_t)/<span class="enscript-keyword">sizeof</span>(<span class="enscript-type">int</span>)))
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORY_OBJECT_ATTR_INFO_COUNT</span>	((mach_msg_type_number_t)	\
		(<span class="enscript-keyword">sizeof</span>(memory_object_attr_info_data_t)/<span class="enscript-keyword">sizeof</span>(<span class="enscript-type">int</span>)))

#<span class="enscript-reference">define</span> <span class="enscript-function-name">invalid_memory_object_flavor</span>(f)					\
	(f != MEMORY_OBJECT_ATTRIBUTE_INFO &amp;&amp; 				\
	 f != MEMORY_OBJECT_PERFORMANCE_INFO &amp;&amp; 			\
	 f != OLD_MEMORY_OBJECT_BEHAVIOR_INFO &amp;&amp;			\
	 f != MEMORY_OBJECT_BEHAVIOR_INFO &amp;&amp;				\
	 f != OLD_MEMORY_OBJECT_ATTRIBUTE_INFO)


<span class="enscript-comment">/*
 * Used to support options on memory_object_release_name call
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORY_OBJECT_TERMINATE_IDLE</span>	0x1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORY_OBJECT_RESPECT_CACHE</span>	0x2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MEMORY_OBJECT_RELEASE_NO_OP</span>	0x4


<span class="enscript-comment">/* named entry processor mapping options */</span>
<span class="enscript-comment">/* enumerated */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAP_MEM_NOOP</span>		0
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAP_MEM_COPYBACK</span>	1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAP_MEM_IO</span>		2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAP_MEM_WTHRU</span>		3
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAP_MEM_WCOMB</span>		4	<span class="enscript-comment">/* Write combining mode */</span>
					<span class="enscript-comment">/* aka store gather     */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAP_MEM_INNERWBACK</span>	5

#<span class="enscript-reference">define</span> <span class="enscript-function-name">GET_MAP_MEM</span>(flags)	\
	((((<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>)(flags)) &gt;&gt; 24) &amp; 0xFF)

#<span class="enscript-reference">define</span> <span class="enscript-function-name">SET_MAP_MEM</span>(caching, flags)	\
	((flags) = ((((<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>)(caching)) &lt;&lt; 24) \
			&amp; 0xFF000000) | ((flags) &amp; 0xFFFFFF));

<span class="enscript-comment">/* leave room for vm_prot bits */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAP_MEM_ONLY</span>		0x010000 <span class="enscript-comment">/* change processor caching  */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAP_MEM_NAMED_CREATE</span>	0x020000 <span class="enscript-comment">/* create extant object      */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAP_MEM_PURGABLE</span>	0x040000 <span class="enscript-comment">/* create a purgable VM object */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAP_MEM_NAMED_REUSE</span>	0x080000 <span class="enscript-comment">/* reuse provided entry if identical */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAP_MEM_USE_DATA_ADDR</span>	0x100000 <span class="enscript-comment">/* preserve address of data, rather than base of page */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAP_MEM_VM_COPY</span>		0x200000 <span class="enscript-comment">/* make a copy of a VM range */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAP_MEM_VM_SHARE</span>	0x400000 <span class="enscript-comment">/* extract a VM range for remap */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAP_MEM_4K_DATA_ADDR</span>	0x800000 <span class="enscript-comment">/* preserve 4K aligned address of data */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>

<span class="enscript-comment">/*
 *  Universal Page List data structures
 *
 *  A UPL describes a bounded set of physical pages
 *  associated with some range of an object or map
 *  and a snapshot of the attributes associated with
 *  each of those pages.
 */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">PRIVATE</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAX_UPL_TRANSFER_BYTES</span>	(1024 * 1024)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAX_UPL_SIZE_BYTES</span>	(1024 * 1024 * 64)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAX_UPL_SIZE</span>		(MAX_UPL_SIZE_BYTES / PAGE_SIZE)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAX_UPL_TRANSFER</span>	(MAX_UPL_TRANSFER_BYTES / PAGE_SIZE)


<span class="enscript-type">struct</span> upl_page_info {
	ppnum_t		phys_addr;	<span class="enscript-comment">/* physical page index number */</span>
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>
#<span class="enscript-reference">ifdef</span>  <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
		<span class="enscript-reference">pageout</span>:1,      <span class="enscript-comment">/* page is to be removed on commit */</span>
		<span class="enscript-reference">absent</span>:1,       <span class="enscript-comment">/* No valid data in this page */</span>
		<span class="enscript-reference">dirty</span>:1,        <span class="enscript-comment">/* Page must be cleaned (O) */</span>
		<span class="enscript-reference">precious</span>:1,     <span class="enscript-comment">/* must be cleaned, we have only copy */</span>
		<span class="enscript-reference">device</span>:1,	<span class="enscript-comment">/* no page data, mapped dev memory */</span>
		<span class="enscript-reference">speculative</span>:1,  <span class="enscript-comment">/* page is valid, but not yet accessed */</span>
		<span class="enscript-reference">cs_validated</span>:1,	<span class="enscript-comment">/* CODE SIGNING: page was validated */</span>
		<span class="enscript-reference">cs_tainted</span>:1,	<span class="enscript-comment">/* CODE SIGNING: page is tainted */</span>
		<span class="enscript-reference">cs_nx</span>:1,	<span class="enscript-comment">/* CODE SIGNING: page is NX */</span>
		<span class="enscript-reference">needed</span>:1,	<span class="enscript-comment">/* page should be left in cache on abort */</span>
		<span class="enscript-reference">mark</span>:1,		<span class="enscript-comment">/* a mark flag for the creator to use as they wish */</span>
		:0;		<span class="enscript-comment">/* force to long boundary */</span>
#<span class="enscript-reference">else</span>
		opaque;		<span class="enscript-comment">/* use upl_page_xxx() accessor funcs */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>
};

#<span class="enscript-reference">else</span>

<span class="enscript-type">struct</span> upl_page_info {
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	opaque[2];	<span class="enscript-comment">/* use upl_page_xxx() accessor funcs */</span>
};

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> upl_page_info	upl_page_info_t;
<span class="enscript-type">typedef</span> upl_page_info_t		*upl_page_info_array_t;
<span class="enscript-type">typedef</span> upl_page_info_array_t	upl_page_list_ptr_t;

<span class="enscript-type">typedef</span> uint32_t	upl_offset_t;	<span class="enscript-comment">/* page-aligned byte offset */</span>
<span class="enscript-type">typedef</span> uint32_t	upl_size_t;	<span class="enscript-comment">/* page-aligned byte size */</span>

<span class="enscript-comment">/* upl invocation flags */</span>
<span class="enscript-comment">/* top nibble is used by super upl */</span>

<span class="enscript-type">typedef</span> uint64_t upl_control_flags_t;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_FLAGS_NONE</span>		0x00000000ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_COPYOUT_FROM</span>	0x00000001ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_PRECIOUS</span>		0x00000002ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_NO_SYNC</span>		0x00000004ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_CLEAN_IN_PLACE</span>	0x00000008ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_NOBLOCK</span>		0x00000010ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_RET_ONLY_DIRTY</span>	0x00000020ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_SET_INTERNAL</span>	0x00000040ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_QUERY_OBJECT_TYPE</span>	0x00000080ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_RET_ONLY_ABSENT</span>	0x00000100ULL <span class="enscript-comment">/* used only for COPY_FROM = FALSE */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_FILE_IO</span>             0x00000200ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_SET_LITE</span>		0x00000400ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_SET_INTERRUPTIBLE</span>	0x00000800ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_SET_IO_WIRE</span>		0x00001000ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_FOR_PAGEOUT</span>		0x00002000ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_WILL_BE_DUMPED</span>      0x00004000ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_FORCE_DATA_SYNC</span>	0x00008000ULL
<span class="enscript-comment">/* continued after the ticket bits... */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_PAGE_TICKET_MASK</span>	0x000F0000ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_PAGE_TICKET_SHIFT</span>   16

<span class="enscript-comment">/* ... flags resume here */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_BLOCK_ACCESS</span>	0x00100000ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_ENCRYPT</span>		0x00200000ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_NOZEROFILL</span>		0x00400000ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_WILL_MODIFY</span>		0x00800000ULL <span class="enscript-comment">/* caller will modify the pages */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_NEED_32BIT_ADDR</span>	0x01000000ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_UBC_MSYNC</span>		0x02000000ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_UBC_PAGEOUT</span>		0x04000000ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_UBC_PAGEIN</span>		0x08000000ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_REQUEST_SET_DIRTY</span>	0x10000000ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_REQUEST_NO_FAULT</span>	0x20000000ULL <span class="enscript-comment">/* fail if pages not all resident */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_NOZEROFILLIO</span>	0x40000000ULL <span class="enscript-comment">/* allow non zerofill pages present */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_REQUEST_FORCE_COHERENCY</span>	0x80000000ULL

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_MEMORY_TAG_MASK</span>	0xFF00000000ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_MEMORY_TAG_SHIFT</span>	32
#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_MEMORY_TAG</span>(x)	(((x) &gt;&gt; UPL_MEMORY_TAG_SHIFT) &amp; 0xFF)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_MEMORY_TAG_MAKE</span>(x)	(((upl_control_flags_t)((x) &amp; 0xFF)) &lt;&lt; UPL_MEMORY_TAG_SHIFT)

<span class="enscript-comment">/* UPL flags known by this kernel */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_VALID_FLAGS</span>		0xFFFFFFFFFFULL


<span class="enscript-comment">/* upl abort error flags */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_ABORT_RESTART</span>		0x1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_ABORT_UNAVAILABLE</span>	0x2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_ABORT_ERROR</span>		0x4
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_ABORT_FREE_ON_EMPTY</span>	0x8  <span class="enscript-comment">/* only implemented in wrappers */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_ABORT_DUMP_PAGES</span>	0x10
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_ABORT_NOTIFY_EMPTY</span>	0x20
<span class="enscript-comment">/* deprecated: #define UPL_ABORT_ALLOW_ACCESS	0x40 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_ABORT_REFERENCE</span>	0x80

<span class="enscript-comment">/* upl pages check flags */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_CHECK_DIRTY</span>         0x1


<span class="enscript-comment">/*
 *  upl pagein/pageout  flags
 *
 * 
 * when I/O is issued from this UPL it should be done synchronously
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_IOSYNC</span>	0x1

<span class="enscript-comment">/*
 * the passed in UPL should not have either a commit or abort 
 * applied to it by the underlying layers... the site that
 * created the UPL is responsible for cleaning it up.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_NOCOMMIT</span>	0x2

<span class="enscript-comment">/*
 * turn off any speculative read-ahead applied at the I/O layer
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_NORDAHEAD</span>	0x4

<span class="enscript-comment">/*
 * pageout request is targeting a real file
 * as opposed to a swap file.
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_VNODE_PAGER</span>	0x8
<span class="enscript-comment">/*
 * this pageout is being originated as part of an explicit
 * memory synchronization operation... no speculative clustering
 * should be applied, only the range specified should be pushed.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_MSYNC</span>		0x10

<span class="enscript-comment">/*
 *
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_PAGING_ENCRYPTED</span>	0x20

<span class="enscript-comment">/*
 * this pageout is being originated as part of an explicit
 * memory synchronization operation that is checking for I/O
 * errors and taking it's own action... if an error occurs,
 * just abort the pages back into the cache unchanged
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_KEEPCACHED</span>		0x40

<span class="enscript-comment">/*
 * this pageout originated from within cluster_io to deal
 * with a dirty page that hasn't yet been seen by the FS
 * that backs it... tag it so that the FS can take the
 * appropriate action w/r to its locking model since the
 * pageout will reenter the FS for the same file currently
 * being handled in this context.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_NESTED_PAGEOUT</span>	0x80

<span class="enscript-comment">/*
 * we've detected a sequential access pattern and
 * we are speculatively and aggressively pulling
 * pages in... do not count these as real PAGEINs
 * w/r to our hard throttle maintenance
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_IOSTREAMING</span>		0x100

<span class="enscript-comment">/*
 * Currently, it's only used for the swap pagein path.
 * Since the swap + compressed pager layer manage their
 * pages, these pages are not marked &quot;absent&quot; i.e. these
 * are &quot;valid&quot; pages. The pagein path will _not_ issue an
 * I/O (correctly) for valid pages. So, this flag is used
 * to override that logic in the vnode I/O path.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_IGNORE_VALID_PAGE_CHECK</span>	0x200



<span class="enscript-comment">/* upl commit flags */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_COMMIT_FREE_ON_EMPTY</span>	0x1 <span class="enscript-comment">/* only implemented in wrappers */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_COMMIT_CLEAR_DIRTY</span>		0x2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_COMMIT_SET_DIRTY</span>		0x4
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_COMMIT_INACTIVATE</span>		0x8
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_COMMIT_NOTIFY_EMPTY</span>		0x10
<span class="enscript-comment">/* deprecated: #define UPL_COMMIT_ALLOW_ACCESS		0x20 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_COMMIT_CS_VALIDATED</span>		0x40
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_COMMIT_CLEAR_PRECIOUS</span>	0x80
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_COMMIT_SPECULATE</span>		0x100
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_COMMIT_FREE_ABSENT</span>		0x200
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_COMMIT_WRITTEN_BY_KERNEL</span>	0x400

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_COMMIT_KERNEL_ONLY_FLAGS</span>	(UPL_COMMIT_CS_VALIDATED | UPL_COMMIT_FREE_ABSENT)

<span class="enscript-comment">/* flags for return of state from vm_map_get_upl,  vm_upl address space */</span>
<span class="enscript-comment">/* based call */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_DEV_MEMORY</span>			0x1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_PHYS_CONTIG</span>			0x2


<span class="enscript-comment">/* 
 * Flags for the UPL page ops routine.  This routine is not exported
 * out of the kernel at the moment and so the defs live here.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_POP_DIRTY</span>		0x1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_POP_PAGEOUT</span>		0x2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_POP_PRECIOUS</span>		0x4
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_POP_ABSENT</span>		0x8
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_POP_BUSY</span>			0x10

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_POP_PHYSICAL</span>	0x10000000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_POP_DUMP</span>		0x20000000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_POP_SET</span>		0x40000000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_POP_CLR</span>		0x80000000

<span class="enscript-comment">/* 
 * Flags for the UPL range op routine.  This routine is not exported 
 * out of the kernel at the moemet and so the defs live here.
 */</span>
<span class="enscript-comment">/*
 * UPL_ROP_ABSENT: Returns the extent of the range presented which
 * is absent, starting with the start address presented    
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_ROP_ABSENT</span>		0x01
<span class="enscript-comment">/*
 * UPL_ROP_PRESENT: Returns the extent of the range presented which
 * is present (i.e. resident), starting with the start address presented
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_ROP_PRESENT</span>		0x02
<span class="enscript-comment">/*
 * UPL_ROP_DUMP: Dump the pages which are found in the target object
 * for the target range.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_ROP_DUMP</span>			0x04

#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">PRIVATE</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_REPRIO_INFO_MASK</span> 	(0xFFFFFFFF)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_REPRIO_INFO_SHIFT</span> 	32

<span class="enscript-comment">/* access macros for upl_t */</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_DEVICE_PAGE</span>(upl) \
	(((upl)[0].phys_addr != 0) ? ((upl)[0].device) : FALSE)

#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_PAGE_PRESENT</span>(upl, index) \
	((upl)[(index)].phys_addr != 0)

#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_PHYS_PAGE</span>(upl, index) \
	((upl)[(index)].phys_addr)

#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_SPECULATIVE_PAGE</span>(upl, index) \
	(((upl)[(index)].phys_addr != 0) ? ((upl)[(index)].speculative) : FALSE)

#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_DIRTY_PAGE</span>(upl, index) \
	(((upl)[(index)].phys_addr != 0) ? ((upl)[(index)].dirty) : FALSE)

#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_PRECIOUS_PAGE</span>(upl, index) \
	(((upl)[(index)].phys_addr != 0) ? ((upl)[(index)].precious) : FALSE)

#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_VALID_PAGE</span>(upl, index) \
	(((upl)[(index)].phys_addr != 0) ? (!((upl)[(index)].absent)) : FALSE)

#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_PAGEOUT_PAGE</span>(upl, index) \
	(((upl)[(index)].phys_addr != 0) ? ((upl)[(index)].pageout) : FALSE)

#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_SET_PAGE_FREE_ON_COMMIT</span>(upl, index) \
	(((upl)[(index)].phys_addr != 0) ?	      \
	 ((upl)[(index)].pageout = TRUE) : FALSE)

#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_CLR_PAGE_FREE_ON_COMMIT</span>(upl, index) \
	(((upl)[(index)].phys_addr != 0) ?       \
	 ((upl)[(index)].pageout = FALSE) : FALSE)

#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_REPRIO_INFO_BLKNO</span>(upl, index) \
	(((upl)-&gt;upl_reprio_info[(index)]) &amp; UPL_REPRIO_INFO_MASK) 

#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_REPRIO_INFO_LEN</span>(upl, index) \
	((((upl)-&gt;upl_reprio_info[(index)]) &gt;&gt; UPL_REPRIO_INFO_SHIFT) &amp; UPL_REPRIO_INFO_MASK)

<span class="enscript-comment">/* modifier macros for upl_t */</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_SET_CS_VALIDATED</span>(upl, index, value) \
	((upl)[(index)].cs_validated = ((value) ? TRUE : FALSE))

#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_SET_CS_TAINTED</span>(upl, index, value) \
	((upl)[(index)].cs_tainted = ((value) ? TRUE : FALSE))

#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_SET_CS_NX</span>(upl, index, value) \
	((upl)[(index)].cs_nx = ((value) ? TRUE : FALSE))

#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_SET_REPRIO_INFO</span>(upl, index, blkno, len) \
	((upl)-&gt;upl_reprio_info[(index)]) = (((uint64_t)(blkno) &amp; UPL_REPRIO_INFO_MASK) | \
	(((uint64_t)(len) &amp; UPL_REPRIO_INFO_MASK) &lt;&lt; UPL_REPRIO_INFO_SHIFT))

<span class="enscript-comment">/* The call prototyped below is used strictly by UPL_GET_INTERNAL_PAGE_LIST */</span>

<span class="enscript-type">extern</span> vm_size_t	upl_offset_to_pagelist;
<span class="enscript-type">extern</span> vm_size_t 	upl_get_internal_pagelist_offset(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>*		upl_get_internal_vectorupl(upl_t);
<span class="enscript-type">extern</span> upl_page_info_t*		upl_get_internal_vectorupl_pagelist(upl_t);

<span class="enscript-comment">/*Use this variant to get the UPL's page list iff:*/</span>
<span class="enscript-comment">/*- the upl being passed in is already part of a vector UPL*/</span>
<span class="enscript-comment">/*- the page list you want is that of this &quot;sub-upl&quot; and not that of the entire vector-upl*/</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_GET_INTERNAL_PAGE_LIST_SIMPLE</span>(upl) \
	((upl_page_info_t *)((upl_offset_to_pagelist == 0) ?  \
	(uintptr_t)upl + (<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>)(upl_offset_to_pagelist = upl_get_internal_pagelist_offset()): \
	(uintptr_t)upl + (<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>)upl_offset_to_pagelist))

<span class="enscript-comment">/* UPL_GET_INTERNAL_PAGE_LIST is only valid on internal objects where the */</span>
<span class="enscript-comment">/* list request was made with the UPL_INTERNAL flag */</span>


#<span class="enscript-reference">define</span> <span class="enscript-function-name">UPL_GET_INTERNAL_PAGE_LIST</span>(upl) \
	((upl_get_internal_vectorupl(upl) != NULL ) ? (upl_get_internal_vectorupl_pagelist(upl)) : \
	((upl_page_info_t *)((upl_offset_to_pagelist == 0) ?  \
	(uintptr_t)upl + (<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>)(upl_offset_to_pagelist = upl_get_internal_pagelist_offset()): \
	(uintptr_t)upl + (<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>)upl_offset_to_pagelist)))

__BEGIN_DECLS

<span class="enscript-type">extern</span> ppnum_t	upl_phys_page(upl_page_info_t *upl, <span class="enscript-type">int</span> index);
<span class="enscript-type">extern</span> boolean_t	upl_device_page(upl_page_info_t *upl);
<span class="enscript-type">extern</span> boolean_t	upl_speculative_page(upl_page_info_t *upl, <span class="enscript-type">int</span> index);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	upl_clear_dirty(upl_t upl, boolean_t value);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	upl_set_referenced(upl_t upl, boolean_t value);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>	upl_range_needed(upl_t upl, <span class="enscript-type">int</span> index, <span class="enscript-type">int</span> count);
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">CONFIG_IOSCHED</span>
<span class="enscript-type">extern</span> int64_t <span class="enscript-function-name">upl_blkno</span>(upl_page_info_t *upl, <span class="enscript-type">int</span> index);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> 	upl_set_blkno(upl_t upl, vm_offset_t upl_offset, <span class="enscript-type">int</span> size, int64_t blkno);
#<span class="enscript-reference">endif</span>

__END_DECLS

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>

__BEGIN_DECLS

<span class="enscript-type">extern</span> boolean_t	upl_page_present(upl_page_info_t *upl, <span class="enscript-type">int</span> index);
<span class="enscript-type">extern</span> boolean_t	upl_dirty_page(upl_page_info_t *upl, <span class="enscript-type">int</span> index);
<span class="enscript-type">extern</span> boolean_t	upl_valid_page(upl_page_info_t *upl, <span class="enscript-type">int</span> index);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>		upl_deallocate(upl_t upl);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> 		upl_mark_decmp(upl_t upl);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> 		upl_unmark_decmp(upl_t upl);

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL_PRIVATE</span>

<span class="enscript-type">void</span> <span class="enscript-function-name">upl_page_set_mark</span>(upl_page_info_t *upl, <span class="enscript-type">int</span> index, boolean_t v);
boolean_t <span class="enscript-function-name">upl_page_get_mark</span>(upl_page_info_t *upl, <span class="enscript-type">int</span> index);

#<span class="enscript-reference">endif</span> // <span class="enscript-variable-name">KERNEL_PRIVATE</span>

__END_DECLS

#<span class="enscript-reference">endif</span>  <span class="enscript-comment">/* KERNEL */</span>

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* _MACH_MEMORY_OBJECT_TYPES_H_ */</span>
</pre>
<hr />
</body></html>