<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>message.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">message.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000-2005 Apple Computer, Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*
 * @OSF_COPYRIGHT@
 */</span>
<span class="enscript-comment">/* 
 * Mach Operating System
 * Copyright (c) 1991,1990,1989,1988,1987 Carnegie Mellon University
 * All Rights Reserved.
 * 
 * Permission to use, copy, modify and distribute this software and its
 * documentation is hereby granted, provided that both the copyright
 * notice and this permission notice appear in all copies of the
 * software, derivative works or modified versions, and any portions
 * thereof, and that both notices appear in supporting documentation.
 * 
 * CARNEGIE MELLON ALLOWS FREE USE OF THIS SOFTWARE IN ITS &quot;AS IS&quot;
 * CONDITION.  CARNEGIE MELLON DISCLAIMS ANY LIABILITY OF ANY KIND FOR
 * ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.
 * 
 * Carnegie Mellon requests users of this software to return to
 * 
 *  Software Distribution Coordinator  or  <a href="mailto:Software.Distribution@CS.CMU.EDU">Software.Distribution@CS.CMU.EDU</a>
 *  School of Computer Science
 *  Carnegie Mellon University
 *  Pittsburgh PA 15213-3890
 * 
 * any improvements or extensions that they make and grant Carnegie Mellon
 * the rights to redistribute these changes.
 */</span>
<span class="enscript-comment">/*
 * NOTICE: This file was modified by McAfee Research in 2004 to introduce
 * support for mandatory and extensible security protections.  This notice
 * is included in support of clause 2.2 (b) of the Apple Public License,
 * Version 2.0.
 * Copyright (c) 2005 SPARTA, Inc.
 */</span>
<span class="enscript-comment">/*
 */</span>
<span class="enscript-comment">/*
 *	File:	mach/message.h
 *
 *	Mach IPC message and primitive function definitions.
 */</span>

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">_MACH_MESSAGE_H_</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_MACH_MESSAGE_H_</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;stdint.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/port.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/boolean.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/kern_return.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/machine/vm_types.h&gt;</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/cdefs.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/appleapiopts.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;Availability.h&gt;</span>

<span class="enscript-comment">/*
 *  The timeout mechanism uses mach_msg_timeout_t values,
 *  passed by value.  The timeout units are milliseconds.
 *  It is controlled with the MACH_SEND_TIMEOUT
 *  and MACH_RCV_TIMEOUT options.
 */</span>

<span class="enscript-type">typedef</span> natural_t mach_msg_timeout_t;

<span class="enscript-comment">/*
 *  The value to be used when there is no timeout.
 *  (No MACH_SEND_TIMEOUT/MACH_RCV_TIMEOUT option.)
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TIMEOUT_NONE</span>		((mach_msg_timeout_t) 0)

<span class="enscript-comment">/*
 *  The kernel uses MACH_MSGH_BITS_COMPLEX as a hint.  If it isn't on, it
 *  assumes the body of the message doesn't contain port rights or OOL
 *  data.  The field is set in received messages.  A user task must
 *  use caution in interpreting the body of a message if the bit isn't
 *  on, because the mach_msg_type's in the body might &quot;lie&quot; about the
 *  contents.  If the bit isn't on, but the mach_msg_types
 *  in the body specify rights or OOL data, the behavior is undefined.
 *  (Ie, an error may or may not be produced.)
 *
 *  The value of MACH_MSGH_BITS_REMOTE determines the interpretation
 *  of the msgh_remote_port field.  It is handled like a msgt_name,
 *  but must result in a send or send-once type right.
 *
 *  The value of MACH_MSGH_BITS_LOCAL determines the interpretation
 *  of the msgh_local_port field.  It is handled like a msgt_name,
 *  and also must result in a send or send-once type right.
 *
 *  The value of MACH_MSGH_BITS_VOUCHER determines the interpretation
 *  of the msgh_voucher_port field.  It is handled like a msgt_name,
 *  but must result in a send right (and the msgh_voucher_port field
 *  must be the name of a send right to a Mach voucher kernel object.
 *
 *  MACH_MSGH_BITS() combines two MACH_MSG_TYPE_* values, for the remote
 *  and local fields, into a single value suitable for msgh_bits.
 *
 *  MACH_MSGH_BITS_CIRCULAR should be zero; is is used internally.
 *
 *  The unused bits should be zero and are reserved for the kernel
 *  or for future interface expansion.
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSGH_BITS_ZERO</span>		0x00000000

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSGH_BITS_REMOTE_MASK</span>	0x0000001f
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSGH_BITS_LOCAL_MASK</span>	0x00001f00
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSGH_BITS_VOUCHER_MASK</span>	0x001f0000

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_MSGH_BITS_PORTS_MASK</span>		\
		(MACH_MSGH_BITS_REMOTE_MASK |	\
		 MACH_MSGH_BITS_LOCAL_MASK |	\
		 MACH_MSGH_BITS_VOUCHER_MASK)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSGH_BITS_COMPLEX</span>		0x80000000U	<span class="enscript-comment">/* message is complex */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSGH_BITS_USER</span>             0x801f1f1fU	<span class="enscript-comment">/* allowed bits user-&gt;kernel */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_MSGH_BITS_RAISEIMP</span>		0x20000000U	<span class="enscript-comment">/* importance raised due to msg */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSGH_BITS_DENAP</span>		MACH_MSGH_BITS_RAISEIMP

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_MSGH_BITS_IMPHOLDASRT</span>	0x10000000U	<span class="enscript-comment">/* assertion help, userland private */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSGH_BITS_DENAPHOLDASRT</span>	MACH_MSGH_BITS_IMPHOLDASRT

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_MSGH_BITS_CIRCULAR</span>		0x10000000U	<span class="enscript-comment">/* message circular, kernel private */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_MSGH_BITS_USED</span>		0xb01f1f1fU

<span class="enscript-comment">/* setter macros for the bits */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">MACH_MSGH_BITS</span>(remote, local)  <span class="enscript-comment">/* legacy */</span>		\
		((remote) | ((local) &lt;&lt; 8))
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MACH_MSGH_BITS_SET_PORTS</span>(remote, local, voucher)	\
	(((remote) &amp; MACH_MSGH_BITS_REMOTE_MASK) | 		\
	 (((local) &lt;&lt; 8) &amp; MACH_MSGH_BITS_LOCAL_MASK) | 	\
	 (((voucher) &lt;&lt; 16) &amp; MACH_MSGH_BITS_VOUCHER_MASK))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">MACH_MSGH_BITS_SET</span>(remote, local, voucher, other)	\
	(MACH_MSGH_BITS_SET_PORTS((remote), (local), (voucher)) \
	 | ((other) &amp;~ MACH_MSGH_BITS_PORTS_MASK))

<span class="enscript-comment">/* getter macros for pulling values out of the bits field */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MACH_MSGH_BITS_REMOTE</span>(bits)				\
		((bits) &amp; MACH_MSGH_BITS_REMOTE_MASK)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MACH_MSGH_BITS_LOCAL</span>(bits)				\
		(((bits) &amp; MACH_MSGH_BITS_LOCAL_MASK) &gt;&gt; 8)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MACH_MSGH_BITS_VOUCHER</span>(bits)				\
		(((bits) &amp; MACH_MSGH_BITS_VOUCHER_MASK) &gt;&gt; 16)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MACH_MSGH_BITS_PORTS</span>(bits)				\
	((bits) &amp; MACH_MSGH_BITS_PORTS_MASK)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MACH_MSGH_BITS_OTHER</span>(bits)				\
		((bits) &amp;~ MACH_MSGH_BITS_PORTS_MASK)

<span class="enscript-comment">/* checking macros */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">MACH_MSGH_BITS_HAS_REMOTE</span>(bits)				\
	(MACH_MSGH_BITS_REMOTE(bits) != MACH_MSGH_BITS_ZERO)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">MACH_MSGH_BITS_HAS_LOCAL</span>(bits)				\
	(MACH_MSGH_BITS_LOCAL(bits) != MACH_MSGH_BITS_ZERO)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">MACH_MSGH_BITS_HAS_VOUCHER</span>(bits)			\
	(MACH_MSGH_BITS_VOUCHER(bits) != MACH_MSGH_BITS_ZERO)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">MACH_MSGH_BITS_IS_COMPLEX</span>(bits)				\
	(((bits) &amp; MACH_MSGH_BITS_COMPLEX) != MACH_MSGH_BITS_ZERO)

<span class="enscript-comment">/* importance checking macros */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">MACH_MSGH_BITS_RAISED_IMPORTANCE</span>(bits)			\
	(((bits) &amp; MACH_MSGH_BITS_RAISEIMP) != MACH_MSGH_BITS_ZERO)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">MACH_MSGH_BITS_HOLDS_IMPORTANCE_ASSERTION</span>(bits)		\
	(((bits) &amp; MACH_MSGH_BITS_IMPHOLDASRT) != MACH_MSGH_BITS_ZERO)

<span class="enscript-comment">/*
 *  Every message starts with a message header.
 *  Following the message header, if the message is complex, are a count
 *  of type descriptors and the type descriptors themselves 
 *  (mach_msg_descriptor_t). The size of the message must be specified in 
 *  bytes, and includes the message header, descriptor count, descriptors, 
 *  and inline data.
 *
 *  The msgh_remote_port field specifies the destination of the message.
 *  It must specify a valid send or send-once right for a port.
 *
 *  The msgh_local_port field specifies a &quot;reply port&quot;.  Normally,
 *  This field carries a send-once right that the receiver will use
 *  to reply to the message.  It may carry the values MACH_PORT_NULL,
 *  MACH_PORT_DEAD, a send-once right, or a send right.
 *
 *  The msgh_voucher_port field specifies a Mach voucher port. Only
 *  send rights to kernel-implemented Mach Voucher kernel objects in
 *  addition to MACH_PORT_NULL or MACH_PORT_DEAD may be passed.
 *
 *  The msgh_id field is uninterpreted by the message primitives.
 *  It normally carries information specifying the format
 *  or meaning of the message.
 */</span>

<span class="enscript-type">typedef</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> mach_msg_bits_t;
<span class="enscript-type">typedef</span>	natural_t mach_msg_size_t;
<span class="enscript-type">typedef</span> integer_t mach_msg_id_t;


#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_SIZE_NULL</span> (mach_msg_size_t *) 0

<span class="enscript-type">typedef</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> mach_msg_type_name_t;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TYPE_MOVE_RECEIVE</span>	16	<span class="enscript-comment">/* Must hold receive right */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TYPE_MOVE_SEND</span>		17	<span class="enscript-comment">/* Must hold send right(s) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TYPE_MOVE_SEND_ONCE</span>	18	<span class="enscript-comment">/* Must hold sendonce right */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TYPE_COPY_SEND</span>		19	<span class="enscript-comment">/* Must hold send right(s) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TYPE_MAKE_SEND</span>		20	<span class="enscript-comment">/* Must hold receive right */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TYPE_MAKE_SEND_ONCE</span>	21	<span class="enscript-comment">/* Must hold receive right */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TYPE_COPY_RECEIVE</span>	22	<span class="enscript-comment">/* NOT VALID */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TYPE_DISPOSE_RECEIVE</span>	24	<span class="enscript-comment">/* must hold receive right */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TYPE_DISPOSE_SEND</span>	25	<span class="enscript-comment">/* must hold send right(s) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TYPE_DISPOSE_SEND_ONCE</span> 26	<span class="enscript-comment">/* must hold sendonce right */</span>

<span class="enscript-type">typedef</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> mach_msg_copy_options_t;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_PHYSICAL_COPY</span>		0
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_VIRTUAL_COPY</span>   	1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_ALLOCATE</span>		2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_OVERWRITE</span>		3	<span class="enscript-comment">/* deprecated */</span>
#<span class="enscript-reference">ifdef</span>  <span class="enscript-variable-name">MACH_KERNEL</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_KALLOC_COPY_T</span>		4
#<span class="enscript-reference">endif</span>  <span class="enscript-comment">/* MACH_KERNEL */</span>

<span class="enscript-comment">/*
 * In a complex mach message, the mach_msg_header_t is followed by 
 * a descriptor count, then an array of that number of descriptors 
 * (mach_msg_*_descriptor_t). The type field of mach_msg_type_descriptor_t
 * (which any descriptor can be cast to) indicates the flavor of the
 * descriptor.
 *
 * Note that in LP64, the various types of descriptors are no longer all
 * the same size as mach_msg_descriptor_t, so the array cannot be indexed 
 * as expected.
 */</span>

<span class="enscript-type">typedef</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> mach_msg_descriptor_type_t;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_PORT_DESCRIPTOR</span> 		0
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_OOL_DESCRIPTOR</span>  		1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_OOL_PORTS_DESCRIPTOR</span> 		2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_OOL_VOLATILE_DESCRIPTOR</span>  	3

#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">pack</span>(4)

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span>
{
  natural_t			pad1;
  mach_msg_size_t		pad2;
  <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>			pad3 : 24;
  mach_msg_descriptor_type_t	type : 8;
} mach_msg_type_descriptor_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span>
{
  mach_port_t			name;
#<span class="enscript-reference">if</span> !(<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">KERNEL</span>) &amp;&amp; <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__LP64__</span>))
<span class="enscript-comment">// Pad to 8 bytes everywhere except the K64 kernel where mach_port_t is 8 bytes
</span>  mach_msg_size_t		pad1;
#<span class="enscript-reference">endif</span>
  <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>			pad2 : 16;
  mach_msg_type_name_t		disposition : 8;
  mach_msg_descriptor_type_t	type : 8;
#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">KERNEL</span>)
  uint32_t          pad_end;
#<span class="enscript-reference">endif</span>
} mach_msg_port_descriptor_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span>
{
  uint32_t			address;
  mach_msg_size_t       	size;
  boolean_t     		deallocate: 8;
  mach_msg_copy_options_t       copy: 8;
  <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>     		pad1: 8;
  mach_msg_descriptor_type_t    type: 8;
} mach_msg_ool_descriptor32_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span>
{
  uint64_t			address;
  boolean_t     		deallocate: 8;
  mach_msg_copy_options_t       copy: 8;
  <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>     		pad1: 8;
  mach_msg_descriptor_type_t    type: 8;
  mach_msg_size_t       	size;
} mach_msg_ool_descriptor64_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span>
{
  <span class="enscript-type">void</span>*				address;
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__LP64__</span>)
  mach_msg_size_t       	size;
#<span class="enscript-reference">endif</span>
  boolean_t     		deallocate: 8;
  mach_msg_copy_options_t       copy: 8;
  <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>     		pad1: 8;
  mach_msg_descriptor_type_t    type: 8;
#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__LP64__</span>)
  mach_msg_size_t       	size;
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">KERNEL</span>) &amp;&amp; !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__LP64__</span>)
  uint32_t          pad_end;
#<span class="enscript-reference">endif</span>
} mach_msg_ool_descriptor_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span>
{
  uint32_t			address;
  mach_msg_size_t		count;
  boolean_t     		deallocate: 8;
  mach_msg_copy_options_t       copy: 8;
  mach_msg_type_name_t		disposition : 8;
  mach_msg_descriptor_type_t	type : 8;
} mach_msg_ool_ports_descriptor32_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span>
{
  uint64_t			address;
  boolean_t     		deallocate: 8;
  mach_msg_copy_options_t       copy: 8;
  mach_msg_type_name_t		disposition : 8;
  mach_msg_descriptor_type_t	type : 8;
  mach_msg_size_t		count;
} mach_msg_ool_ports_descriptor64_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span>
{
  <span class="enscript-type">void</span>*				address;
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__LP64__</span>)
  mach_msg_size_t		count;
#<span class="enscript-reference">endif</span>
  boolean_t     		deallocate: 8;
  mach_msg_copy_options_t       copy: 8;
  mach_msg_type_name_t		disposition : 8;
  mach_msg_descriptor_type_t	type : 8;
#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__LP64__</span>)
  mach_msg_size_t		count;
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">KERNEL</span>) &amp;&amp; !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__LP64__</span>)
  uint32_t          pad_end;
#<span class="enscript-reference">endif</span>
} mach_msg_ool_ports_descriptor_t;

<span class="enscript-comment">/*
 * LP64support - This union definition is not really
 * appropriate in LP64 mode because not all descriptors
 * are of the same size in that environment.
 */</span>
#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__LP64__</span>) &amp;&amp; <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">KERNEL</span>)
<span class="enscript-type">typedef</span> <span class="enscript-type">union</span>
{
  mach_msg_port_descriptor_t		port;
  mach_msg_ool_descriptor32_t		out_of_line;
  mach_msg_ool_ports_descriptor32_t	ool_ports;
  mach_msg_type_descriptor_t		type;
} mach_msg_descriptor_t;
#<span class="enscript-reference">else</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">union</span>
{
  mach_msg_port_descriptor_t		port;
  mach_msg_ool_descriptor_t		out_of_line;
  mach_msg_ool_ports_descriptor_t	ool_ports;
  mach_msg_type_descriptor_t		type;
} mach_msg_descriptor_t;
#<span class="enscript-reference">endif</span>

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span>
{
        mach_msg_size_t msgh_descriptor_count;
} mach_msg_body_t;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_BODY_NULL</span> (mach_msg_body_t *) 0
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_DESCRIPTOR_NULL</span> (mach_msg_descriptor_t *) 0

<span class="enscript-type">typedef</span>	<span class="enscript-type">struct</span> 
{
  mach_msg_bits_t	msgh_bits;
  mach_msg_size_t	msgh_size;
  mach_port_t		msgh_remote_port;
  mach_port_t		msgh_local_port;
  mach_port_name_t	msgh_voucher_port;
  mach_msg_id_t		msgh_id;
} mach_msg_header_t;

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">msgh_reserved</span>		msgh_voucher_port
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_NULL</span>	(mach_msg_header_t *) 0

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span>
{
        mach_msg_header_t       header;
        mach_msg_body_t         body;
} mach_msg_base_t;

<span class="enscript-type">typedef</span>	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> mach_msg_trailer_type_t;

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_MSG_TRAILER_FORMAT_0</span>	0

<span class="enscript-type">typedef</span>	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> mach_msg_trailer_size_t;
<span class="enscript-type">typedef</span> <span class="enscript-type">char</span> *mach_msg_trailer_info_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> 
{
  mach_msg_trailer_type_t	msgh_trailer_type;
  mach_msg_trailer_size_t	msgh_trailer_size;
} mach_msg_trailer_t;

<span class="enscript-comment">/*
 *  The msgh_seqno field carries a sequence number
 *  associated with the received-from port.  A port's
 *  sequence number is incremented every time a message
 *  is received from it and included in the received
 *  trailer to help put messages back in sequence if
 *  multiple threads receive and/or process received
 *  messages.
 */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span>
{
  mach_msg_trailer_type_t       msgh_trailer_type;
  mach_msg_trailer_size_t       msgh_trailer_size;
  mach_port_seqno_t             msgh_seqno;
} mach_msg_seqno_trailer_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span>
{
  <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>			val[2];
} security_token_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> 
{
  mach_msg_trailer_type_t	msgh_trailer_type;
  mach_msg_trailer_size_t	msgh_trailer_size;
  mach_port_seqno_t		msgh_seqno;
  security_token_t		msgh_sender;
} mach_msg_security_trailer_t;

<span class="enscript-comment">/*
 * The audit token is an opaque token which identifies
 * Mach tasks and senders of Mach messages as subjects
 * to the BSM audit system.  Only the appropriate BSM
 * library routines should be used to interpret the
 * contents of the audit token as the representation
 * of the subject identity within the token may change
 * over time.
 */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span>
{
  <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>			val[8];
} audit_token_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> 
{
  mach_msg_trailer_type_t	msgh_trailer_type;
  mach_msg_trailer_size_t	msgh_trailer_size;
  mach_port_seqno_t		msgh_seqno;
  security_token_t		msgh_sender;
  audit_token_t			msgh_audit;
} mach_msg_audit_trailer_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> 
{
  mach_msg_trailer_type_t	msgh_trailer_type;
  mach_msg_trailer_size_t	msgh_trailer_size;
  mach_port_seqno_t		msgh_seqno;
  security_token_t		msgh_sender;
  audit_token_t			msgh_audit;
  mach_port_context_t		msgh_context;
} mach_msg_context_trailer_t;



<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span>
{
  mach_port_name_t sender;
} msg_labels_t;

<span class="enscript-comment">/* 
   Trailer type to pass MAC policy label info as a mach message trailer.
   
*/</span>

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span>
{
  mach_msg_trailer_type_t       msgh_trailer_type;
  mach_msg_trailer_size_t       msgh_trailer_size;
  mach_port_seqno_t             msgh_seqno;
  security_token_t              msgh_sender;
  audit_token_t                 msgh_audit;
  mach_port_context_t		msgh_context;
  <span class="enscript-type">int</span>				msgh_ad;
  msg_labels_t                  msgh_labels;
} mach_msg_mac_trailer_t;


#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TRAILER_MINIMUM_SIZE</span>  sizeof(mach_msg_trailer_t)

<span class="enscript-comment">/*
 * These values can change from release to release - but clearly
 * code cannot request additional trailer elements one was not
 * compiled to understand.  Therefore, it is safe to use this
 * constant when the same module specified the receive options.
 * Otherwise, you run the risk that the options requested by
 * another module may exceed the local modules notion of
 * MAX_TRAILER_SIZE.
 */</span>

<span class="enscript-type">typedef</span> mach_msg_mac_trailer_t mach_msg_max_trailer_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAX_TRAILER_SIZE</span> ((mach_msg_size_t)sizeof(mach_msg_max_trailer_t))

<span class="enscript-comment">/*
 * Legacy requirements keep us from ever updating these defines (even
 * when the format_0 trailers gain new option data fields in the future).
 * Therefore, they shouldn't be used going forward.  Instead, the sizes
 * should be compared against the specific element size requested using
 * REQUESTED_TRAILER_SIZE.
 */</span>
<span class="enscript-type">typedef</span> mach_msg_security_trailer_t mach_msg_format_0_trailer_t;

<span class="enscript-comment">/*typedef mach_msg_mac_trailer_t mach_msg_format_0_trailer_t;
*/</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TRAILER_FORMAT_0_SIZE</span> sizeof(mach_msg_format_0_trailer_t)

#<span class="enscript-reference">define</span>   <span class="enscript-variable-name">KERNEL_SECURITY_TOKEN_VALUE</span>  { {0, 1} }
<span class="enscript-type">extern</span> security_token_t KERNEL_SECURITY_TOKEN;

#<span class="enscript-reference">define</span>   <span class="enscript-variable-name">KERNEL_AUDIT_TOKEN_VALUE</span>  { {0, 0, 0, 0, 0, 0, 0, 0} }
<span class="enscript-type">extern</span> audit_token_t KERNEL_AUDIT_TOKEN;

<span class="enscript-type">typedef</span>	integer_t mach_msg_options_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span>
{
  mach_msg_header_t	header;
} mach_msg_empty_send_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span>
{
  mach_msg_header_t	header;
  mach_msg_trailer_t	trailer;
} mach_msg_empty_rcv_t;

<span class="enscript-type">typedef</span> <span class="enscript-type">union</span>
{
  mach_msg_empty_send_t	send;
  mach_msg_empty_rcv_t	rcv;
} mach_msg_empty_t;

#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">pack</span>()

<span class="enscript-comment">/* utility to round the message size - will become machine dependent */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">round_msg</span>(x)	(((mach_msg_size_t)(x) + sizeof (natural_t) - 1) &amp; \
				~(<span class="enscript-keyword">sizeof</span> (natural_t) - 1))

<span class="enscript-comment">/*
 *  There is no fixed upper bound to the size of Mach messages.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_MSG_SIZE_MAX</span>	((mach_msg_size_t) ~0)

#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__APPLE_API_PRIVATE</span>)
<span class="enscript-comment">/*
 *  But architectural limits of a given implementation, or
 *  temporal conditions may cause unpredictable send failures
 *  for messages larger than MACH_MSG_SIZE_RELIABLE.
 *
 *  In either case, waiting for memory is [currently] outside
 *  the scope of send timeout values provided to IPC.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_MSG_SIZE_RELIABLE</span>	((mach_msg_size_t) 256 * 1024)
#<span class="enscript-reference">endif</span>
<span class="enscript-comment">/*
 *  Compatibility definitions, for code written
 *  when there was a msgh_kind instead of msgh_seqno.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSGH_KIND_NORMAL</span>		0x00000000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSGH_KIND_NOTIFICATION</span>	0x00000001
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">msgh_kind</span>			msgh_seqno
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">mach_msg_kind_t</span>			mach_port_seqno_t

<span class="enscript-type">typedef</span> natural_t mach_msg_type_size_t;
<span class="enscript-type">typedef</span> natural_t mach_msg_type_number_t;

<span class="enscript-comment">/*
 *  Values received/carried in messages.  Tells the receiver what
 *  sort of port right he now has.
 *
 *  MACH_MSG_TYPE_PORT_NAME is used to transfer a port name
 *  which should remain uninterpreted by the kernel.  (Port rights
 *  are not transferred, just the port name.)
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TYPE_PORT_NONE</span>		0

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TYPE_PORT_NAME</span>		15
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TYPE_PORT_RECEIVE</span>	MACH_MSG_TYPE_MOVE_RECEIVE
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TYPE_PORT_SEND</span>		MACH_MSG_TYPE_MOVE_SEND
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TYPE_PORT_SEND_ONCE</span>	MACH_MSG_TYPE_MOVE_SEND_ONCE

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TYPE_LAST</span>		22		<span class="enscript-comment">/* Last assigned */</span>

<span class="enscript-comment">/*
 *  A dummy value.  Mostly used to indicate that the actual value
 *  will be filled in later, dynamically.
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_TYPE_POLYMORPHIC</span>	((mach_msg_type_name_t) -1)

<span class="enscript-comment">/*
 *	Is a given item a port type?
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">MACH_MSG_TYPE_PORT_ANY</span>(x)			\
	(((x) &gt;= MACH_MSG_TYPE_MOVE_RECEIVE) &amp;&amp;		\
	 ((x) &lt;= MACH_MSG_TYPE_MAKE_SEND_ONCE))

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MACH_MSG_TYPE_PORT_ANY_SEND</span>(x)			\
	(((x) &gt;= MACH_MSG_TYPE_MOVE_SEND) &amp;&amp;		\
	 ((x) &lt;= MACH_MSG_TYPE_MAKE_SEND_ONCE))

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MACH_MSG_TYPE_PORT_ANY_RIGHT</span>(x)			\
	(((x) &gt;= MACH_MSG_TYPE_MOVE_RECEIVE) &amp;&amp;		\
	 ((x) &lt;= MACH_MSG_TYPE_MOVE_SEND_ONCE))

<span class="enscript-type">typedef</span> integer_t mach_msg_option_t;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_OPTION_NONE</span>	0x00000000

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_SEND_MSG</span>		0x00000001
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_RCV_MSG</span>		0x00000002

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_LARGE</span>		0x00000004	<span class="enscript-comment">/* report large message sizes */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_LARGE_IDENTITY</span>	0x00000008	<span class="enscript-comment">/* identify source of large messages */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_TIMEOUT</span>	0x00000010	<span class="enscript-comment">/* timeout value applies to send */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_INTERRUPT</span>	0x00000040	<span class="enscript-comment">/* don't restart interrupted sends */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_NOTIFY</span>	0x00000080	<span class="enscript-comment">/* arm send-possible notify */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_ALWAYS</span>	0x00010000	<span class="enscript-comment">/* ignore qlimits - kernel only */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_TRAILER</span>	0x00020000	<span class="enscript-comment">/* sender-provided trailer */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_NOIMPORTANCE</span>  0x00040000      <span class="enscript-comment">/* msg won't carry importance */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_NODENAP</span>	MACH_SEND_NOIMPORTANCE
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_IMPORTANCE</span>	0x00080000	<span class="enscript-comment">/* msg carries importance - kernel only */</span>


#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_TIMEOUT</span>	0x00000100	<span class="enscript-comment">/* timeout value applies to receive */</span>	
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_NOTIFY</span>		0x00000200	<span class="enscript-comment">/* reserved - legacy */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_INTERRUPT</span>	0x00000400	<span class="enscript-comment">/* don't restart interrupted receive */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_VOUCHER</span>	0x00000800	<span class="enscript-comment">/* willing to receive voucher port */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_OVERWRITE</span>	0x00001000	<span class="enscript-comment">/* scatter receive (deprecated) */</span>

<span class="enscript-comment">/* 
 * NOTE: a 0x00------ RCV mask implies to ask for
 * a MACH_MSG_TRAILER_FORMAT_0 with 0 Elements, 
 * which is equivalent to a mach_msg_trailer_t.
 *
 * XXXMAC: unlike the rest of the MACH_RCV_* flags, MACH_RCV_TRAILER_LABELS
 * needs its own private bit since we only calculate its fields when absolutely 
 * required.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_TRAILER_NULL</span>   0
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_TRAILER_SEQNO</span>  1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_TRAILER_SENDER</span> 2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_TRAILER_AUDIT</span>  3
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_TRAILER_CTX</span>    4
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_TRAILER_AV</span>     7
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_TRAILER_LABELS</span> 8

#<span class="enscript-reference">define</span> <span class="enscript-function-name">MACH_RCV_TRAILER_TYPE</span>(x)     (((x) &amp; 0xf) &lt;&lt; 28) 
#<span class="enscript-reference">define</span> <span class="enscript-function-name">MACH_RCV_TRAILER_ELEMENTS</span>(x) (((x) &amp; 0xf) &lt;&lt; 24)  
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_TRAILER_MASK</span> 	     ((0xf &lt;&lt; 24))

#<span class="enscript-reference">define</span> <span class="enscript-function-name">GET_RCV_ELEMENTS</span>(y) (((y) &gt;&gt; 24) &amp; 0xf)

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">MACH_KERNEL_PRIVATE</span>
<span class="enscript-comment">/* The options that the kernel honors when passed from user space */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_USER</span>		 (MACH_SEND_MSG | \
				  MACH_SEND_TIMEOUT | MACH_SEND_NOTIFY | \
				  MACH_SEND_TRAILER | MACH_SEND_NOIMPORTANCE )

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_USER</span>		 (MACH_RCV_MSG | MACH_RCV_TIMEOUT | \
				  MACH_RCV_LARGE | MACH_RCV_LARGE_IDENTITY | \
				  MACH_RCV_VOUCHER | MACH_RCV_TRAILER_MASK)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_OPTION_USER</span>	 (MACH_SEND_USER | MACH_RCV_USER)

<span class="enscript-comment">/* The options implemented by the library interface to mach_msg et. al. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_OPTION_LIB</span>	 (MACH_SEND_INTERRUPT | MACH_RCV_INTERRUPT)

<span class="enscript-comment">/* Default options to use when sending from the kernel */</span>
#<span class="enscript-reference">if</span> 11938665
	<span class="enscript-comment">/*
	 * Until we are sure of its effects, we are disabling
	 * importance donation from the kernel-side of user
	 * threads in importance-donating tasks.
	 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_KERNEL_DEFAULT</span> (MACH_SEND_MSG | \
				  MACH_SEND_ALWAYS | MACH_SEND_NOIMPORTANCE)
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_KERNEL_DEFAULT</span> (MACH_SEND_MSG | MACH_SEND_ALWAYS)
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* MACH_KERNEL_PRIVATE */</span>

<span class="enscript-comment">/* 
 * XXXMAC: note that in the case of MACH_RCV_TRAILER_LABELS, 
 * we just fall through to mach_msg_max_trailer_t.
 * This is correct behavior since mach_msg_max_trailer_t is defined as
 * mac_msg_mac_trailer_t which is used for the LABELS trailer.
 * It also makes things work properly if MACH_RCV_TRAILER_LABELS is ORed 
 * with one of the other options.
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">REQUESTED_TRAILER_SIZE_NATIVE</span>(y)			\
	((mach_msg_trailer_size_t)				\
	 ((GET_RCV_ELEMENTS(y) == MACH_RCV_TRAILER_NULL) ?	\
	  <span class="enscript-keyword">sizeof</span>(mach_msg_trailer_t) :				\
	  ((GET_RCV_ELEMENTS(y) == MACH_RCV_TRAILER_SEQNO) ?	\
	   <span class="enscript-keyword">sizeof</span>(mach_msg_seqno_trailer_t) :			\
	  ((GET_RCV_ELEMENTS(y) == MACH_RCV_TRAILER_SENDER) ?	\
	   <span class="enscript-keyword">sizeof</span>(mach_msg_security_trailer_t) :		\
	   ((GET_RCV_ELEMENTS(y) == MACH_RCV_TRAILER_AUDIT) ?	\
	    <span class="enscript-keyword">sizeof</span>(mach_msg_audit_trailer_t) :      		\
	    ((GET_RCV_ELEMENTS(y) == MACH_RCV_TRAILER_CTX) ?	\
	     <span class="enscript-keyword">sizeof</span>(mach_msg_context_trailer_t) :      		\
	     ((GET_RCV_ELEMENTS(y) == MACH_RCV_TRAILER_AV) ?	\
	      <span class="enscript-keyword">sizeof</span>(mach_msg_mac_trailer_t) :      		\
	     <span class="enscript-keyword">sizeof</span>(mach_msg_max_trailer_t))))))))


#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">REQUESTED_TRAILER_SIZE</span>(is64, y) REQUESTED_TRAILER_SIZE_NATIVE(y)

#<span class="enscript-reference">else</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">REQUESTED_TRAILER_SIZE</span>(y) REQUESTED_TRAILER_SIZE_NATIVE(y)
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>

<span class="enscript-comment">/*
 *  Much code assumes that mach_msg_return_t == kern_return_t.
 *  This definition is useful for descriptive purposes.
 *
 *  See &lt;mach/error.h&gt; for the format of error codes.
 *  IPC errors are system 4.  Send errors are subsystem 0;
 *  receive errors are subsystem 1.  The code field is always non-zero.
 *  The high bits of the code field communicate extra information
 *  for some error codes.  MACH_MSG_MASK masks off these special bits.
 */</span>

<span class="enscript-type">typedef</span> kern_return_t mach_msg_return_t;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_MSG_SUCCESS</span>		0x00000000


#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_MSG_MASK</span>			0x00003e00
		<span class="enscript-comment">/* All special error code bits defined below. */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_MSG_IPC_SPACE</span>		0x00002000
		<span class="enscript-comment">/* No room in IPC name space for another capability name. */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_MSG_VM_SPACE</span>		0x00001000
		<span class="enscript-comment">/* No room in VM address space for out-of-line memory. */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_MSG_IPC_KERNEL</span>		0x00000800
		<span class="enscript-comment">/* Kernel resource shortage handling an IPC capability. */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_MSG_VM_KERNEL</span>		0x00000400
		<span class="enscript-comment">/* Kernel resource shortage handling out-of-line memory. */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_IN_PROGRESS</span>		0x10000001
		<span class="enscript-comment">/* Thread is waiting to send.  (Internal use only.) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_INVALID_DATA</span>		0x10000002
		<span class="enscript-comment">/* Bogus in-line data. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_INVALID_DEST</span>		0x10000003
		<span class="enscript-comment">/* Bogus destination port. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_TIMED_OUT</span>		0x10000004
		<span class="enscript-comment">/* Message not sent before timeout expired. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_INVALID_VOUCHER</span>	0x10000005
		<span class="enscript-comment">/* Bogus voucher port. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_INTERRUPTED</span>		0x10000007
		<span class="enscript-comment">/* Software interrupt. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_MSG_TOO_SMALL</span>		0x10000008
		<span class="enscript-comment">/* Data doesn't contain a complete message. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_INVALID_REPLY</span>		0x10000009
		<span class="enscript-comment">/* Bogus reply port. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_INVALID_RIGHT</span>		0x1000000a
		<span class="enscript-comment">/* Bogus port rights in the message body. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_INVALID_NOTIFY</span>	0x1000000b
		<span class="enscript-comment">/* Bogus notify port argument. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_INVALID_MEMORY</span>	0x1000000c
		<span class="enscript-comment">/* Invalid out-of-line memory pointer. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_NO_BUFFER</span>		0x1000000d
		<span class="enscript-comment">/* No message buffer is available. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_TOO_LARGE</span>		0x1000000e
		<span class="enscript-comment">/* Send is too large for port */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_INVALID_TYPE</span>		0x1000000f
		<span class="enscript-comment">/* Invalid msg-type specification. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_INVALID_HEADER</span>	0x10000010
		<span class="enscript-comment">/* A field in the header had a bad value. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_INVALID_TRAILER</span>	0x10000011
		<span class="enscript-comment">/* The trailer to be sent does not match kernel format. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_SEND_INVALID_RT_OOL_SIZE</span>	0x10000015
		<span class="enscript-comment">/* compatibility: no longer a returned error */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_IN_PROGRESS</span>		0x10004001
		<span class="enscript-comment">/* Thread is waiting for receive.  (Internal use only.) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_INVALID_NAME</span>		0x10004002
		<span class="enscript-comment">/* Bogus name for receive port/port-set. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_TIMED_OUT</span>		0x10004003
		<span class="enscript-comment">/* Didn't get a message within the timeout value. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_TOO_LARGE</span>		0x10004004
		<span class="enscript-comment">/* Message buffer is not large enough for inline data. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_INTERRUPTED</span>		0x10004005
		<span class="enscript-comment">/* Software interrupt. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_PORT_CHANGED</span>		0x10004006
		<span class="enscript-comment">/* compatibility: no longer a returned error */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_INVALID_NOTIFY</span>		0x10004007
		<span class="enscript-comment">/* Bogus notify port argument. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_INVALID_DATA</span>		0x10004008
		<span class="enscript-comment">/* Bogus message buffer for inline data. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_PORT_DIED</span>		0x10004009
		<span class="enscript-comment">/* Port/set was sent away/died during receive. */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_RCV_IN_SET</span>			0x1000400a
		<span class="enscript-comment">/* compatibility: no longer a returned error */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_RCV_HEADER_ERROR</span>		0x1000400b
		<span class="enscript-comment">/* Error receiving message header.  See special bits. */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_RCV_BODY_ERROR</span>		0x1000400c
		<span class="enscript-comment">/* Error receiving message body.  See special bits. */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_RCV_INVALID_TYPE</span>		0x1000400d
		<span class="enscript-comment">/* Invalid msg-type specification in scatter list. */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_RCV_SCATTER_SMALL</span>		0x1000400e
		<span class="enscript-comment">/* Out-of-line overwrite region is not large enough */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_INVALID_TRAILER</span>	0x1000400f
		<span class="enscript-comment">/* trailer type or number of trailer elements not supported */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_RCV_IN_PROGRESS_TIMED</span>      0x10004011
                <span class="enscript-comment">/* Waiting for receive with timeout. (Internal use only.) */</span>


__BEGIN_DECLS

<span class="enscript-comment">/*
 *	Routine:	mach_msg_overwrite
 *	Purpose:
 *		Send and/or receive a message.  If the message operation
 *		is interrupted, and the user did not request an indication
 *		of that fact, then restart the appropriate parts of the
 *		operation silently (trap version does not restart).
 *
 *		Distinct send and receive buffers may be specified.  If
 *		no separate receive buffer is specified, the msg parameter
 *		will be used for both send and receive operations.
 *
 *		In addition to a distinct receive buffer, that buffer may
 *		already contain scatter control information to direct the
 *		receiving of the message.
 */</span>
__WATCHOS_PROHIBITED __TVOS_PROHIBITED
<span class="enscript-type">extern</span> mach_msg_return_t	mach_msg_overwrite(
					mach_msg_header_t *msg,
					mach_msg_option_t option,
					mach_msg_size_t send_size,
					mach_msg_size_t rcv_size,
					mach_port_name_t rcv_name,
					mach_msg_timeout_t timeout,
					mach_port_name_t notify,
					mach_msg_header_t *rcv_msg,
					mach_msg_size_t rcv_limit);

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">KERNEL</span>

<span class="enscript-comment">/*
 *	Routine:	mach_msg
 *	Purpose:
 *		Send and/or receive a message.  If the message operation
 *		is interrupted, and the user did not request an indication
 *		of that fact, then restart the appropriate parts of the
 *		operation silently (trap version does not restart).
 */</span>
__WATCHOS_PROHIBITED __TVOS_PROHIBITED
<span class="enscript-type">extern</span> mach_msg_return_t	mach_msg(
					mach_msg_header_t *msg,
					mach_msg_option_t option,
					mach_msg_size_t send_size,
					mach_msg_size_t rcv_size,
					mach_port_name_t rcv_name,
					mach_msg_timeout_t timeout,
					mach_port_name_t notify);

<span class="enscript-comment">/*
 *	Routine:	mach_voucher_deallocate
 *	Purpose:
 *		Deallocate a mach voucher created or received in a message.  Drops
 *		one (send right) reference to the voucher.
 */</span>
__WATCHOS_PROHIBITED __TVOS_PROHIBITED
<span class="enscript-type">extern</span> kern_return_t		mach_voucher_deallocate(
					mach_port_name_t voucher);

#<span class="enscript-reference">elif</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">MACH_KERNEL_PRIVATE</span>)

<span class="enscript-type">extern</span> mach_msg_return_t	mach_msg_receive_results(<span class="enscript-type">void</span>);

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* KERNEL */</span>

__END_DECLS

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* _MACH_MESSAGE_H_ */</span>

</pre>
<hr />
</body></html>