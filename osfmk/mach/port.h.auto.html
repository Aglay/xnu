<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>port.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">port.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000-2006 Apple Computer, Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*
 * @OSF_COPYRIGHT@
 */</span>
<span class="enscript-comment">/* 
 * Mach Operating System
 * Copyright (c) 1991,1990,1989,1988,1987 Carnegie Mellon University
 * All Rights Reserved.
 * 
 * Permission to use, copy, modify and distribute this software and its
 * documentation is hereby granted, provided that both the copyright
 * notice and this permission notice appear in all copies of the
 * software, derivative works or modified versions, and any portions
 * thereof, and that both notices appear in supporting documentation.
 * 
 * CARNEGIE MELLON ALLOWS FREE USE OF THIS SOFTWARE IN ITS &quot;AS IS&quot;
 * CONDITION.  CARNEGIE MELLON DISCLAIMS ANY LIABILITY OF ANY KIND FOR
 * ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.
 * 
 * Carnegie Mellon requests users of this software to return to
 * 
 *  Software Distribution Coordinator  or  <a href="mailto:Software.Distribution@CS.CMU.EDU">Software.Distribution@CS.CMU.EDU</a>
 *  School of Computer Science
 *  Carnegie Mellon University
 *  Pittsburgh PA 15213-3890
 * 
 * any improvements or extensions that they make and grant Carnegie Mellon
 * the rights to redistribute these changes.
 */</span>
<span class="enscript-comment">/*
 * NOTICE: This file was modified by McAfee Research in 2004 to introduce
 * support for mandatory and extensible security protections.  This notice
 * is included in support of clause 2.2 (b) of the Apple Public License,
 * Version 2.0.
 */</span>
<span class="enscript-comment">/*
 */</span>
<span class="enscript-comment">/*
 *	File:	mach/port.h
 *
 *	Definition of a Mach port
 *
 *	Mach ports are the endpoints to Mach-implemented communications
 *	channels (usually uni-directional message queues, but other types
 *	also exist).
 *
 *	Unique collections of these endpoints are maintained for each
 *	Mach task.  Each Mach port in the task's collection is given a 
 *	[task-local] name to identify it - and the the various &quot;rights&quot;
 *	held by the task for that specific endpoint.
 *
 *	This header defines the types used to identify these Mach ports
 *	and the various rights associated with them.  For more info see:
 *
 *	&lt;mach/mach_port.h&gt; - manipulation of port rights in a given space
 *	&lt;mach/message.h&gt; - message queue [and port right passing] mechanism
 *
 */</span>

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">_MACH_PORT_H_</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_MACH_PORT_H_</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/cdefs.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;stdint.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/boolean.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/machine/vm_types.h&gt;</span>

<span class="enscript-comment">/*
 *	mach_port_name_t - the local identity for a Mach port
 *
 *	The name is Mach port namespace specific.  It is used to
 *	identify the rights held for that port by the task whose
 *	namespace is implied [or specifically provided].
 *
 *	Use of this type usually implies just a name - no rights.
 *	See mach_port_t for a type that implies a &quot;named right.&quot;
 *
 */</span>
 
<span class="enscript-type">typedef</span> natural_t mach_port_name_t;
<span class="enscript-type">typedef</span> mach_port_name_t *mach_port_name_array_t;

#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">KERNEL</span>

<span class="enscript-comment">/* 
 *	mach_port_t - a named port right
 *
 *	In the kernel, &quot;rights&quot; are represented [named] by pointers to
 *	the ipc port object in question. There is no port namespace for the
 *	rights to be collected.
 *
 *	Actually, there is namespace for the kernel task.  But most kernel
 *	code - including, but not limited to, Mach IPC code - lives in the
 *	limbo between the current user-level task and the &quot;next&quot; task. Very
 *	little of the kernel code runs in full kernel task context.  So very
 *	little of it gets to use the kernel task's port name space.  
 *
 *	Because of this implementation approach, all in-kernel rights for
 *	a given port coalesce [have the same name/pointer].  The actual
 *	references are counted in the port itself.  It is up to the kernel
 *	code in question to &quot;just remember&quot; how many [and what type of]
 *	rights it holds and handle them appropriately.
 *
 */</span>

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">MACH_KERNEL_PRIVATE</span>
<span class="enscript-comment">/*
 *	For kernel code that resides outside of Mach proper, we opaque the
 *	port structure definition.
 */</span>
<span class="enscript-type">struct</span> ipc_port ;

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* MACH_KERNEL_PRIVATE */</span>

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> ipc_port	        *ipc_port_t;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IPC_PORT_NULL</span>		((ipc_port_t) 0UL)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IPC_PORT_DEAD</span>		((ipc_port_t)~0UL)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">IPC_PORT_VALID</span>(port) \
	((port) != IPC_PORT_NULL &amp;&amp; (port) != IPC_PORT_DEAD)

<span class="enscript-type">typedef</span> ipc_port_t 		mach_port_t;

<span class="enscript-comment">/*
 * Since the 32-bit and 64-bit representations of ~0 are different,
 * explicitly handle MACH_PORT_DEAD
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">CAST_MACH_PORT_TO_NAME</span>(x) ((mach_port_name_t)(uintptr_t)(x))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">CAST_MACH_NAME_TO_PORT</span>(x) ((x) == MACH_PORT_DEAD ? (mach_port_t)IPC_PORT_DEAD : (mach_port_t)(uintptr_t)(x))

#<span class="enscript-reference">else</span>	<span class="enscript-comment">/* KERNEL */</span>

<span class="enscript-comment">/* 
 *	mach_port_t - a named port right
 *
 *	In user-space, &quot;rights&quot; are represented by the name of the
 *	right in the Mach port namespace.  Even so, this type is
 *	presented as a unique one to more clearly denote the presence
 *	of a right coming along with the name. 
 *
 *	Often, various rights for a port held in a single name space
 *	will coalesce and are, therefore, be identified by a single name
 *	[this is the case for send and receive rights].  But not
 *	always [send-once rights currently get a unique name for
 *	each right].      
 *
 */</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/_types/_mach_port_t.h&gt;</span>

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* KERNEL */</span>

<span class="enscript-type">typedef</span> mach_port_t			*mach_port_array_t;

<span class="enscript-comment">/*
 *  MACH_PORT_NULL is a legal value that can be carried in messages.
 *  It indicates the absence of any port or port rights.  (A port
 *  argument keeps the message from being &quot;simple&quot;, even if the
 *  value is MACH_PORT_NULL.)  The value MACH_PORT_DEAD is also a legal
 *  value that can be carried in messages.  It indicates
 *  that a port right was present, but it died.
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_NULL</span>		0  <span class="enscript-comment">/* intentional loose typing */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_DEAD</span>		((mach_port_name_t) ~0)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">MACH_PORT_VALID</span>(name)				\
		(((name) != MACH_PORT_NULL) &amp;&amp; 		\
		 ((name) != MACH_PORT_DEAD))


<span class="enscript-comment">/*
 *	For kernel-selected [assigned] port names, the name is
 *	comprised of two parts: a generation number and an index.
 *	This approach keeps the exact same name from being generated
 *	and reused too quickly [to catch right/reference counting bugs].
 *	The dividing line between the constituent parts is exposed so
 *	that efficient &quot;mach_port_name_t to data structure pointer&quot;
 *	conversion implementation can be made.  But it is possible
 *	for user-level code to assign their own names to Mach ports.
 *	These are not required to participate in this algorithm.  So
 *	care should be taken before &quot;assuming&quot; this model.
 *
 */</span>

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">NO_PORT_GEN</span>

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MACH_PORT_INDEX</span>(name)		((name) &gt;&gt; 8)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MACH_PORT_GEN</span>(name)		(((name) &amp; 0xff) &lt;&lt; 24)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MACH_PORT_MAKE</span>(index, gen)	\
		(((index) &lt;&lt; 8) | (gen) &gt;&gt; 24)

#<span class="enscript-reference">else</span>	<span class="enscript-comment">/* NO_PORT_GEN */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MACH_PORT_INDEX</span>(name)		(name)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MACH_PORT_GEN</span>(name)		(0)
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">MACH_PORT_MAKE</span>(index, gen)	(index)

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* NO_PORT_GEN */</span>


<span class="enscript-comment">/*
 *  These are the different rights a task may have for a port.
 *  The MACH_PORT_RIGHT_* definitions are used as arguments
 *  to mach_port_allocate, mach_port_get_refs, etc, to specify
 *  a particular right to act upon.  The mach_port_names and
 *  mach_port_type calls return bitmasks using the MACH_PORT_TYPE_*
 *  definitions.  This is because a single name may denote
 *  multiple rights.
 */</span>

<span class="enscript-type">typedef</span> natural_t mach_port_right_t;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_RIGHT_SEND</span>		((mach_port_right_t) 0)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_RIGHT_RECEIVE</span>		((mach_port_right_t) 1)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_RIGHT_SEND_ONCE</span>	((mach_port_right_t) 2)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_RIGHT_PORT_SET</span>	((mach_port_right_t) 3)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_RIGHT_DEAD_NAME</span>	((mach_port_right_t) 4)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_RIGHT_LABELH</span>	        ((mach_port_right_t) 5)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_RIGHT_NUMBER</span>		((mach_port_right_t) 6)

<span class="enscript-type">typedef</span> natural_t mach_port_type_t;
<span class="enscript-type">typedef</span> mach_port_type_t *mach_port_type_array_t;

#<span class="enscript-reference">define</span> <span class="enscript-function-name">MACH_PORT_TYPE</span>(right)						\
		((mach_port_type_t)(((mach_port_type_t) 1)  		\
		&lt;&lt; ((right) + ((mach_port_right_t) 16))))	
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_TYPE_NONE</span>	    ((mach_port_type_t) 0L)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_TYPE_SEND</span>	    MACH_PORT_TYPE(MACH_PORT_RIGHT_SEND)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_TYPE_RECEIVE</span>	    MACH_PORT_TYPE(MACH_PORT_RIGHT_RECEIVE)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_TYPE_SEND_ONCE</span>    MACH_PORT_TYPE(MACH_PORT_RIGHT_SEND_ONCE)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_TYPE_PORT_SET</span>	    MACH_PORT_TYPE(MACH_PORT_RIGHT_PORT_SET)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_TYPE_DEAD_NAME</span>    MACH_PORT_TYPE(MACH_PORT_RIGHT_DEAD_NAME)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_TYPE_LABELH</span>       MACH_PORT_TYPE(MACH_PORT_RIGHT_LABELH)

<span class="enscript-comment">/* Convenient combinations. */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_TYPE_SEND_RECEIVE</span>					\
		(MACH_PORT_TYPE_SEND|MACH_PORT_TYPE_RECEIVE)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_PORT_TYPE_SEND_RIGHTS</span>					\
		(MACH_PORT_TYPE_SEND|MACH_PORT_TYPE_SEND_ONCE)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_PORT_TYPE_PORT_RIGHTS</span>					\
		(MACH_PORT_TYPE_SEND_RIGHTS|MACH_PORT_TYPE_RECEIVE)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_PORT_TYPE_PORT_OR_DEAD</span>					\
		(MACH_PORT_TYPE_PORT_RIGHTS|MACH_PORT_TYPE_DEAD_NAME)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_TYPE_ALL_RIGHTS</span>					\
		(MACH_PORT_TYPE_PORT_OR_DEAD|MACH_PORT_TYPE_PORT_SET)

<span class="enscript-comment">/* Dummy type bits that mach_port_type/mach_port_names can return. */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_TYPE_DNREQUEST</span>		0x80000000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_TYPE_SPREQUEST</span>		0x40000000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_TYPE_SPREQUEST_DELAYED</span>	0x20000000

<span class="enscript-comment">/* User-references for capabilities. */</span>

<span class="enscript-type">typedef</span> natural_t mach_port_urefs_t;
<span class="enscript-type">typedef</span> integer_t mach_port_delta_t;			<span class="enscript-comment">/* change in urefs */</span>

<span class="enscript-comment">/* Attributes of ports.  (See mach_port_get_receive_status.) */</span>

<span class="enscript-type">typedef</span> natural_t mach_port_seqno_t;		<span class="enscript-comment">/* sequence number */</span>
<span class="enscript-type">typedef</span> natural_t mach_port_mscount_t;		<span class="enscript-comment">/* make-send count */</span>
<span class="enscript-type">typedef</span> natural_t mach_port_msgcount_t;		<span class="enscript-comment">/* number of msgs */</span>
<span class="enscript-type">typedef</span> natural_t mach_port_rights_t;		<span class="enscript-comment">/* number of rights */</span>

<span class="enscript-comment">/*
 *	Are there outstanding send rights for a given port?
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_PORT_SRIGHTS_NONE</span>		0		<span class="enscript-comment">/* no srights */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MACH_PORT_SRIGHTS_PRESENT</span>	1		<span class="enscript-comment">/* srights */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> mach_port_srights_t;	<span class="enscript-comment">/* status of send rights */</span>

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> mach_port_status {
	mach_port_rights_t	mps_pset;	<span class="enscript-comment">/* count of containing port sets */</span>
	mach_port_seqno_t	mps_seqno;	<span class="enscript-comment">/* sequence number */</span>
	mach_port_mscount_t	mps_mscount;	<span class="enscript-comment">/* make-send count */</span>
	mach_port_msgcount_t	mps_qlimit;	<span class="enscript-comment">/* queue limit */</span>
	mach_port_msgcount_t	mps_msgcount;	<span class="enscript-comment">/* number in the queue */</span>
	mach_port_rights_t	mps_sorights;	<span class="enscript-comment">/* how many send-once rights */</span>
	boolean_t		mps_srights;	<span class="enscript-comment">/* do send rights exist? */</span>
	boolean_t		mps_pdrequest;	<span class="enscript-comment">/* port-deleted requested? */</span>
	boolean_t		mps_nsrequest;	<span class="enscript-comment">/* no-senders requested? */</span>
	natural_t		mps_flags;		<span class="enscript-comment">/* port flags */</span>
} mach_port_status_t;

<span class="enscript-comment">/* System-wide values for setting queue limits on a port */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_QLIMIT_ZERO</span>		(0)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_QLIMIT_BASIC</span>		(5)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_QLIMIT_SMALL</span>		(16)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_QLIMIT_LARGE</span>		(1024)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_QLIMIT_KERNEL</span>		(65534)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_QLIMIT_MIN</span>		MACH_PORT_QLIMIT_ZERO
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_QLIMIT_DEFAULT</span>	MACH_PORT_QLIMIT_BASIC
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_QLIMIT_MAX</span>		MACH_PORT_QLIMIT_LARGE

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> mach_port_limits {
	mach_port_msgcount_t	mpl_qlimit;	<span class="enscript-comment">/* number of msgs */</span>
} mach_port_limits_t;

<span class="enscript-comment">/* Possible values for mps_flags (part of mach_port_status_t) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_STATUS_FLAG_TEMPOWNER</span>		0x01
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_STATUS_FLAG_GUARDED</span>		0x02
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_STATUS_FLAG_STRICT_GUARD</span>	0x04
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_STATUS_FLAG_IMP_DONATION</span>	0x08
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_STATUS_FLAG_REVIVE</span>		0x10
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_STATUS_FLAG_TASKPTR</span>		0x20

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> mach_port_info_ext {
	mach_port_status_t	mpie_status;
	mach_port_msgcount_t	mpie_boost_cnt;
	uint32_t		reserved[6];
} mach_port_info_ext_t;

<span class="enscript-type">typedef</span> integer_t *mach_port_info_t;		<span class="enscript-comment">/* varying array of natural_t */</span>

<span class="enscript-comment">/* Flavors for mach_port_get/set_attributes() */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">int</span>	mach_port_flavor_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_LIMITS_INFO</span>		1	<span class="enscript-comment">/* uses mach_port_status_t */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_RECEIVE_STATUS</span>	2	<span class="enscript-comment">/* uses mach_port_limits_t */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_DNREQUESTS_SIZE</span>	3	<span class="enscript-comment">/* info is int */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_TEMPOWNER</span>		4	<span class="enscript-comment">/* indicates receive right will be reassigned to another task */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_IMPORTANCE_RECEIVER</span>	5	<span class="enscript-comment">/* indicates recieve right accepts priority donation */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_DENAP_RECEIVER</span>	6	<span class="enscript-comment">/* indicates receive right accepts de-nap donation */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_INFO_EXT</span>		7	<span class="enscript-comment">/* uses mach_port_info_ext_t */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_LIMITS_INFO_COUNT</span>	((natural_t) \
	(<span class="enscript-keyword">sizeof</span>(mach_port_limits_t)/<span class="enscript-keyword">sizeof</span>(natural_t)))
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_RECEIVE_STATUS_COUNT</span>	((natural_t) \
	(<span class="enscript-keyword">sizeof</span>(mach_port_status_t)/<span class="enscript-keyword">sizeof</span>(natural_t)))
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_DNREQUESTS_SIZE_COUNT</span> 1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_PORT_INFO_EXT_COUNT</span>	((natural_t) \
	(<span class="enscript-keyword">sizeof</span>(mach_port_info_ext_t)/<span class="enscript-keyword">sizeof</span>(natural_t)))
<span class="enscript-comment">/*
 * Structure used to pass information about port allocation requests.
 * Must be padded to 64-bits total length.
 */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> mach_port_qos {
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>		name:1;		<span class="enscript-comment">/* name given */</span>
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> 		prealloc:1;	<span class="enscript-comment">/* prealloced message */</span>
	boolean_t		pad1:30;
	natural_t		len;
} mach_port_qos_t;

<span class="enscript-comment">/* Mach Port Guarding definitions */</span>

<span class="enscript-comment">/*
 * Flags for mach_port_options (used for
 * invocation of mach_port_construct).
 * Indicates attributes to be set for the newly
 * allocated port.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MPO_CONTEXT_AS_GUARD</span>	0x01	<span class="enscript-comment">/* Add guard to the port */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MPO_QLIMIT</span>		0x02	<span class="enscript-comment">/* Set qlimit for the port msg queue */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MPO_TEMPOWNER</span>		0x04	<span class="enscript-comment">/* Set the tempowner bit of the port */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MPO_IMPORTANCE_RECEIVER</span> 0x08	<span class="enscript-comment">/* Mark the port as importance receiver */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MPO_INSERT_SEND_RIGHT</span>   0x10	<span class="enscript-comment">/* Insert a send right for the port */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MPO_STRICT</span>		0x20	<span class="enscript-comment">/* Apply strict guarding for port */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MPO_DENAP_RECEIVER</span>	0x40	<span class="enscript-comment">/* Mark the port as App de-nap receiver */</span>
<span class="enscript-comment">/*
 * Structure to define optional attributes for a newly
 * constructed port.
 */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> mach_port_options {
	uint32_t		flags;		<span class="enscript-comment">/* Flags defining attributes for port */</span>
	mach_port_limits_t	mpl;		<span class="enscript-comment">/* Message queue limit for port */</span>
	uint64_t		reserved[2];	<span class="enscript-comment">/* Reserved */</span>
}mach_port_options_t;

<span class="enscript-type">typedef</span> mach_port_options_t *mach_port_options_ptr_t;

<span class="enscript-comment">/*
 * EXC_GUARD represents a guard violation for both
 * mach ports and file descriptors. GUARD_TYPE_ is used
 * to differentiate among them.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">GUARD_TYPE_MACH_PORT</span>	0x1

<span class="enscript-comment">/* Reasons for exception for a guarded mach port */</span>
<span class="enscript-type">enum</span> mach_port_guard_exception_codes {
	kGUARD_EXC_DESTROY		= 1u &lt;&lt; 0,
	kGUARD_EXC_MOD_REFS		= 1u &lt;&lt; 1,
	kGUARD_EXC_SET_CONTEXT		= 1u &lt;&lt; 2,
	kGUARD_EXC_UNGUARDED		= 1u &lt;&lt; 3,
	kGUARD_EXC_INCORRECT_GUARD	= 1u &lt;&lt; 4
};

#<span class="enscript-reference">if</span>	!<span class="enscript-variable-name">__DARWIN_UNIX03</span> &amp;&amp; !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">_NO_PORT_T_FROM_MACH</span>)
<span class="enscript-comment">/*
 *  Mach 3.0 renamed everything to have mach_ in front of it.
 *  These types and macros are provided for backward compatibility
 *	but are deprecated.
 */</span>
<span class="enscript-type">typedef</span> mach_port_t		port_t;
<span class="enscript-type">typedef</span> mach_port_name_t	port_name_t;
<span class="enscript-type">typedef</span> mach_port_name_t	*port_name_array_t;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PORT_NULL</span>		((port_t) 0)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PORT_DEAD</span>		((port_t) ~0)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">PORT_VALID</span>(name) \
		((port_t)(name) != PORT_NULL &amp;&amp; (port_t)(name) != PORT_DEAD)

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* !__DARWIN_UNIX03 &amp;&amp; !_NO_PORT_T_FROM_MACH */</span>

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* _MACH_PORT_H_ */</span>
</pre>
<hr />
</body></html>