<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>mach_voucher_types.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">mach_voucher_types.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2013 Apple Computer, Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">_MACH_VOUCHER_TYPES_H_</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_MACH_VOUCHER_TYPES_H_</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/std_types.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/port.h&gt;</span>

<span class="enscript-comment">/*
 * Mach Voucher - an immutable collection of attribute value handles.
 *
 * The mach voucher is such that it can be passed between processes
 * as a Mach port send right (by convention in the mach_msg_header_t’s
 * msgh_voucher field).
 *
 * You may construct a new mach voucher by passing a construction
 * recipe to host_create_mach_voucher().  The construction recipe supports
 * generic commands for copying, removing, and redeeming attribute value
 * handles from previous vouchers, or running attribute-mananger-specific
 * commands within the recipe.
 *
 * Once the set of attribute value handles is constructed and returned,
 * that set will not change for the life of the voucher (just because the
 * attribute value handle itself doesn't change, the value the handle refers
 * to is free to change at will).
 */</span>
<span class="enscript-type">typedef</span> mach_port_t		mach_voucher_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_NULL</span>	((mach_voucher_t) 0)

<span class="enscript-type">typedef</span> mach_port_name_t	mach_voucher_name_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_NAME_NULL</span>	((mach_voucher_name_t) 0)

<span class="enscript-type">typedef</span> mach_voucher_name_t	*mach_voucher_name_array_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_NAME_ARRAY_NULL</span> ((mach_voucher_name_array_t) 0)

<span class="enscript-comment">/*
 * This type changes appearance between user-space and kernel.  It is
 * a port at user-space and a reference to an ipc_voucher structure in-kernel.
 */</span>
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">KERNEL</span>)
<span class="enscript-type">typedef</span> mach_voucher_t		ipc_voucher_t;
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">MACH_KERNEL_PRIVATE</span>)
<span class="enscript-type">struct</span> ipc_voucher 		;
#<span class="enscript-reference">endif</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> ipc_voucher	*ipc_voucher_t;
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IPC_VOUCHER_NULL</span>	((ipc_voucher_t) 0)

<span class="enscript-comment">/*
 * mach_voucher_selector_t - A means of specifying which thread/task value to extract -
 *  the current voucher set at this level, or a voucher representing
 * the full [layered] effective value for the task/thread.
 */</span>
<span class="enscript-type">typedef</span> uint32_t mach_voucher_selector_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_SELECTOR_CURRENT</span> 		((mach_voucher_selector_t)0)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_SELECTOR_EFFECTIVE</span> 	((mach_voucher_selector_t)1)


<span class="enscript-comment">/*
 * mach_voucher_attr_key_t - The key used to identify a particular managed resource or
 * to select the specific resource manager’s data associated
 * with a given voucher.
 */</span> 
<span class="enscript-type">typedef</span> uint32_t mach_voucher_attr_key_t;
<span class="enscript-type">typedef</span> mach_voucher_attr_key_t *mach_voucher_attr_key_array_t;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_KEY_ALL</span> 		((mach_voucher_attr_key_t)~0)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_KEY_NONE</span> 		((mach_voucher_attr_key_t)0)

<span class="enscript-comment">/* other well-known-keys will be added here */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_KEY_ATM</span>		((mach_voucher_attr_key_t)1)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_KEY_IMPORTANCE</span>	((mach_voucher_attr_key_t)2)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_KEY_BANK</span>		((mach_voucher_attr_key_t)3)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_KEY_USER_DATA</span>		((mach_voucher_attr_key_t)7)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_KEY_BITS</span>		MACH_VOUCHER_ATTR_KEY_USER_DATA <span class="enscript-comment">/* deprecated */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_KEY_TEST</span> 		((mach_voucher_attr_key_t)8)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_KEY_NUM_WELL_KNOWN</span>	MACH_VOUCHER_ATTR_KEY_TEST

<span class="enscript-comment">/*
 * mach_voucher_attr_content_t
 *
 * Data passed to a resource manager for modifying an attribute
 * value or returned from the resource manager in response to a
 * request to externalize the current value for that attribute.
 */</span>
<span class="enscript-type">typedef</span> uint8_t *mach_voucher_attr_content_t;
<span class="enscript-type">typedef</span> uint32_t mach_voucher_attr_content_size_t;

<span class="enscript-comment">/*
 * mach_voucher_attr_command_t - The private verbs implemented by each voucher
 * attribute manager via mach_voucher_attr_command().
 */</span>
<span class="enscript-type">typedef</span> uint32_t mach_voucher_attr_command_t;

<span class="enscript-comment">/*
 * mach_voucher_attr_recipe_command_t 
 * 
 * The verbs used to create/morph a voucher attribute value.
 * We define some system-wide commands here - related to creation, and transport of
 * vouchers and attributes.  Additional commands can be defined by, and supported by,
 * individual attribute resource managers.
 */</span>
<span class="enscript-type">typedef</span> uint32_t mach_voucher_attr_recipe_command_t;
<span class="enscript-type">typedef</span> mach_voucher_attr_recipe_command_t *mach_voucher_attr_recipe_command_array_t;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_NOOP</span>			((mach_voucher_attr_recipe_command_t)0)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_COPY</span> 			((mach_voucher_attr_recipe_command_t)1)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_REMOVE</span>		((mach_voucher_attr_recipe_command_t)2)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_SET_VALUE_HANDLE</span>	((mach_voucher_attr_recipe_command_t)3)

<span class="enscript-comment">/* redeem is on its way out? */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_REDEEM</span> 		((mach_voucher_attr_recipe_command_t)10)

<span class="enscript-comment">/* recipe command(s) for importance attribute manager */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_IMPORTANCE_SELF</span>	((mach_voucher_attr_recipe_command_t)200)

<span class="enscript-comment">/* recipe command(s) for bit-store attribute manager */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_USER_DATA_STORE</span> 	((mach_voucher_attr_recipe_command_t)211)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_BITS_STORE</span> 		MACH_VOUCHER_ATTR_USER_DATA_STORE <span class="enscript-comment">/* deprecated */</span>

<span class="enscript-comment">/* recipe command(s) for test attribute manager */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_TEST_STORE</span> 		MACH_VOUCHER_ATTR_USER_DATA_STORE

<span class="enscript-comment">/*
 * mach_voucher_attr_recipe_t
 *
 * An element in a recipe list to create a voucher.
 */</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">pack</span>(1)

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> mach_voucher_attr_recipe_data {
	mach_voucher_attr_key_t	                key;
	mach_voucher_attr_recipe_command_t      command;
	mach_voucher_name_t                     previous_voucher;
	mach_voucher_attr_content_size_t	content_size;
	uint8_t				        content[];
} mach_voucher_attr_recipe_data_t;
<span class="enscript-type">typedef</span> mach_voucher_attr_recipe_data_t *mach_voucher_attr_recipe_t;
<span class="enscript-type">typedef</span> mach_msg_type_number_t mach_voucher_attr_recipe_size_t;

<span class="enscript-comment">/* Make the above palatable to MIG */</span>
<span class="enscript-type">typedef</span> uint8_t *mach_voucher_attr_raw_recipe_t;
<span class="enscript-type">typedef</span> mach_voucher_attr_raw_recipe_t mach_voucher_attr_raw_recipe_array_t;
<span class="enscript-type">typedef</span> mach_msg_type_number_t mach_voucher_attr_raw_recipe_size_t;
<span class="enscript-type">typedef</span> mach_msg_type_number_t mach_voucher_attr_raw_recipe_array_size_t;

#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">pack</span>()

<span class="enscript-comment">/*
 * VOUCHER ATTRIBUTE MANAGER Writer types
 */</span>
 
<span class="enscript-comment">/*
 * mach_voucher_attr_manager_t
 *
 * A handle through which the mach voucher mechanism communicates with the voucher
 * attribute manager for a given attribute key.
 */</span>
<span class="enscript-type">typedef</span> mach_port_t			mach_voucher_attr_manager_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_MANAGER_NULL</span>  ((mach_voucher_attr_manager_t) 0)

<span class="enscript-comment">/*
 * mach_voucher_attr_control_t
 *
 * A handle provided to the voucher attribute manager for a given attribute key
 * through which it makes inquiries or control operations of the mach voucher mechanism.
 */</span>
<span class="enscript-type">typedef</span> mach_port_t			mach_voucher_attr_control_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_CONTROL_NULL</span>  ((mach_voucher_attr_control_t) 0)

<span class="enscript-comment">/*
 * These types are different in-kernel vs user-space.  They are ports in user-space,
 * pointers to opaque structs in most of the kernel, and pointers to known struct
 * types in the Mach portion of the kernel.
 */</span>
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">KERNEL</span>)
<span class="enscript-type">typedef</span> mach_port_t		ipc_voucher_attr_manager_t;
<span class="enscript-type">typedef</span> mach_port_t		ipc_voucher_attr_control_t;
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">if</span> !<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">MACH_KERNEL_PRIVATE</span>)
<span class="enscript-type">struct</span> ipc_voucher_attr_manager ;
<span class="enscript-type">struct</span> ipc_voucher_attr_control ;
#<span class="enscript-reference">endif</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> ipc_voucher_attr_manager *ipc_voucher_attr_manager_t;
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> ipc_voucher_attr_control *ipc_voucher_attr_control_t;
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IPC_VOUCHER_ATTR_MANAGER_NULL</span> ((ipc_voucher_attr_manager_t) 0)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">IPC_VOUCHER_ATTR_CONTROL_NULL</span> ((ipc_voucher_attr_control_t) 0)

<span class="enscript-comment">/*
 * mach_voucher_attr_value_handle_t
 * 
 * The private handle that the voucher attribute manager provides to
 * the mach voucher mechanism to represent a given attr content/value.
 */</span> 
<span class="enscript-type">typedef</span> uint64_t mach_voucher_attr_value_handle_t;
<span class="enscript-type">typedef</span> mach_voucher_attr_value_handle_t *mach_voucher_attr_value_handle_array_t;

<span class="enscript-type">typedef</span> mach_msg_type_number_t mach_voucher_attr_value_handle_array_size_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_VALUE_MAX_NESTED</span> 	((mach_voucher_attr_value_handle_array_size_t)4)

<span class="enscript-type">typedef</span> uint32_t mach_voucher_attr_value_reference_t;

<span class="enscript-comment">/* USE - TBD */</span>
<span class="enscript-type">typedef</span> uint32_t mach_voucher_attr_control_flags_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_ATTR_CONTROL_FLAGS_NONE</span> 	((mach_voucher_attr_control_flags_t)0)

<span class="enscript-comment">/*
 * Commands and types for the IPC Importance Attribute Manager
 *
 * These are the valid mach_voucher_attr_command() options with the 
 * MACH_VOUCHER_ATTR_KEY_IMPORTANCE key.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_IMPORTANCE_ATTR_ADD_EXTERNAL</span>       1  <span class="enscript-comment">/* Add some number of external refs (not supported) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VOUCHER_IMPORTANCE_ATTR_DROP_EXTERNAL</span>      2  <span class="enscript-comment">/* Drop some number of external refs */</span>
<span class="enscript-type">typedef</span> uint32_t mach_voucher_attr_importance_refs;

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* _MACH_VOUCHER_TYPES_H_ */</span>
</pre>
<hr />
</body></html>