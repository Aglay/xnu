<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>vm_param.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">vm_param.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000-2012 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*
 * @OSF_COPYRIGHT@
 */</span>
<span class="enscript-comment">/* 
 * Mach Operating System
 * Copyright (c) 1991,1990,1989,1988 Carnegie Mellon University
 * All Rights Reserved.
 * 
 * Permission to use, copy, modify and distribute this software and its
 * documentation is hereby granted, provided that both the copyright
 * notice and this permission notice appear in all copies of the
 * software, derivative works or modified versions, and any portions
 * thereof, and that both notices appear in supporting documentation.
 * 
 * CARNEGIE MELLON ALLOWS FREE USE OF THIS SOFTWARE IN ITS &quot;AS IS&quot;
 * CONDITION.  CARNEGIE MELLON DISCLAIMS ANY LIABILITY OF ANY KIND FOR
 * ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.
 * 
 * Carnegie Mellon requests users of this software to return to
 * 
 *  Software Distribution Coordinator  or  <a href="mailto:Software.Distribution@CS.CMU.EDU">Software.Distribution@CS.CMU.EDU</a>
 *  School of Computer Science
 *  Carnegie Mellon University
 *  Pittsburgh PA 15213-3890
 * 
 * any improvements or extensions that they make and grant Carnegie Mellon
 * the rights to redistribute these changes.
 */</span>

<span class="enscript-comment">/* 
 * Copyright (c) 1994 The University of Utah and
 * the Computer Systems Laboratory at the University of Utah (CSL).
 * All rights reserved.
 *
 * Permission to use, copy, modify and distribute this software is hereby
 * granted provided that (1) source code retains these copyright, permission,
 * and disclaimer notices, and (2) redistributions including binaries
 * reproduce the notices in supporting documentation, and (3) all advertising
 * materials mentioning features or use of this software display the following
 * acknowledgement: ``This product includes software developed by the
 * Computer Systems Laboratory at the University of Utah.''
 *
 * THE UNIVERSITY OF UTAH AND CSL ALLOW FREE USE OF THIS SOFTWARE IN ITS &quot;AS
 * IS&quot; CONDITION.  THE UNIVERSITY OF UTAH AND CSL DISCLAIM ANY LIABILITY OF
 * ANY KIND FOR ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.
 *
 * CSL requests users of this software to return to <a href="mailto:csl-dist@cs.utah.edu">csl-dist@cs.utah.edu</a> any
 * improvements that they make and grant CSL redistribution rights.
 *
 */</span>

<span class="enscript-comment">/*
 *	File:	vm_param.h
 *	Author:	Avadis Tevanian, Jr.
 *	Date:	1985
 *
 *	I386 machine dependent virtual memory parameters.
 *	Most of the declarations are preceeded by I386_ (or i386_)
 *	which is OK because only I386 specific code will be using
 *	them.
 */</span>

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">_MACH_I386_VM_PARAM_H_</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_MACH_I386_VM_PARAM_H_</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">BYTE_SIZE</span>		8		<span class="enscript-comment">/* byte size in bits */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">I386_PGBYTES</span>		4096		<span class="enscript-comment">/* bytes per 80386 page */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">I386_PGSHIFT</span>		12		<span class="enscript-comment">/* bitshift for pages */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PAGE_SIZE</span>		I386_PGBYTES
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PAGE_SHIFT</span>		I386_PGSHIFT
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PAGE_MASK</span>		(PAGE_SIZE - 1)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PAGE_MAX_SHIFT</span>          PAGE_SHIFT
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PAGE_MAX_SIZE</span>           PAGE_SIZE
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PAGE_MAX_MASK</span>           PAGE_MASK

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PAGE_MIN_SHIFT</span>          PAGE_SHIFT
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PAGE_MIN_SIZE</span>           PAGE_SIZE
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">PAGE_MIN_MASK</span>           PAGE_MASK

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">I386_LPGBYTES</span>		2*1024*1024	<span class="enscript-comment">/* bytes per large page */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">I386_LPGSHIFT</span>		21		<span class="enscript-comment">/* bitshift for large pages */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">I386_LPGMASK</span>		(I386_LPGBYTES-1)

<span class="enscript-comment">/*
 *	Convert bytes to pages and convert pages to bytes.
 *	No rounding is used.
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">i386_btop</span>(x)		((ppnum_t)((x) &gt;&gt; I386_PGSHIFT))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">machine_btop</span>(x)		i386_btop(x)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">i386_ptob</span>(x)		(((pmap_paddr_t)(x)) &lt;&lt; I386_PGSHIFT)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">machine_ptob</span>(x)		i386_ptob(x)

<span class="enscript-comment">/*
 *	Round off or truncate to the nearest page.  These will work
 *	for either addresses or counts.  (i.e. 1 byte rounds to 1 page
 *	bytes.
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">i386_round_page</span>(x)	((((pmap_paddr_t)(x)) + I386_PGBYTES - 1) &amp; \
					~(I386_PGBYTES-1))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">i386_trunc_page</span>(x)	(((pmap_paddr_t)(x)) &amp; ~(I386_PGBYTES-1))



#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_MIN_ADDRESS64</span>	((user_addr_t) 0x0000000000000000ULL)
<span class="enscript-comment">/*
 * default top of user stack... it grows down from here
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_USRSTACK64</span>		((user_addr_t) 0x00007FFF5FC00000ULL)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_DYLD64</span>		((user_addr_t) 0x00007FFF5FC00000ULL)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_LIB64_SHR_DATA</span>	((user_addr_t) 0x00007FFF60000000ULL)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_LIB64_SHR_TEXT</span>	((user_addr_t) 0x00007FFF80000000ULL)
<span class="enscript-comment">/*
 * the end of the usable user address space , for now about 47 bits.
 * the 64 bit commpage is past the end of this
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_MAX_PAGE_ADDRESS</span>	((user_addr_t) 0x00007FFFFFE00000ULL)
<span class="enscript-comment">/*
 * canonical end of user address space for limits checking
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_MAX_USER_PAGE_ADDRESS</span> ((user_addr_t)0x00007FFFFFFFF000ULL)


<span class="enscript-comment">/* system-wide values */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VM_MIN_ADDRESS</span>		((mach_vm_offset_t) 0)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACH_VM_MAX_ADDRESS</span>		((mach_vm_offset_t) VM_MAX_PAGE_ADDRESS)

<span class="enscript-comment">/* process-relative values (all 32-bit legacy only for now) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_MIN_ADDRESS</span>		((vm_offset_t) 0)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_USRSTACK32</span>		((vm_offset_t) 0xC0000000)	<span class="enscript-comment">/* ASLR slides stack down by up to 1 MB */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_MAX_ADDRESS</span>		((vm_offset_t) 0xFFE00000)


#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">KERNEL_PRIVATE</span> 

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TEST_PAGE_SIZE_16K</span>      FALSE
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">TEST_PAGE_SIZE_4K</span>       TRUE

<span class="enscript-comment">/* Kernel-wide values */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KB</span>		(1024ULL)		
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MB</span>		(1024*KB)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">GB</span>		(1024*MB)

<span class="enscript-comment">/*
 * Maximum physical memory supported.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">K32_MAXMEM</span>	(32*GB)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">K64_MAXMEM</span>	(252*GB)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KERNEL_MAXMEM</span>	K64_MAXMEM

<span class="enscript-comment">/*
 * XXX
 * The kernel max VM address is limited to 0xFF3FFFFF for now because
 * some data structures are explicitly allocated at 0xFF400000 without
 * VM's knowledge (see osfmk/i386/locore.s for the allocation of PTmap and co.).
 * We can't let VM allocate memory from there.
 */</span>


#<span class="enscript-reference">define</span> <span class="enscript-function-name">KERNEL_IMAGE_TO_PHYS</span>(x) (x)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_MIN_KERNEL_ADDRESS</span>		((vm_offset_t) 0xFFFFFF8000000000UL)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_MIN_KERNEL_PAGE</span>		((ppnum_t)0)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_MIN_KERNEL_AND_KEXT_ADDRESS</span>	(VM_MIN_KERNEL_ADDRESS - 0x80000000ULL)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_MAX_KERNEL_ADDRESS</span>		((vm_offset_t) 0xFFFFFFFFFFFFEFFFUL)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_MAX_KERNEL_ADDRESS_EFI32</span>	((vm_offset_t) 0xFFFFFF80FFFFEFFFUL)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KEXT_ALLOC_MAX_OFFSET</span> (2 * 1024 * 1024 * 1024UL)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">KEXT_ALLOC_BASE</span>(x)  ((x) - KEXT_ALLOC_MAX_OFFSET)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">KEXT_ALLOC_SIZE</span>(x)  (KEXT_ALLOC_MAX_OFFSET - (x))


#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KERNEL_STACK_SIZE</span>	(I386_PGBYTES*4)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_MAP_MIN_ADDRESS</span>	MACH_VM_MIN_ADDRESS
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_MAP_MAX_ADDRESS</span>	MACH_VM_MAX_ADDRESS

<span class="enscript-comment">/* FIXME  - always leave like this? */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">INTSTACK_SIZE</span>	(I386_PGBYTES*4)

#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">MACH_KERNEL_PRIVATE</span>

<span class="enscript-comment">/* For implementing legacy 32-bit interfaces */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM32_SUPPORT</span>			1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM32_MIN_ADDRESS</span>		((vm32_offset_t) 0)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM32_MAX_ADDRESS</span>		((vm32_offset_t) (VM_MAX_PAGE_ADDRESS &amp; 0xFFFFFFFF))

<span class="enscript-comment">/*
 * kalloc() parameters:
 *
 * Historically kalloc's underlying zones were power-of-2 sizes, with a
 * KALLOC_MINSIZE of 16 bytes.  The allocator ensured that
 * (sizeof == alignof) &gt;= 16 for all kalloc allocations.
 *
 * Today kalloc may use zones with intermediate sizes, constrained by
 * KALLOC_MINSIZE and a minimum alignment, expressed by KALLOC_LOG2_MINALIGN.
 *
 * The common alignment for LP64 is for longs and pointers i.e. 8 bytes.
 */</span>


#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KALLOC_MINSIZE</span>		16	<span class="enscript-comment">/* minimum allocation size */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">KALLOC_LOG2_MINALIGN</span>	4	<span class="enscript-comment">/* log2 minimum alignment */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">LINEAR_KERNEL_ADDRESS</span>	((vm_offset_t) 0x00000000)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_MIN_KERNEL_LOADED_ADDRESS</span>	((vm_offset_t) 0xFFFFFF8000000000UL)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_MAX_KERNEL_LOADED_ADDRESS</span>	((vm_offset_t) 0xFFFFFF801FFFFFFFUL)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">NCOPY_WINDOWS</span> 0



<span class="enscript-comment">/*
 *	Conversion between 80386 pages and VM pages
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">trunc_i386_to_vm</span>(p)	(atop(trunc_page(i386_ptob(p))))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">round_i386_to_vm</span>(p)	(atop(round_page(i386_ptob(p))))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">vm_to_i386</span>(p)		(i386_btop(ptoa(p)))


#<span class="enscript-reference">define</span> <span class="enscript-function-name">PMAP_SET_CACHE_ATTR</span>(mem, object, cache_attr, batch_pmap_op)	\
	MACRO_BEGIN							\
		pmap_set_cache_attributes((mem)-&gt;phys_page, (cache_attr));	\
		(object)-&gt;set_cache_attr = TRUE;				\
		(<span class="enscript-type">void</span>) batch_pmap_op;					\
	MACRO_END							

#<span class="enscript-reference">define</span> <span class="enscript-function-name">PMAP_BATCH_SET_CACHE_ATTR</span>(object, user_page_list, cache_attr, num_pages, batch_pmap_op)\
	MACRO_BEGIN							\
	(<span class="enscript-type">void</span>) user_page_list;						\
	(<span class="enscript-type">void</span>) num_pages;						\
	(<span class="enscript-type">void</span>) batch_pmap_op;						\
	MACRO_END

#<span class="enscript-reference">define</span> <span class="enscript-function-name">IS_USERADDR64_CANONICAL</span>(addr)			\
	((addr) &lt; (VM_MAX_USER_PAGE_ADDRESS + PAGE_SIZE))

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* MACH_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* KERNEL_PRIVATE */</span>

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* _MACH_I386_VM_PARAM_H_ */</span>
</pre>
<hr />
</body></html>