<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>thread_status.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">thread_status.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000-2006 Apple Computer, Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*
 * @OSF_COPYRIGHT@
 */</span>
<span class="enscript-comment">/* 
 * Mach Operating System
 * Copyright (c) 1991,1990,1989 Carnegie Mellon University
 * All Rights Reserved.
 * 
 * Permission to use, copy, modify and distribute this software and its
 * documentation is hereby granted, provided that both the copyright
 * notice and this permission notice appear in all copies of the
 * software, derivative works or modified versions, and any portions
 * thereof, and that both notices appear in supporting documentation.
 * 
 * CARNEGIE MELLON ALLOWS FREE USE OF THIS SOFTWARE IN ITS &quot;AS IS&quot;
 * CONDITION.  CARNEGIE MELLON DISCLAIMS ANY LIABILITY OF ANY KIND FOR
 * ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.
 * 
 * Carnegie Mellon requests users of this software to return to
 * 
 *  Software Distribution Coordinator  or  <a href="mailto:Software.Distribution@CS.CMU.EDU">Software.Distribution@CS.CMU.EDU</a>
 *  School of Computer Science
 *  Carnegie Mellon University
 *  Pittsburgh PA 15213-3890
 * 
 * any improvements or extensions that they make and grant Carnegie Mellon
 * the rights to redistribute these changes.
 */</span>
<span class="enscript-comment">/*
 */</span>
<span class="enscript-comment">/*
 *	File:	thread_status.h
 *	Author:	Avadis Tevanian, Jr.
 *	Date:	1985
 *
 *	This file contains the structure definitions for the thread
 *	state as applied to I386 processors.
 */</span>

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">_MACH_I386_THREAD_STATUS_H_</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_MACH_I386_THREAD_STATUS_H_</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/i386/_structs.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/message.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/i386/fp_reg.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/i386/thread_state.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;i386/eflags.h&gt;</span>

<span class="enscript-comment">/*
 * the i386_xxxx form is kept for legacy purposes since these types
 * are externally known... eventually they should be deprecated.
 * our internal implementation has moved to the following naming convention
 *
 *   x86_xxxx32 names are used to deal with 32 bit states
 *   x86_xxxx64 names are used to deal with 64 bit states
 *   x86_xxxx   names are used to deal with either 32 or 64 bit states
 *	via a self-describing mechanism
 */</span>

<span class="enscript-comment">/*
 * these are the legacy names which should be deprecated in the future
 * they are externally known which is the only reason we don't just get
 * rid of them
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">i386_THREAD_STATE</span>		1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">i386_FLOAT_STATE</span>		2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">i386_EXCEPTION_STATE</span>		3

<span class="enscript-comment">/*
 * THREAD_STATE_FLAVOR_LIST 0
 * 	these are the supported flavors
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_THREAD_STATE32</span>		1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_FLOAT_STATE32</span>		2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_EXCEPTION_STATE32</span>		3
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_THREAD_STATE64</span>		4
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_FLOAT_STATE64</span>		5
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_EXCEPTION_STATE64</span>		6
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_THREAD_STATE</span>		7
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_FLOAT_STATE</span>			8
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_EXCEPTION_STATE</span>		9
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_DEBUG_STATE32</span>		10
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_DEBUG_STATE64</span>		11
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_DEBUG_STATE</span>			12
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">THREAD_STATE_NONE</span>		13
<span class="enscript-comment">/* 14 and 15 are used for the internal x86_SAVED_STATE flavours */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_AVX_STATE32</span>			16
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_AVX_STATE64</span>			17
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_AVX_STATE</span>			18


<span class="enscript-comment">/*
 * Largest state on this machine:
 * (be sure mach/machine/thread_state.h matches!)
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">THREAD_MACHINE_STATE_MAX</span>	THREAD_STATE_MAX

<span class="enscript-comment">/*
 * VALID_THREAD_STATE_FLAVOR is a platform specific macro that when passed
 * an exception flavor will return if that is a defined flavor for that
 * platform. The macro must be manually updated to include all of the valid
 * exception flavors as defined above.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">VALID_THREAD_STATE_FLAVOR</span>(x)       \
	 ((x == x86_THREAD_STATE32)	|| \
	  (x == x86_FLOAT_STATE32)	|| \
	  (x == x86_EXCEPTION_STATE32)	|| \
	  (x == x86_DEBUG_STATE32)	|| \
	  (x == x86_THREAD_STATE64)	|| \
	  (x == x86_FLOAT_STATE64)	|| \
	  (x == x86_EXCEPTION_STATE64)	|| \
	  (x == x86_DEBUG_STATE64)	|| \
	  (x == x86_THREAD_STATE)	|| \
	  (x == x86_FLOAT_STATE)	|| \
	  (x == x86_EXCEPTION_STATE)	|| \
	  (x == x86_DEBUG_STATE)	|| \
	  (x == x86_AVX_STATE32)	|| \
	  (x == x86_AVX_STATE64)	|| \
	  (x == x86_AVX_STATE)		|| \
	  (x == THREAD_STATE_NONE))

<span class="enscript-type">struct</span> x86_state_hdr {
	<span class="enscript-type">int</span>	flavor;
	<span class="enscript-type">int</span>	count;
};
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> x86_state_hdr x86_state_hdr_t;

<span class="enscript-comment">/*
 * Default segment register values.
 */</span>
    
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">USER_CODE_SELECTOR</span>	0x0017
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">USER_DATA_SELECTOR</span>	0x001f
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KERN_CODE_SELECTOR</span>	0x0008
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">KERN_DATA_SELECTOR</span>	0x0010

<span class="enscript-comment">/*
 * to be deprecated in the future
 */</span>
<span class="enscript-type">typedef</span> _STRUCT_X86_THREAD_STATE32 i386_thread_state_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">i386_THREAD_STATE_COUNT</span>	((mach_msg_type_number_t) \
    ( <span class="enscript-keyword">sizeof</span> (i386_thread_state_t) / <span class="enscript-keyword">sizeof</span> (<span class="enscript-type">int</span>) ))

<span class="enscript-type">typedef</span> _STRUCT_X86_THREAD_STATE32 x86_thread_state32_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_THREAD_STATE32_COUNT</span>	((mach_msg_type_number_t) \
    ( <span class="enscript-keyword">sizeof</span> (x86_thread_state32_t) / <span class="enscript-keyword">sizeof</span> (<span class="enscript-type">int</span>) ))

<span class="enscript-comment">/*
 * to be deprecated in the future
 */</span>
<span class="enscript-type">typedef</span> _STRUCT_X86_FLOAT_STATE32 i386_float_state_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">i386_FLOAT_STATE_COUNT</span> ((mach_msg_type_number_t) \
		(<span class="enscript-keyword">sizeof</span>(i386_float_state_t)/<span class="enscript-keyword">sizeof</span>(<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>)))

<span class="enscript-type">typedef</span> _STRUCT_X86_FLOAT_STATE32 x86_float_state32_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_FLOAT_STATE32_COUNT</span> ((mach_msg_type_number_t) \
		(<span class="enscript-keyword">sizeof</span>(x86_float_state32_t)/<span class="enscript-keyword">sizeof</span>(<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>)))

<span class="enscript-type">typedef</span> _STRUCT_X86_AVX_STATE32 x86_avx_state32_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_AVX_STATE32_COUNT</span> ((mach_msg_type_number_t) \
		(<span class="enscript-keyword">sizeof</span>(x86_avx_state32_t)/<span class="enscript-keyword">sizeof</span>(<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>)))

<span class="enscript-comment">/*
 * to be deprecated in the future
 */</span>
<span class="enscript-type">typedef</span> _STRUCT_X86_EXCEPTION_STATE32 i386_exception_state_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">i386_EXCEPTION_STATE_COUNT</span>	((mach_msg_type_number_t) \
    ( <span class="enscript-keyword">sizeof</span> (i386_exception_state_t) / <span class="enscript-keyword">sizeof</span> (<span class="enscript-type">int</span>) ))

<span class="enscript-type">typedef</span> _STRUCT_X86_EXCEPTION_STATE32 x86_exception_state32_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_EXCEPTION_STATE32_COUNT</span>	((mach_msg_type_number_t) \
    ( <span class="enscript-keyword">sizeof</span> (x86_exception_state32_t) / <span class="enscript-keyword">sizeof</span> (<span class="enscript-type">int</span>) ))

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">I386_EXCEPTION_STATE_COUNT</span> i386_EXCEPTION_STATE_COUNT

<span class="enscript-type">typedef</span> _STRUCT_X86_DEBUG_STATE32 x86_debug_state32_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_DEBUG_STATE32_COUNT</span>       ((mach_msg_type_number_t) \
	( <span class="enscript-keyword">sizeof</span> (x86_debug_state32_t) / <span class="enscript-keyword">sizeof</span> (<span class="enscript-type">int</span>) ))

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">X86_DEBUG_STATE32_COUNT</span> x86_DEBUG_STATE32_COUNT

<span class="enscript-type">typedef</span> _STRUCT_X86_THREAD_STATE64 x86_thread_state64_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_THREAD_STATE64_COUNT</span>	((mach_msg_type_number_t) \
    ( <span class="enscript-keyword">sizeof</span> (x86_thread_state64_t) / <span class="enscript-keyword">sizeof</span> (<span class="enscript-type">int</span>) ))

<span class="enscript-type">typedef</span> _STRUCT_X86_FLOAT_STATE64 x86_float_state64_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_FLOAT_STATE64_COUNT</span> ((mach_msg_type_number_t) \
		(<span class="enscript-keyword">sizeof</span>(x86_float_state64_t)/<span class="enscript-keyword">sizeof</span>(<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>)))

<span class="enscript-type">typedef</span> _STRUCT_X86_AVX_STATE64 x86_avx_state64_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_AVX_STATE64_COUNT</span> ((mach_msg_type_number_t) \
		(<span class="enscript-keyword">sizeof</span>(x86_avx_state64_t)/<span class="enscript-keyword">sizeof</span>(<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>)))

<span class="enscript-type">typedef</span> _STRUCT_X86_EXCEPTION_STATE64 x86_exception_state64_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_EXCEPTION_STATE64_COUNT</span>	((mach_msg_type_number_t) \
    ( <span class="enscript-keyword">sizeof</span> (x86_exception_state64_t) / <span class="enscript-keyword">sizeof</span> (<span class="enscript-type">int</span>) ))

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">X86_EXCEPTION_STATE64_COUNT</span> x86_EXCEPTION_STATE64_COUNT

<span class="enscript-type">typedef</span> _STRUCT_X86_DEBUG_STATE64 x86_debug_state64_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_DEBUG_STATE64_COUNT</span>	((mach_msg_type_number_t) \
    ( <span class="enscript-keyword">sizeof</span> (x86_debug_state64_t) / <span class="enscript-keyword">sizeof</span> (<span class="enscript-type">int</span>) ))

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">X86_DEBUG_STATE64_COUNT</span> x86_DEBUG_STATE64_COUNT

<span class="enscript-comment">/*
 * Combined thread, float and exception states
 */</span>
<span class="enscript-type">struct</span> x86_thread_state {
	x86_state_hdr_t			tsh;
	<span class="enscript-type">union</span> {
	    x86_thread_state32_t	ts32;
	    x86_thread_state64_t	ts64;
	} uts;
};

<span class="enscript-type">struct</span> x86_float_state {
	x86_state_hdr_t			fsh;
	<span class="enscript-type">union</span> {
		x86_float_state32_t	fs32;
		x86_float_state64_t	fs64;
	} ufs;
};

<span class="enscript-type">struct</span> x86_exception_state {
	x86_state_hdr_t			esh;
	<span class="enscript-type">union</span> {
		x86_exception_state32_t	es32;
		x86_exception_state64_t	es64;
	} ues;
};

<span class="enscript-type">struct</span> x86_debug_state {
	x86_state_hdr_t			dsh;
	<span class="enscript-type">union</span> {
		x86_debug_state32_t	ds32;
		x86_debug_state64_t	ds64;
	} uds;
};

<span class="enscript-type">struct</span> x86_avx_state {
	x86_state_hdr_t			ash;
	<span class="enscript-type">union</span> {
		x86_avx_state32_t	as32;
		x86_avx_state64_t	as64;
	} ufs;
};

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> x86_thread_state x86_thread_state_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_THREAD_STATE_COUNT</span>	((mach_msg_type_number_t) \
		( <span class="enscript-keyword">sizeof</span> (x86_thread_state_t) / <span class="enscript-keyword">sizeof</span> (<span class="enscript-type">int</span>) ))

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> x86_float_state x86_float_state_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_FLOAT_STATE_COUNT</span> ((mach_msg_type_number_t) \
		(<span class="enscript-keyword">sizeof</span>(x86_float_state_t)/<span class="enscript-keyword">sizeof</span>(<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>)))

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> x86_exception_state x86_exception_state_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_EXCEPTION_STATE_COUNT</span> ((mach_msg_type_number_t) \
		(<span class="enscript-keyword">sizeof</span>(x86_exception_state_t)/<span class="enscript-keyword">sizeof</span>(<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>)))

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> x86_debug_state x86_debug_state_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_DEBUG_STATE_COUNT</span> ((mach_msg_type_number_t) \
		(<span class="enscript-keyword">sizeof</span>(x86_debug_state_t)/<span class="enscript-keyword">sizeof</span>(<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>)))

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> x86_avx_state x86_avx_state_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_AVX_STATE_COUNT</span> ((mach_msg_type_number_t) \
		(<span class="enscript-keyword">sizeof</span>(x86_avx_state_t)/<span class="enscript-keyword">sizeof</span>(<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>)))

<span class="enscript-comment">/*
 * Machine-independent way for servers and Mach's exception mechanism to
 * choose the most efficient state flavor for exception RPC's:
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACHINE_THREAD_STATE</span>		x86_THREAD_STATE
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MACHINE_THREAD_STATE_COUNT</span>	x86_THREAD_STATE_COUNT

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_SAVED_STATE32</span>		THREAD_STATE_NONE + 1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_SAVED_STATE64</span>		THREAD_STATE_NONE + 2

<span class="enscript-comment">/*
 * The format in which thread state is saved by Mach on this machine.  This
 * state flavor is most efficient for exception RPC's to kernel-loaded
 * servers, because copying can be avoided:
 */</span>
<span class="enscript-type">struct</span> x86_saved_state32 {
	uint32_t	gs;
	uint32_t	fs;
	uint32_t	es;
	uint32_t	ds;
	uint32_t	edi;
	uint32_t	esi;
	uint32_t	ebp;
	uint32_t	cr2;	<span class="enscript-comment">/* kernel esp stored by pusha - we save cr2 here later */</span>
	uint32_t	ebx;
	uint32_t	edx;
	uint32_t	ecx;
	uint32_t	eax;
	uint16_t	trapno;
	uint16_t	cpu;
	uint32_t	err;
	uint32_t	eip;
	uint32_t	cs;
	uint32_t	efl;
	uint32_t	uesp;
	uint32_t	ss;
};
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> x86_saved_state32 x86_saved_state32_t;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_SAVED_STATE32_COUNT</span>	((mach_msg_type_number_t) \
	(<span class="enscript-keyword">sizeof</span> (x86_saved_state32_t)/<span class="enscript-keyword">sizeof</span>(<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>)))

#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">pack</span>(4)

<span class="enscript-comment">/*
 * This is the state pushed onto the 64-bit interrupt stack
 * on any exception/trap/interrupt.
 */</span>
<span class="enscript-type">struct</span> x86_64_intr_stack_frame {
	uint16_t	trapno;
	uint16_t	cpu;
	uint32_t 	_pad;
	uint64_t	trapfn;
	uint64_t	err;
	uint64_t	rip;
	uint64_t	cs;
	uint64_t	rflags;
	uint64_t	rsp;
	uint64_t	ss;
};
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> x86_64_intr_stack_frame x86_64_intr_stack_frame_t;
<span class="enscript-comment">/* Note: sizeof(x86_64_intr_stack_frame_t) must be a multiple of 16 bytes */</span>

<span class="enscript-comment">/*
 * thread state format for task running in 64bit long mode
 * in long mode, the same hardware frame is always pushed regardless
 * of whether there was a change in privlege level... therefore, there
 * is no need for an x86_saved_state64_from_kernel variant
 */</span>
<span class="enscript-type">struct</span> x86_saved_state64 {
	uint64_t	rdi;		<span class="enscript-comment">/* arg0 for system call */</span>
	uint64_t	rsi;
	uint64_t	rdx;
	uint64_t	r10;		<span class="enscript-comment">/* R10 := RCX prior to syscall trap */</span>
	uint64_t	r8;
	uint64_t	r9;		<span class="enscript-comment">/* arg5 for system call */</span>

        uint64_t	cr2;
        uint64_t	r15;
        uint64_t	r14;
        uint64_t	r13;
        uint64_t	r12;
        uint64_t	r11;
	uint64_t	rbp;
	uint64_t	rbx;
	uint64_t	rcx;
	uint64_t	rax;

	uint32_t	gs;
	uint32_t	fs;

	uint64_t 	_pad;

	<span class="enscript-type">struct</span>	x86_64_intr_stack_frame	isf;
};
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> x86_saved_state64 x86_saved_state64_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">x86_SAVED_STATE64_COUNT</span>	((mach_msg_type_number_t) \
	(<span class="enscript-keyword">sizeof</span> (<span class="enscript-type">struct</span> x86_saved_state64)/<span class="enscript-keyword">sizeof</span>(<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>)))

<span class="enscript-type">extern</span> uint32_t <span class="enscript-function-name">get_eflags_exportmask</span>(<span class="enscript-type">void</span>);

<span class="enscript-comment">/*
 * Unified, tagged saved state:
 */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
	uint32_t			flavor;
	uint32_t			_pad_for_16byte_alignment[3];
	<span class="enscript-type">union</span> {
		x86_saved_state32_t	ss_32;
		x86_saved_state64_t	ss_64;
	} uss;
} x86_saved_state_t;
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ss_32</span>	uss.ss_32
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">ss_64</span>	uss.ss_64
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">pack</span>()

<span class="enscript-type">static</span> inline boolean_t
<span class="enscript-function-name">is_saved_state64</span>(x86_saved_state_t *iss)
{
	<span class="enscript-keyword">return</span> (iss-&gt;flavor == x86_SAVED_STATE64);
}

<span class="enscript-type">static</span> inline boolean_t
<span class="enscript-function-name">is_saved_state32</span>(x86_saved_state_t *iss)
{
	<span class="enscript-keyword">return</span> (iss-&gt;flavor == x86_SAVED_STATE32);
}

<span class="enscript-type">static</span> inline x86_saved_state32_t *
<span class="enscript-function-name">saved_state32</span>(x86_saved_state_t *iss)
{
	<span class="enscript-keyword">return</span> &amp;iss-&gt;ss_32; 
}

<span class="enscript-type">static</span> inline x86_saved_state64_t *
<span class="enscript-function-name">saved_state64</span>(x86_saved_state_t *iss)
{
	<span class="enscript-keyword">return</span> &amp;iss-&gt;ss_64; 
}

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* XNU_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* _MACH_I386_THREAD_STATUS_H_ */</span>
</pre>
<hr />
</body></html>