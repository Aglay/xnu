<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>vm_map.html</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">vm_map.html&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-keyword">&lt;h2&gt;</span>vm_map<span class="enscript-keyword">&lt;/h2&gt;</span>
<span class="enscript-keyword">&lt;hr&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;strong&gt;</span>Function<span class="enscript-keyword">&lt;/strong&gt;</span> - Map the specified memory object to a region of virtual memory.
<span class="enscript-keyword">&lt;h3&gt;</span>SYNOPSIS<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;pre&gt;</span>
<span class="enscript-keyword">&lt;strong&gt;</span>kern_return_t   vm_map<span class="enscript-keyword">&lt;/strong&gt;</span>
                <span class="enscript-keyword">&lt;strong&gt;</span>(vm_task_t<span class="enscript-keyword">&lt;/strong&gt;</span>                          <span class="enscript-keyword">&lt;var&gt;</span>target_task<span class="enscript-keyword">&lt;/var&gt;</span>,
                 <span class="enscript-keyword">&lt;strong&gt;</span>vm_address_t<span class="enscript-keyword">&lt;/strong&gt;</span>                           <span class="enscript-keyword">&lt;var&gt;</span>address<span class="enscript-keyword">&lt;/var&gt;</span>,
                 <span class="enscript-keyword">&lt;strong&gt;</span>vm_size_t<span class="enscript-keyword">&lt;/strong&gt;</span>                                 <span class="enscript-keyword">&lt;var&gt;</span>size<span class="enscript-keyword">&lt;/var&gt;</span>,
                 <span class="enscript-keyword">&lt;strong&gt;</span>vm_address_t<span class="enscript-keyword">&lt;/strong&gt;</span>                              <span class="enscript-keyword">&lt;var&gt;</span>mask<span class="enscript-keyword">&lt;/var&gt;</span>,
                 <span class="enscript-keyword">&lt;strong&gt;</span>boolean_t<span class="enscript-keyword">&lt;/strong&gt;</span>                             <span class="enscript-keyword">&lt;var&gt;</span>anywhere<span class="enscript-keyword">&lt;/var&gt;</span>,
                 <span class="enscript-keyword">&lt;strong&gt;</span>memory_object_t<span class="enscript-keyword">&lt;/strong&gt;</span>                  <span class="enscript-keyword">&lt;var&gt;</span>memory_object<span class="enscript-keyword">&lt;/var&gt;</span>,
                 <span class="enscript-keyword">&lt;strong&gt;</span>vm_offset_t<span class="enscript-keyword">&lt;/strong&gt;</span>                             <span class="enscript-keyword">&lt;var&gt;</span>offset<span class="enscript-keyword">&lt;/var&gt;</span>,
                 <span class="enscript-keyword">&lt;strong&gt;</span>boolean_t<span class="enscript-keyword">&lt;/strong&gt;</span>                                 <span class="enscript-keyword">&lt;var&gt;</span>copy<span class="enscript-keyword">&lt;/var&gt;</span>,
                 <span class="enscript-keyword">&lt;strong&gt;</span>vm_prot_t<span class="enscript-keyword">&lt;/strong&gt;</span>                       <span class="enscript-keyword">&lt;var&gt;</span>cur_protection<span class="enscript-keyword">&lt;/var&gt;</span>,
                 <span class="enscript-keyword">&lt;strong&gt;</span>vm_prot_t<span class="enscript-keyword">&lt;/strong&gt;</span>                       <span class="enscript-keyword">&lt;var&gt;</span>max_protection<span class="enscript-keyword">&lt;/var&gt;</span>,
                 <span class="enscript-keyword">&lt;strong&gt;</span>vm_inherit_t<span class="enscript-keyword">&lt;/strong&gt;</span>                       <span class="enscript-keyword">&lt;var&gt;</span>inheritance<span class="enscript-keyword">&lt;/var&gt;</span><span class="enscript-keyword">&lt;strong&gt;</span>);<span class="enscript-keyword">&lt;/strong&gt;</span>
<span class="enscript-keyword">&lt;/pre&gt;</span>
<span class="enscript-keyword">&lt;h3&gt;</span>PARAMETERS<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;dl&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;var&gt;</span>target_task<span class="enscript-keyword">&lt;/var&gt;</span> 
<span class="enscript-keyword">&lt;dd&gt;</span>
[in task send right]
The port for the task in whose address space the 
memory object is to be mapped.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;var&gt;</span>address<span class="enscript-keyword">&lt;/var&gt;</span> 
<span class="enscript-keyword">&lt;dd&gt;</span>
[pointer to in/out scalar]
The starting address for the mapped object. 
The mapped object will start at the beginning of the page containing 
<span class="enscript-keyword">&lt;var&gt;</span>address<span class="enscript-keyword">&lt;/var&gt;</span>.  If there is not enough room following the address, the kernel 
does not map the object.  The kernel returns the starting address
actually used for the mapped object.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;var&gt;</span>size<span class="enscript-keyword">&lt;/var&gt;</span> 
<span class="enscript-keyword">&lt;dd&gt;</span>
[in scalar]
The number of bytes to allocate for the object.  The kernel 
rounds this number up to an integral number of virtual pages.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;var&gt;</span>mask<span class="enscript-keyword">&lt;/var&gt;</span> 
<span class="enscript-keyword">&lt;dd&gt;</span>
[in scalar]
Alignment restrictions for starting address.  Bits turned on in 
the mask will not be turned on in the starting address.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;var&gt;</span>anywhere<span class="enscript-keyword">&lt;/var&gt;</span> 
<span class="enscript-keyword">&lt;dd&gt;</span>
[in scalar]
Placement indicator.  The valid values are:
<span class="enscript-keyword">&lt;dl&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;strong&gt;</span>TRUE<span class="enscript-keyword">&lt;/strong&gt;</span>
<span class="enscript-keyword">&lt;dd&gt;</span>
The kernel allocates the region in the next unused space that 
is sufficient within the address space.  The kernel returns the 
starting address actually used in <span class="enscript-keyword">&lt;var&gt;</span>address<span class="enscript-keyword">&lt;/var&gt;</span>.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;strong&gt;</span>FALSE<span class="enscript-keyword">&lt;/strong&gt;</span>
<span class="enscript-keyword">&lt;dd&gt;</span>
The kernel allocates the region starting at <span class="enscript-keyword">&lt;var&gt;</span>address<span class="enscript-keyword">&lt;/var&gt;</span> unless that 
space is already allocated.
<span class="enscript-keyword">&lt;/dl&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;var&gt;</span>memory_object<span class="enscript-keyword">&lt;/var&gt;</span> 
<span class="enscript-keyword">&lt;dd&gt;</span>
[in memory-object send right]
The port naming the 
memory object.  If <span class="enscript-keyword">&lt;strong&gt;</span>MEMORY_OBJECT_NULL<span class="enscript-keyword">&lt;/strong&gt;</span> is
specified, the kernel allocates zero-filled memory, as with <span class="enscript-keyword">&lt;strong&gt;</span>vm_allocate<span class="enscript-keyword">&lt;/strong&gt;</span>.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;var&gt;</span>offset<span class="enscript-keyword">&lt;/var&gt;</span> 
<span class="enscript-keyword">&lt;dd&gt;</span>
[in scalar]
An offset within the memory object, in bytes.  The kernel 
maps <span class="enscript-keyword">&lt;var&gt;</span>address<span class="enscript-keyword">&lt;/var&gt;</span> to the specified offset.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;var&gt;</span>copy<span class="enscript-keyword">&lt;/var&gt;</span> 
<span class="enscript-keyword">&lt;dd&gt;</span>
[in scalar]
Copy indicator.  If true, the kernel copies the region of the 
memory object to the specified task's address space.  If false, the region 
is directly mapped.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;var&gt;</span>cur_protection<span class="enscript-keyword">&lt;/var&gt;</span> 
<span class="enscript-keyword">&lt;dd&gt;</span>
[in scalar]
The initial current protection for the region.  Valid values are 
obtained by or'ing together the following values:
<span class="enscript-keyword">&lt;dl&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;strong&gt;</span>VM_PROT_READ<span class="enscript-keyword">&lt;/strong&gt;</span>
<span class="enscript-keyword">&lt;dd&gt;</span>
Allows read access.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;strong&gt;</span>VM_PROT_WRITE<span class="enscript-keyword">&lt;/strong&gt;</span>
<span class="enscript-keyword">&lt;dd&gt;</span>
Allows write access.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;strong&gt;</span>VM_PROT_EXECUTE<span class="enscript-keyword">&lt;/strong&gt;</span>
<span class="enscript-keyword">&lt;dd&gt;</span>
Allows execute access.
<span class="enscript-keyword">&lt;/dl&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;var&gt;</span>max_protection<span class="enscript-keyword">&lt;/var&gt;</span> 
<span class="enscript-keyword">&lt;dd&gt;</span>
[in scalar]
The maximum protection for the region.  Values are the same 
as for <span class="enscript-keyword">&lt;var&gt;</span>cur_protection<span class="enscript-keyword">&lt;/var&gt;</span>.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;var&gt;</span>inheritance<span class="enscript-keyword">&lt;/var&gt;</span> 
<span class="enscript-keyword">&lt;dd&gt;</span>
[in scalar]
The initial inheritance attribute for the region.  Valid values 
are:
<span class="enscript-keyword">&lt;dl&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;strong&gt;</span>VM_INHERIT_SHARE<span class="enscript-keyword">&lt;/strong&gt;</span>
<span class="enscript-keyword">&lt;dd&gt;</span>
Allows child tasks to share the region.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;strong&gt;</span>VM_INHERIT_COPY<span class="enscript-keyword">&lt;/strong&gt;</span>
<span class="enscript-keyword">&lt;dd&gt;</span>
Gives child tasks a copy of the region.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;strong&gt;</span>VM_INHERIT_NONE<span class="enscript-keyword">&lt;/strong&gt;</span>
<span class="enscript-keyword">&lt;dd&gt;</span>
Provides no access to the region for child tasks.
<span class="enscript-keyword">&lt;/dl&gt;</span>
<span class="enscript-keyword">&lt;/dl&gt;</span>
<span class="enscript-keyword">&lt;h3&gt;</span>DESCRIPTION<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
The <span class="enscript-keyword">&lt;strong&gt;</span>vm_map<span class="enscript-keyword">&lt;/strong&gt;</span> function maps a portion of the specified
memory object into the 
virtual address space belonging to <span class="enscript-keyword">&lt;var&gt;</span>target_task<span class="enscript-keyword">&lt;/var&gt;</span>.  The target task
can be the calling 
task or another task, identified by its task kernel port.
<span class="enscript-keyword">&lt;p&gt;</span>
The portion of the memory object mapped is determined by <span class="enscript-keyword">&lt;var&gt;</span>offset<span class="enscript-keyword">&lt;/var&gt;</span> 
and <span class="enscript-keyword">&lt;var&gt;</span>size<span class="enscript-keyword">&lt;/var&gt;</span>.  The 
kernel maps <span class="enscript-keyword">&lt;var&gt;</span>address<span class="enscript-keyword">&lt;/var&gt;</span> to the offset, so that an access to the memory
starts at the offset in the object.
<span class="enscript-keyword">&lt;p&gt;</span>
The <span class="enscript-keyword">&lt;var&gt;</span>mask<span class="enscript-keyword">&lt;/var&gt;</span> parameter specifies additional alignment restrictions on 
the kernel's selection of the starting address.  Uses for this mask include:
<span class="enscript-keyword">&lt;ul&gt;</span>
<span class="enscript-keyword">&lt;li&gt;</span>
Forcing the memory address alignment for a mapping to be the same as the 
alignment within the memory object.
<span class="enscript-keyword">&lt;li&gt;</span>
Quickly finding the beginning of an allocated region by performing bit
arithmetic on an address known to be in the region.
<span class="enscript-keyword">&lt;li&gt;</span>
Emulating a larger virtual page size.
<span class="enscript-keyword">&lt;/ul&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
The <span class="enscript-keyword">&lt;var&gt;</span>cur_protection<span class="enscript-keyword">&lt;/var&gt;</span>, <span class="enscript-keyword">&lt;var&gt;</span>max_protection<span class="enscript-keyword">&lt;/var&gt;</span>, and <span class="enscript-keyword">&lt;var&gt;</span>inheritance<span class="enscript-keyword">&lt;/var&gt;</span>
parameters set the
protection and inheritance attributes for the mapped object.
As a rule, at least the
maximum protection should be specified so that a server can make
a restricted (for 
example, read-only) mapping in a client atomically.  The current
protection and 
inheritance parameters are provided for convenience so that the
caller does not 
have to call <span class="enscript-keyword">&lt;strong&gt;</span>vm_inherit<span class="enscript-keyword">&lt;/strong&gt;</span> and <span class="enscript-keyword">&lt;strong&gt;</span>vm_protect<span class="enscript-keyword">&lt;/strong&gt;</span> separately.
<span class="enscript-keyword">&lt;p&gt;</span>
The same memory object can be mapped more than once and by more than one 
task.  If an object is mapped by multiple tasks, the kernel maintains
consistency 
for all the mappings if they use the same page alignment for <span class="enscript-keyword">&lt;var&gt;</span>offset<span class="enscript-keyword">&lt;/var&gt;</span> 
and are on 
the same host.  In this case, the virtual memory to which the
object is mapped is 
shared by all the tasks.  Changes made by one task in its address space are
visible to all the other tasks.
The call will not return until the
memory object is ready for 
use.
<span class="enscript-keyword">&lt;h3&gt;</span>NOTES<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;strong&gt;</span>vm_map<span class="enscript-keyword">&lt;/strong&gt;</span> allocates a region in a task's address space
and maps the specified 
memory object to this region.  <span class="enscript-keyword">&lt;strong&gt;</span>vm_allocate<span class="enscript-keyword">&lt;/strong&gt;</span> allocates
a zero-filled temporary
region in a task's address space.
<span class="enscript-keyword">&lt;p&gt;</span>
Before a memory object can be mapped, a port naming it must be acquired from 
the memory manager serving it.
<span class="enscript-keyword">&lt;p&gt;</span>
This interface is machine word length specific because of the virtual address
parameter.
<span class="enscript-keyword">&lt;h3&gt;</span>CAUTIONS<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
Do not attempt to map a memory object unless it has been provided by a
memory manager that implements the memory object interface. 
If another type of port 
is specified, a thread that accesses the mapped virtual memory may become
permanently hung or may receive a memory exception.
<span class="enscript-keyword">&lt;h3&gt;</span>RETURN VALUES<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;dl&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;strong&gt;</span>KERN_NO_SPACE<span class="enscript-keyword">&lt;/strong&gt;</span>
<span class="enscript-keyword">&lt;dd&gt;</span>
There is not enough space in the task's address space to allocate the 
new region for the memory object.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;strong&gt;</span>KERN_PROTECTION_FAILURE<span class="enscript-keyword">&lt;/strong&gt;</span>
<span class="enscript-keyword">&lt;dd&gt;</span>
<span class="enscript-keyword">&lt;var&gt;</span>max_protection<span class="enscript-keyword">&lt;/var&gt;</span> or <span class="enscript-keyword">&lt;var&gt;</span>cur_protection<span class="enscript-keyword">&lt;/var&gt;</span> exceeds 
that permitted by <span class="enscript-keyword">&lt;var&gt;</span>memory_object<span class="enscript-keyword">&lt;/var&gt;</span>.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;strong&gt;</span>KERN_INVALID_OBJECT<span class="enscript-keyword">&lt;/strong&gt;</span>
<span class="enscript-keyword">&lt;dd&gt;</span>
The memory manager failed to map the memory object.
<span class="enscript-keyword">&lt;/dl&gt;</span>
<span class="enscript-keyword">&lt;h3&gt;</span>RELATED INFORMATION<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
Functions:
<span class="enscript-keyword">&lt;a href=</span><span class="enscript-string">&quot;vm_allocate.html&quot;</span><span class="enscript-keyword">&gt;</span><span class="enscript-keyword">&lt;strong&gt;</span>vm_allocate<span class="enscript-keyword">&lt;/strong&gt;</span><span class="enscript-keyword">&lt;/a&gt;</span>,
<span class="enscript-keyword">&lt;a href=</span><span class="enscript-string">&quot;vm_remap.html&quot;</span><span class="enscript-keyword">&gt;</span><span class="enscript-keyword">&lt;strong&gt;</span>vm_remap<span class="enscript-keyword">&lt;/strong&gt;</span><span class="enscript-keyword">&lt;/a&gt;</span>.
</pre>
<hr />
</body></html>