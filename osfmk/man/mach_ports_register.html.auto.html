<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>mach_ports_register.html</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">mach_ports_register.html&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-keyword">&lt;h2&gt;</span>mach_ports_register<span class="enscript-keyword">&lt;/h2&gt;</span>
<span class="enscript-keyword">&lt;hr&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;strong&gt;</span>Function<span class="enscript-keyword">&lt;/strong&gt;</span> - Register an array of well-known ports on behalf of the target task.
<span class="enscript-keyword">&lt;h3&gt;</span>SYNOPSIS<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;pre&gt;</span>
<span class="enscript-keyword">&lt;strong&gt;</span>kern_return_t   mach_ports_register<span class="enscript-keyword">&lt;/strong&gt;</span>
                <span class="enscript-keyword">&lt;strong&gt;</span>(task_t<span class="enscript-keyword">&lt;/strong&gt;</span>                             <span class="enscript-keyword">&lt;var&gt;</span>target_task<span class="enscript-keyword">&lt;/var&gt;</span>,
                 <span class="enscript-keyword">&lt;strong&gt;</span>mach_port_array_t<span class="enscript-keyword">&lt;/strong&gt;</span>                <span class="enscript-keyword">&lt;var&gt;</span>init_port_set<span class="enscript-keyword">&lt;/var&gt;</span>,
                 <span class="enscript-keyword">&lt;strong&gt;</span>target_task<span class="enscript-keyword">&lt;/strong&gt;</span>              <span class="enscript-keyword">&lt;var&gt;</span>init_port_array_count<span class="enscript-keyword">&lt;/var&gt;</span><span class="enscript-keyword">&lt;strong&gt;</span>);<span class="enscript-keyword">&lt;/strong&gt;</span>
<span class="enscript-keyword">&lt;/pre&gt;</span>
<span class="enscript-keyword">&lt;h3&gt;</span>PARAMETERS<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;dl&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;var&gt;</span>target_task<span class="enscript-keyword">&lt;/var&gt;</span> 
<span class="enscript-keyword">&lt;dd&gt;</span>
[in task send right]
The task for which the ports are to be registered.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;var&gt;</span>init_port_set<span class="enscript-keyword">&lt;/var&gt;</span> 
<span class="enscript-keyword">&lt;dd&gt;</span>
[in pointer to array of registered send rights]
The array of ports to
register.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;var&gt;</span>init_port_array_count<span class="enscript-keyword">&lt;/var&gt;</span> 
<span class="enscript-keyword">&lt;dd&gt;</span>
[in scalar]
The number of ports in the array.  Note that while this is a 
variable, the kernel accepts only a limited number of ports.  The
maximum number of ports is defined by the global constant
<span class="enscript-keyword">&lt;strong&gt;</span>MACH_PORTS_SLOTS_USED<span class="enscript-keyword">&lt;/strong&gt;</span>.
<span class="enscript-keyword">&lt;/dl&gt;</span>
<span class="enscript-keyword">&lt;h3&gt;</span>DESCRIPTION<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
The <span class="enscript-keyword">&lt;strong&gt;</span>mach_ports_register<span class="enscript-keyword">&lt;/strong&gt;</span> function registers an array
of well-known system 
ports for the specified task.  The task holds only send rights
for the registered 
ports.  The valid well-known system ports are:
<span class="enscript-keyword">&lt;ul&gt;</span>
<span class="enscript-keyword">&lt;li&gt;</span>
The port for the Name Server
<span class="enscript-keyword">&lt;li&gt;</span>
The port for the Environment Manager
<span class="enscript-keyword">&lt;li&gt;</span>
The port for the Service server
<span class="enscript-keyword">&lt;/ul&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
Each port must be placed in a specific slot in the array.  The slot numbers are
defined (in <span class="enscript-keyword">&lt;strong&gt;</span>mach.h<span class="enscript-keyword">&lt;/strong&gt;</span>) by the global constants <span class="enscript-keyword">&lt;strong&gt;</span>NAME_SERVER_SLOT<span class="enscript-keyword">&lt;/strong&gt;</span>,
<span class="enscript-keyword">&lt;strong&gt;</span>ENVIRONMENT_SLOT<span class="enscript-keyword">&lt;/strong&gt;</span>, and <span class="enscript-keyword">&lt;strong&gt;</span>SERVICE_SLOT<span class="enscript-keyword">&lt;/strong&gt;</span>.
<span class="enscript-keyword">&lt;p&gt;</span>
A task can retrieve the currently registered ports by using the
<span class="enscript-keyword">&lt;strong&gt;</span>mach_ports_lookup<span class="enscript-keyword">&lt;/strong&gt;</span> function.
<span class="enscript-keyword">&lt;h3&gt;</span>NOTES<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
When a new task is created (with <span class="enscript-keyword">&lt;strong&gt;</span>task_create<span class="enscript-keyword">&lt;/strong&gt;</span>), 
the child task can inherit the
parent's registered ports.  Note that child tasks do not automatically
acquire rights 
to these ports.  They must use <span class="enscript-keyword">&lt;strong&gt;</span>mach_ports_lookup<span class="enscript-keyword">&lt;/strong&gt;</span> to
get them.  It is intended 
that port registration be used only for task initialization, and then only by
run-time support modules.
<span class="enscript-keyword">&lt;p&gt;</span>
A parent task has three choices when passing registered ports to child tasks:
<span class="enscript-keyword">&lt;ul&gt;</span>
<span class="enscript-keyword">&lt;li&gt;</span>
The parent task can do nothing.  In this case, all child tasks
inherit access to 
the same ports that the parent has.
<span class="enscript-keyword">&lt;li&gt;</span>
The parent task can use <span class="enscript-keyword">&lt;strong&gt;</span>mach_ports_register<span class="enscript-keyword">&lt;/strong&gt;</span> to modify
its set of registered 
ports before creating child tasks.  In this case, the child tasks get access 
to the 
modified set of ports.  After creating its child tasks. the parent can use 
<span class="enscript-keyword">&lt;strong&gt;</span>mach_ports_register<span class="enscript-keyword">&lt;/strong&gt;</span> again to reset its registered ports.
<span class="enscript-keyword">&lt;li&gt;</span>
The parent task can first create a specific child task and then use
<span class="enscript-keyword">&lt;strong&gt;</span>mach_ports_register<span class="enscript-keyword">&lt;/strong&gt;</span> to modify the child's inherited
set of ports, before starting 
the child's thread(s).  The parent must specify the child's task port, rather 
than its own, on the call to <span class="enscript-keyword">&lt;strong&gt;</span>mach_ports_register<span class="enscript-keyword">&lt;/strong&gt;</span>. 
<span class="enscript-keyword">&lt;/ul&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
Tasks other than the Name Server and the Environment Manager 
should not need access to the Service port.  The Name Server port is 
the same for all tasks on a given machine.  The Environment port
is the only port 
likely to have different values for different tasks.
<span class="enscript-keyword">&lt;p&gt;</span>
Registered ports are restricted to those ports that are used by the run-time
system to initialize a task.  A parent task can pass other ports
to its child tasks 
through:
<span class="enscript-keyword">&lt;ul&gt;</span>
<span class="enscript-keyword">&lt;li&gt;</span>
An initial message (see <span class="enscript-keyword">&lt;strong&gt;</span>mach_msg<span class="enscript-keyword">&lt;/strong&gt;</span>).
<span class="enscript-keyword">&lt;li&gt;</span>
The Name Server, for public ports.
<span class="enscript-keyword">&lt;li&gt;</span>
The Environment Manager, for private ports.
<span class="enscript-keyword">&lt;li&gt;</span>
The task bootstrap port (see <span class="enscript-keyword">&lt;strong&gt;</span>task_get_special_port<span class="enscript-keyword">&lt;/strong&gt;</span>).
<span class="enscript-keyword">&lt;/ul&gt;</span>
<span class="enscript-keyword">&lt;h3&gt;</span>RETURN VALUES<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
Only generic errors apply.
<span class="enscript-keyword">&lt;h3&gt;</span>RELATED INFORMATION<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
Functions:
<span class="enscript-keyword">&lt;a href=</span><span class="enscript-string">&quot;mach_msg.html&quot;</span><span class="enscript-keyword">&gt;</span><span class="enscript-keyword">&lt;strong&gt;</span>mach_msg<span class="enscript-keyword">&lt;/strong&gt;</span><span class="enscript-keyword">&lt;/a&gt;</span>,
<span class="enscript-keyword">&lt;a href=</span><span class="enscript-string">&quot;mach_ports_lookup.html&quot;</span><span class="enscript-keyword">&gt;</span><span class="enscript-keyword">&lt;strong&gt;</span>mach_ports_lookup<span class="enscript-keyword">&lt;/strong&gt;</span><span class="enscript-keyword">&lt;/a&gt;</span>.
</pre>
<hr />
</body></html>