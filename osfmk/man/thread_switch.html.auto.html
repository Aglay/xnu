<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>thread_switch.html</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">thread_switch.html&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-keyword">&lt;h2&gt;</span>thread_switch<span class="enscript-keyword">&lt;/h2&gt;</span>
<span class="enscript-keyword">&lt;hr&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;strong&gt;</span>Function<span class="enscript-keyword">&lt;/strong&gt;</span> - Cause context switch with options.
<span class="enscript-keyword">&lt;h3&gt;</span>SYNOPSIS<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;pre&gt;</span>
<span class="enscript-keyword">&lt;strong&gt;</span>kern_return_t   thread_switch<span class="enscript-keyword">&lt;/strong&gt;</span>
                <span class="enscript-keyword">&lt;strong&gt;</span>(mach_port_t<span class="enscript-keyword">&lt;/strong&gt;</span>                         <span class="enscript-keyword">&lt;var&gt;</span>new_thread<span class="enscript-keyword">&lt;/var&gt;</span>,
                 <span class="enscript-keyword">&lt;strong&gt;</span>int<span class="enscript-keyword">&lt;/strong&gt;</span>                                     <span class="enscript-keyword">&lt;var&gt;</span>option<span class="enscript-keyword">&lt;/var&gt;</span>,
                 <span class="enscript-keyword">&lt;strong&gt;</span>mach_msg_timeout_t<span class="enscript-keyword">&lt;/strong&gt;</span>                        <span class="enscript-keyword">&lt;var&gt;</span>time<span class="enscript-keyword">&lt;/var&gt;</span><span class="enscript-keyword">&lt;strong&gt;</span>);<span class="enscript-keyword">&lt;/strong&gt;</span>
<span class="enscript-keyword">&lt;/pre&gt;</span>
<span class="enscript-keyword">&lt;h3&gt;</span>PARAMETERS<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;dl&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;var&gt;</span>new_thread<span class="enscript-keyword">&lt;/var&gt;</span> 
<span class="enscript-keyword">&lt;dd&gt;</span>
[in thread send right]
Thread to which the processor should switch
context.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;var&gt;</span>option<span class="enscript-keyword">&lt;/var&gt;</span> 
<span class="enscript-keyword">&lt;dd&gt;</span>
[in scalar]
Options applicable to the context switch.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;var&gt;</span>time<span class="enscript-keyword">&lt;/var&gt;</span> 
<span class="enscript-keyword">&lt;dd&gt;</span>
[in scalar]
Time duration during which the thread should be affected by 
<span class="enscript-keyword">&lt;var&gt;</span>option<span class="enscript-keyword">&lt;/var&gt;</span>.
<span class="enscript-keyword">&lt;/dl&gt;</span>
<span class="enscript-keyword">&lt;h3&gt;</span>DESCRIPTION<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
The <span class="enscript-keyword">&lt;strong&gt;</span>thread_switch<span class="enscript-keyword">&lt;/strong&gt;</span> function provides low-level access
to the scheduler's
context switching code.  <span class="enscript-keyword">&lt;var&gt;</span>new_thread<span class="enscript-keyword">&lt;/var&gt;</span> is a hint that implements
hand-off scheduling. 
The operating system will attempt to switch directly to the new thread 
(bypassing the normal logic that selects the next thread to run) 
if possible.  Since this is a hint, it may be incorrect; it is ignored if it 
doesn't specify a thread on the same host as the current thread or if 
the scheduler cannot switch to that thread (i.e., 
not runable or already running on another processor).  In this
case, the normal 
logic to select the next thread to run is used; the current thread
may continue 
running if there is no other appropriate thread to run.
<span class="enscript-keyword">&lt;p&gt;</span>
The <span class="enscript-keyword">&lt;var&gt;</span>option<span class="enscript-keyword">&lt;/var&gt;</span> argument specifies the interpretation and use of <span class="enscript-keyword">&lt;var&gt;</span>time<span class="enscript-keyword">&lt;/var&gt;</span>.
The possible values (from \*L<span class="enscript-keyword">&lt;mach/thread_switch.h&gt;</span>\*O) are:
<span class="enscript-keyword">&lt;dl&gt;</span>
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;strong&gt;</span>SWITCH_OPTION_NONE<span class="enscript-keyword">&lt;/strong&gt;</span>
<span class="enscript-keyword">&lt;dd&gt;</span>
The <span class="enscript-keyword">&lt;var&gt;</span>time<span class="enscript-keyword">&lt;/var&gt;</span> argument is ignored.
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;strong&gt;</span>SWITCH_OPTION_WAIT<span class="enscript-keyword">&lt;/strong&gt;</span>
<span class="enscript-keyword">&lt;dd&gt;</span>
The thread is blocked for the specified <span class="enscript-keyword">&lt;var&gt;</span>time<span class="enscript-keyword">&lt;/var&gt;</span>.  This wait cannot be
canceled by <span class="enscript-keyword">&lt;strong&gt;</span>thread_resume<span class="enscript-keyword">&lt;/strong&gt;</span>; 
only <span class="enscript-keyword">&lt;strong&gt;</span>thread_abort<span class="enscript-keyword">&lt;/strong&gt;</span> can terminate this wait.
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;strong&gt;</span>SWITCH_OPTION_DEPRESS<span class="enscript-keyword">&lt;/strong&gt;</span>
<span class="enscript-keyword">&lt;dd&gt;</span>
The thread's scheduling attributes are temporarily set so as to provide 
it with the lowest possible service for duration <span class="enscript-keyword">&lt;var&gt;</span>time<span class="enscript-keyword">&lt;/var&gt;</span>.  The scheduling
depression is aborted when <span class="enscript-keyword">&lt;var&gt;</span>time<span class="enscript-keyword">&lt;/var&gt;</span> has passed, when the current thread is 
next run (either via hand-off scheduling or because the processor set 
has nothing better to do), or when <span class="enscript-keyword">&lt;strong&gt;</span>thread_abort<span class="enscript-keyword">&lt;/strong&gt;</span> or
<span class="enscript-keyword">&lt;strong&gt;</span>thread_depress_abort<span class="enscript-keyword">&lt;/strong&gt;</span> is applied to the current thread.
Changing the thread's scheduling attributes (via <span class="enscript-keyword">&lt;strong&gt;</span>thread_policy<span class="enscript-keyword">&lt;/strong&gt;</span>) 
will not affect this depression.
<span class="enscript-keyword">&lt;dt&gt;</span> <span class="enscript-keyword">&lt;strong&gt;</span>SWITCH_OPTION_IDLE<span class="enscript-keyword">&lt;/strong&gt;</span>
<span class="enscript-keyword">&lt;dd&gt;</span>
This option is similar to <span class="enscript-keyword">&lt;strong&gt;</span>SWITCH_OPTION_DEPRESS<span class="enscript-keyword">&lt;/strong&gt;</span> however, the 
thread's scheduling attributes are temporarily set so as to place it 
at a service level that is below all runnable threads for 
duration <span class="enscript-keyword">&lt;var&gt;</span>time<span class="enscript-keyword">&lt;/var&gt;</span>.  The scheduling depression is aborted 
when <span class="enscript-keyword">&lt;var&gt;</span>time<span class="enscript-keyword">&lt;/var&gt;</span> has passed, when the current thread is 
next run (either via hand-off scheduling or because the processor set 
has nothing better to do), or when <span class="enscript-keyword">&lt;strong&gt;</span>thread_abort<span class="enscript-keyword">&lt;/strong&gt;</span> or
<span class="enscript-keyword">&lt;strong&gt;</span>thread_depress_abort<span class="enscript-keyword">&lt;/strong&gt;</span> is applied to the current thread.
Changing the thread's scheduling attributes (via <span class="enscript-keyword">&lt;strong&gt;</span>thread_policy<span class="enscript-keyword">&lt;/strong&gt;</span>) 
will not affect this depression.
<span class="enscript-keyword">&lt;/dl&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
The minimum time and units of time can be obtained as the <span class="enscript-keyword">&lt;var&gt;</span>min_timeout<span class="enscript-keyword">&lt;/var&gt;</span> 
value from the <span class="enscript-keyword">&lt;strong&gt;</span>HOST_SCHED_INFO<span class="enscript-keyword">&lt;/strong&gt;</span> flavor of <span class="enscript-keyword">&lt;strong&gt;</span>host_info<span class="enscript-keyword">&lt;/strong&gt;</span>.
<span class="enscript-keyword">&lt;h3&gt;</span>NOTES<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;strong&gt;</span>thread_switch<span class="enscript-keyword">&lt;/strong&gt;</span> is often called when the current thread
can proceed no further 
for some reason; the various options and arguments allow information about 
this reason to be transmitted to the kernel.  The <span class="enscript-keyword">&lt;var&gt;</span>new_thread<span class="enscript-keyword">&lt;/var&gt;</span>
argument (hand-off 
scheduling) is useful when the identity of the thread that must make progress
before the current thread runs again is known.  The <span class="enscript-keyword">&lt;strong&gt;</span>SWITCH_OPTION_WAIT<span class="enscript-keyword">&lt;/strong&gt;</span>
option is used when the amount of time that the current thread
must wait before it 
can do anything useful can be estimated and is fairly short,
especially when the 
identity of the thread for which this thread must wait is not known.
<span class="enscript-keyword">&lt;h3&gt;</span>CAUTIONS<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
Users should beware of calling <span class="enscript-keyword">&lt;strong&gt;</span>thread_switch<span class="enscript-keyword">&lt;/strong&gt;</span> with an
invalid hint (e.g., <span class="enscript-keyword">&lt;strong&gt;</span>THREAD_NULL<span class="enscript-keyword">&lt;/strong&gt;</span>) and no option.  
Because the time-sharing scheduler varies the 
priority of threads based on usage, this may result in a waste
of CPU time if the 
thread that must be run is of lower priority.  The use of the 
<span class="enscript-keyword">&lt;strong&gt;</span>SWITCH_OPTION_DEPRESS<span class="enscript-keyword">&lt;/strong&gt;</span> option in this situation is highly recommended.
<span class="enscript-keyword">&lt;p&gt;</span>
<span class="enscript-keyword">&lt;strong&gt;</span>thread_switch<span class="enscript-keyword">&lt;/strong&gt;</span> ignores policies.  Users relying on the
preemption semantics of a 
fixed time policy should be aware that <span class="enscript-keyword">&lt;strong&gt;</span>thread_switch<span class="enscript-keyword">&lt;/strong&gt;</span>
ignores these semantics; 
it will run the specified <span class="enscript-keyword">&lt;var&gt;</span>new_thread<span class="enscript-keyword">&lt;/var&gt;</span> independent of its scheduling
attributes and 
those of any threads that could run instead.
<span class="enscript-keyword">&lt;h3&gt;</span>RETURN VALUES<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
Only generic errors apply.
<span class="enscript-keyword">&lt;h3&gt;</span>RELATED INFORMATION<span class="enscript-keyword">&lt;/h3&gt;</span>
<span class="enscript-keyword">&lt;p&gt;</span>
Functions:
<span class="enscript-keyword">&lt;a href=</span><span class="enscript-string">&quot;thread_abort.html&quot;</span><span class="enscript-keyword">&gt;</span><span class="enscript-keyword">&lt;strong&gt;</span>thread_abort<span class="enscript-keyword">&lt;/strong&gt;</span><span class="enscript-keyword">&lt;/a&gt;</span>,
<span class="enscript-keyword">&lt;a href=</span><span class="enscript-string">&quot;thread_depress_abort.html&quot;</span><span class="enscript-keyword">&gt;</span><span class="enscript-keyword">&lt;strong&gt;</span>thread_depress_abort<span class="enscript-keyword">&lt;/strong&gt;</span><span class="enscript-keyword">&lt;/a&gt;</span>.
</pre>
<hr />
</body></html>