<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>scalegear.c</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">scalegear.c&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">//
</span><span class="enscript-comment">//cc scalegear.c -framework Accelerate -g -Wall */
</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;stdio.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;stdlib.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;Accelerate/Accelerate.h&gt;</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;../../../pexpert/pexpert/GearImage.h&quot;</span>

<span class="enscript-type">int</span> <span class="enscript-function-name">main</span>(<span class="enscript-type">int</span> argc, <span class="enscript-type">char</span> * argv[])
{
    vImage_Buffer vs;
    vImage_Buffer vd;
    vImage_Error  verr;
    uint32_t      i, data32;
    uint8_t       data8;

    vs.width  = kGearWidth * 2;
    vs.height = kGearHeight * 2 * kGearFrames;
    vs.rowBytes  = vs.width * <span class="enscript-keyword">sizeof</span>(uint32_t);
    vs.data = malloc(vs.height * vs.rowBytes);

    vd.width  = 1.5 * vs.width;
    vd.height = 1.5 * vs.height;
    vd.rowBytes  = vd.width * <span class="enscript-keyword">sizeof</span>(uint32_t);
    vd.data = malloc(vd.height * vd.rowBytes);

    <span class="enscript-keyword">for</span> (i = 0; i &lt; vs.width * vs.height; i++)
    {
    	data32 = gGearPict2x[i];
    	data32 = (0xFF000000 | (data32 &lt;&lt; 16) | (data32 &lt;&lt; 8) | data32);
    	((uint32_t *)vs.data)[i] = data32;
    }

    verr = vImageScale_ARGB8888(&amp;vs, &amp;vd, NULL, kvImageHighQualityResampling);

    <span class="enscript-keyword">if</span> (kvImageNoError != verr) exit(1);

    printf(<span class="enscript-string">&quot;const unsigned char gGearPict3x[9*kGearFrames*kGearWidth*kGearHeight] = {&quot;</span>);

    <span class="enscript-keyword">for</span> (i = 0; i &lt; vd.width * vd.height; i++)
    {
    	data32 = ((uint32_t *)vd.data)[i];
	data8 = (0xFF &amp; data32);
    	<span class="enscript-keyword">if</span> (data32 != (0xFF000000 | (data8 &lt;&lt; 16) | (data8 &lt;&lt; 8) | data8)) exit(1);

 	<span class="enscript-keyword">if</span> (0 == (15 &amp; i)) printf(<span class="enscript-string">&quot;\n    &quot;</span>);
	printf(<span class="enscript-string">&quot;0x%02x,&quot;</span>, data8);
    }
    printf(<span class="enscript-string">&quot;\n};\n&quot;</span>);

    exit(0);
}
</pre>
<hr />
</body></html>