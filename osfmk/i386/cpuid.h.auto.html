<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>cpuid.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">cpuid.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000-2006 Apple Computer, Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*
 * @OSF_COPYRIGHT@
 */</span>

<span class="enscript-comment">/*
 * x86 CPU identification
 *
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_MACHINE_CPUID_H_</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_MACHINE_CPUID_H_</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/appleapiopts.h&gt;</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__APPLE_API_PRIVATE</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CPUID_VID_INTEL</span>		<span class="enscript-string">&quot;GenuineIntel&quot;</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CPUID_VID_AMD</span>		<span class="enscript-string">&quot;AuthenticAMD&quot;</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_VMM_ID_VMWARE</span>		<span class="enscript-string">&quot;VMwareVMware&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_VMM_ID_PARALLELS</span>	<span class="enscript-string">&quot;Parallels\0\0\0&quot;</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_STRING_UNKNOWN</span>    <span class="enscript-string">&quot;Unknown CPU Typ&quot;</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">_Bit</span>(n)			(1ULL &lt;&lt; n)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">_HBit</span>(n)		(1ULL &lt;&lt; ((n)+32))

<span class="enscript-comment">/*
 * The CPUID_FEATURE_XXX values define 64-bit values
 * returned in %ecx:%edx to a CPUID request with %eax of 1: 
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_FPU</span>       _Bit(0)   <span class="enscript-comment">/* Floating point unit on-chip */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_VME</span>       _Bit(1)   <span class="enscript-comment">/* Virtual Mode Extension */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_DE</span>        _Bit(2)   <span class="enscript-comment">/* Debugging Extension */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_PSE</span>       _Bit(3)   <span class="enscript-comment">/* Page Size Extension */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_TSC</span>       _Bit(4)   <span class="enscript-comment">/* Time Stamp Counter */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_MSR</span>       _Bit(5)   <span class="enscript-comment">/* Model Specific Registers */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_PAE</span>       _Bit(6)   <span class="enscript-comment">/* Physical Address Extension */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_MCE</span>       _Bit(7)   <span class="enscript-comment">/* Machine Check Exception */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_CX8</span>       _Bit(8)   <span class="enscript-comment">/* CMPXCHG8B */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_APIC</span>      _Bit(9)   <span class="enscript-comment">/* On-chip APIC */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_SEP</span>       _Bit(11)  <span class="enscript-comment">/* Fast System Call */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_MTRR</span>      _Bit(12)  <span class="enscript-comment">/* Memory Type Range Register */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_PGE</span>       _Bit(13)  <span class="enscript-comment">/* Page Global Enable */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_MCA</span>       _Bit(14)  <span class="enscript-comment">/* Machine Check Architecture */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_CMOV</span>      _Bit(15)  <span class="enscript-comment">/* Conditional Move Instruction */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_PAT</span>       _Bit(16)  <span class="enscript-comment">/* Page Attribute Table */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_PSE36</span>     _Bit(17)  <span class="enscript-comment">/* 36-bit Page Size Extension */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_PSN</span>       _Bit(18)  <span class="enscript-comment">/* Processor Serial Number */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_CLFSH</span>     _Bit(19)  <span class="enscript-comment">/* CLFLUSH Instruction supported */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_DS</span>        _Bit(21)  <span class="enscript-comment">/* Debug Store */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_ACPI</span>      _Bit(22)  <span class="enscript-comment">/* Thermal monitor and Clock Ctrl */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_MMX</span>       _Bit(23)  <span class="enscript-comment">/* MMX supported */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_FXSR</span>      _Bit(24)  <span class="enscript-comment">/* Fast floating pt save/restore */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_SSE</span>       _Bit(25)  <span class="enscript-comment">/* Streaming SIMD extensions */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_SSE2</span>      _Bit(26)  <span class="enscript-comment">/* Streaming SIMD extensions 2 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_SS</span>        _Bit(27)  <span class="enscript-comment">/* Self-Snoop */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_HTT</span>       _Bit(28)  <span class="enscript-comment">/* Hyper-Threading Technology */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_TM</span>        _Bit(29)  <span class="enscript-comment">/* Thermal Monitor (TM1) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_PBE</span>       _Bit(31)  <span class="enscript-comment">/* Pend Break Enable */</span>
 
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_SSE3</span>      _HBit(0)  <span class="enscript-comment">/* Streaming SIMD extensions 3 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_PCLMULQDQ</span> _HBit(1)  <span class="enscript-comment">/* PCLMULQDQ instruction */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_DTES64</span>    _HBit(2)  <span class="enscript-comment">/* 64-bit DS layout */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_MONITOR</span>   _HBit(3)  <span class="enscript-comment">/* Monitor/mwait */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_DSCPL</span>     _HBit(4)  <span class="enscript-comment">/* Debug Store CPL */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_VMX</span>       _HBit(5)  <span class="enscript-comment">/* VMX */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_SMX</span>       _HBit(6)  <span class="enscript-comment">/* SMX */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_EST</span>       _HBit(7)  <span class="enscript-comment">/* Enhanced SpeedsTep (GV3) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_TM2</span>       _HBit(8)  <span class="enscript-comment">/* Thermal Monitor 2 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_SSSE3</span>     _HBit(9)  <span class="enscript-comment">/* Supplemental SSE3 instructions */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_CID</span>       _HBit(10) <span class="enscript-comment">/* L1 Context ID */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_SEGLIM64</span>  _HBit(11) <span class="enscript-comment">/* 64-bit segment limit checking */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_FMA</span>       _HBit(12) <span class="enscript-comment">/* Fused-Multiply-Add support */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_CX16</span>      _HBit(13) <span class="enscript-comment">/* CmpXchg16b instruction */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_xTPR</span>      _HBit(14) <span class="enscript-comment">/* Send Task PRiority msgs */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_PDCM</span>      _HBit(15) <span class="enscript-comment">/* Perf/Debug Capability MSR */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_PCID</span>      _HBit(17) <span class="enscript-comment">/* ASID-PCID support */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_DCA</span>       _HBit(18) <span class="enscript-comment">/* Direct Cache Access */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_SSE4_1</span>    _HBit(19) <span class="enscript-comment">/* Streaming SIMD extensions 4.1 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_SSE4_2</span>    _HBit(20) <span class="enscript-comment">/* Streaming SIMD extensions 4.2 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_x2APIC</span>    _HBit(21) <span class="enscript-comment">/* Extended APIC Mode */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_MOVBE</span>     _HBit(22) <span class="enscript-comment">/* MOVBE instruction */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_POPCNT</span>    _HBit(23) <span class="enscript-comment">/* POPCNT instruction */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_TSCTMR</span>    _HBit(24) <span class="enscript-comment">/* TSC deadline timer */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_AES</span>       _HBit(25) <span class="enscript-comment">/* AES instructions */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_XSAVE</span>     _HBit(26) <span class="enscript-comment">/* XSAVE instructions */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_OSXSAVE</span>   _HBit(27) <span class="enscript-comment">/* XGETBV/XSETBV instructions */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_AVX1_0</span>	_HBit(28) <span class="enscript-comment">/* AVX 1.0 instructions */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_F16C</span>	_HBit(29) <span class="enscript-comment">/* Float16 convert instructions */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_RDRAND</span>	_HBit(30) <span class="enscript-comment">/* RDRAND instruction */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_FEATURE_VMM</span>       _HBit(31) <span class="enscript-comment">/* VMM (Hypervisor) present */</span>

<span class="enscript-comment">/*
 * Leaf 7, subleaf 0 additional features.
 * Bits returned in %ebx:%ecx to a CPUID request with {%eax,%ecx} of (0x7,0x0}:
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_LEAF7_FEATURE_RDWRFSGS</span> _Bit(0)	<span class="enscript-comment">/* FS/GS base read/write */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_LEAF7_FEATURE_TSCOFF</span>   _Bit(1)	<span class="enscript-comment">/* TSC thread offset */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_LEAF7_FEATURE_BMI1</span>     _Bit(3)	<span class="enscript-comment">/* Bit Manipulation Instrs, set 1 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_LEAF7_FEATURE_HLE</span>      _Bit(4)	<span class="enscript-comment">/* Hardware Lock Elision*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_LEAF7_FEATURE_AVX2</span>     _Bit(5)	<span class="enscript-comment">/* AVX2 Instructions */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_LEAF7_FEATURE_SMEP</span>     _Bit(7)	<span class="enscript-comment">/* Supervisor Mode Execute Protect */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_LEAF7_FEATURE_BMI2</span>     _Bit(8)	<span class="enscript-comment">/* Bit Manipulation Instrs, set 2 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_LEAF7_FEATURE_ERMS</span>     _Bit(9)	<span class="enscript-comment">/* Enhanced Rep Movsb/Stosb */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_LEAF7_FEATURE_INVPCID</span>  _Bit(10)	<span class="enscript-comment">/* INVPCID intruction, TDB */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_LEAF7_FEATURE_RTM</span>      _Bit(11)	<span class="enscript-comment">/* RTM */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_LEAF7_FEATURE_RDSEED</span>   _Bit(18)	<span class="enscript-comment">/* RDSEED Instruction */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_LEAF7_FEATURE_ADX</span>      _Bit(19)	<span class="enscript-comment">/* ADX Instructions */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_LEAF7_FEATURE_SMAP</span>     _Bit(20)	<span class="enscript-comment">/* Supervisor Mode Access Protect */</span>

<span class="enscript-comment">/*
 * The CPUID_EXTFEATURE_XXX values define 64-bit values
 * returned in %ecx:%edx to a CPUID request with %eax of 0x80000001: 
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_EXTFEATURE_SYSCALL</span>   _Bit(11)	<span class="enscript-comment">/* SYSCALL/sysret */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_EXTFEATURE_XD</span>	   _Bit(20)	<span class="enscript-comment">/* eXecute Disable */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_EXTFEATURE_1GBPAGE</span>   _Bit(26)	<span class="enscript-comment">/* 1GB pages */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_EXTFEATURE_RDTSCP</span>	   _Bit(27)	<span class="enscript-comment">/* RDTSCP */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_EXTFEATURE_EM64T</span>	   _Bit(29)	<span class="enscript-comment">/* Extended Mem 64 Technology */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_EXTFEATURE_LAHF</span>	   _HBit(0)	<span class="enscript-comment">/* LAFH/SAHF instructions */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_EXTFEATURE_LZCNT</span>     _HBit(5)	<span class="enscript-comment">/* LZCNT instruction */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_EXTFEATURE_PREFETCHW</span> _HBit(8)	<span class="enscript-comment">/* PREFETCHW instruction */</span>

<span class="enscript-comment">/*
 * The CPUID_EXTFEATURE_XXX values define 64-bit values
 * returned in %ecx:%edx to a CPUID request with %eax of 0x80000007: 
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_EXTFEATURE_TSCI</span>      _Bit(8)	<span class="enscript-comment">/* TSC Invariant */</span>

<span class="enscript-comment">/*
 * CPUID_X86_64_H_FEATURE_SUBSET and CPUID_X86_64_H_LEAF7_FEATURE_SUBSET
 * indicate the bitmask of features that must be present before the system
 * is eligible to run the &quot;x86_64h&quot; &quot;Haswell feature subset&quot; slice.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_X86_64_H_FEATURE_SUBSET</span> ( CPUID_FEATURE_FMA    | \
                                        CPUID_FEATURE_SSE4_2 | \
                                        CPUID_FEATURE_MOVBE  | \
                                        CPUID_FEATURE_POPCNT | \
                                        CPUID_FEATURE_AVX1_0   \
                                      )

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_X86_64_H_EXTFEATURE_SUBSET</span> ( CPUID_EXTFEATURE_LZCNT \
                                         )

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_X86_64_H_LEAF7_FEATURE_SUBSET</span> ( CPUID_LEAF7_FEATURE_BMI1 | \
                                              CPUID_LEAF7_FEATURE_AVX2 | \
                                              CPUID_LEAF7_FEATURE_BMI2   \
                                            )

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CPUID_CACHE_SIZE</span>	16	<span class="enscript-comment">/* Number of descriptor values */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MWAIT_EXTENSION</span>	_Bit(0)	<span class="enscript-comment">/* enumeration of WMAIT extensions */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MWAIT_BREAK</span>	_Bit(1)	<span class="enscript-comment">/* interrupts are break events	   */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_YONAH</span>		0x0E
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_MEROM</span>		0x0F
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_PENRYN</span>		0x17
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_NEHALEM</span>		0x1A
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_FIELDS</span>		0x1E	<span class="enscript-comment">/* Lynnfield, Clarksfield */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_DALES</span>		0x1F	<span class="enscript-comment">/* Havendale, Auburndale */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_NEHALEM_EX</span>		0x2E
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_DALES_32NM</span>		0x25	<span class="enscript-comment">/* Clarkdale, Arrandale */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_WESTMERE</span>		0x2C	<span class="enscript-comment">/* Gulftown, Westmere-EP/-WS */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_WESTMERE_EX</span>		0x2F
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_SANDYBRIDGE</span>		0x2A
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_JAKETOWN</span>		0x2D
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_IVYBRIDGE</span>		0x3A
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_IVYBRIDGE_EP</span>	0x3E
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_CRYSTALWELL</span>		0x46
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_HASWELL</span>		0x3C
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_HASWELL_EP</span>		0x3F
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_HASWELL_ULT</span>		0x45
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_BROADWELL</span>		0x3D
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_BROADWELL_ULX</span>	0x3D
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_BROADWELL_ULT</span>	0x3D
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_MODEL_BRYSTALWELL</span>		0x47

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_VMM_FAMILY_UNKNOWN</span>	0x0
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_VMM_FAMILY_VMWARE</span>		0x1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CPUID_VMM_FAMILY_PARALLELS</span>	0x2

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">ASSEMBLER</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;stdint.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/mach_types.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;kern/kern_types.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/machine.h&gt;</span>


<span class="enscript-type">typedef</span> <span class="enscript-type">enum</span> { eax, ebx, ecx, edx } cpuid_register_t;
<span class="enscript-type">static</span> inline <span class="enscript-type">void</span>
<span class="enscript-function-name">cpuid</span>(uint32_t *data)
{
	__asm__ <span class="enscript-type">volatile</span> (<span class="enscript-string">&quot;cpuid&quot;</span>
		: <span class="enscript-string">&quot;=a&quot;</span> (data[eax]),
		  <span class="enscript-string">&quot;=b&quot;</span> (data[ebx]),
		  <span class="enscript-string">&quot;=c&quot;</span> (data[ecx]),
		  <span class="enscript-string">&quot;=d&quot;</span> (data[edx])
		: <span class="enscript-string">&quot;a&quot;</span>  (data[eax]),
		  <span class="enscript-string">&quot;b&quot;</span>  (data[ebx]),
		  <span class="enscript-string">&quot;c&quot;</span>  (data[ecx]),
		  <span class="enscript-string">&quot;d&quot;</span>  (data[edx]));
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span>
<span class="enscript-function-name">do_cpuid</span>(uint32_t selector, uint32_t *data)
{
	__asm__ <span class="enscript-type">volatile</span> (<span class="enscript-string">&quot;cpuid&quot;</span>
		: <span class="enscript-string">&quot;=a&quot;</span> (data[0]),
		  <span class="enscript-string">&quot;=b&quot;</span> (data[1]),
		  <span class="enscript-string">&quot;=c&quot;</span> (data[2]),
		  <span class="enscript-string">&quot;=d&quot;</span> (data[3])
		: <span class="enscript-string">&quot;a&quot;</span>(selector),
		  <span class="enscript-string">&quot;b&quot;</span> (0),
		  <span class="enscript-string">&quot;c&quot;</span> (0),
		  <span class="enscript-string">&quot;d&quot;</span> (0));
}

<span class="enscript-comment">/*
 * Cache ID descriptor structure, used to parse CPUID leaf 2.
 * Note: not used in kernel.
 */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">enum</span> { Lnone, L1I, L1D, L2U, L3U, LCACHE_MAX } cache_type_t ; 
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
	<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>	value;          <span class="enscript-comment">/* Descriptor value */</span>
	cache_type_t 	type;           <span class="enscript-comment">/* Cache type */</span>
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> 	size;           <span class="enscript-comment">/* Cache size */</span>
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> 	linesize;       <span class="enscript-comment">/* Cache line size */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>
	<span class="enscript-type">const</span> <span class="enscript-type">char</span>	*description;   <span class="enscript-comment">/* Cache description */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL */</span>
} cpuid_cache_desc_t;  

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">CACHE_DESC</span>(value,type,size,linesize,text) \
	{ value, type, size, linesize, text }
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">CACHE_DESC</span>(value,type,size,linesize,text) \
	{ value, type, size, linesize }
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL */</span>

<span class="enscript-comment">/* Monitor/mwait Leaf: */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
	uint32_t	linesize_min;
	uint32_t	linesize_max;
	uint32_t	extensions;
	uint32_t	sub_Cstates;
} cpuid_mwait_leaf_t;

<span class="enscript-comment">/* Thermal and Power Management Leaf: */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
	boolean_t	sensor;
	boolean_t	dynamic_acceleration;
	boolean_t	invariant_APIC_timer;
	boolean_t	core_power_limits;
	boolean_t	fine_grain_clock_mod;
	boolean_t	package_thermal_intr;
	uint32_t	thresholds;
	boolean_t	ACNT_MCNT;
	boolean_t	hardware_feedback;
	boolean_t	energy_policy;
} cpuid_thermal_leaf_t;


<span class="enscript-comment">/* XSAVE Feature Leaf: */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
	uint32_t	extended_state[4];	<span class="enscript-comment">/* eax .. edx */</span>
} cpuid_xsave_leaf_t;


<span class="enscript-comment">/* Architectural Performance Monitoring Leaf: */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
	uint8_t		version;
	uint8_t		number;
	uint8_t		width;
	uint8_t		events_number;
	uint32_t	events;
	uint8_t		fixed_number;
	uint8_t		fixed_width;
} cpuid_arch_perf_leaf_t;

<span class="enscript-comment">/* Physical CPU info - this is exported out of the kernel (kexts), so be wary of changes */</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
	<span class="enscript-type">char</span>		cpuid_vendor[16];
	<span class="enscript-type">char</span>		cpuid_brand_string[48];
	<span class="enscript-type">const</span> <span class="enscript-type">char</span>	*cpuid_model_string;

	cpu_type_t	cpuid_type;	<span class="enscript-comment">/* this is *not* a cpu_type_t in our &lt;mach/machine.h&gt; */</span>
	uint8_t		cpuid_family;
	uint8_t		cpuid_model;
	uint8_t		cpuid_extmodel;
	uint8_t		cpuid_extfamily;
	uint8_t		cpuid_stepping;
	uint64_t	cpuid_features;
	uint64_t	cpuid_extfeatures;
	uint32_t	cpuid_signature;
	uint8_t   	cpuid_brand; 
	uint8_t		cpuid_processor_flag;
	
	uint32_t	cache_size[LCACHE_MAX];
	uint32_t	cache_linesize;

	uint8_t		cache_info[64];    <span class="enscript-comment">/* list of cache descriptors */</span>

	uint32_t	cpuid_cores_per_package;
	uint32_t	cpuid_logical_per_package;
	uint32_t	cache_sharing[LCACHE_MAX];
	uint32_t	cache_partitions[LCACHE_MAX];

	cpu_type_t	cpuid_cpu_type;			<span class="enscript-comment">/* &lt;mach/machine.h&gt; */</span>
	cpu_subtype_t	cpuid_cpu_subtype;		<span class="enscript-comment">/* &lt;mach/machine.h&gt; */</span>	

	<span class="enscript-comment">/* Per-vendor info */</span>
	cpuid_mwait_leaf_t	cpuid_mwait_leaf;	
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">cpuid_mwait_linesize_max</span>	cpuid_mwait_leaf.linesize_max
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">cpuid_mwait_linesize_min</span>	cpuid_mwait_leaf.linesize_min
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">cpuid_mwait_extensions</span>		cpuid_mwait_leaf.extensions
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">cpuid_mwait_sub_Cstates</span>		cpuid_mwait_leaf.sub_Cstates
	cpuid_thermal_leaf_t	cpuid_thermal_leaf;
	cpuid_arch_perf_leaf_t	cpuid_arch_perf_leaf;
	uint32_t	unused[4];			<span class="enscript-comment">/* cpuid_xsave_leaf */</span>

	<span class="enscript-comment">/* Cache details: */</span>
	uint32_t	cpuid_cache_linesize;
	uint32_t	cpuid_cache_L2_associativity;
	uint32_t	cpuid_cache_size;

	<span class="enscript-comment">/* Virtual and physical address aize: */</span>
	uint32_t	cpuid_address_bits_physical;
	uint32_t	cpuid_address_bits_virtual;

	uint32_t	cpuid_microcode_version;

	<span class="enscript-comment">/* Numbers of tlbs per processor [i|d, small|large, level0|level1] */</span>
	uint32_t	cpuid_tlb[2][2][2];
			#define	TLB_INST	0
			#define	TLB_DATA	1
			#define	TLB_SMALL	0
			#define	TLB_LARGE	1
	uint32_t	cpuid_stlb;

	uint32_t	core_count;
	uint32_t	thread_count;

	<span class="enscript-comment">/* Max leaf ids available from CPUID */</span>
	uint32_t	cpuid_max_basic;
	uint32_t	cpuid_max_ext;

	<span class="enscript-comment">/* Family-specific info links */</span>
	uint32_t		cpuid_cpufamily;
	cpuid_mwait_leaf_t	*cpuid_mwait_leafp;	
	cpuid_thermal_leaf_t	*cpuid_thermal_leafp;
	cpuid_arch_perf_leaf_t	*cpuid_arch_perf_leafp;
	cpuid_xsave_leaf_t	*cpuid_xsave_leafp;
	uint64_t		cpuid_leaf7_features;
	cpuid_xsave_leaf_t	cpuid_xsave_leaf[2];
} i386_cpu_info_t;

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">MACH_KERNEL_PRIVATE</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> {
	<span class="enscript-type">char</span>		cpuid_vmm_vendor[16];
	uint32_t	cpuid_vmm_family;
	uint32_t	cpuid_vmm_bus_frequency;
	uint32_t	cpuid_vmm_tsc_frequency;
} i386_vmm_info_t;
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__cplusplus</span>
<span class="enscript-type">extern</span> <span class="enscript-string">&quot;C&quot;</span> {
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">/*
 * External declarations
 */</span>
<span class="enscript-type">extern</span> cpu_type_t	cpuid_cputype(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> cpu_subtype_t	cpuid_cpusubtype(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>		cpuid_cpu_display(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>		cpuid_feature_display(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>		cpuid_extfeature_display(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *);
<span class="enscript-type">extern</span> <span class="enscript-type">char</span> *		cpuid_get_feature_names(uint64_t, <span class="enscript-type">char</span> *, <span class="enscript-type">unsigned</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">char</span> *		cpuid_get_extfeature_names(uint64_t, <span class="enscript-type">char</span> *, <span class="enscript-type">unsigned</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">char</span> *		cpuid_get_leaf7_feature_names(uint64_t, <span class="enscript-type">char</span> *, <span class="enscript-type">unsigned</span>);

<span class="enscript-type">extern</span> uint64_t		cpuid_features(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> uint64_t		cpuid_extfeatures(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> uint64_t		cpuid_leaf7_features(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> uint32_t		cpuid_family(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> uint32_t		cpuid_cpufamily(<span class="enscript-type">void</span>);
	
<span class="enscript-type">extern</span> i386_cpu_info_t	*cpuid_info(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>		cpuid_set_info(<span class="enscript-type">void</span>);

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">MACH_KERNEL_PRIVATE</span>
<span class="enscript-type">extern</span> boolean_t	cpuid_vmm_present(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> i386_vmm_info_t	*cpuid_vmm_info(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> uint32_t		cpuid_vmm_family(<span class="enscript-type">void</span>);
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__cplusplus</span>
}
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* ASSEMBLER */</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* __APPLE_API_PRIVATE */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* _MACHINE_CPUID_H_ */</span>
</pre>
<hr />
</body></html>