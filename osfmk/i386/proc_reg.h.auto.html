<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>proc_reg.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">proc_reg.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000-2012 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*
 * @OSF_COPYRIGHT@
 */</span>
<span class="enscript-comment">/* CMU_ENDHIST */</span>
<span class="enscript-comment">/* 
 * Mach Operating System
 * Copyright (c) 1991,1990 Carnegie Mellon University
 * All Rights Reserved.
 * 
 * Permission to use, copy, modify and distribute this software and its
 * documentation is hereby granted, provided that both the copyright
 * notice and this permission notice appear in all copies of the
 * software, derivative works or modified versions, and any portions
 * thereof, and that both notices appear in supporting documentation.
 * 
 * CARNEGIE MELLON ALLOWS FREE USE OF THIS SOFTWARE IN ITS &quot;AS IS&quot;
 * CONDITION.  CARNEGIE MELLON DISCLAIMS ANY LIABILITY OF ANY KIND FOR
 * ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.
 * 
 * Carnegie Mellon requests users of this software to return to
 * 
 *  Software Distribution Coordinator  or  <a href="mailto:Software.Distribution@CS.CMU.EDU">Software.Distribution@CS.CMU.EDU</a>
 *  School of Computer Science
 *  Carnegie Mellon University
 *  Pittsburgh PA 15213-3890
 * 
 * any improvements or extensions that they make and grant Carnegie Mellon
 * the rights to redistribute these changes.
 */</span>

<span class="enscript-comment">/*
 */</span>

<span class="enscript-comment">/*
 * Processor registers for i386 and i486.
 */</span>
#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">_I386_PROC_REG_H_</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_I386_PROC_REG_H_</span>

<span class="enscript-comment">/*
 * Model Specific Registers
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_TSC</span>		0x10	<span class="enscript-comment">/* Time Stamp Register */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR</span>		0x11	<span class="enscript-comment">/* Control and Event Select Register */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CTR0</span>		0x12	<span class="enscript-comment">/* Counter #0 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CTR1</span>		0x13	<span class="enscript-comment">/* Counter #1 */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_PC</span>		0x0200	<span class="enscript-comment">/* Pin Control */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_CC</span>		0x01C0	<span class="enscript-comment">/* Counter Control mask */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES</span>		0x003F	<span class="enscript-comment">/* Event Control mask */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_SHIFT</span>	16		<span class="enscript-comment">/* Shift to get Counter 1 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_MASK</span>	(MSR_P5_CESR_PC|\
				 MSR_P5_CESR_CC|\
				 MSR_P5_CESR_ES) <span class="enscript-comment">/* Mask Counter */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_CC_CLOCK</span>	0x0100	<span class="enscript-comment">/* Clock Counting (otherwise Event) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_CC_DISABLE</span>	0x0000	<span class="enscript-comment">/* Disable counter */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_CC_CPL012</span>	0x0040	<span class="enscript-comment">/* Count if the CPL == 0, 1, 2 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_CC_CPL3</span>	0x0080	<span class="enscript-comment">/* Count if the CPL == 3 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_CC_CPL</span>	0x00C0	<span class="enscript-comment">/* Count regardless of the CPL */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_DATA_READ</span>       0x000000	<span class="enscript-comment">/* Data Read */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_DATA_WRITE</span>      0x000001	<span class="enscript-comment">/* Data Write */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_DATA_RW</span>	       0x101000	<span class="enscript-comment">/* Data Read or Write */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_DATA_TLB_MISS</span>   0x000010	<span class="enscript-comment">/* Data TLB Miss */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_DATA_READ_MISS</span>  0x000011	<span class="enscript-comment">/* Data Read Miss */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_DATA_WRITE_MISS</span> 0x000100	<span class="enscript-comment">/* Data Write Miss */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_DATA_RW_MISS</span>    0x101001	<span class="enscript-comment">/* Data Read or Write Miss */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_HIT_EM</span>	       0x000101	<span class="enscript-comment">/* Write (hit) to M|E state */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_DATA_CACHE_WB</span>   0x000110	<span class="enscript-comment">/* Cache lines written back */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_EXTERNAL_SNOOP</span>  0x000111	<span class="enscript-comment">/* External Snoop */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_CACHE_SNOOP_HIT</span> 0x001000	<span class="enscript-comment">/* Data cache snoop hits */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_MEM_ACCESS_PIPE</span> 0x001001	<span class="enscript-comment">/* Mem. access in both pipes */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_BANK_CONFLICTS</span>  0x001010	<span class="enscript-comment">/* Bank conflicts */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_MISALIGNED</span>      0x001011	<span class="enscript-comment">/* Misaligned Memory or I/O */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_CODE_READ</span>       0x001100	<span class="enscript-comment">/* Code Read */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_CODE_TLB_MISS</span>   0x001101	<span class="enscript-comment">/* Code TLB miss */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_CODE_CACHE_MISS</span> 0x001110	<span class="enscript-comment">/* Code Cache miss */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_SEGMENT_LOADED</span>  0x001111	<span class="enscript-comment">/* Any segment reg. loaded */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_BRANCHE</span>	       0x010010	<span class="enscript-comment">/* Branches */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_BTB_HIT</span>	       0x010011	<span class="enscript-comment">/* BTB Hits */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_BRANCHE_BTB</span>     0x010100	<span class="enscript-comment">/* Taken branch or BTB Hit */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_PIPELINE_FLUSH</span>  0x010101	<span class="enscript-comment">/* Pipeline Flushes */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_INSTRUCTION</span>     0x010110	<span class="enscript-comment">/* Instruction executed */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_INSTRUCTION_V</span>   0x010111	<span class="enscript-comment">/* Inst. executed (v-pipe) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_BUS_CYCLE</span>       0x011000	<span class="enscript-comment">/* Clocks while bus cycle */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_FULL_WRITE_BUF</span>  0x011001	<span class="enscript-comment">/* Clocks while full wrt buf. */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_DATA_MEM_READ</span>   0x011010	<span class="enscript-comment">/* Pipeline waiting for read */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_WRITE_EM</span>        0x011011	<span class="enscript-comment">/* Stall on write E|M state */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_LOCKED_CYCLE</span>    0x011100	<span class="enscript-comment">/* Locked bus cycles */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_IO_CYCLE</span>	       0x011101	<span class="enscript-comment">/* I/O Read or Write cycles */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_NON_CACHEABLE</span>   0x011110	<span class="enscript-comment">/* Non-cacheable Mem. read */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_AGI</span>	       0x011111	<span class="enscript-comment">/* Stall because of AGI */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_FLOP</span>	       0x100010	<span class="enscript-comment">/* Floating Point operations */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_BREAK_DR0</span>       0x100011	<span class="enscript-comment">/* Breakpoint matches on DR0 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_BREAK_DR1</span>       0x100100	<span class="enscript-comment">/* Breakpoint matches on DR1 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_BREAK_DR2</span>       0x100101	<span class="enscript-comment">/* Breakpoint matches on DR2 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_BREAK_DR3</span>       0x100110	<span class="enscript-comment">/* Breakpoint matches on DR3 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_P5_CESR_ES_HARDWARE_IT</span>     0x100111	<span class="enscript-comment">/* Hardware interrupts */</span>

<span class="enscript-comment">/*
 * CR0
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CR0_PG</span>	0x80000000	<span class="enscript-comment">/*	 Enable paging */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CR0_CD</span>	0x40000000	<span class="enscript-comment">/* i486: Cache disable */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CR0_NW</span>	0x20000000	<span class="enscript-comment">/* i486: No write-through */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CR0_AM</span>	0x00040000	<span class="enscript-comment">/* i486: Alignment check mask */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CR0_WP</span>	0x00010000	<span class="enscript-comment">/* i486: Write-protect kernel access */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CR0_NE</span>	0x00000020	<span class="enscript-comment">/* i486: Handle numeric exceptions */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CR0_ET</span>	0x00000010	<span class="enscript-comment">/*	 Extension type is 80387 */</span>
				<span class="enscript-comment">/*	 (not official) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CR0_TS</span>	0x00000008	<span class="enscript-comment">/*	 Task switch */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CR0_EM</span>	0x00000004	<span class="enscript-comment">/*	 Emulate coprocessor */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CR0_MP</span>	0x00000002	<span class="enscript-comment">/*	 Monitor coprocessor */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CR0_PE</span>	0x00000001	<span class="enscript-comment">/*	 Enable protected mode */</span>

<span class="enscript-comment">/*
 * CR4
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CR4_SMAP</span>	0x00200000	<span class="enscript-comment">/* Supervisor-Mode Access Protect */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CR4_SMEP</span>	0x00100000	<span class="enscript-comment">/* Supervisor-Mode Execute Protect */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CR4_OSXSAVE</span>	0x00040000	<span class="enscript-comment">/* OS supports XSAVE */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CR4_PCIDE</span>	0x00020000	<span class="enscript-comment">/* PCID Enable */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CR4_RDWRFSGS</span>	0x00010000	<span class="enscript-comment">/* RDWRFSGS Enable */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CR4_SMXE</span>	0x00004000	<span class="enscript-comment">/* Enable SMX operation */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CR4_VMXE</span>	0x00002000	<span class="enscript-comment">/* Enable VMX operation */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CR4_OSXMM</span>	0x00000400	<span class="enscript-comment">/* SSE/SSE2 exception support in OS */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CR4_OSFXS</span>	0x00000200	<span class="enscript-comment">/* SSE/SSE2 OS supports FXSave */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CR4_PCE</span>		0x00000100	<span class="enscript-comment">/* Performance-Monitor Count Enable */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CR4_PGE</span>		0x00000080	<span class="enscript-comment">/* Page Global Enable */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CR4_MCE</span>		0x00000040	<span class="enscript-comment">/* Machine Check Exceptions */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">CR4_PAE</span>		0x00000020	<span class="enscript-comment">/* Physical Address Extensions */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CR4_PSE</span>		0x00000010	<span class="enscript-comment">/* Page Size Extensions */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CR4_DE</span>		0x00000008	<span class="enscript-comment">/* Debugging Extensions */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CR4_TSD</span>		0x00000004	<span class="enscript-comment">/* Time Stamp Disable */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CR4_PVI</span>		0x00000002	<span class="enscript-comment">/* Protected-mode Virtual Interrupts */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">CR4_VME</span>		0x00000001	<span class="enscript-comment">/* Virtual-8086 Mode Extensions */</span>

<span class="enscript-comment">/*
 * XCR0 - XFEATURE_ENABLED_MASK (a.k.a. XFEM) register
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">XCR0_X87</span> 	(1ULL &lt;&lt; 0)	<span class="enscript-comment">/* x87, FPU/MMX (always set) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">XCR0_SSE</span>	(1ULL &lt;&lt; 1)	<span class="enscript-comment">/* SSE supported by XSAVE/XRESTORE */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">XCR0_YMM</span>	(1ULL &lt;&lt; 2)	<span class="enscript-comment">/* YMM state available */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">XFEM_X87</span>	XCR0_X87
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">XFEM_SSE</span>	XCR0_SSE
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">XFEM_YMM</span>	XCR0_YMM
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">XCR0</span> (0)

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PMAP_PCID_PRESERVE</span> (1ULL &lt;&lt; 63)
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PMAP_PCID_MASK</span> (0xFFF)

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">ASSEMBLER</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/cdefs.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;stdint.h&gt;</span>

__BEGIN_DECLS

#<span class="enscript-reference">define</span>	<span class="enscript-function-name">set_ts</span>() set_cr0(get_cr0() | CR0_TS)

<span class="enscript-type">static</span> inline uint16_t <span class="enscript-function-name">get_es</span>(<span class="enscript-type">void</span>)
{
	uint16_t es;
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;mov %%es, %0&quot;</span> : <span class="enscript-string">&quot;=r&quot;</span> (es));
	<span class="enscript-keyword">return</span> es;
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">set_es</span>(uint16_t es)
{
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;mov %0, %%es&quot;</span> : : <span class="enscript-string">&quot;r&quot;</span> (es));
}

<span class="enscript-type">static</span> inline uint16_t <span class="enscript-function-name">get_ds</span>(<span class="enscript-type">void</span>)
{
	uint16_t ds;
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;mov %%ds, %0&quot;</span> : <span class="enscript-string">&quot;=r&quot;</span> (ds));
	<span class="enscript-keyword">return</span> ds;
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">set_ds</span>(uint16_t ds)
{
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;mov %0, %%ds&quot;</span> : : <span class="enscript-string">&quot;r&quot;</span> (ds));
}

<span class="enscript-type">static</span> inline uint16_t <span class="enscript-function-name">get_fs</span>(<span class="enscript-type">void</span>)
{
	uint16_t fs;
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;mov %%fs, %0&quot;</span> : <span class="enscript-string">&quot;=r&quot;</span> (fs));
	<span class="enscript-keyword">return</span> fs;
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">set_fs</span>(uint16_t fs)
{
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;mov %0, %%fs&quot;</span> : : <span class="enscript-string">&quot;r&quot;</span> (fs));
}

<span class="enscript-type">static</span> inline uint16_t <span class="enscript-function-name">get_gs</span>(<span class="enscript-type">void</span>)
{
	uint16_t gs;
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;mov %%gs, %0&quot;</span> : <span class="enscript-string">&quot;=r&quot;</span> (gs));
	<span class="enscript-keyword">return</span> gs;
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">set_gs</span>(uint16_t gs)
{
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;mov %0, %%gs&quot;</span> : : <span class="enscript-string">&quot;r&quot;</span> (gs));
}

<span class="enscript-type">static</span> inline uint16_t <span class="enscript-function-name">get_ss</span>(<span class="enscript-type">void</span>)
{
	uint16_t ss;
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;mov %%ss, %0&quot;</span> : <span class="enscript-string">&quot;=r&quot;</span> (ss));
	<span class="enscript-keyword">return</span> ss;
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">set_ss</span>(uint16_t ss)
{
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;mov %0, %%ss&quot;</span> : : <span class="enscript-string">&quot;r&quot;</span> (ss));
}

<span class="enscript-type">static</span> inline uintptr_t <span class="enscript-function-name">get_cr0</span>(<span class="enscript-type">void</span>)
{
	uintptr_t cr0; 
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;mov %%cr0, %0&quot;</span> : <span class="enscript-string">&quot;=r&quot;</span> (cr0));
	<span class="enscript-keyword">return</span>(cr0);
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">set_cr0</span>(uintptr_t value)
{
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;mov %0, %%cr0&quot;</span> : : <span class="enscript-string">&quot;r&quot;</span> (value));
}

<span class="enscript-type">static</span> inline uintptr_t <span class="enscript-function-name">get_cr2</span>(<span class="enscript-type">void</span>)
{
	uintptr_t cr2;
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;mov %%cr2, %0&quot;</span> : <span class="enscript-string">&quot;=r&quot;</span> (cr2));
	<span class="enscript-keyword">return</span>(cr2);
}

<span class="enscript-type">static</span> inline uintptr_t <span class="enscript-function-name">get_cr3_raw</span>(<span class="enscript-type">void</span>)
{
	uintptr_t cr3;
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;mov %%cr3, %0&quot;</span> : <span class="enscript-string">&quot;=r&quot;</span> (cr3));
	<span class="enscript-keyword">return</span>(cr3);
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">set_cr3_raw</span>(uintptr_t value)
{
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;mov %0, %%cr3&quot;</span> : : <span class="enscript-string">&quot;r&quot;</span> (value));
}

<span class="enscript-type">static</span> inline uintptr_t <span class="enscript-function-name">get_cr3_base</span>(<span class="enscript-type">void</span>)
{
	uintptr_t cr3;
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;mov %%cr3, %0&quot;</span> : <span class="enscript-string">&quot;=r&quot;</span> (cr3));
	<span class="enscript-keyword">return</span>(cr3 &amp; ~(0xFFFULL));
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">set_cr3_composed</span>(uintptr_t base, uint16_t pcid, uint32_t preserve)
{
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;mov %0, %%cr3&quot;</span> : : <span class="enscript-string">&quot;r&quot;</span> (base | pcid | ( ( (uint64_t)preserve) &lt;&lt; 63) ) );
}

<span class="enscript-type">static</span> inline uintptr_t <span class="enscript-function-name">get_cr4</span>(<span class="enscript-type">void</span>)
{
	uintptr_t cr4;
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;mov %%cr4, %0&quot;</span> : <span class="enscript-string">&quot;=r&quot;</span> (cr4));
	<span class="enscript-keyword">return</span>(cr4);
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">set_cr4</span>(uintptr_t value)
{
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;mov %0, %%cr4&quot;</span> : : <span class="enscript-string">&quot;r&quot;</span> (value));
}

<span class="enscript-type">static</span> inline uintptr_t <span class="enscript-function-name">x86_get_flags</span>(<span class="enscript-type">void</span>)
{
	uintptr_t erflags;
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;pushf; pop	%0&quot;</span> :  <span class="enscript-string">&quot;=r&quot;</span> (erflags));
	<span class="enscript-keyword">return</span> erflags;
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">clear_ts</span>(<span class="enscript-type">void</span>)
{
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;clts&quot;</span>);
}

<span class="enscript-type">static</span> inline <span class="enscript-type">unsigned</span> <span class="enscript-type">short</span> <span class="enscript-function-name">get_tr</span>(<span class="enscript-type">void</span>)
{
	<span class="enscript-type">unsigned</span> <span class="enscript-type">short</span> seg; 
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;str %0&quot;</span> : <span class="enscript-string">&quot;=rm&quot;</span> (seg));
	<span class="enscript-keyword">return</span>(seg);
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">set_tr</span>(<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> seg)
{
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;ltr %0&quot;</span> : : <span class="enscript-string">&quot;rm&quot;</span> ((<span class="enscript-type">unsigned</span> <span class="enscript-type">short</span>)(seg)));
}

<span class="enscript-type">static</span> inline <span class="enscript-type">unsigned</span> <span class="enscript-type">short</span> <span class="enscript-function-name">sldt</span>(<span class="enscript-type">void</span>)
{
	<span class="enscript-type">unsigned</span> <span class="enscript-type">short</span> seg;
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;sldt %0&quot;</span> : <span class="enscript-string">&quot;=rm&quot;</span> (seg));
	<span class="enscript-keyword">return</span>(seg);
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">lldt</span>(<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> seg)
{
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;lldt %0&quot;</span> : : <span class="enscript-string">&quot;rm&quot;</span> ((<span class="enscript-type">unsigned</span> <span class="enscript-type">short</span>)(seg)));
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">lgdt</span>(uintptr_t *desc)
{
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;lgdt %0&quot;</span> : : <span class="enscript-string">&quot;m&quot;</span> (*desc));
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">lidt</span>(uintptr_t *desc)
{
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;lidt %0&quot;</span> : : <span class="enscript-string">&quot;m&quot;</span> (*desc));
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">swapgs</span>(<span class="enscript-type">void</span>)
{
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;swapgs&quot;</span>);
}

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">MACH_KERNEL_PRIVATE</span>

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">flush_tlb_raw</span>(<span class="enscript-type">void</span>)
{
	set_cr3_raw(get_cr3_raw());
}
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">rdmsr64_carefully</span>(uint32_t msr, uint64_t *val);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">wrmsr64_carefully</span>(uint32_t msr, uint64_t val);
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* MACH_KERNEL_PRIVATE */</span>

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">wbinvd</span>(<span class="enscript-type">void</span>)
{
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;wbinvd&quot;</span>);
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">invlpg</span>(uintptr_t addr)
{
	__asm__  <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;invlpg (%0)&quot;</span> :: <span class="enscript-string">&quot;r&quot;</span> (addr) : <span class="enscript-string">&quot;memory&quot;</span>);
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">clac</span>(<span class="enscript-type">void</span>)
{
	__asm__  <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;clac&quot;</span>);
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">stac</span>(<span class="enscript-type">void</span>)
{
	__asm__  <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;stac&quot;</span>);
}

<span class="enscript-comment">/*
 * Access to machine-specific registers (available on 586 and better only)
 * Note: the rd* operations modify the parameters directly (without using
 * pointer indirection), this allows gcc to optimize better
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">rdmsr</span>(msr,lo,hi) \
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;rdmsr&quot;</span> : <span class="enscript-string">&quot;=a&quot;</span> (lo), <span class="enscript-string">&quot;=d&quot;</span> (hi) : <span class="enscript-string">&quot;c&quot;</span> (msr))

#<span class="enscript-reference">define</span> <span class="enscript-function-name">wrmsr</span>(msr,lo,hi) \
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;wrmsr&quot;</span> : : <span class="enscript-string">&quot;c&quot;</span> (msr), <span class="enscript-string">&quot;a&quot;</span> (lo), <span class="enscript-string">&quot;d&quot;</span> (hi))

#<span class="enscript-reference">define</span> <span class="enscript-function-name">rdtsc</span>(lo,hi) \
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;lfence; rdtsc; lfence&quot;</span> : <span class="enscript-string">&quot;=a&quot;</span> (lo), <span class="enscript-string">&quot;=d&quot;</span> (hi))

#<span class="enscript-reference">define</span> <span class="enscript-function-name">rdtsc_nofence</span>(lo,hi) \
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;rdtsc&quot;</span> : <span class="enscript-string">&quot;=a&quot;</span> (lo), <span class="enscript-string">&quot;=d&quot;</span> (hi))

#<span class="enscript-reference">define</span> <span class="enscript-function-name">write_tsc</span>(lo,hi) wrmsr(0x10, lo, hi)

#<span class="enscript-reference">define</span> <span class="enscript-function-name">rdpmc</span>(counter,lo,hi) \
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;rdpmc&quot;</span> : <span class="enscript-string">&quot;=a&quot;</span> (lo), <span class="enscript-string">&quot;=d&quot;</span> (hi) : <span class="enscript-string">&quot;c&quot;</span> (counter))

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">XNU_KERNEL_PRIVATE</span>
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">do_mfence</span>(<span class="enscript-type">void</span>);
#<span class="enscript-reference">define</span> <span class="enscript-function-name">mfence</span>() do_mfence()
#<span class="enscript-reference">endif</span>

<span class="enscript-type">static</span> inline uint64_t <span class="enscript-function-name">rdpmc64</span>(uint32_t pmc)
{
	uint32_t lo=0, hi=0;
	rdpmc(pmc, lo, hi);
	<span class="enscript-keyword">return</span> (((uint64_t)hi) &lt;&lt; 32) | ((uint64_t)lo);
}

<span class="enscript-type">static</span> inline uint64_t <span class="enscript-function-name">rdmsr64</span>(uint32_t msr)
{
	uint32_t lo=0, hi=0;
	rdmsr(msr, lo, hi);
	<span class="enscript-keyword">return</span> (((uint64_t)hi) &lt;&lt; 32) | ((uint64_t)lo);
}

<span class="enscript-type">static</span> inline <span class="enscript-type">void</span> <span class="enscript-function-name">wrmsr64</span>(uint32_t msr, uint64_t val)
{
	wrmsr(msr, (val &amp; 0xFFFFFFFFUL), ((val &gt;&gt; 32) &amp; 0xFFFFFFFFUL));
}

<span class="enscript-type">static</span> inline uint64_t <span class="enscript-function-name">rdtsc64</span>(<span class="enscript-type">void</span>)
{
	uint64_t lo, hi;
	rdtsc(lo, hi);
	<span class="enscript-keyword">return</span> ((hi) &lt;&lt; 32) | (lo);
}

<span class="enscript-type">static</span> inline uint64_t <span class="enscript-function-name">rdtscp64</span>(uint32_t *aux)
{
	uint64_t lo, hi;
	__asm__ <span class="enscript-type">volatile</span>(<span class="enscript-string">&quot;rdtscp; mov %%ecx, %1&quot;</span>
					 : <span class="enscript-string">&quot;=a&quot;</span> (lo), <span class="enscript-string">&quot;=d&quot;</span> (hi), <span class="enscript-string">&quot;=m&quot;</span> (*aux)
					 :
					 : <span class="enscript-string">&quot;ecx&quot;</span>);
	<span class="enscript-keyword">return</span> ((hi) &lt;&lt; 32) | (lo);
}


<span class="enscript-comment">/*
 * rdmsr_carefully() returns 0 when the MSR has been read successfully,
 * or non-zero (1) if the MSR does not exist.
 * The implementation is in locore.s.
 */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">rdmsr_carefully</span>(uint32_t msr, uint32_t *lo, uint32_t *hi);
__END_DECLS

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* ASSEMBLER */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_P5_MC_ADDR</span>			0
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_P5_MC_TYPE</span>			1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PLATFORM_ID</span>			0x17
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_EBL_CR_POWERON</span>			0x2a

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_APIC_BASE</span>			0x1b
#<span class="enscript-reference">define</span>     <span class="enscript-variable-name">MSR_IA32_APIC_BASE_BSP</span>		    (1&lt;&lt;8)
#<span class="enscript-reference">define</span>     <span class="enscript-variable-name">MSR_IA32_APIC_BASE_EXTENDED</span>		    (1&lt;&lt;10)
#<span class="enscript-reference">define</span>     <span class="enscript-variable-name">MSR_IA32_APIC_BASE_ENABLE</span>		    (1&lt;&lt;11)
#<span class="enscript-reference">define</span>     <span class="enscript-variable-name">MSR_IA32_APIC_BASE_BASE</span>		    (0xfffff&lt;&lt;12)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_CORE_THREAD_COUNT</span>			0x35

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_FEATURE_CONTROL</span>		0x3a
#<span class="enscript-reference">define</span>     <span class="enscript-variable-name">MSR_IA32_FEATCTL_LOCK</span>		    (1&lt;&lt;0)
#<span class="enscript-reference">define</span>     <span class="enscript-variable-name">MSR_IA32_FEATCTL_VMXON_SMX</span>		    (1&lt;&lt;1)
#<span class="enscript-reference">define</span>     <span class="enscript-variable-name">MSR_IA32_FEATCTL_VMXON</span>		    (1&lt;&lt;2)
#<span class="enscript-reference">define</span>     <span class="enscript-variable-name">MSR_IA32_FEATCTL_CSTATE_SMI</span>		    (1&lt;&lt;16)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_UPDT_TRIG</span>			0x79
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_BIOS_SIGN_ID</span>			0x8b
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_UCODE_WRITE</span>			MSR_IA32_UPDT_TRIG
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_UCODE_REV</span>			MSR_IA32_BIOS_SIGN_ID

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PERFCTR0</span>			0xc1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PERFCTR1</span>			0xc2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PERFCTR3</span>			0xc3
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PERFCTR4</span>			0xc4

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_PLATFORM_INFO</span>			0xce

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MPERF</span>				0xE7
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_APERF</span>				0xE8

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_BBL_CR_CTL</span>			0x119

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_SYSENTER_CS</span>			0x174
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_SYSENTER_ESP</span>			0x175
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_SYSENTER_EIP</span>			0x176

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MCG_CAP</span>			0x179
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MCG_STATUS</span>			0x17a
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MCG_CTL</span>			0x17b

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_EVNTSEL0</span>			0x186
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_EVNTSEL1</span>			0x187
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_EVNTSEL2</span>			0x188
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_EVNTSEL3</span>			0x189

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_FLEX_RATIO</span>				0x194
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PERF_STS</span>			0x198
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PERF_CTL</span>			0x199
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_CLOCK_MODULATION</span>		0x19a

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MISC_ENABLE</span>			0x1a0


#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PACKAGE_THERM_STATUS</span>		0x1b1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PACKAGE_THERM_INTERRUPT</span>	0x1b2

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_DEBUGCTLMSR</span>			0x1d9
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_LASTBRANCHFROMIP</span>		0x1db
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_LASTBRANCHTOIP</span>			0x1dc
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_LASTINTFROMIP</span>			0x1dd
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_LASTINTTOIP</span>			0x1de

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_CR_PAT</span> 			0x277	

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MTRRCAP</span>			0xfe
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MTRR_DEF_TYPE</span>			0x2ff
#<span class="enscript-reference">define</span> <span class="enscript-function-name">MSR_IA32_MTRR_PHYSBASE</span>(n)		(0x200 + 2*(n))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">MSR_IA32_MTRR_PHYSMASK</span>(n)		(0x200 + 2*(n) + 1)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MTRR_FIX64K_00000</span>		0x250
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MTRR_FIX16K_80000</span>		0x258
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MTRR_FIX16K_A0000</span>		0x259
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MTRR_FIX4K_C0000</span>		0x268
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MTRR_FIX4K_C8000</span>		0x269
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MTRR_FIX4K_D0000</span>		0x26a
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MTRR_FIX4K_D8000</span>		0x26b
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MTRR_FIX4K_E0000</span>		0x26c
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MTRR_FIX4K_E8000</span>		0x26d
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MTRR_FIX4K_F0000</span>		0x26e
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MTRR_FIX4K_F8000</span>		0x26f

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PERF_FIXED_CTR0</span>		0x309

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PERF_FIXED_CTR_CTRL</span>		0x38D
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PERF_GLOBAL_STATUS</span>		0x38E
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PERF_GLOBAL_CTRL</span>		0x38F
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PERF_GLOBAL_OVF_CTRL</span>	0x390

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PKG_C3_RESIDENCY</span>		0x3F8
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PKG_C6_RESIDENCY</span>		0x3F9
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PKG_C7_RESIDENCY</span>		0x3FA

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_CORE_C3_RESIDENCY</span> 		0x3FC
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_CORE_C6_RESIDENCY</span> 		0x3FD
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_CORE_C7_RESIDENCY</span> 		0x3FE

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MC0_CTL</span>			0x400
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MC0_STATUS</span>			0x401
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MC0_ADDR</span>			0x402
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_MC0_MISC</span>			0x403

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_VMX_BASE</span>					0x480
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_VMX_BASIC</span>					MSR_IA32_VMX_BASE
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_VMX_PINBASED_CTLS</span>			MSR_IA32_VMX_BASE+1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_VMX_PROCBASED_CTLS</span>			MSR_IA32_VMX_BASE+2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_VMX_EXIT_CTLS</span>				MSR_IA32_VMX_BASE+3
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_VMX_ENTRY_CTLS</span>				MSR_IA32_VMX_BASE+4
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_VMX_MISC</span>					MSR_IA32_VMX_BASE+5
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_VMX_CR0_FIXED0</span>				MSR_IA32_VMX_BASE+6
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_VMX_CR0_FIXED1</span>				MSR_IA32_VMX_BASE+7
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_VMX_CR4_FIXED0</span>				MSR_IA32_VMX_BASE+8
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_VMX_CR4_FIXED1</span>				MSR_IA32_VMX_BASE+9
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_VMX_VMCS_ENUM</span>				MSR_IA32_VMX_BASE+10
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_VMX_PROCBASED_CTLS2</span>		MSR_IA32_VMX_BASE+11
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_VMX_EPT_VPID_CAP</span>			MSR_IA32_VMX_BASE+12
#<span class="enscript-reference">define</span>		<span class="enscript-variable-name">MSR_IA32_VMX_EPT_VPID_CAP_AD_SHIFT</span>	21
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_VMX_TRUE_PINBASED_CTLS</span>		MSR_IA32_VMX_BASE+13
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_VMX_TRUE_PROCBASED_CTLS</span>	MSR_IA32_VMX_BASE+14
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_VMX_TRUE_VMEXIT_CTLS</span>		MSR_IA32_VMX_BASE+15
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_VMX_TRUE_VMENTRY_CTLS</span>		MSR_IA32_VMX_BASE+16
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_VMX_VMFUNC</span>					MSR_IA32_VMX_BASE+17

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_DS_AREA</span>			0x600

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PKG_POWER_SKU_UNIT</span>		0x606
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PKG_C2_RESIDENCY</span>		0x60D
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PKG_ENERGY_STATUS</span>		0x611
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_DDR_ENERGY_STATUS</span>		0x619
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_LLC_FLUSHED_RESIDENCY_TIMER</span>	0x61D
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_RING_PERF_STATUS</span>		0x621

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PKG_C8_RESIDENCY</span>		0x630
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PKG_C9_RESIDENCY</span>		0x631
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PKG_C10_RESIDENCY</span>		0x632

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PP0_ENERGY_STATUS</span>		0x639
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_PP1_ENERGY_STATUS</span>		0x641

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_IA_PERF_LIMIT_REASONS</span>		0x690
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_GT_PERF_LIMIT_REASONS</span>		0x6B0

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_TSC_DEADLINE</span>			0x6e0

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_IA32_EFER</span>				0xC0000080
#<span class="enscript-reference">define</span>	    <span class="enscript-variable-name">MSR_IA32_EFER_SCE</span>			    0x00000001
#<span class="enscript-reference">define</span>	    <span class="enscript-variable-name">MSR_IA32_EFER_LME</span>			    0x00000100
#<span class="enscript-reference">define</span>	    <span class="enscript-variable-name">MSR_IA32_EFER_LMA</span>			    0x00000400
#<span class="enscript-reference">define</span>     <span class="enscript-variable-name">MSR_IA32_EFER_NXE</span>			    0x00000800

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_IA32_STAR</span>				0xC0000081
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_IA32_LSTAR</span>				0xC0000082
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_IA32_CSTAR</span>				0xC0000083
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MSR_IA32_FMASK</span>				0xC0000084

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_FS_BASE</span>			0xC0000100
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_GS_BASE</span>			0xC0000101
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_KERNEL_GS_BASE</span>			0xC0000102
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MSR_IA32_TSC_AUX</span>			0xC0000103

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* _I386_PROC_REG_H_ */</span>
</pre>
<hr />
</body></html>