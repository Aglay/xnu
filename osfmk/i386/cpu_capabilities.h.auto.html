<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>cpu_capabilities.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">cpu_capabilities.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2003-2009 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">PRIVATE</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_I386_CPU_CAPABILITIES_H</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_I386_CPU_CAPABILITIES_H</span>

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">__ASSEMBLER__</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;stdint.h&gt;</span>
#<span class="enscript-reference">endif</span>
 
<span class="enscript-comment">/*
 * This API only supported for Apple internal use.
 */</span>

<span class="enscript-comment">/* Bit definitions for _cpu_capabilities: */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kHasMMX</span>				0x00000001
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kHasSSE</span>				0x00000002
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kHasSSE2</span>			0x00000004
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kHasSSE3</span>			0x00000008
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kCache32</span>			0x00000010	<span class="enscript-comment">/* cache line size is 32 bytes */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kCache64</span>			0x00000020
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kCache128</span>			0x00000040
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kFastThreadLocalStorage</span>		0x00000080	<span class="enscript-comment">/* TLS ptr is kept in a user-mode-readable register */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kHasSupplementalSSE3</span>		0x00000100
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">k64Bit</span>				0x00000200	<span class="enscript-comment">/* processor supports EM64T (not what mode you're running in) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kHasSSE4_1</span>			0x00000400
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kHasSSE4_2</span>			0x00000800
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kHasAES</span>				0x00001000
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kInOrderPipeline</span>		0x00002000
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kSlow</span>				0x00004000	<span class="enscript-comment">/* tsc &lt; nanosecond */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kUP</span>				0x00008000	<span class="enscript-comment">/* set if (kNumCPUs == 1) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kNumCPUs</span>			0x00FF0000	<span class="enscript-comment">/* number of CPUs (see _NumCPUs() below) */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kNumCPUsShift</span>			16
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kHasAVX1_0</span>			0x01000000
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kHasRDRAND</span>			0x02000000
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kHasF16C</span>			0x04000000
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kHasENFSTRG</span>			0x08000000
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kHasFMA</span>				0x10000000
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kHasAVX2_0</span>			0x20000000
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kHasBMI1</span>			0x40000000
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kHasBMI2</span>			0x80000000
<span class="enscript-comment">/* Extending into 64-bits from here: */</span> 
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kHasRTM</span>			0x0000000100000000ULL
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kHasHLE</span>			0x0000000200000000ULL
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kHasRDSEED</span>		0x0000000800000000ULL
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">kHasADX</span>			0x0000000400000000ULL


#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">__ASSEMBLER__</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/cdefs.h&gt;</span>

__BEGIN_DECLS
<span class="enscript-type">extern</span> uint64_t  <span class="enscript-function-name">_get_cpu_capabilities</span>( <span class="enscript-type">void</span> );
__END_DECLS

inline <span class="enscript-type">static</span>
<span class="enscript-type">int</span> <span class="enscript-function-name">_NumCPUs</span>( <span class="enscript-type">void</span> )
{
	<span class="enscript-keyword">return</span> (<span class="enscript-type">int</span>) (_get_cpu_capabilities() &amp; kNumCPUs) &gt;&gt; kNumCPUsShift;
}

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* __ASSEMBLER__ */</span>

<span class="enscript-comment">/* The following macro is used to generate the 64-bit commpage address for a given
 * routine, based on its 32-bit address.  This is used in the kernel to compile
 * the 64-bit commpage.  Since the kernel can be a 32-bit object, cpu_capabilities.h
 * only defines the 32-bit address.
 */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-function-name">_COMM_PAGE_32_TO_64</span>( ADDRESS )	( ADDRESS + _COMM_PAGE64_START_ADDRESS - _COMM_PAGE32_START_ADDRESS )


<span class="enscript-comment">/*
 * The shared kernel/user &quot;comm page(s)&quot;:
 *
 * The last several pages of every address space are reserved for the kernel/user
 * &quot;comm area&quot;. During system initialization, the kernel populates the comm pages with
 * code customized for the particular processor and platform.
 *
 * Because Mach VM cannot map the last page of an address space, we don't use it.
 */</span>
 
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_COMM_PAGE32_AREA_LENGTH</span>	( 1 * 4096 )				<span class="enscript-comment">/* reserved length of entire comm area */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE32_BASE_ADDRESS</span>	( 0xffff0000 )				<span class="enscript-comment">/* base address of allocated memory */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE32_START_ADDRESS</span>	( _COMM_PAGE32_BASE_ADDRESS )	<span class="enscript-comment">/* address traditional commpage code starts on */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE32_AREA_USED</span>		( 1 * 4096 )				<span class="enscript-comment">/* this is the amt actually allocated */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE32_SIGS_OFFSET</span>	0x8000					    <span class="enscript-comment">/* offset to routine signatures */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_COMM_PAGE64_AREA_LENGTH</span>	( 1 * 4096 )			<span class="enscript-comment">/* reserved length of entire comm area (2MB) */</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__ASSEMBLER__</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE64_BASE_ADDRESS</span>	( 0x00007fffffe00000 )   <span class="enscript-comment">/* base address of allocated memory */</span>
#<span class="enscript-reference">else</span> <span class="enscript-comment">/* __ASSEMBLER__ */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE64_BASE_ADDRESS</span>	( 0x00007fffffe00000ULL )   <span class="enscript-comment">/* base address of allocated memory */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* __ASSEMBLER__ */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE64_START_ADDRESS</span>	( _COMM_PAGE64_BASE_ADDRESS )	<span class="enscript-comment">/* address traditional commpage code starts on */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE64_AREA_USED</span>		( 1 * 4096 )				<span class="enscript-comment">/* this is the amt actually populated */</span>

<span class="enscript-comment">/* no need for an Objective-C area on Intel */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE32_OBJC_SIZE</span>		0ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE32_OBJC_BASE</span>		0ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE64_OBJC_SIZE</span>		0ULL
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE64_OBJC_BASE</span>		0ULL

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL_PRIVATE</span>

<span class="enscript-comment">/* Inside the kernel, comm page addresses are absolute addresses
 * assuming they are a part of the 32-bit commpage. They may
 * be mapped somewhere else, especially for the 64-bit commpage.
 */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_START_ADDRESS</span>	_COMM_PAGE32_START_ADDRESS
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_SIGS_OFFSET</span>		_COMM_PAGE32_SIGS_OFFSET

#<span class="enscript-reference">else</span> <span class="enscript-comment">/* !KERNEL_PRIVATE */</span>

#<span class="enscript-reference">if</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__i386__</span>)

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_COMM_PAGE_AREA_LENGTH</span>		_COMM_PAGE32_AREA_LENGTH
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_BASE_ADDRESS</span>		_COMM_PAGE32_BASE_ADDRESS
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_START_ADDRESS</span>	_COMM_PAGE32_START_ADDRESS
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_AREA_USED</span>		_COMM_PAGE32_AREA_USED
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_SIGS_OFFSET</span>		_COMM_PAGE32_SIGS_OFFSET

#<span class="enscript-reference">elif</span> <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__x86_64__</span>)

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_COMM_PAGE_AREA_LENGTH</span>		_COMM_PAGE64_AREA_LENGTH
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_BASE_ADDRESS</span>		_COMM_PAGE64_BASE_ADDRESS
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_START_ADDRESS</span>	_COMM_PAGE64_START_ADDRESS
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_AREA_USED</span>		_COMM_PAGE64_AREA_USED

#<span class="enscript-reference">else</span>
#<span class="enscript-reference">error</span> <span class="enscript-variable-name">architecture</span> <span class="enscript-variable-name">not</span> <span class="enscript-variable-name">supported</span>
#<span class="enscript-reference">endif</span>
 
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* !KERNEL_PRIVATE */</span>

<span class="enscript-comment">/* data in the comm page */</span>
 
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_SIGNATURE</span>		(_COMM_PAGE_START_ADDRESS+0x000)	<span class="enscript-comment">/* first 16 bytes are a signature */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_SIGNATURELEN</span>		(0x10)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_CPU_CAPABILITIES64</span>	(_COMM_PAGE_START_ADDRESS+0x010)	<span class="enscript-comment">/* uint64_t _cpu_capabilities */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_UNUSED</span>		(_COMM_PAGE_START_ADDRESS+0x018)	<span class="enscript-comment">/* 6 unused bytes */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_VERSION</span>		(_COMM_PAGE_START_ADDRESS+0x01E)	<span class="enscript-comment">/* 16-bit version# */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_THIS_VERSION</span>		13					<span class="enscript-comment">/* in ver 13, _COMM_PAGE_NT_SHIFT defaults to 0 (was 32) */</span>
  
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_CPU_CAPABILITIES</span>	(_COMM_PAGE_START_ADDRESS+0x020)	<span class="enscript-comment">/* uint32_t _cpu_capabilities (retained for compatibility) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_NCPUS</span>		(_COMM_PAGE_START_ADDRESS+0x022)	<span class="enscript-comment">/* uint8_t number of configured CPUs (hw.logicalcpu at boot time) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_UNUSED0</span>		(_COMM_PAGE_START_ADDRESS+0x024)	<span class="enscript-comment">/* 2 unused bytes, previouly reserved for expansion of cpu_capabilities */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_CACHE_LINESIZE</span>	(_COMM_PAGE_START_ADDRESS+0x026)	<span class="enscript-comment">/* uint16_t cache line size */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_SCHED_GEN</span>		(_COMM_PAGE_START_ADDRESS+0x028)	<span class="enscript-comment">/* uint32_t scheduler generation number (count of pre-emptions) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_MEMORY_PRESSURE</span>	(_COMM_PAGE_START_ADDRESS+0x02c)	<span class="enscript-comment">/* uint32_t copy of vm_memory_pressure */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_COMM_PAGE_SPIN_COUNT</span>		(_COMM_PAGE_START_ADDRESS+0x030)	<span class="enscript-comment">/* uint32_t max spin count for mutex's */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_ACTIVE_CPUS</span>		(_COMM_PAGE_START_ADDRESS+0x034)	<span class="enscript-comment">/* uint8_t number of active CPUs (hw.activecpu) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_PHYSICAL_CPUS</span>	(_COMM_PAGE_START_ADDRESS+0x035)	<span class="enscript-comment">/* uint8_t number of physical CPUs (hw.physicalcpu_max) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_LOGICAL_CPUS</span>	(_COMM_PAGE_START_ADDRESS+0x036)	<span class="enscript-comment">/* uint8_t number of logical CPUs (hw.logicalcpu_max) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_UNUSED1</span>		(_COMM_PAGE_START_ADDRESS+0x037)	<span class="enscript-comment">/* 1 unused bytes */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_MEMORY_SIZE</span>		(_COMM_PAGE_START_ADDRESS+0x038)	<span class="enscript-comment">/* uint64_t max memory size */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_CPUFAMILY</span>		(_COMM_PAGE_START_ADDRESS+0x040)	<span class="enscript-comment">/* uint32_t hw.cpufamily, x86*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_KDEBUG_ENABLE</span>	(_COMM_PAGE_START_ADDRESS+0x044)	<span class="enscript-comment">/* uint32_t export &quot;kdebug_enable&quot; to userspace */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_COMM_PAGE_ATM_DIAGNOSTIC_CONFIG</span>	(_COMM_PAGE_START_ADDRESS+0x48) <span class="enscript-comment">/* uint32_t export &quot;atm_diagnostic_config&quot; to userspace */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_UNUSED2</span>		(_COMM_PAGE_START_ADDRESS+0x04C)	<span class="enscript-comment">/* [0x4C,0x50) unused */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_COMM_PAGE_TIME_DATA_START</span>	(_COMM_PAGE_START_ADDRESS+0x050)	<span class="enscript-comment">/* base of offsets below (_NT_SCALE etc) */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_NT_TSC_BASE</span>		(_COMM_PAGE_START_ADDRESS+0x050)	<span class="enscript-comment">/* used by nanotime() */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_NT_SCALE</span>		(_COMM_PAGE_START_ADDRESS+0x058)	<span class="enscript-comment">/* used by nanotime() */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_NT_SHIFT</span>		(_COMM_PAGE_START_ADDRESS+0x05c)	<span class="enscript-comment">/* used by nanotime() */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_NT_NS_BASE</span>		(_COMM_PAGE_START_ADDRESS+0x060)	<span class="enscript-comment">/* used by nanotime() */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_NT_GENERATION</span>	(_COMM_PAGE_START_ADDRESS+0x068)	<span class="enscript-comment">/* used by nanotime() */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_GTOD_GENERATION</span>	(_COMM_PAGE_START_ADDRESS+0x06c)	<span class="enscript-comment">/* used by gettimeofday() */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_GTOD_NS_BASE</span>		(_COMM_PAGE_START_ADDRESS+0x070)	<span class="enscript-comment">/* used by gettimeofday() */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_GTOD_SEC_BASE</span>	(_COMM_PAGE_START_ADDRESS+0x078)	<span class="enscript-comment">/* used by gettimeofday() */</span>
<span class="enscript-comment">/* NOTE: APPROX_TIME must be aligned to 64-byte cache line size: */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_APPROX_TIME</span>		(_COMM_PAGE_START_ADDRESS+0x080)	<span class="enscript-comment">/* used by mach_approximate_time() */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_APPROX_TIME_SUPPORTED</span> (_COMM_PAGE_START_ADDRESS+0x088)	<span class="enscript-comment">/* used by mach_approximate_time() */</span>


#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_END</span>			(_COMM_PAGE_START_ADDRESS+0xfff)	<span class="enscript-comment">/* end of common page */</span>

<span class="enscript-comment">/* Warning: kernel commpage.h has a matching c typedef for the following.  They must be kept in sync.  */</span>
<span class="enscript-comment">/* These offsets are from _COMM_PAGE_TIME_DATA_START */</span>

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_NT_TSC_BASE</span>			0
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_NT_SCALE</span>			8
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_NT_SHIFT</span>			12
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_NT_NS_BASE</span>			16
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_NT_GENERATION</span>			24
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_GTOD_GENERATION</span>		28
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_GTOD_NS_BASE</span>			32
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_GTOD_SEC_BASE</span>			40
 
 <span class="enscript-comment">/* jump table (jmp to this address, which may be a branch to the actual code somewhere else) */</span>
 <span class="enscript-comment">/* When new jump table entries are added, corresponding symbols should be added below        */</span>
 <span class="enscript-comment">/* New slots should be allocated with at least 16-byte alignment. Some like bcopy require    */</span>
 <span class="enscript-comment">/* 32-byte alignment, and should be aligned as such in the assembly source before they are relocated */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_TEXT_START</span>		(_COMM_PAGE_START_ADDRESS+0x1000)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE32_TEXT_START</span>         (_COMM_PAGE32_BASE_ADDRESS+0x1000)    <span class="enscript-comment">/* start of text section */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE64_TEXT_START</span>		(_COMM_PAGE64_BASE_ADDRESS+0x1000)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_TEXT_AREA_USED</span>	( 1 * 4096 )
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_TEXT_AREA_LENGTH</span>	( 1 * 4096 )
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_PFZ32_SLIDE_RANGE</span>		( 14 ) <span class="enscript-comment">/* pages between 0xfffff000 and _COMM_PAGE32_TEXT_START */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_PFZ64_SLIDE_RANGE</span>		( 510 ) <span class="enscript-comment">/* pages between 0x00007ffffffff000 and _COMM_PAGE64_TEXT_START */</span>

<span class="enscript-comment">/* setup start offset in the commpage text region for each jump table entry 
 * the Comm Page Offset is shortened to _COMM_TEXT_[label]_OFFSET
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_TEXT_PREEMPT_OFFSET</span>		(0x5a0)	<span class="enscript-comment">/* called from withing pfz */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_TEXT_BACKOFF_OFFSET</span>		(0x600)	<span class="enscript-comment">/* called from PFZ */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_TEXT_PFZ_START_OFFSET</span>		(0xc00)	<span class="enscript-comment">/* offset for Preemption Free Zone */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_TEXT_PFZ_ENQUEUE_OFFSET</span>		(0xc00)	<span class="enscript-comment">/* internal FIFO enqueue */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_TEXT_PFZ_DEQUEUE_OFFSET</span>		(0xc80)	<span class="enscript-comment">/* internal FIFO dequeue */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_TEXT_UNUSED_OFFSET</span>		(0xd80)	<span class="enscript-comment">/* end of routines in text page */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_TEXT_PFZ_END_OFFSET</span>		(0xfff)	<span class="enscript-comment">/* offset for end of PFZ */</span>


#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_PREEMPT</span>		(_COMM_PAGE_TEXT_START+_COMM_TEXT_PREEMPT_OFFSET)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_BACKOFF</span>		(_COMM_PAGE_TEXT_START+_COMM_TEXT_BACKOFF_OFFSET)	

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_PFZ_START</span>		(_COMM_PAGE_TEXT_START+_COMM_PAGE_PFZ_START_OFFSET)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_PFZ_ENQUEUE</span>		(_COMM_PAGE_TEXT_START+_COMM_TEXT_PFZ_ENQUEUE_OFFSET)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_PFZ_DEQUEUE</span>		(_COMM_PAGE_TEXT_START+_COMM_TEXT_PFZ_DEQUEUE_OFFSET)

#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">_COMM_PAGE_UNUSED6</span>		(_COMM_PAGE_TEXT_START+_COMM_TEXT_UNUSED_OFFSET)	
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_PFZ_END</span>		(_COMM_PAGE_TEXT_START+_COMM_TEXT_PFZ_END_OFFSET)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_TEXT_END</span>		(_COMM_PAGE_TEXT_START+_COMM_TEXT_PFZ_END_OFFSET) <span class="enscript-comment">/* end of common text page */</span>

<span class="enscript-comment">/* _COMM_PAGE_COMPARE_AND_SWAP{32,64}B are not used on x86 and are
 * maintained here for source compatability.  These will be removed at
 * some point, so don't go relying on them. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_COMPARE_AND_SWAP32B</span>  (_COMM_PAGE_START_ADDRESS+0xf80)	<span class="enscript-comment">/* compare-and-swap word w barrier */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_COMM_PAGE_COMPARE_AND_SWAP64B</span>  (_COMM_PAGE_START_ADDRESS+0xfc0)	<span class="enscript-comment">/* compare-and-swap doubleword w barrier */</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__ASSEMBLER__</span>
#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__COMM_PAGE_SYMBOLS</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">CREATE_COMM_PAGE_SYMBOL</span>(symbol_name, symbol_address)		\
				.org	(symbol_address - (_COMM_PAGE_START_ADDRESS &amp; 0xFFFFE000)) ;\
<span class="enscript-reference">symbol_name</span>: nop

	.text		<span class="enscript-comment">/* Required to make a well behaved symbol file */</span>

	CREATE_COMM_PAGE_SYMBOL(___preempt, _COMM_PAGE_PREEMPT)
	CREATE_COMM_PAGE_SYMBOL(___backoff, _COMM_PAGE_BACKOFF)
	CREATE_COMM_PAGE_SYMBOL(___pfz_enqueue, _COMM_PAGE_PFZ_ENQUEUE)
	CREATE_COMM_PAGE_SYMBOL(___pfz_dequeue, _COMM_PAGE_PFZ_DEQUEUE)
	CREATE_COMM_PAGE_SYMBOL(___end_comm_page, _COMM_PAGE_END)

	.data		<span class="enscript-comment">/* Required to make a well behaved symbol file */</span>
	.<span class="enscript-type">long</span>	0	<span class="enscript-comment">/* Required to make a well behaved symbol file */</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* __COMM_PAGE_SYMBOLS */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* __ASSEMBLER__ */</span>

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* _I386_CPU_CAPABILITIES_H */</span>
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* PRIVATE */</span>
</pre>
<hr />
</body></html>