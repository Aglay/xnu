<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>exc_resource.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">exc_resource.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2011-2012 Apple Computer, Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/* 
 * Mach Operating System
 * Copyright (c) 1989 Carnegie-Mellon University
 * Copyright (c) 1988 Carnegie-Mellon University
 * Copyright (c) 1987 Carnegie-Mellon University
 * All rights reserved.  The CMU software License Agreement specifies
 * the terms and conditions for use and redistribution.
 */</span>

<span class="enscript-comment">/*
 *        EXC_RESOURCE related macros, namespace etc.
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">_EXC_RESOURCE_H_</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_EXC_RESOURCE_H_</span>

<span class="enscript-comment">/*
 * Generic exception code format:
 *
 * code:
 * +----------------------------------------------------------+
 * |[63:61] type | [60:58] flavor | [57:0] type-specific data |
 * +----------------------------------------------------------+
 */</span>


<span class="enscript-comment">/* EXC_RESOURCE type and flavor decoding routines */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">EXC_RESOURCE_DECODE_RESOURCE_TYPE</span>(code) \
	(((code) &gt;&gt; 61) &amp; 0x7ULL)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">EXC_RESOURCE_DECODE_FLAVOR</span>(code) \
	(((code) &gt;&gt; 58) &amp; 0x7ULL)

<span class="enscript-comment">/* EXC_RESOURCE Types */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">RESOURCE_TYPE_CPU</span>	1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">RESOURCE_TYPE_WAKEUPS</span>	2
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">RESOURCE_TYPE_MEMORY</span>	3

<span class="enscript-comment">/* RESOURCE_TYPE_CPU flavors */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">FLAVOR_CPU_MONITOR</span>		1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">FLAVOR_CPU_MONITOR_FATAL</span>	2

<span class="enscript-comment">/*
 * RESOURCE_TYPE_CPU exception code &amp; subcode.
 *
 * This is sent by the kernel when the CPU usage monitor
 * is tripped. [See proc_set_cpumon_params()]
 *
 * code:
 * +-----------------------------------------------+
 * |[63:61] RESOURCE |[60:58] FLAVOR_CPU_ |[57:32] |
 * |_TYPE_CPU        |MONITOR[_FATAL]     |Unused  |
 * +-----------------------------------------------+
 * |[31:7]  Interval (sec)    | [6:0] CPU limit (%)|
 * +-----------------------------------------------+
 *
 * subcode:
 * +-----------------------------------------------+
 * |                          | [6:0] % of CPU     |
 * |                          | actually consumed  |
 * +-----------------------------------------------+
 *
 */</span>

<span class="enscript-comment">/* RESOURCE_TYPE_CPU decoding macros */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">EXC_RESOURCE_CPUMONITOR_DECODE_INTERVAL</span>(code) \
	(((code) &gt;&gt; 7) &amp; 0x1FFFFFFULL)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">EXC_RESOURCE_CPUMONITOR_DECODE_PERCENTAGE</span>(code) \
	((code) &amp; 0x7FULL)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">EXC_RESOURCE_CPUMONITOR_DECODE_PERCENTAGE_OBSERVED</span>(subcode) \
	((subcode) &amp; 0x7FULL)


<span class="enscript-comment">/* RESOURCE_TYPE_WAKEUPS flavors */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">FLAVOR_WAKEUPS_MONITOR</span>	1

<span class="enscript-comment">/*
 * RESOURCE_TYPE_WAKEUPS exception code &amp; subcode.
 *
 * This is sent by the kernel when the platform idle
 * wakeups monitor is tripped.
 * [See proc_set_wakeupsmon_params()]
 *
 * code:
 * +-----------------------------------------------+
 * |[63:61] RESOURCE |[60:58] FLAVOR_     |[57:32] |
 * |_TYPE_WAKEUPS    |WAKEUPS_MONITOR     |Unused  |
 * +-----------------------------------------------+
 * | [31:20] Observation     | [19:0] # of wakeups |
 * |         interval (sec)  | permitted (per sec) |
 * +-----------------------------------------------+
 *
 * subcode:
 * +-----------------------------------------------+
 * |                         | [19:0] # of wakeups |
 * |                         | observed (per sec)  |
 * +-----------------------------------------------+
 *
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">EXC_RESOURCE_CPUMONITOR_DECODE_WAKEUPS_PERMITTED</span>(code) \
	((code) &amp; 0xFFFULL)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">EXC_RESOURCE_CPUMONITOR_DECODE_OBSERVATION_INTERVAL</span>(code) \
	(((code) &gt;&gt; 20) &amp; 0xFFFFFULL)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">EXC_RESOURCE_CPUMONITOR_DECODE_WAKEUPS_OBSERVED</span>(subcode) \
	((subcode) &amp; 0xFFFFFULL)

<span class="enscript-comment">/* RESOURCE_TYPE_MEMORY flavors */</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">FLAVOR_HIGH_WATERMARK</span>	1

<span class="enscript-comment">/*
 * RESOURCE_TYPE_MEMORY / FLAVOR_HIGH_WATERMARK
 * exception code &amp; subcode.
 *
 * This is sent by the kernel when a task crosses its high
 * watermark memory limit.
 *
 * code:
 * +------------------------------------------------+
 * |[63:61] RESOURCE |[60:58] FLAVOR_HIGH_ |[57:32] |
 * |_TYPE_MEMORY     |WATERMARK            |Unused  |
 * +------------------------------------------------+
 * |                         | [12:0] HWM limit (MB)|
 * +------------------------------------------------+
 *
 * subcode:
 * +------------------------------------------------+
 * |                                         unused |
 * +------------------------------------------------+
 *
 */</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">EXC_RESOURCE_HWM_DECODE_LIMIT</span>(code) \
	((code) &amp; 0x1FFFULL)


#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">KERNEL</span>

<span class="enscript-comment">/* EXC_RESOURCE type and flavor encoding macros */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">EXC_RESOURCE_ENCODE_TYPE</span>(code, type) \
	((code) |= (((uint64_t)(type) &amp; 0x7ULL) &lt;&lt; 61))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">EXC_RESOURCE_ENCODE_FLAVOR</span>(code, flavor) \
	((code) |= (((uint64_t)(flavor) &amp; 0x7ULL) &lt;&lt; 58))

<span class="enscript-comment">/* RESOURCE_TYPE_CPU::FLAVOR_CPU_MONITOR specific encoding macros */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">EXC_RESOURCE_CPUMONITOR_ENCODE_INTERVAL</span>(code, interval) \
	((code) |= (((uint64_t)(interval) &amp; 0x1FFFFFFULL) &lt;&lt; 7))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">EXC_RESOURCE_CPUMONITOR_ENCODE_PERCENTAGE</span>(code, percentage) \
	((code) |= (((uint64_t)(percentage) &amp; 0x7FULL)))

<span class="enscript-comment">/* RESOURCE_TYPE_WAKEUPS::FLAVOR_WAKEUPS_MONITOR specific encoding macros */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">EXC_RESOURCE_CPUMONITOR_ENCODE_WAKEUPS_PERMITTED</span>(code, num) \
	((code) |= ((uint64_t)(num) &amp; 0xFFFFFULL))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">EXC_RESOURCE_CPUMONITOR_ENCODE_OBSERVATION_INTERVAL</span>(code, num) \
	((code) |= (((uint64_t)(num) &amp; 0xFFFULL) &lt;&lt; 20))
#<span class="enscript-reference">define</span> <span class="enscript-function-name">EXC_RESOURCE_CPUMONITOR_ENCODE_WAKEUPS_OBSERVED</span>(subcode, num) \
	((subcode) |= ((uint64_t)(num) &amp; 0xFFFFFULL))

<span class="enscript-comment">/* RESOURCE_TYPE_MEMORY::FLAVOR_HIGH_WATERMARK specific encoding macros */</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">EXC_RESOURCE_HWM_ENCODE_LIMIT</span>(code, num) \
	((code) |= ((uint64_t)(num) &amp; 0x1FFFULL))

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* KERNEL */</span>


#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* _EXC_RESOURCE_H_ */</span>
</pre>
<hr />
</body></html>