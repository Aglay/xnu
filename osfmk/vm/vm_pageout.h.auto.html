<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>vm_pageout.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">vm_pageout.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2000-2009 Apple Inc. All rights reserved.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 * 
 * Please obtain a copy of the License at
 * <a href="http://www.opensource.apple.com/apsl/">http://www.opensource.apple.com/apsl/</a> and read it before using this file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */</span>
<span class="enscript-comment">/*
 * @OSF_COPYRIGHT@
 */</span>
<span class="enscript-comment">/* 
 * Mach Operating System
 * Copyright (c) 1991,1990,1989,1988,1987 Carnegie Mellon University
 * All Rights Reserved.
 * 
 * Permission to use, copy, modify and distribute this software and its
 * documentation is hereby granted, provided that both the copyright
 * notice and this permission notice appear in all copies of the
 * software, derivative works or modified versions, and any portions
 * thereof, and that both notices appear in supporting documentation.
 * 
 * CARNEGIE MELLON ALLOWS FREE USE OF THIS SOFTWARE IN ITS &quot;AS IS&quot;
 * CONDITION.  CARNEGIE MELLON DISCLAIMS ANY LIABILITY OF ANY KIND FOR
 * ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.
 * 
 * Carnegie Mellon requests users of this software to return to
 * 
 *  Software Distribution Coordinator  or  <a href="mailto:Software.Distribution@CS.CMU.EDU">Software.Distribution@CS.CMU.EDU</a>
 *  School of Computer Science
 *  Carnegie Mellon University
 *  Pittsburgh PA 15213-3890
 * 
 * any improvements or extensions that they make and grant Carnegie Mellon
 * the rights to redistribute these changes.
 */</span>
<span class="enscript-comment">/*
 */</span>
<span class="enscript-comment">/*
 *	File:	vm/vm_pageout.h
 *	Author:	Avadis Tevanian, Jr.
 *	Date:	1986
 *
 *	Declarations for the pageout daemon interface.
 */</span>

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">_VM_VM_PAGEOUT_H_</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">_VM_VM_PAGEOUT_H_</span>

#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">KERNEL_PRIVATE</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/mach_types.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/boolean.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/machine/vm_types.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;mach/memory_object_types.h&gt;</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;kern/kern_types.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;kern/locks.h&gt;</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;libkern/OSAtomic.h&gt;</span>


#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;vm/vm_options.h&gt;</span>

#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">MACH_KERNEL_PRIVATE</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;vm/vm_page.h&gt;</span>
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;sys/kdebug.h&gt;</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">VM_PAGE_AVAILABLE_COUNT</span>()		((unsigned int)(vm_page_cleaned_count))

<span class="enscript-comment">/* externally manipulated counters */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> vm_pageout_cleaned_reactivated, vm_pageout_cleaned_fault_reactivated, vm_pageout_cleaned_commit_reactivated;

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">CONFIG_FREEZE</span>
<span class="enscript-type">extern</span> boolean_t memorystatus_freeze_enabled;
#<span class="enscript-reference">define</span> <span class="enscript-function-name">VM_DYNAMIC_PAGING_ENABLED</span>(port) (COMPRESSED_PAGER_IS_ACTIVE || DEFAULT_FREEZER_COMPRESSED_PAGER_IS_SWAPBACKED || (memorystatus_freeze_enabled == FALSE &amp;&amp; IP_VALID(port)))
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">VM_DYNAMIC_PAGING_ENABLED</span>(port) (COMPRESSED_PAGER_IS_ACTIVE || IP_VALID(port))
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">VM_PRESSURE_EVENTS</span>
<span class="enscript-type">extern</span> boolean_t vm_pressure_events_enabled;
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* VM_PRESSURE_EVENTS */</span>

<span class="enscript-type">extern</span> <span class="enscript-type">int</span>	vm_debug_events;

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VMF_CHECK_ZFDELAY</span>		0x100
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VMF_COWDELAY</span>			0x101
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VMF_ZFDELAY</span>			0x102
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VMF_COMPRESSORDELAY</span>		0x103

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_PAGEOUT_SCAN</span>			0x104
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_PAGEOUT_BALANCE</span>		0x105
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_PAGEOUT_FREELIST</span>		0x106
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_PAGEOUT_PURGEONE</span>		0x107
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_PAGEOUT_CACHE_EVICT</span>		0x108
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_PAGEOUT_THREAD_BLOCK</span>		0x109
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_PAGEOUT_JETSAM</span>		0x10A

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_UPL_PAGE_WAIT</span>		0x120
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_IOPL_PAGE_WAIT</span>		0x121
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_PAGE_WAIT_BLOCK</span>		0x122

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">CONFIG_IOSCHED</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_PAGE_SLEEP</span>			0x123
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_PAGE_EXPEDITE</span>		0x124
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_PRESSURE_EVENT</span>		0x130
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_EXECVE</span>			0x131
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_WAKEUP_COMPACTOR_SWAPPER</span>	0x132

#<span class="enscript-reference">define</span> <span class="enscript-function-name">VM_DEBUG_EVENT</span>(name, event, control, arg1, arg2, arg3, arg4)	\
	MACRO_BEGIN						\
	<span class="enscript-keyword">if</span> (vm_debug_events) {					\
		KERNEL_DEBUG_CONSTANT((MACHDBG_CODE(DBG_MACH_VM, event)) | control, arg1, arg2, arg3, arg4, 0); \
	}							\
	MACRO_END

#<span class="enscript-reference">define</span> <span class="enscript-function-name">VM_DEBUG_CONSTANT_EVENT</span>(name, event, control, arg1, arg2, arg3, arg4)	\
	MACRO_BEGIN						\
		KERNEL_DEBUG_CONSTANT((MACHDBG_CODE(DBG_MACH_VM, event)) | control, arg1, arg2, arg3, arg4, 0); \
	MACRO_END

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">memoryshot</span>(<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> event, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> control);

<span class="enscript-type">extern</span> kern_return_t <span class="enscript-function-name">vm_map_create_upl</span>(
	vm_map_t		map,
	vm_map_address_t	offset,
	upl_size_t		*upl_size,
	upl_t			*upl,
	upl_page_info_array_t	page_list,
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>		*count,
	upl_control_flags_t	*flags);

<span class="enscript-type">extern</span> ppnum_t <span class="enscript-function-name">upl_get_highest_page</span>(
	upl_t			upl);

<span class="enscript-type">extern</span> upl_size_t <span class="enscript-function-name">upl_get_size</span>(
	upl_t			upl);

<span class="enscript-type">extern</span> upl_t <span class="enscript-function-name">upl_associated_upl</span>(upl_t upl);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">upl_set_associated_upl</span>(upl_t upl, upl_t associated_upl);

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">iopl_valid_data</span>(
	upl_t			upl_ptr);

#<span class="enscript-reference">ifndef</span>	<span class="enscript-variable-name">MACH_KERNEL_PRIVATE</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> vm_page	*vm_page_t;
#<span class="enscript-reference">endif</span>

<span class="enscript-type">extern</span> <span class="enscript-type">void</span>                <span class="enscript-function-name">vm_page_free_list</span>(
                            vm_page_t	mem,
                            boolean_t	prepare_object);

<span class="enscript-type">extern</span> kern_return_t      <span class="enscript-function-name">vm_page_alloc_list</span>(
                            <span class="enscript-type">int</span>         page_count,
                            <span class="enscript-type">int</span>			flags,
                            vm_page_t * list);

<span class="enscript-type">extern</span> <span class="enscript-type">void</span>               <span class="enscript-function-name">vm_page_set_offset</span>(vm_page_t page, vm_object_offset_t offset);
<span class="enscript-type">extern</span> vm_object_offset_t <span class="enscript-function-name">vm_page_get_offset</span>(vm_page_t page);
<span class="enscript-type">extern</span> ppnum_t            <span class="enscript-function-name">vm_page_get_phys_page</span>(vm_page_t page);
<span class="enscript-type">extern</span> vm_page_t          <span class="enscript-function-name">vm_page_get_next</span>(vm_page_t page);

<span class="enscript-type">extern</span> kern_return_t	mach_vm_pressure_level_monitor(boolean_t wait_for_pressure, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> *pressure_level);

#<span class="enscript-reference">ifdef</span>	<span class="enscript-variable-name">MACH_KERNEL_PRIVATE</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;vm/vm_page.h&gt;</span>

<span class="enscript-type">extern</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	vm_pageout_scan_event_counter;
<span class="enscript-type">extern</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	vm_page_anonymous_count;


<span class="enscript-comment">/*
 * must hold the page queues lock to
 * manipulate this structure
 */</span>
<span class="enscript-type">struct</span> vm_pageout_queue {
        queue_head_t	pgo_pending;	<span class="enscript-comment">/* laundry pages to be processed by pager's iothread */</span>
        <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	pgo_laundry;	<span class="enscript-comment">/* current count of laundry pages on queue or in flight */</span>
        <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	pgo_maxlaundry;
	uint64_t	pgo_tid;	<span class="enscript-comment">/* thread ID of I/O thread that services this queue */</span>
	uint8_t		pgo_lowpriority; <span class="enscript-comment">/* iothread is set to use low priority I/O */</span>

        <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	pgo_idle:1,	<span class="enscript-comment">/* iothread is blocked waiting for work to do */</span>
	                <span class="enscript-reference">pgo_busy</span>:1,     <span class="enscript-comment">/* iothread is currently processing request from pgo_pending */</span>
			<span class="enscript-reference">pgo_throttled</span>:1,<span class="enscript-comment">/* vm_pageout_scan thread needs a wakeup when pgo_laundry drops */</span>
		        <span class="enscript-reference">pgo_draining</span>:1,
			<span class="enscript-reference">pgo_inited</span>:1,
			:0;
};

#<span class="enscript-reference">define</span> <span class="enscript-function-name">VM_PAGE_Q_THROTTLED</span>(q)		\
        ((q)-&gt;pgo_laundry &gt;= (q)-&gt;pgo_maxlaundry)

<span class="enscript-type">extern</span> <span class="enscript-type">struct</span>	vm_pageout_queue	vm_pageout_queue_internal;
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span>	vm_pageout_queue	vm_pageout_queue_external;


<span class="enscript-comment">/*
 *	Routines exported to Mach.
 */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">void</span>		vm_pageout(<span class="enscript-type">void</span>);

<span class="enscript-type">extern</span> kern_return_t	vm_pageout_internal_start(<span class="enscript-type">void</span>);

<span class="enscript-type">extern</span> <span class="enscript-type">void</span>		vm_pageout_object_terminate(
					vm_object_t	object);

<span class="enscript-type">extern</span> <span class="enscript-type">int</span>		vm_pageout_cluster(
	                                vm_page_t	m,
					boolean_t	pageout,
					boolean_t	immediate_ok,
					boolean_t	keep_object_locked);

<span class="enscript-type">extern</span> <span class="enscript-type">void</span>		vm_pageout_initialize_page(
					vm_page_t	m);

<span class="enscript-comment">/* UPL exported routines and structures */</span>

#<span class="enscript-reference">define</span> <span class="enscript-function-name">upl_lock_init</span>(object)	lck_mtx_init(&amp;(object)-&gt;Lock, &amp;vm_object_lck_grp, &amp;vm_object_lck_attr)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">upl_lock_destroy</span>(object)	lck_mtx_destroy(&amp;(object)-&gt;Lock, &amp;vm_object_lck_grp)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">upl_lock</span>(object)	lck_mtx_lock(&amp;(object)-&gt;Lock)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">upl_unlock</span>(object)	lck_mtx_unlock(&amp;(object)-&gt;Lock)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">upl_try_lock</span>(object) 	lck_mtx_try_lock(&amp;(object)-&gt;Lock)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MAX_VECTOR_UPL_ELEMENTS</span>	8

<span class="enscript-type">struct</span> _vector_upl_iostates{
	upl_offset_t offset;
	upl_size_t   size;
};

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> _vector_upl_iostates vector_upl_iostates_t;

<span class="enscript-type">struct</span> _vector_upl {
	upl_size_t		size;
	uint32_t		num_upls;
	uint32_t		invalid_upls;
	uint32_t		_reserved;
	vm_map_t		submap;
	vm_offset_t		submap_dst_addr;
	vm_object_offset_t	offset;
	upl_t			upl_elems[MAX_VECTOR_UPL_ELEMENTS];	
	upl_page_info_array_t	pagelist;	
	vector_upl_iostates_t	upl_iostates[MAX_VECTOR_UPL_ELEMENTS]; 
};

<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> _vector_upl* vector_upl_t;

<span class="enscript-comment">/* universal page list structure */</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">UPL_DEBUG</span>
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">UPL_DEBUG_STACK_FRAMES</span>	16
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_DEBUG_COMMIT_RECORDS</span> 4

<span class="enscript-type">struct</span> ucd {
	upl_offset_t	c_beg;
	upl_offset_t	c_end;
	<span class="enscript-type">int</span>		c_aborted;
	<span class="enscript-type">void</span> *		c_retaddr[UPL_DEBUG_STACK_FRAMES];
};
#<span class="enscript-reference">endif</span>


<span class="enscript-type">struct</span> upl {
	decl_lck_mtx_data(,	Lock)	<span class="enscript-comment">/* Synchronization */</span>
	<span class="enscript-type">int</span>		ref_count;
	<span class="enscript-type">int</span>		ext_ref_count;
	<span class="enscript-type">int</span>		flags;
	vm_object_t	src_object; <span class="enscript-comment">/* object derived from */</span>
	vm_object_offset_t offset;
	upl_size_t	size;	    <span class="enscript-comment">/* size in bytes of the address space */</span>
	vm_offset_t	kaddr;      <span class="enscript-comment">/* secondary mapping in kernel */</span>
	vm_object_t	map_object;
	ppnum_t		highest_page;
	<span class="enscript-type">void</span>*		vector_upl;
	upl_t		associated_upl;
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">CONFIG_IOSCHED</span>
	<span class="enscript-type">int</span> 		upl_priority;
	uint64_t        *upl_reprio_info;
	<span class="enscript-type">void</span> 		*decmp_io_upl;
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">CONFIG_IOSCHED</span> || <span class="enscript-variable-name">UPL_DEBUG</span>
	thread_t        upl_creator;
	queue_chain_t	uplq;	    <span class="enscript-comment">/* List of outstanding upls on an obj */</span>
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">if</span>	<span class="enscript-variable-name">UPL_DEBUG</span>
	uintptr_t	ubc_alias1;
	uintptr_t 	ubc_alias2;
		
	uint32_t	upl_state;
	uint32_t	upl_commit_index;
	<span class="enscript-type">void</span>	*upl_create_retaddr[UPL_DEBUG_STACK_FRAMES];

	<span class="enscript-type">struct</span>  ucd	upl_commit_records[UPL_DEBUG_COMMIT_RECORDS];
#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* UPL_DEBUG */</span>
};

<span class="enscript-comment">/* upl struct flags */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_PAGE_LIST_MAPPED</span>	0x1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_KERNEL_MAPPED</span> 	0x2
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">UPL_CLEAR_DIRTY</span>		0x4
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_COMPOSITE_LIST</span>	0x8
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_INTERNAL</span>		0x10
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_PAGE_SYNC_DONE</span>	0x20
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_DEVICE_MEMORY</span>	0x40
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_PAGEOUT</span>		0x80
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_LITE</span>		0x100
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_IO_WIRE</span>		0x200
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_ACCESS_BLOCKED</span>	0x400
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_ENCRYPTED</span>		0x800
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_SHADOWED</span>		0x1000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_KERNEL_OBJECT</span>	0x2000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_VECTOR</span>		0x4000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_SET_DIRTY</span>		0x8000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_HAS_BUSY</span>		0x10000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_TRACKED_BY_OBJECT</span>	0x20000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_EXPEDITE_SUPPORTED</span> 	0x40000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_DECMP_REQ</span> 		0x80000
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_DECMP_REAL_IO</span> 	0x100000

<span class="enscript-comment">/* flags for upl_create flags parameter */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_CREATE_EXTERNAL</span>	0
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_CREATE_INTERNAL</span>	0x1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_CREATE_LITE</span>		0x2
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_CREATE_IO_TRACKING</span>	0x4
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">UPL_CREATE_EXPEDITE_SUP</span> 0x8

<span class="enscript-type">extern</span> upl_t <span class="enscript-function-name">vector_upl_create</span>(vm_offset_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">vector_upl_deallocate</span>(upl_t);
<span class="enscript-type">extern</span> boolean_t <span class="enscript-function-name">vector_upl_is_valid</span>(upl_t);
<span class="enscript-type">extern</span> boolean_t <span class="enscript-function-name">vector_upl_set_subupl</span>(upl_t, upl_t, u_int32_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">vector_upl_set_pagelist</span>(upl_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">vector_upl_set_submap</span>(upl_t, vm_map_t, vm_offset_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">vector_upl_get_submap</span>(upl_t, vm_map_t*, vm_offset_t*);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">vector_upl_set_iostate</span>(upl_t, upl_t, upl_offset_t, upl_size_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">vector_upl_get_iostate</span>(upl_t, upl_t, upl_offset_t*, upl_size_t*);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">vector_upl_get_iostate_byindex</span>(upl_t, uint32_t, upl_offset_t*, upl_size_t*);
<span class="enscript-type">extern</span> upl_t <span class="enscript-function-name">vector_upl_subupl_byindex</span>(upl_t , uint32_t);
<span class="enscript-type">extern</span> upl_t <span class="enscript-function-name">vector_upl_subupl_byoffset</span>(upl_t , upl_offset_t*, upl_size_t*);

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">vm_object_set_pmap_cache_attr</span>(
		vm_object_t		object,
		upl_page_info_array_t	user_page_list,
		<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>		num_pages,
		boolean_t		batch_pmap_op);

<span class="enscript-type">extern</span> kern_return_t <span class="enscript-function-name">vm_object_iopl_request</span>(
	vm_object_t		object,
	vm_object_offset_t	offset,
	upl_size_t		size,
	upl_t			*upl_ptr,
	upl_page_info_array_t	user_page_list,
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>		*page_list_count,
	upl_control_flags_t	cntrl_flags);

<span class="enscript-type">extern</span> kern_return_t <span class="enscript-function-name">vm_object_super_upl_request</span>(
	vm_object_t		object,
	vm_object_offset_t	offset,
	upl_size_t		size,
	upl_size_t		super_cluster,
	upl_t			*upl,
	upl_page_info_t		*user_page_list,
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>		*page_list_count,
	upl_control_flags_t	cntrl_flags);

<span class="enscript-comment">/* should be just a regular vm_map_enter() */</span>
<span class="enscript-type">extern</span> kern_return_t <span class="enscript-function-name">vm_map_enter_upl</span>(
	vm_map_t		map, 
	upl_t			upl, 
	vm_map_offset_t		*dst_addr);

<span class="enscript-comment">/* should be just a regular vm_map_remove() */</span>
<span class="enscript-type">extern</span> kern_return_t <span class="enscript-function-name">vm_map_remove_upl</span>(
	vm_map_t		map, 
	upl_t			upl);

<span class="enscript-comment">/* wired  page list structure */</span>
<span class="enscript-type">typedef</span> uint32_t *wpl_array_t;

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">vm_page_free_reserve</span>(<span class="enscript-type">int</span> pages);

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">vm_pageout_throttle_down</span>(vm_page_t page);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">vm_pageout_throttle_up</span>(vm_page_t page);

<span class="enscript-comment">/*
 * ENCRYPTED SWAP:
 */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">upl_encrypt</span>(
	upl_t			upl,
	upl_offset_t		crypt_offset,
	upl_size_t		crypt_size);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">vm_page_encrypt</span>(
	vm_page_t		page,
	vm_map_offset_t		kernel_map_offset);
<span class="enscript-type">extern</span> boolean_t vm_pages_encrypted; <span class="enscript-comment">/* are there encrypted pages ? */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">vm_page_decrypt</span>(
	vm_page_t		page,
	vm_map_offset_t		kernel_map_offset);
<span class="enscript-type">extern</span> kern_return_t <span class="enscript-function-name">vm_paging_map_object</span>(
	vm_page_t		page,
	vm_object_t		object,
	vm_object_offset_t	offset,
	vm_prot_t		protection,
	boolean_t		can_unlock_object,
	vm_map_size_t		*size,		<span class="enscript-comment">/* IN/OUT */</span>
	vm_map_offset_t		*address,	<span class="enscript-comment">/* OUT */</span>
	boolean_t		*need_unmap);	<span class="enscript-comment">/* OUT */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">vm_paging_unmap_object</span>(
	vm_object_t		object,
	vm_map_offset_t		start,
	vm_map_offset_t		end);
<span class="enscript-function-name">decl_simple_lock_data</span>(<span class="enscript-type">extern</span>, vm_paging_lock)

<span class="enscript-comment">/*
 * Backing store throttle when BS is exhausted
 */</span>
<span class="enscript-type">extern</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>    vm_backing_store_low;

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">vm_pageout_steal_laundry</span>(
	vm_page_t page, 
	boolean_t queues_locked);
	
<span class="enscript-type">extern</span> boolean_t <span class="enscript-function-name">vm_page_is_slideable</span>(vm_page_t m);

<span class="enscript-type">extern</span> kern_return_t <span class="enscript-function-name">vm_page_slide</span>(vm_page_t page, vm_map_offset_t kernel_mapping_offset);
#<span class="enscript-reference">endif</span>  <span class="enscript-comment">/* MACH_KERNEL_PRIVATE */</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">UPL_DEBUG</span>
<span class="enscript-type">extern</span> kern_return_t  <span class="enscript-function-name">upl_ubc_alias_set</span>(
	upl_t upl,
	uintptr_t alias1,
	uintptr_t alias2);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>  <span class="enscript-function-name">upl_ubc_alias_get</span>(
	upl_t upl,
	uintptr_t * al,
	uintptr_t * al2);
#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* UPL_DEBUG */</span>

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">vm_countdirtypages</span>(<span class="enscript-type">void</span>);

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">vm_backing_store_disable</span>(
			boolean_t	suspend);

<span class="enscript-type">extern</span> kern_return_t <span class="enscript-function-name">upl_transpose</span>(
	upl_t	upl1,
	upl_t	upl2);

<span class="enscript-type">extern</span> kern_return_t <span class="enscript-function-name">mach_vm_pressure_monitor</span>(
	boolean_t	wait_for_pressure,
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	nsecs_monitored,
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	*pages_reclaimed_p,
	<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>	*pages_wanted_p);

<span class="enscript-type">extern</span> kern_return_t
<span class="enscript-function-name">vm_set_buffer_cleanup_callout</span>(
	boolean_t	(*func)(<span class="enscript-type">int</span>));

<span class="enscript-type">struct</span> vm_page_stats_reusable {
	SInt32		reusable_count;
	uint64_t	reusable;
	uint64_t	reused;
	uint64_t	reused_wire;
	uint64_t	reused_remove;
	uint64_t	all_reusable_calls;
	uint64_t	partial_reusable_calls;
	uint64_t	all_reuse_calls;
	uint64_t	partial_reuse_calls;
	uint64_t	reusable_pages_success;
	uint64_t	reusable_pages_failure;
	uint64_t	reusable_pages_shared;
	uint64_t	reuse_pages_success;
	uint64_t	reuse_pages_failure;
	uint64_t	can_reuse_success;
	uint64_t	can_reuse_failure;
	uint64_t	reusable_reclaimed;
};
<span class="enscript-type">extern</span> <span class="enscript-type">struct</span> vm_page_stats_reusable vm_page_stats_reusable;
	
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> <span class="enscript-function-name">hibernate_flush_memory</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">hibernate_reset_stats</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">hibernate_create_paddr_map</span>(<span class="enscript-type">void</span>);

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">vm_set_restrictions</span>(<span class="enscript-type">void</span>);

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> vm_compressor_mode;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> vm_compressor_thread_count;
<span class="enscript-type">extern</span> boolean_t vm_restricted_to_single_processor;
<span class="enscript-type">extern</span> boolean_t vm_compressor_immediate_preferred;
<span class="enscript-type">extern</span> boolean_t vm_compressor_immediate_preferred_override;
<span class="enscript-type">extern</span> kern_return_t <span class="enscript-function-name">vm_pageout_compress_page</span>(<span class="enscript-type">void</span> **, <span class="enscript-type">char</span> *, vm_page_t, boolean_t);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">vm_pageout_anonymous_pages</span>(<span class="enscript-type">void</span>);


#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_PAGER_DEFAULT</span>				0x1	<span class="enscript-comment">/* Use default pager. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_PAGER_COMPRESSOR_NO_SWAP</span>			0x2	<span class="enscript-comment">/* In-core compressor only. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_PAGER_COMPRESSOR_WITH_SWAP</span>			0x4	<span class="enscript-comment">/* In-core compressor + swap backend. */</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_PAGER_FREEZER_DEFAULT</span>			0x8	<span class="enscript-comment">/* Freezer backed by default pager.*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_PAGER_FREEZER_COMPRESSOR_NO_SWAP</span>		0x10	<span class="enscript-comment">/* Freezer backed by in-core compressor only i.e. frozen data remain in-core compressed.*/</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_PAGER_FREEZER_COMPRESSOR_WITH_SWAP</span>		0x20	<span class="enscript-comment">/* Freezer backed by in-core compressor with swap support too.*/</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">VM_PAGER_MAX_MODES</span>				6	<span class="enscript-comment">/* Total number of vm compressor modes supported */</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DEFAULT_PAGER_IS_ACTIVE</span>		((vm_compressor_mode &amp; VM_PAGER_DEFAULT) == VM_PAGER_DEFAULT)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">COMPRESSED_PAGER_IS_ACTIVE</span>	(vm_compressor_mode &amp; (VM_PAGER_COMPRESSOR_NO_SWAP | VM_PAGER_COMPRESSOR_WITH_SWAP))
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">COMPRESSED_PAGER_IS_SWAPLESS</span>	((vm_compressor_mode &amp; VM_PAGER_COMPRESSOR_NO_SWAP) == VM_PAGER_COMPRESSOR_NO_SWAP)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">COMPRESSED_PAGER_IS_SWAPBACKED</span>	((vm_compressor_mode &amp; VM_PAGER_COMPRESSOR_WITH_SWAP) == VM_PAGER_COMPRESSOR_WITH_SWAP)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DEFAULT_FREEZER_IS_ACTIVE</span>	((vm_compressor_mode &amp; VM_PAGER_FREEZER_DEFAULT) == VM_PAGER_FREEZER_DEFAULT)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DEFAULT_FREEZER_COMPRESSED_PAGER_IS_ACTIVE</span>		(vm_compressor_mode &amp; (VM_PAGER_FREEZER_COMPRESSOR_NO_SWAP | VM_PAGER_FREEZER_COMPRESSOR_WITH_SWAP))
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DEFAULT_FREEZER_COMPRESSED_PAGER_IS_SWAPLESS</span>		((vm_compressor_mode &amp; VM_PAGER_FREEZER_COMPRESSOR_NO_SWAP) == VM_PAGER_FREEZER_COMPRESSOR_NO_SWAP)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DEFAULT_FREEZER_COMPRESSED_PAGER_IS_SWAPBACKED</span>		((vm_compressor_mode &amp; VM_PAGER_FREEZER_COMPRESSOR_WITH_SWAP) == VM_PAGER_FREEZER_COMPRESSOR_WITH_SWAP)


#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* KERNEL_PRIVATE */</span>

#<span class="enscript-reference">endif</span>	<span class="enscript-comment">/* _VM_VM_PAGEOUT_H_ */</span>
</pre>
<hr />
</body></html>